{"version":3,"mappings":"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6iB,EAAaqD,GACjBlmB,EACAiH,EAAajH,CAAI,EACjBmmB,EACAC,CAEF,EACA4B,EAAY,IAAIhoB,EAAM6iB,CAAU,CAClC,CAAC,EAEMmF,CACT,CCpZA,MAAMC,GAAkB,CACtB,SAAU,CACR,KAAM,KACN,SAAU,CACR,QACA,MACA,QACA,UACA,UACA,UACA,OACA,MACA,OACA,OACA,OACA,YAEF,kBAAmB,CAAC,KAAK,GAE3B,SAAU,CACR,KAAM,QACN,SAAU,CACR,OACA,MACA,OACA,MACA,OACA,QACA,OACA,KACA,OACA,QACA,QACA,UAEF,kBAAmB,CAAC,IAAI,GAE1B,KAAM,CACJ,KAAM,KACN,SAAU,CACR,MACA,QACA,UACA,UACA,OACA,QACA,OACA,QACA,WACA,YACA,SACA,QACA,aAEF,kBAAmB,CAAC,KAAM,IAAI,GAEhC,QAAS,CACP,KAAM,KACN,SAAU,CACR,QACA,QACA,SACA,QACA,QACA,MACA,OACA,OACA,OACA,UACA,eAEF,kBAAmB,CAAC,MAAO,IAAI,GAEjC,KAAM,CACJ,KAAM,MACN,SAAU,CACR,OACA,MACA,QACA,OACA,OACA,YACA,QACA,SACA,SACA,UACA,aAEF,kBAAmB,CAAC,KAAM,KAAM,KAAK,GAEvC,OAAQ,CACN,KAAM,KACN,SAAU,CACR,OACA,SACA,WACA,QACA,MACA,MACA,MACA,OACA,OACA,SACA,QACA,UAEF,kBAAmB,CAAC,IAAI,GAE1B,OAAQ,CACN,KAAM,UACN,SAAU,CACR,SACA,SACA,SACA,UACA,SACA,SACA,QACA,SACA,UACA,WAEF,kBAAmB,CAAC,IAAI,GAE1B,KAAM,CACJ,KAAM,SACN,SAAU,CACR,MACA,QACA,QACA,OACA,OACA,OACA,QACA,OACA,OACA,MACA,OACA,UAEF,kBAAmB,CAAC,KAAK,GAE3B,cAAe,CACb,KAAM,YACN,SAAU,CACR,MACA,QACA,OACA,OACA,MACA,SACA,SACA,OACA,QACA,OACA,OACA,SAEF,kBAAmB,CAAC,IAAI,GAE1B,SAAU,CACR,KAAM,KACN,SAAU,CACR,QACA,QACA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AS,gBAEX,CACE,KAAM,iBACN,QACE,8EACF,QAAS,WAEX,CACE,KAAM,iBACN,QAAS,sDACT,QAAS,iBAEb,EAGMC,GAAqC,CACzC,CACE,KAAM,WACN,QACE,sEACF,QAAS,aAEX,CACE,KAAM,WACN,QACE,gDACF,QAAS,WAEX,CACE,KAAM,WACN,QACE,oFACF,QAAS,gBAEX,CACE,KAAM,WACN,QACE,6EACF,QAAS,sBAEX,CACE,KAAM,WACN,QACE,6EACF,QAAS,aAEX,CACE,KAAM,WACN,QACE,sFACF,QAAS,WAEX,CACE,KAAM,WACN,QACE,6EACF,QAAS,gBAEX,CACE,KAAM,WACN,QAAS,qDACT,QAAS,kBAEX,CACE,KAAM,WACN,QACE,+DACF,QAAS,aAEX,CACE,KAAM,WACN,QACE,kEACF,QAAS,qBAEb,EAiDMC,GAAiC,CACrC,CACE,KAAM,WACN,QACE,gEACF,QAAS,gBAEX,CACE,KAAM,WACN,QACE,kEACF,QAAS,aAEX,CACE,KAAM,WACN,QACE,sEACF,QAAS,WAEX,CACE,KAAM,WACN,QACE,4EACF,QAAS,sBAEX,CACE,KAAM,WACN,QACE,6DACF,QAAS,gBAEX,CACE,KAAM,WACN,QAAS,2DACT,QAAS,kBAEX,CACE,KAAM,WACN,QACE,qEACF,QAAS,YAEb,EAGMC,GAAkC,CACtC,CACE,KAAM,YACN,QACE,uEACF,QAAS,aAEX,CACE,KAAM,YACN,QACE,oEACF,QAAS,WAEX,CACE,KAAM,YACN,QACE,+EACF,QAAS,gBAEX,CACE,KAAM,YACN,QACE,uEACF,QAAS,aAEX,CACE,KAAM,YACN,QACE,+DACF,QAAS,sBAEX,CACE,KAAM,YACN,QACE,8EACF,QAAS,WAEX,CACE,KAAM,YACN,QACE,gEACF,QAAS,gBAEX,CACE,KAAM,YACN,QACE,6EACF,QAAS,YAEb,EAGMC,GAAgC,CACpC,CACE,KAAM,cACN,QACE,gEACF,QAAS,gBAEX,CACE,KAAM,cACN,QACE,4DACF,QAAS,kBAEX,CACE,KAAM,cACN,QACE,0EACF,QAAS,WAEX,CACE,KAAM,cACN,QACE,o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,CAIJ,MAAQ,CAGN,OAAAx4C,EAAO,IACL,qCAAqCm3C,CAAS,yDAEzC,IACT,CACF,CAMA,eAAsBqC,GACpBpB,EAC2B,OAC3B,MAAMhB,EAAWH,GAAA,EACX5oC,EAA6B,GAEnCrO,EAAO,IAAI,WAAWo3C,EAAS,MAAM,cAAc,EAEnD,UAAWqC,KAAQrC,EAAU,CAE3B,IAAI7oC,EAAU,MAAMgrC,GAAuBE,EAAK,EAAE,EAG7ClrC,IACHA,EAAU,MAAM4pC,GAA8BsB,EAAK,GAAIrB,CAAc,GAGnE7pC,GACFvO,EAAO,IAAI,qBAAqBy5C,EAAK,EAAE,OAAK98B,EAAApO,EAAQ,UAAR,YAAAoO,EAAiB,SAAU,CAAC,WAAW,EACnFtO,EAAS,KAAKE,CAAO,GAErBvO,EAAO,MAAM,6BAA6By5C,EAAK,EAAE,EAAE,CAEvD,CAEA,OAAAz5C,EAAO,IAAI,0BAA0BqO,EAAS,MAAM,EAAE,EAC/CA,CACT,CCzdA,MAAMqrC,OAAY,IAAI,CACpB,KACA,KACA,KACA,MACA,MACA,OACA,OACA,QACA,OACA,MACA,MACA,SACA,KACA,OACA,MACA,OACA,QACA,MACA,QACA,OACA,QACA,QACA,SACA,MACA,QACA,OACA,KACA,OACA,OACA,OACA,QACA,MACA,OACA,MACA,SACA,UACA,OACA,QACA,OACA,SACA,OACA,QACA,OACA,QACA,SACA,MACA,OACA,MACA,OACA,SACA,OACA,QACA,OACA,SACA,OACA,QACA,SACA,UACA,MACA,OACA,OACA,QACA,OACA,QACA,QACA,UACA,OACA,QACA,OACA,QACA,SACA,OACA,QACA,OACA,UACA,OACA,QACA,SACA,UACA,OACA,QACA,SACA,UACA,MACA,QACA,QACA,SACA,MACA,OACA,QACA,SACA,OACA,QACA,SACA,UACA,OACA,QACA,OACA,UACA,SACA,UACA,SACA,WACA,QACA,SACA,OACA,UACA,MACA,OACA,UACA,OACA,QACA,QACA,UACA,OACA,QACA,OACA,UACA,MACA,OACA,UACA,QACA,SACA,QACA,QACA,YACA,OACA,QACA,SACA,UACA,OACA,QACA,SACA,UACA,OACA,QACA,SACA,UACA,OACA,QACA,SACA,UACA,QACA,SACA,UACA,WACA,OACA,QACA,SACA,QACA,UACA,OACA,QACA,QACA,UACA,OACA,QACA,SACA,UACA,MACA,OACA,MACA,UACA,OACA,QACA,QACA,SACA,OACA,QACA,QACA,SACA,OACA,QACA,QACA,SACA,UACA,WACA,WACA,YACA,QACA,SACA,UACA,WACA,SACA,UACA,WACA,YACA,QACA,SACA,QACA,UACA,UACA,MACA,OACA,MACA,UACA,QACA,SACA,QACA,WACA,OACA,QACA,OACA,SACA,MACA,OACA,OACA,SACA,OACA,QACA,MACA,UACA,UACA,WACA,WACA,YACA,WACA,YACA,YACA,aACA,MACA,OACA,UACA,QACA,SACA,UACA,WACA,SACA,UACA,UACA,WACA,OACA,QACA,MACA,UACA,aACA,cACA,aACA,gBACA,QACA,UACA,UACA,WACA,SACA,UACA,WACA,YACA,OACA,QACA,UACA,WACA,SACA,UACA,UACA,WACA,QACA,SACA,QACA,SACA,WACA,OACA,QACA,UACA,QACA,SACA,QACA,WACA,OACA,QACA,OACA,QACA,UACA,OACA,QACA,SACA,UACA,OACA,QACA,SACA,UACA,MACA,OACA,MACA,UACA,QACA,UACA,SACA,WACA,QACA,SACA,UACA,WACA,WACA,YACA,aACA,cACA,WACA,YACA,aACA,cACA,SACA,UACA,WACA,YACA,MACA,OACA,SACA,SACA,QACA,SACA,SACA,UACA,MACA,OACA,OACA,QACA,OACA,QACA,OACA,UACA,QACA,SACA,QACA,WACA,OACA,QACA,SACA,UACA,OACA,QACA,OACA,SACA,UACA,MACA,OACA,UACA,QACA,UACA,UACA,WACA,OACA,QACA,SACA,UACA,QACA,SACA,SACA,UACA,OACA,SACA,SACA,UACA,OACA,QACA,OACA,UACA,SACA,UACA,UACA,WACA,SACA,UACA,WACA,YACA,UACA,WACA,YACA,aACA,OACA,QACA,QACA,SACA,UACA,WACA,YACA,aACA,QACA,UACA,UACA,WACA,QACA,SACA,QACA,SACA,WACA,UACA,WACA,WACA,YACA,QACA,SACA,SACA,WACA,UACA,WACA,YACA,aACA,MACA,OACA,UACA,UACA,WACA,WACA,YACA,MACA,OACA,MACA,QACA,SACA,QACA,SACA,UACA,WACA,QACA,UACA,SACA,WACA,OACA,QACA,OACA,QACA,UACA,OACA,QACA,OACA,QACA,SACA,QACA,UACA,UACA,WACA,OACA,SACA,SACA,UACA,UACA,WACA,WACA,YACA,QACA,SACA,UACA,UACF,CAAC,EAEKC,OAAmB,IAAI,CAC3B,KACA,KACA,KACA,KACA,MACA,OACA,OACA,KACA,QACA,KACA,OACA,OACA,UACA,QACA,OACA,UACA,MACA,UACA,SACA,UACA,SACA,QACA,SACA,QACA,KACA,IACF,CAAC,EAEKC,OAAmB,IAAI,CAC3B,MACA,MACA,KACA,KACA,MACA,MACA,MACA,UACA,WACA,KACA,OACA,QACA,QACA,SACA,OACA,QACA,MACA,OACA,QACA,OACF,CAAC,EAEKC,OAAkB,IAAI,CAC1B,MACA,IACA,KACA,OACA,OACA,QACA,QACA,KACA,OACA,MACA,MACA,MACA,MACA,QACA,OACA,MACA,KACA,QACA,OACA,SACA,UACA,OACA,OACA,OACA,OACA,MACA,SACA,SACF,CAAC,EAEKC,OAAe,IAAI,CACvB,IACA,MACA,KACA,MACA,KACA,KACA,OACA,KACA,MACA,MACA,KACA,OACA,SACA,WACA,UACA,UACA,SACA,YACA,YACF,CAAC,EAEKC,OAAiB,IAAI,CACzB,OACA,MACA,QACA,OACA,OACA,QACA,SACA,MACA,QACA,MACA,QACA,MACA,OACA,YACA,QACA,QACA,OACA,QACA,QACA,YACA,MACA,SACA,MACA,OACA,OACA,QACA,QACA,QACA,OACF,CAAC,EAEKC,OAAc,IAAI,CACtB,MACA,KACA,KACA,MACA,OACA,MACA,MACA,OACA,OACA,OACA,OAC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AAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;AAAA;A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","names":["m","require$$0","client","OFFICIAL_CATEGORIES","isValidCategory","category","isDebugMode","logger","args","DB_NAME","DB_VERSION","STORES","isIndexedDBSupported","dbInstance","initDB","resolve","reject","request","event","db","historyStore","getFromDB","storeName","key","error","putToDB","value","store","deleteDatabase","MIGRATION_FLAG_KEY","MIGRATION_VERSION","isMigrationCompleted","setMigrationCompleted","getLocalStorageData","data","getLocalStorageRawData","_error","migrateProgressData","progressData","initialData","migrateSessionHistory","modes","totalMigrated","mode","history","item","migrateDailyStats","now","ninetyDaysAgo","migratedCount","cleanedCount","i","dateStr","stats","migrateSettings","jsonSettingsKeys","rawSettingsKeys","planKey","goalKey","planValue","goalValue","verifyMigration","migrateToIndexedDB","results","labels","result","index","r","useIndexedDB","initStorageStrategy","saveProgressData","fallbackError","loadProgressData","fallbackData","saveSetting","loadSetting","DEFAULT_STUDY_SETTINGS","getStudySettings","stored","e","SESSION_HISTORY_KEY","MAX_SESSION_HISTORY","addSessionHistory","getTodayIncorrectWords","progress","loadProgressSync","today","incorrectWords","word","getTodayStats","tomorrow","todayResults","todayCorrectCount","sum","todayTotalAnswered","todayAccuracy","getWeeklyStats","currentDay","mondayOffset","weekStart","weekEnd","lastWeekStart","lastWeekEnd","thisWeekResults","lastWeekResults","studyDatesThisWeek","date","totalAnswered","totalCorrect","accuracy","lastWeekTotalAnswered","lastWeekTotalCorrect","previousWeekAccuracy","newMastered","wp","getMonthlyStats","monthStart","monthEnd","thisMonthResults","studyDatesThisMonth","totalDays","getDetailedRetentionStats","allWords","appearedWords","masteredCount","learningCount","strugglingCount","totalAttempts","total","weightedScore","getNearMasteryStats","nearMasteryCount","totalRemaining","longTermMemoryCount","superMemoryCount","checkFlexibleMastery","consecutiveCorrect","getRecentlyMasteredWords","days","limit","cutoff","_","a","b","getGrammarDetailedRetentionStats","grammarQuestions","appearedQuestions","correctCount","getMemorizationDetailedRetentionStats","memorizationWords","stillLearningCount","effectiveCorrect","getGrammarUnitStats","unitMap","match","grade","unit","unitKey","unitData","incorrectCount","recentHistory","isMarkedAsMastered","isOneShot","isStableAccuracy","historyIcons","STORAGE_KEY","MAX_RESULTS","MAX_RESPONSE_TIMES","initializeProgress","loadProgress","initialized","updateProgressCache","rawData","compressProgressData","progressCache","ensureProgressCache","saveProgress","addQuizResult","updateStatistics","evt","QUIZ_RESULT_EVENT","calculateStreakDays","setStats","setResults","totalScore","studyDates","yesterday","latestStudy","streak","getOvercomeWeakWords","wordMistakes","overcomeWords","mistakes","hasHighAccuracy","isCurrentlyMastered","overcomeScore","getCurrentWeakWords","currentWeakWords","isFirstTimeCorrect","initializeWordProgress","calculateDifficultyScore","wordProgress","baseScore","consecutivePenalty","avgTime","timePenalty","userRatingBonus","finalScore","calculateExponentialInterval","intervals","isCorrect","lastStudied","daysSinceLastStudy","excludeDays","masteryLevel","reason","baseInterval","determineMasteryLevel","isTwoShotPerfect","isHighAccuracy","isStrongStreak","isLongTermLearning","updateWordProgress","responseTime","userRating","_mode","isStillLearning","ef","newInterval","previousInterval","oldMasteryLevel","masteryResult","removeFromReadingUnknownWords","questionSetName","readingDataKey","storedData","passages","modified","passage","phrase","segment","err","recordWordSkip","isWordSkipExcluded","filterSkippedWords","questions","q","getWordProgress","getAllWordProgress","recordConfusion","confusedWord","actualWord","getConfusedWords","countDiff","getTotalAnsweredCount","getUniqueQuestionedWordsCount","uniqueWords","hasBeenAnswered","hasBeenSkipped","getTotalMasteredWordsCount","isConsecutivelyCorrect","isSkipped","getRetentionRateWithAI","retentionRate","normalizedRetentionRate","resetAllProgress","keysToRemove","initialProgress","getStudyCalendarData","calendarData","formatLocalYYYYMMDD","dayStart","dayEnd","dayResults","getCumulativeProgressData","weeks","cumulativeMastered","cumulativeAnswered","weeklyAnswered","weeklyMastered","weekLabel","getRetentionTrend","day7Ago","day30Ago","words7Days","mastered7Days","words30Days","mastered30Days","wordsAllTime","masteredAllTime","getWordDetailedData","totalCount","accuracyHistory","h","baseAccuracy","consecutiveBonus","daysSinceStudy","status","statusLabel","statusIcon","saveMemorizationCardSettings","settings","getMemorizationCardSettings","saveMemorizationSettings","getMemorizationSettings","recordMemorizationBehavior","behavior","existingBehaviors","updated","CUSTOM_QUESTION_SETS_KEY","getCustomQuestionSets","saveCustomQuestionSet","questionSet","sets","existingIndex","s","createWeakWordsQuestionSet","name","minMistakes","maxAccuracy","allQuestions","w","questionData","getGrammarRetentionRateWithAI","getGrammarUnitStatsWithTitles","baseStats","stat","unitNum","res","parseCSV","csvText","lines","parseCSVLine","line","current","inQuotes","char","nextChar","startIndex","firstLine","columns","reading","meaning","etymology","relatedWords","relatedFields","difficultyRaw","difficulty","shuffle","array","newArray","j","generateChoicesWithQuestions","currentQuestion","currentIndex","wrongQuestions","otherQuestions","idx","shuffledOthers","wrongQuestion","QUESTION_SETS_KEY","saveQuestionSets","d","y","day","generateId","selectWeakQuestions","count","weakWords","weakQuestions","classifyPhraseType","lowerPhrase","words","commonVerbs","particles","pattern","getPhase","dayNumber","phase1End","phase2End","getUnlearnedWords","allProgress","progressMap","getReviewDueWords","dueInterval","selectNewWordsForPhase","unlearnedWords","phase","filtered","beginner","intermediate","mid","adv","generateDailyPlan","schedule","reviewDueWords","morningCount","morningWords","afternoonCount","afternoonWords","eveningNewCount","eveningReviewCount","eveningWords","calculateProgress","totalLearned","totalReviewed","averageAccuracy","dailyAverage","estimatedDays","calculateWeeklyAchievement","weekNumber","targetPerWeek","weekProgress","useQuizSettings","autoAdvance","useState","saved","autoAdvanceDelay","useQuizFilters","categoryList","setCategoryList","selectedCategory","setSelectedCategory","selectedDifficulty","setSelectedDifficulty","selectedWordPhraseFilter","setSelectedWordPhraseFilter","selectedPhraseTypeFilter","setSelectedPhraseTypeFilter","selectedDataSource","setSelectedDataSource","useQuizState","sessionStats","setSessionStats","quizState","setQuizState","reviewFocusMode","setReviewFocusMode","reviewQuestionPool","setReviewQuestionPool","reviewCorrectStreak","setReviewCorrectStreak","loadCustomQuestionState","parsed","saveCustomQuestionState","state","createCustomQuestionSet","description","icon","color","addWordToSet","setId","set","updateRecentSetIds","removeWordFromSet","deleteCustomQuestionSet","id","updateCustomQuestionSet","updates","recentSetIds","calculateForgettingRisk","reviewInterval","risk","calculateOptimalInterval","easinessFactor","getWordStatus","_a","modeKey","attempts","correct","stillLearning","forgettingRisk","sortQuestionsByPriority","options","isReviewFocusMode","learningLimit","reviewLimit","questionsWithStatus","counts","shouldFocusOnStillLearning","shouldFocusOnIncorrect","totalStudied","needsReview","shouldSuppressNew","effectiveLimit","concentrationThreshold","newQuestionThreshold","hasLargeIncorrectBacklog","canIntroduceNewQuestions","sortedQuestions","statusA","statusB","priorityA","priorityB","hasSessionPriorityA","hasSessionPriorityB","riskA","riskB","lastStudiedA","lastStudiedB","sessionPriorityQuestions","reviewQuestions","newQuestions","reviewIndex","newIndex","useQuestionRequeue","reAddQuestion","useCallback","question","qid","reAddedQuestion","windowEnd","prevCount","offset","insertPosition","clearExpiredFlags","sessionPriority","rest","isReviewQuestion","updateRequeueStats","currentStats","setter","isReview","prev","SessionKpi","__publicField","lag","items","shownTwice","x","reappearanceRate","allLags","medianLag","p90Lag","sessionKpi","SKIP_GROUP_KEY","SKIP_GROUP_TIME_WINDOW","loadSkipGroups","saveSkipGroups","groups","addToSkipGroup","currentGroup","g","handleSkippedWordIncorrect","group","suspiciousWord","handleSkippedWordCorrect","analyzeRadarChart","categoryStats","isDefinitelyMastered","isLikelyMastered","weakCategories","strongCategories","masteryRate","overallScore","weaknessLevel","priorityScore","strengthLevel","balanceScore","calculateBalanceScore","improvementPlan","generateImprovementPlan","aiRecommendations","generateAIRecommendations","accuracies","mean","val","variance","stdDev","targetCategories","dailyQuestions","milestones","topWeak","weak","questionsPerDay","milestone","estimatedCompletionDays","recommendations","topStrong","cat","prioritizeWeakCategoryQuestions","targetCount","prioritized","categoryQuotas","totalPriority","quota","categoryQuestions","unmastered","selected","shuffleArray","remainingCount","weakCategorySet","selectedWords","remaining","shuffled","saveImprovementProgress","analysis","getImprovementProgress","updateImprovementProgress","currentAnalysis","daysSinceStart","completedCount","improvement","analyzeLearningHistory","allAttempts","learningCurve","calculateLearningCurve","confusedWith","extractConfusionPatterns","predictionModel","buildPredictionModel","windowSize","start","window","recentAttempts","recentAccuracies","acc","stabilityScore","recentCorrectRate","stage","incorrectAttempts","forgettingCount","typicalDecayDays","currentProgress","attemptsToMastery","estimatedDaysToMastery","confusionMap","attempt","_wordProgress","recent5","recentAccuracy","stabilityFactor","timeSinceLastStudy","recentConfusions","confusionRisk","probability","decayFactor","confidence","calculateQuestionPriorities","wordProgressMap","learningHistories","priorities","priority","calculateSingleWordPriority","curve","prediction","daysSince","isOptimalTiming","optimalInterval","currentInterval","isNearOptimal","planConsolidationSequence","strugglingWords","sessionLength","struggling","p","sequence","topStruggling","improving","calculateCognitiveLoad","responses","sessionStartTime","sessionDuration","last5","last10","last5Accuracy","last10Accuracy","isDecreasing","averageResponseTime","recentResponseTimes","responseTimeIncrease","calculateTrend","fatigueLevel","concentrationLevel","hour","timeOfDay","breakRecommendation","determineBreakRecommendation","values","recent","earlier","recentAvg","v","earlierAvg","adjustDifficultyByCognitiveLoad","cognitiveLoad","adjustByTimeOfDay","generateFatigueMessage","analyzeErrorPatterns","recentAnswers","errorsByPattern","confusionPairs","totalErrors","recentErrorRate","isSpellingError","existingPair","last5ErrorRate","errorTrend","predictErrorRisk","errorAnalysis","currentFatigue","recentErrors","riskFactors","baseRisk","errorRate","last3","last3ErrorRate","daysSinceReview","confusionPair","otherWord","fatigueRisk","errorRisk","warningLevel","suggestedSupport","generateSupportStrategy","calculatePredictionConfidence","hints","reviewWords","warningMessage","confidenceBooster","factor","riskFactorCount","correctWord","userAnswer","distance","calculateLevenshteinDistance","matrix","batchPredictErrors","predictions","SEMANTIC_THEMES","ANTONYM_PAIRS","SYNONYM_GROUPS","generateSemanticClusters","clusters","processedWords","themeId","theme","themeWords","keyword","pair","word1","word2","matchingWords","categoryMap","detectWordRelations","w1","w2","matchesTheme1","k","matchesTheme2","generateContextualSequence","recentlyStudied","transitions","used","cluster","availableWords","progressA","progressB","errorRateA","prevWord","relation","getTimeOfDay","timestamp","recordSessionStats","startTime","endTime","questionsAnswered","correctAnswers","newWordsLearned","reviewedWords","duration","analyzeTimeOfDayPerformance","sessions","timeSessions","totalQuestions","averageFatigue","totalNewWords","totalReviewWords","accuracyScore","speedScore","fatigueScore","efficiencyScore","analyzeSessionLength","currentAverageDuration","performanceByDuration","range","rangeSessions","avgAccuracy","avgFatigue","efficiency","bestRange","best","optimalDuration","recommendation","determineLearningStyle","avgDuration","dates","avgSessionsPerDay","generateLearningStyleProfile","userId","primaryStyle","timePerformance","sessionLengthAnalysis","bestTimeOfDay","optimalSessionLength","optimalDailyFrequency","strengths","improvements","_b","_c","personalizedRecommendations","saveSessionToHistory","session","trimmed","loadSessionHistory","generateRecommendationMessage","profile","currentTimeOfDay","isBestTime","timeNames","BADGE_DEFINITIONS","XP_PER_LEVEL","level","XP_REWARDS","loadGamificationStats","c","generateInitialMilestones","saveGamificationStats","addExperience","xp","newStats","leveledUp","newLevel","updateStreak","lastDate","yesterdayStr","newCurrent","checkAndAwardBadges","sessionData","newBadges","earnedBadgeTypes","awardBadge","type","badge","highAccuracySessions","updateMilestones","completedMilestones","updatedMilestones","completed","processSessionEnd","avgResponseTime","wordsLearned","feedback","totalXP","oldStreak","perfectScore","focused","badgeResult","milestoneResult","xpResult","getMotivationalMessage","messages","randomChoice","arr","analyzeLearningPattern","recentResults","older","newer","olderAvg","recentImprovement","uniqueDates","consistencyScore","DrillSergeantCommentGenerator","ctx","parts","KindTeacherCommentGenerator","AnalystCommentGenerator","newAccuracy","newCatAccuracy","EnthusiasticCoachCommentGenerator","exclamations","WiseSageCommentGenerator","generateAIComment","personality","context","generator","PERSONALITY_INFO","getLastLoginDate","getConsecutiveDays","getDaysSinceLastLogin","lastLogin","diffTime","getTodayStudyStats","generateTimeBasedGreeting","consecutive","generateReturningGreeting","generateStreakGreeting","generateTimeGreeting","todayStudyCount","getDrillSergeantTimeGreeting","getKindTeacherTimeGreeting","getAnalystTimeGreeting","getEnthusiasticCoachTimeGreeting","getWiseSageTimeGreeting","_accuracy","generateTeacherInteraction","currentPersonality","interactions","getInteractionPatterns","mainTeacher","patterns","commonPatterns","getTimeBasedTeacherChat","morning","lunch","evening","lateNight","getTeacherReactionToStreak","getSpecialDayChat","month","ENGLISH_COMMON_MISTAKES","ENGLISH_FUN_FACTS","CULTURAL_TIPS","ETYMOLOGY_TIPS","GRAMMAR_TIPS","getRelevantMistakeTip","tips","getBreatherTrivia","_personality","currentWord","isPhrase","breathers","ScoreBoard","currentScore","sessionCorrect","_sessionIncorrect","_sessionReview","onReviewFocus","onShowSettings","onAnswerTime","lastAnswerCorrect","lastAnswerWord","lastAnswerDifficulty","correctStreak","incorrectStreak","learningPhase","estimatedSpeed","forgettingRate","dataSource","wordPhraseFilter","grammarUnit","activeTab","setActiveTab","questionComment","setQuestionComment","answerComment","setAnswerComment","useEffect","wordData","comment","wasCorrect","todayStats","todayQuestions","userAccuracy","additionalMessages","trivia","specialChat","teacherChat","masteredRef","useRef","learningRef","strugglingRef","setLearningLimit","setReviewLimit","stillLearningLimit","setStillLearningLimit","incorrectLimit","setIncorrectLimit","showPlanSettings","setShowPlanSettings","incorrect","review","totalNeedReview","retentionData","setRetentionData","appearedCount","detailedStatsData","setDetailedStatsData","currentWordData","setCurrentWordData","attemptCounts","useMemo","grammarUnitStats","setGrammarUnitStats","targetUnit","masteredWidth","learningWidth","strugglingWidth","_todayAccuracy","_todayTotalAnswered","_retentionRate","detailedStats","jsxs","jsx","Fragment","finalValue","answeredQuestions","gradeMatch","gradeDisplay","unitMatch","unitDisplay","planDisplay","GOAL_LEVELS","getCurrentGoal","goalId","goal","calculateGoalProgress","targetGoal","currentWords","currentAccuracy","wordsProgress","accuracyProgress","overallProgress","isAchieved","estimatedDaysToAchieve","calculateEstimatedDays","remainingWords","recommendedDailyWords","requiredWords","requiredAccuracy","sevenDaysAgo","recentMastered","dailyMasteryRate","effectiveDailyRate","daysForWords","daysForAccuracy","generateGoalMessage","includeEncouragement","goalProgress","CONFUSION_PAIRS","getConfusionPartners","lowerWord","analyzeConfusionPatterns","partners","groupWords","confusionScore","getConfusionDescription","calculateGroupRetention","individualRetentions","retentions","retention","groupRetention","generateConfusionAdvice","cleanDialogueText","text","quotedPattern","quotedMatch","unquotedPattern","unquotedMatch","speakEnglish","cleanedText","startSpeech","utterance","savedRate","savedGender","englishVoices","voice","highQualityVoices","femaleVoice","hq","maleVoice","bestVoice","isSpeechSynthesisSupported","stopSpeaking","pauseSpeaking","resumeSpeaking","isSpeaking","isPaused","AddToCustomButton","onAddWord","onRemoveWord","onOpenManagement","size","variant","showMenu","setShowMenu","containingSets","isInAnySet","sizeClasses","iconSizeClasses","handleToggle","handleSelectSet","isInSet","isInThisSet","QuestionCard","answered","selectedAnswer","onAnswer","onNext","onPrevious","_onDifficultyRate","customQuestionSets","onAddWordToCustomSet","onRemoveWordFromCustomSet","onOpenCustomSetManagement","onFullscreen","choicesWithQuestions","_userRating","setUserRating","expandedChoices","setExpandedChoices","_aiComment","setAiComment","attemptCount","setAttemptCount","setCorrectStreak","touchStartX","touchEndX","cardRef","isTouchingRef","toggleChoiceDetails","newSet","autoShowDetails","currentStreak","additionalComments","confusionPartners","relevantGroup","interaction","streakReaction","newStreak","handleNextClick","handleTouchStart","target","handleTouchMove","handleTouchEnd","swipeDistance","card","handleKeyDown","choice","choiceQuestion","getButtonClass","baseClasses","hoverClasses","activeClasses","isExpanded","LIMIT_OPTIONS","LearningLimitsInput","onLearningLimitChange","onReviewLimitChange","idPrefix","option","useLearningLimits","setLearningLimitState","setReviewLimitState","validValue","LearningPhase","DEFAULT_PHASE_THRESHOLDS","MAX_DAYS_THRESHOLD","MASTERY_THRESHOLD","RESET_THRESHOLD","MIN_RESPONSE_TIME","MAX_RESPONSE_TIME","DEFAULT_RESPONSE_TIME","LearningPhaseDetector","personalParams","customThresholds","baseThresholds","cached","lastReviewTime","lastCorrectTime","timeSinceLastReview","daysSinceLastReview","correctRate","metrics","hoursSinceCorrect","targetPhase","currentPhase","phaseOrder","targetIndex","timestamp1","timestamp2","date1","date2","QueueType","QuestionCategory","DEFAULT_TAB_CONFIGS","MAX_QUEUE_SIZE","QUEUE_EXPIRY_TIME","MAX_SAME_WORD_ATTEMPTS","AcquisitionQueueManager","customConfigs","config","gap","entry","currentQ","candidates","currentQueue","finalDifficulty","finalCategory","endQueue","incomplete","_d","threshold","recentReviews","queueType","queue","maxSize","queueName","DEFAULT_RETENTION_CONFIG","MemoryRetentionManager","customConfig","alpha","wordList","currentTime","dueWords","reviewDates","nextDate","endDate","totalRetention","totalEaseFactor","totalInterval","dueCount","overdueCount","wellLearnedCount","daysUntilReview","decay","overdueDays","sm2","quality","newEF","wrongImpact","responseImpact","consecutiveWrongImpact","DEFAULT_ESTIMATION_CONFIG","DEFAULT_PERSONAL_PARAMETERS","PersonalParameterEstimator","fullHistory","params","wordTrials","wordFirstCorrect","record","trials","averageTrials","t","wordLastCorrect","retentionPeriods","periodDays","averagePeriod","wordConsecutiveCorrect","wordMaxConsecutive","consolidationCounts","max","averageCount","responseTimes","fastThreshold","slowThreshold","coefficientOfVariation","sampleSize","DEFAULT_HYBRID_STRATEGY","HybridQuestionSelector","strategy","queuedQuestion","candidate","breakdown","positionBonus","timeDiff","hoursOverdue","hoursEarly","newWords","acquisitionRatio","questionNumber","_breakdown","reasons","diff","hours","convertToQuestionStatus","useAdaptiveLearning","sessionId","phaseDetectorRef","acquisitionAlgoRef","retentionAlgoRef","paramEstimatorRef","questionSelectorRef","sessionQuestionCount","setSessionQuestionCount","setState","queues","selectNextQuestion","questionCandidates","queueInfo","selectedQuestion","recordAnswer","queueSizes","reset","getDebugInfo","QuizView","_categoryList","onCategoryChange","onDifficultyChange","onWordPhraseFilterChange","onPhraseTypeFilterChange","onDataSourceChange","questionSets","_onStartQuiz","onSkip","onDifficultyRate","errorPrediction","hasQuestions","showSettings","setShowSettings","isFullscreen","setIsFullscreen","lastAnswerTime","setLastAnswerTime","setLastAnswerCorrect","setLastAnswerWord","setIncorrectStreak","adaptiveLearning","autoNext","setAutoNext","autoNextDelay","setAutoNextDelay","setAutoShowDetails","handleAnswer","answer","handleNextWrapper","handleSkipWrapper","learningPlan","hasPlan","planStatus","daysPassed","progressPercent","toggleFullscreen","qs","delay","useSpellingGame","spellingState","setSpellingState","shuffledLetters","setShuffledLetters","selectedSequence","setSelectedSequence","phraseWords","setPhraseWords","currentWordIndex","setCurrentWordIndex","completedWords","setCompletedWords","questionStartTimeRef","newSequence","userWord","currentTargetWord","newCompletedWords","nextWordIndex","fullUserWord","useSessionStats","SpellingView","onStartQuiz","handleLetterClickCore","checkAnswer","moveToNextQuestion","updateScore","resetStats","updateStats","_isFullscreen","_setIsFullscreen","_autoNext","_setAutoNext","_autoNextDelay","_setAutoNextDelay","letterCardsRef","quizStartTimeRef","incorrectWordsRef","timer","handleLetterClick","_letter","handleCheckAnswer","processAnswer","_userWord","remainingQuestions","savedLearningLimit","savedReviewLimit","resorted","handleNext","nextIndex","cleanedQuestions","handleSkip","handlePrevious","handleBackspace","customWord","availableIndex","letter","isSelected","selectionOrder","answerClass","extractTitleFromPath","filePath","fileName","PASSAGE_FILES_RAW","PASSAGE_FILES","getPassageList","loadOriginalPassage","passageId","metadata","originalPath","response","loadPassage","content","sections","parsePassageContent","currentSection","getLemma","cleaned","base","loadFullTranslation","translationFilePath","loadJapanesePhrases","jaFilePath","convertPassageToReadingFormat","wordDictionary","loaded","japanesePhrases","fullTranslation","originalText","japaneseIndex","phrases","section","paragraph","fullText","segments","processWord","leadingQuote","lemma","punctuationMatch","cleanWord","punctuation","japanese","phraseText","loadPhraseLearningJSON","loadAllPassagesAsReadingFormat","meta","VERBS","PREPOSITIONS","CONJUNCTIONS","DETERMINERS","PRONOUNS","ADJECTIVES","ADVERBS","getTagColor","tag","getTagDescription","classifyWord","lower","getPunctuationMeaning","analyzeSentence","sentence","foundVerb","foundSubject","PHRASAL_EXPRESSIONS","detectPhrasalExpressions","detected","lowerWords","expression","exprLower","GRAMMAR_PATTERNS","detectGrammarPatterns","_getLevelLabel","ComprehensiveReadingView","onSaveUnknownWords","setPassages","selectedPassageId","setSelectedPassageId","phraseTranslations","setPhraseTranslations","wordMeaningsVisible","setWordMeaningsVisible","difficultyFilter","setDifficultyFilter","setError","setWordDictionary","readingDictionary","setReadingDictionary","wordPopup","setWordPopup","readingStarted","_setReadingStarted","readingSubTab","setReadingSubTab","_currentPhraseIndex","_setCurrentPhraseIndex","isFullTextSpeaking","setIsFullTextSpeaking","isFullTextPaused","setIsFullTextPaused","selectedSentenceIndex","setSelectedSentenceIndex","selectedSentenceDetails","setSelectedSentenceDetails","showGrammarLegend","setShowGrammarLegend","showDetailedExplanation","setShowDetailedExplanation","isLoading","setIsLoading","readingProgressKey","pIdx","seg","sIdx","dictionary","row","cell","_err","dictData","readingDict","info","normalized","deduped","getMeaning","existingMeaning","readingWord","checkSpeechStatus","savedProgress","loadedPassages","restoredPassages","levelOrder","sortedData","levelA","levelB","wordCountA","wordCountB","currentPassage","filteredPassages","handleSelectPassage","phraseIdx","element","handleWordDoubleClick","normalizedWord","baseForm","wordInfo","rect","handleSaveUnknownWords","unknownWords","handleReset","unknownCount","sentences","reconstructedSentences","grammarAnalysis","lineText","lastWasPeriod","phrasalExpressions","expr","widx","firstPhraseText","isFirstPhraseTitle","paragraphs","currentParagraph","wordCount","targetWordsPerParagraph","sentenceWordCount","allSentences","handleSentenceClick","para","translatedSentences","currentSentence","isEndOfSentence","sentencesPerParagraph","paragraphSentences","GrammarQuizView","_props","quizType","setQuizType","setGrade","availableUnits","setAvailableUnits","setIsReviewFocusMode","handleReviewFocus","autoReadAloud","setAutoReadAloud","quizStarted","setQuizStarted","_loading","setLoading","currentQuestions","setCurrentQuestions","currentQuestionIndex","setCurrentQuestionIndex","setSelectedAnswer","setSelectedWords","setRemainingWords","textInput","setTextInput","setAnswered","showHint","setShowHint","score","setScore","setTotalAnswered","isSentenceOrdering","currentGrammarUnit","prevSettingsRef","handleStartQuiz","gradesToLoad","selectedUnitIndex","gradeNum","allGrammarFiles","unitIdx","grammarFile","typeMapping","targetType","__vitePreload","progressStorage","questionId","units","prevSettings","settingsChanged","handleAnswerSelect","isDontKnow","isMastered","utils","handleWordClick","fromRemaining","correctAnswer","prevTotal","prevScore","toggleHint","u","lastWord","part","isCorrectChoice","showCorrect","showIncorrect","MemorizationView","cardState","setCardState","autoVoice","setAutoVoice","voiceWord","setVoiceWord","voiceMeaning","setVoiceMeaning","voiceDelay","setVoiceDelay","setCurrentQuestion","setCurrentIndex","setQuestions","consecutiveViews","setConsecutiveViews","cardDisplayTimeRef","previousQuestionId","savedCardSettings","memSettings","getAvailableCategories","categories","field","baseQuestions","timeRisk","accuracyRisk","avgResponseSpeed","toggleCardField","newState","updateVoiceSettings","autoVoiceVal","voiceWordVal","voiceMeaningVal","voiceDelayVal","handleSwipe","direction","viewDuration","shouldResortImmediately","shouldResortPeriodically","sortByPriorityCommon","updatedQuestions","prevQuestions","clearedQuestions","num","newDelay","GrammarGuideView","PrepositionGuide","PunctuationGuide","ReadingTipsGuide","punctuations","punc","tip","detail","detailIdx","DictionaryView","FloatingPanel","isOpen","onClose","onCreateSet","onDeleteSet","onEditSet","newSetName","setNewSetName","newSetDescription","setNewSetDescription","expandedSetId","setExpandedSetId","editingSetId","setEditingSetId","editName","setEditName","editDescription","setEditDescription","handleCreateSet","handleStartEdit","handleSaveEdit","handleCancelEdit","StatsView","onResetComplete","onQuestionSetsUpdated","autoRefresh","_setAutoRefresh","storageInfo","setStorageInfo","hasWeakWordsSet","setHasWeakWordsSet","setCalendarData","_weeklyStats","setWeeklyStats","_monthlyStats","setMonthlyStats","_cumulativeData","setCumulativeData","_retentionTrend","setRetentionTrend","setWeakWords","_overcomeWords","setOvercomeWords","_recentlyMastered","setRecentlyMastered","_streakDays","setStreakDays","getStorageSize","totalSize","details","loadData","calData","weakWordsWithDetails","checkWeakWordsSet","hasSet","onQuizResultAdded","interval","handleResetAll","CalendarHeatmap","numLimit","todayStr","todayData","twoWeeksAgo","dataMap","mondayThisWeek","dow","diffToMonday2","firstDate","currentDate","week","dayData","normalizedCurrentDate","cellData","getColorClass","dayLabels","label","weekIdx","dayIdx","dayName","isToday","colorClasses","LearningPlanView","onStartSession","setSchedule","dailyPlan","setDailyPlan","_selectedMonths","setProgress","progressBar","phaseNames","weeklyAchievement","isPassed","isCurrent","SettingsView","_selectedDataSource","_onDataSourceChange","batchSize","setBatchSize","aiPersonality","setAIPersonality","handlePersonalityChange","voiceGender","setVoiceGender","speechRate","setSpeechRate","handleVoiceGenderChange","gender","handleSpeechRateChange","rate","darkMode","setDarkMode","applyDarkMode","isDark","mediaQuery","handleChange","LoadingIndicator","isVisible","message","grammarQuizViewCache","comprehensiveReadingViewCache","loadGrammarQuizView","GrammarQuizView$1","loadComprehensiveReadingView","ComprehensiveReadingView$1","preloadHeavyComponents","checkLocalStorageSize","totalMB","sizeMB","App","isLoadingTab","setIsLoadingTab","setAllQuestions","customQuestionState","setCustomQuestionState","isFloatingPanelOpen","setIsFloatingPanelOpen","setQuestionSets","isDataLoaded","setIsDataLoaded","hasAutoStarted","adaptiveMode","sessionQuestionIndexRef","sessionResponsesRef","cognitiveLoadRef","errorAnalysisRef","errorPredictionsRef","recentAnswersRef","recentlyStudiedWordsRef","currentMode","migrationError","progressLoaded","progressError","juniorWordsText","juniorWordsQuestions","juniorPhrasesQuestions","juniorPhrasesText","intermediateWordsQuestions","intermediateWordsText","intermediatePhrasesQuestions","intermediatePhrasesText","unitTitleMap","questionsCache","sortedCategories","gradeRegex","matchA","matchB","gradeA","gradeB","unitA","unitB","unitRegex","unitMatchA","unitMatchB","numA","numB","allSet","advancedSet","standardSet","progressStorage$1","cs","sourcePrefix","reloadQuestionSets","customSets","mainSet","getFilteredQuestions","difficultyMap","handleCreateCustomSet","handleDeleteCustomSet","handleEditCustomSet","handleAddWordToCustomSet","handleRemoveWordFromCustomSet","motivationMsg","studySettings","filteredQuestions","todayIncorrect","radarAnalysis","improvementProgress","rec","confusedWords","incorrectQuestions","correctQuestions","confusedQuestions","nonConfusedQuestions","optimizedSequence","currentLoad","adjustedSequence","wordToPriority","contextualSeq","contextualOrder","orderA","orderB","sample","highRisk","handleSpellingReviewFocus","handleCategoryChange","handleDifficultyChange","normalizedAnswer","normalizedCorrect","skipWordProgress","newPool","sessionEndTime","totalResponseTime","newSessionStats","getTimeOfDayStyle","sessionDurationMinutes","gamificationResult","fb","handleDifficultyRate","rating","_preloadHeavyComponents","defaultName","setName","updatedSets","initializeDarkMode","ReactDOM","React"],"ignoreList":[0],"sources":["../../node_modules/react-dom/client.js","../../src/types.ts","../../src/utils/logger.ts","../../src/storage/indexedDB/indexedDBStorage.ts","../../src/storage/migration/dataMigration.ts","../../src/storage/manager/storageManager.ts","../../src/storage/progress/settings.ts","../../src/storage/progress/sessionHistory.ts","../../src/storage/progress/statistics.ts","../../src/storage/progress/progressStorage.ts","../../src/utils.ts","../../src/hooks/useQuizSettings.ts","../../src/hooks/useQuizFilters.ts","../../src/hooks/useQuizState.ts","../../src/utils/customQuestionStorage.ts","../../src/utils/questionPrioritySorter.ts","../../src/hooks/useQuestionRequeue.ts","../../src/metrics/sessionKpi.ts","../../src/features/learning/learningAssistant.ts","../../src/ai/analysis/radarChartAI.ts","../../src/ai/analysis/learningCurveAI.ts","../../src/ai/cognitive/cognitiveLoadAI.ts","../../src/ai/prediction/errorPredictionAI.ts","../../src/ai/optimization/contextualLearningAI.ts","../../src/ai/adaptation/learningStyleAI.ts","../../src/ai/engagement/gamificationAI.ts","../../src/features/interaction/aiCommentHelpers.ts","../../src/features/interaction/aiCommentGenerator.ts","../../src/features/interaction/timeBasedGreeting.ts","../../src/features/interaction/teacherInteractions.ts","../../src/englishTrivia.ts","../../src/components/ScoreBoard.tsx","../../src/features/learning/goalSimulator.ts","../../src/features/analysis/confusionPairs.ts","../../src/features/speech/speechSynthesis.ts","../../src/components/AddToCustomButton.tsx","../../src/components/QuestionCard.tsx","../../src/components/LearningLimitsInput.tsx","../../src/hooks/useLearningLimits.ts","../../src/strategies/learningPhaseDetector.ts","../../src/strategies/memoryAcquisitionAlgorithm.ts","../../src/strategies/memoryRetentionAlgorithm.ts","../../src/strategies/personalParameterEstimator.ts","../../src/strategies/hybridQuestionSelector.ts","../../src/hooks/useAdaptiveLearning.ts","../../src/components/QuizView.tsx","../../src/hooks/useSpellingGame.ts","../../src/hooks/useSessionStats.ts","../../src/components/SpellingView.tsx","../../src/utils/passageLoader.ts","../../src/utils/passageAdapter.ts","../../src/utils/grammarAnalyzer.ts","../../src/components/ComprehensiveReadingView.tsx","../../src/components/GrammarQuizView.tsx","../../src/components/MemorizationView.tsx","../../src/components/GrammarGuideView.tsx","../../src/components/DictionaryView.tsx","../../src/components/FloatingPanel.tsx","../../src/components/StatsView.tsx","../../src/components/LearningPlanView.tsx","../../src/components/SettingsView.tsx","../../src/components/LoadingIndicator.tsx","../../src/utils/lazyLoader.ts","../../src/App.tsx","../../src/main.tsx"],"sourcesContent":["'use strict';\n\nvar m = require('react-dom');\nif (process.env.NODE_ENV === 'production') {\n  exports.createRoot = m.createRoot;\n  exports.hydrateRoot = m.hydrateRoot;\n} else {\n  var i = m.__SECRET_INTERNALS_DO_NOT_USE_OR_YOU_WILL_BE_FIRED;\n  exports.createRoot = function(c, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.createRoot(c, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n  exports.hydrateRoot = function(c, h, o) {\n    i.usingClientEntryPoint = true;\n    try {\n      return m.hydrateRoot(c, h, o);\n    } finally {\n      i.usingClientEntryPoint = false;\n    }\n  };\n}\n","// quiz-app7CSV\n// ,,,,,,\n\n// 10\n// : docs/19-junior-high-vocabulary.md\nexport const OFFICIAL_CATEGORIES = [\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n] as const;\n\nexport type CategoryType = (typeof OFFICIAL_CATEGORIES)[number];\n\n// \nexport const DIFFICULTY_LEVELS = ['beginner', 'intermediate', 'advanced'] as const;\nexport type DifficultyType = (typeof DIFFICULTY_LEVELS)[number];\n\nexport interface Question {\n  word: string; //  or \n  reading: string; // \n  meaning: string; // \n  etymology: string; // \n  relatedWords: string; // \n  relatedFields: string; // CSV\n  category?: string; // \n  difficulty: string; // CSV\n  source?: 'junior' | 'intermediate'; //  or 1800\n  type?: 'word' | 'phrase'; // \n  isPhraseOnly?: boolean; // true\n  sessionPriority?: number; // 3\n  reAddedCount?: number; // \n}\n\n// \nexport function isValidCategory(category: string): category is CategoryType {\n  return (OFFICIAL_CATEGORIES as readonly string[]).includes(category);\n}\n\nexport function isValidDifficulty(difficulty: string): difficulty is DifficultyType {\n  return (DIFFICULTY_LEVELS as readonly string[]).includes(difficulty);\n}\n\nexport interface QuizState {\n  questions: Question[];\n  currentIndex: number;\n  score: number;\n  totalAnswered: number;\n  answered: boolean;\n  selectedAnswer: string | null;\n}\n\nexport interface CreatedQuestion {\n  word: string;\n  reading: string;\n  meaning: string;\n  etymology: string;\n  relatedWords: string;\n  relatedFields: string;\n  difficulty: string;\n}\n\n// \nexport interface SpellingState {\n  questions: Question[];\n  currentIndex: number;\n  score: number;\n  totalAnswered: number;\n  answered: boolean;\n  selectedLetters: (string | null)[]; // \n  correctWord: string; // \n}\n\n// \nexport interface ReadingPassage {\n  id: string;\n  title: string;\n  level?: string; // //\n  theme?: string; // \n  targetWordCount?: number; // \n  actualWordCount?: number; // \n  phrases: ReadingPhrase[]; // \n  translation?: string; // \n  originalText?: string; // passages-original\n}\n\nexport interface ReadingPhrase {\n  id?: number; // ID\n  words?: string[]; // (: [\"Modern\", \"technology\"]) - segments\n  phraseMeaning: string; // (: \"\")\n  segments: ReadingSegment[]; // \n  isUnknown?: boolean; //  - \n}\n\nexport interface ReadingSegment {\n  word: string; // \n  meaning: string; // \n  isUnknown: boolean; // \n\n  // Question\n  lemma?: string; // - gatheredgather\n  reading?: string; // : \n  etymology?: string; // \n  relatedWords?: string; // \n  relatedFields?: string; // \n  difficulty?: string; // beginner/intermediate/advanced\n}\n\n// \nexport interface QuestionSet {\n  id: string; // ID\n  name: string; // \n  questions: Question[]; // \n  createdAt: number; // \n  isBuiltIn: boolean; // \n  source?: string; // : \"\", \"CSV\", \"\"\n}\n\n// \nexport interface LearningSchedule {\n  userId: string;\n  startDate: number;\n  currentDay: number;\n  totalDays: number; // 30, 60, 90, 180\n  planDurationMonths: number; // 1, 2, 3, 6\n  phase: 1 | 2 | 3;\n\n  dailyGoals: {\n    newWords: number;\n    reviewWords: number;\n    timeMinutes: number;\n  };\n\n  weeklyProgress: {\n    week: number;\n    wordsLearned: number;\n    wordsReviewed: number;\n    averageAccuracy: number;\n    completionRate: number;\n  }[];\n\n  milestones: {\n    day: number;\n    title: string;\n    wordsTarget: number;\n    achieved: boolean;\n  }[];\n}\n\nexport interface DailyStudyPlan {\n  date: number;\n  dayNumber: number;\n  phase: 1 | 2 | 3;\n\n  morning: {\n    newWords: Question[];\n    duration: number;\n    mode: 'discovery';\n  };\n\n  afternoon: {\n    reviewWords: Question[];\n    duration: number;\n    mode: 'weakness';\n  };\n\n  evening: {\n    mixedWords: Question[];\n    duration: number;\n    mode: 'mixed';\n  };\n\n  completed: boolean;\n  actualAccuracy: number;\n}\n\n// AI\nexport type AIPersonality =\n  | 'drill-sergeant' // \n  | 'kind-teacher' // \n  | 'analyst' // \n  | 'enthusiastic-coach' // \n  | 'wise-sage'; // \n\n// AI\nexport interface CommentContext {\n  // \n  isCorrect: boolean;\n  attemptCount: number;\n  responseTime: number; // \n\n  // \n  correctStreak: number;\n  incorrectStreak: number;\n\n  // \n  word: string;\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  category: string;\n\n  // \n  userAccuracy: number; // (0-100)\n  categoryAccuracy: number; // (0-100)\n  isWeakCategory: boolean;\n  hasSeenBefore: boolean;\n  previousAttempts: number; // \n\n  // \n  todayQuestions: number;\n  todayAccuracy: number;\n  planProgress: number; // (0-100)\n\n  // \n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n\n  // \n  learningPhase?: 'ENCODING' | 'INITIAL_CONSOLIDATION' | 'LONG_TERM_RETENTION' | 'MASTERED';\n  queueType?: 'IMMEDIATE' | 'EARLY' | 'MID' | 'END';\n  estimatedSpeed?: number; // \n  forgettingRate?: number; // \n}\n\n// \nexport interface UserLearningProfile {\n  // \n  difficultyMastery: {\n    beginner: number; //  (0-100)\n    intermediate: number; // \n    advanced: number; // \n  };\n\n  // \n  categoryStrength: {\n    [category: string]: {\n      accuracyRate: number; // (0-100)\n      learningSpeed: number; // (/)\n      retentionRate: number; // (0-100)\n      confidence: 'high' | 'medium' | 'low'; // \n      totalStudied: number; // \n      totalMastered: number; // \n    };\n  };\n\n  // \n  dynamicThresholds: {\n    masteryThreshold: number; // (60-90%)\n    reviewThreshold: number; // (40-70%)\n    priorityThreshold: number; // (50-80%)\n  };\n\n  // \n  learningPace: {\n    dailyAverage: number; // 1\n    preferredBatchSize: number; // \n    studyPattern: 'fast' | 'steady' | 'slow'; // \n  };\n\n  // \n  lastUpdated: number;\n}\n\n// \nexport interface MemorizationCardState {\n  showWord: boolean; // \n  showMeaning: boolean; // : \n  showPronunciation: boolean; // \n  showExample: boolean; // \n  showEtymology: boolean; // \n  showRelated: boolean; // \n}\n\n// \nexport interface MemorizationBehavior {\n  word: string;\n  timestamp: number;\n  viewDuration: number; // \n  swipeDirection: 'left' | 'right'; // \n  sessionId: string;\n  consecutiveViews: number; // \n}\n\n// \nexport interface MemorizationCurve {\n  word: string;\n  exposures: Array<{\n    timestamp: number;\n    viewDuration: number;\n    swipeDirection: 'left' | 'right';\n    confidence: number; // 0-1: AI\n  }>;\n  predictedMastery: number; // 0-1: \n  optimalNextReview: number; // \n  learningVelocity: number; // \n}\n\n// \nexport interface PersonalizedLearningProfile {\n  userId: string;\n\n  // \n  learningSpeed: 'fast' | 'medium' | 'slow';\n\n  // \n  optimalReviewIntervals: {\n    firstReview: number; // \n    secondReview: number; // 2\n    thirdReview: number; // 3\n  };\n\n  // \n  viewDurationThresholds: {\n    quick: number; // \n    normal: number; // \n    struggling: number; // \n  };\n\n  // \n  modelConfidence: number; // 0-1\n\n  // \n  calibrationData: {\n    totalPredictions: number;\n    correctPredictions: number;\n    overestimations: number; // \n    underestimations: number; // \n  };\n}\n\n// \nexport interface MemorizationSettings {\n  // \n  autoVoice: boolean; // \n  voiceWord: boolean; // \n  voiceMeaning: boolean; // \n  voiceDelay?: number; // \n  voiceWithMeaning?: boolean; // \n\n  // \n  interleavingMode: 'off' | 'medium' | 'high';\n\n  // \n  cardDisplaySettings: MemorizationCardState;\n}\n\n// \nexport interface CustomQuestionSet {\n  id: string; // ID\n  name: string; // \n  source: 'reading' | 'weak-words' | 'manual'; // \n  questions: Question[]; // \n  createdAt: number; // \n  updatedAt: number; // \n  isAutoUpdate: boolean; // \n  autoUpdateConfig?: {\n    limit: number; // \n    minMistakes: number; // \n    maxAccuracy: number; // \n  };\n  metadata?: {\n    description?: string; // \n    tags?: string[]; // \n    difficulty?: string; // \n    totalWords?: number; // \n  };\n}\n","/**\n * \n *\n * :\n * - production: \n * - development: \n * - debug: URL  ?debug=true \n */\n\nconst isDevelopment = import.meta.env.DEV;\nconst isDebugMode =\n  typeof window !== 'undefined' &&\n  new URLSearchParams(window.location.search).get('debug') === 'true';\n\nexport const logger = {\n  log: (...args: unknown[]) => {\n    // \n    if (isDebugMode) {\n      console.log(...args);\n    }\n  },\n\n  warn: (...args: unknown[]) => {\n    // \n    if (isDevelopment || isDebugMode) {\n      console.warn(...args);\n    }\n  },\n\n  error: (...args: unknown[]) => {\n    // \n    console.error(...args);\n  },\n\n  debug: (...args: unknown[]) => {\n    // \n    if (isDebugMode) {\n      console.debug(...args);\n    }\n  },\n\n  info: (...args: unknown[]) => {\n    // \n    if (isDebugMode) {\n      console.info(...args);\n    }\n  },\n};\n","// IndexedDB - \n\nimport { logger } from '@/utils/logger';\n\nconst DB_NAME = 'QuizAppDB';\nconst DB_VERSION = 1;\n\n// Store\nexport const STORES = {\n  PROGRESS: 'progress',\n  SESSION_HISTORY: 'sessionHistory',\n  DAILY_STATS: 'dailyStats',\n  SETTINGS: 'settings',\n} as const;\n\n// IndexedDB\nexport function isIndexedDBSupported(): boolean {\n  try {\n    return 'indexedDB' in window && indexedDB !== null;\n  } catch {\n    return false;\n  }\n}\n\n// IndexedDB\nexport async function isPrivateMode(): Promise<boolean> {\n  if (!isIndexedDBSupported()) return true;\n\n  try {\n    const testDB = indexedDB.open('test');\n    return new Promise((resolve) => {\n      testDB.onsuccess = () => {\n        testDB.result.close();\n        indexedDB.deleteDatabase('test');\n        resolve(false);\n      };\n      testDB.onerror = () => resolve(true);\n    });\n  } catch {\n    return true;\n  }\n}\n\n// DB\nlet dbInstance: IDBDatabase | null = null;\n\nexport function initDB(): Promise<IDBDatabase> {\n  return new Promise((resolve, reject) => {\n    if (dbInstance) {\n      resolve(dbInstance);\n      return;\n    }\n\n    if (!isIndexedDBSupported()) {\n      reject(new Error('IndexedDB is not supported'));\n      return;\n    }\n\n    const request = indexedDB.open(DB_NAME, DB_VERSION);\n\n    request.onerror = () => {\n      logger.error('IndexedDB open error:', request.error);\n      reject(request.error);\n    };\n\n    request.onsuccess = () => {\n      dbInstance = request.result;\n      logger.log(' IndexedDB initialized successfully');\n      resolve(dbInstance);\n    };\n\n    request.onupgradeneeded = (event) => {\n      const db = (event.target as IDBOpenDBRequest).result;\n\n      // progress store: \n      if (!db.objectStoreNames.contains(STORES.PROGRESS)) {\n        db.createObjectStore(STORES.PROGRESS);\n      }\n\n      // sessionHistory store: \n      if (!db.objectStoreNames.contains(STORES.SESSION_HISTORY)) {\n        const historyStore = db.createObjectStore(STORES.SESSION_HISTORY, {\n          keyPath: 'id',\n          autoIncrement: true,\n        });\n        historyStore.createIndex('mode', 'mode', { unique: false });\n        historyStore.createIndex('timestamp', 'timestamp', { unique: false });\n        historyStore.createIndex('modeTimestamp', ['mode', 'timestamp'], { unique: false });\n      }\n\n      // dailyStats store: \n      if (!db.objectStoreNames.contains(STORES.DAILY_STATS)) {\n        const statsStore = db.createObjectStore(STORES.DAILY_STATS, { keyPath: 'date' });\n        statsStore.createIndex('date', 'date', { unique: true });\n      }\n\n      // settings store: \n      if (!db.objectStoreNames.contains(STORES.SETTINGS)) {\n        db.createObjectStore(STORES.SETTINGS);\n      }\n\n      logger.log(' IndexedDB stores created');\n    };\n  });\n}\n\n// get\nexport async function getFromDB<T>(storeName: string, key: IDBValidKey): Promise<T | null> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.get(key);\n\n      request.onsuccess = () => resolve(request.result || null);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('getFromDB error:', error);\n    return null;\n  }\n}\n\n// put\nexport async function putToDB<T>(storeName: string, value: T, key?: IDBValidKey): Promise<boolean> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readwrite');\n      const store = transaction.objectStore(storeName);\n      const request = key !== undefined ? store.put(value, key) : store.put(value);\n\n      request.onsuccess = () => resolve(true);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('putToDB error:', error);\n    return false;\n  }\n}\n\n// delete\nexport async function deleteFromDB(storeName: string, key: IDBValidKey): Promise<boolean> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readwrite');\n      const store = transaction.objectStore(storeName);\n      const request = store.delete(key);\n\n      request.onsuccess = () => resolve(true);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('deleteFromDB error:', error);\n    return false;\n  }\n}\n\n// \nexport async function getAllFromDB<T>(storeName: string): Promise<T[]> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.getAll();\n\n      request.onsuccess = () => resolve(request.result || []);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('getAllFromDB error:', error);\n    return [];\n  }\n}\n\n// \nexport async function queryByIndex<T>(\n  storeName: string,\n  indexName: string,\n  query: IDBValidKey | IDBKeyRange,\n  limit?: number\n): Promise<T[]> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const index = store.index(indexName);\n      const request = index.openCursor(query, 'prev'); // \n      const results: T[] = [];\n\n      request.onsuccess = (event) => {\n        const cursor = (event.target as IDBRequest).result;\n        if (cursor && (!limit || results.length < limit)) {\n          results.push(cursor.value);\n          cursor.continue();\n        } else {\n          resolve(results);\n        }\n      };\n\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('queryByIndex error:', error);\n    return [];\n  }\n}\n\n// Store\nexport async function clearStore(storeName: string): Promise<boolean> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readwrite');\n      const store = transaction.objectStore(storeName);\n      const request = store.clear();\n\n      request.onsuccess = () => resolve(true);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('clearStore error:', error);\n    return false;\n  }\n}\n\n// \nexport async function getStorageEstimate(): Promise<{ usage: number; quota: number }> {\n  if ('storage' in navigator && 'estimate' in navigator.storage) {\n    try {\n      const estimate = await navigator.storage.estimate();\n      return {\n        usage: estimate.usage || 0,\n        quota: estimate.quota || 0,\n      };\n    } catch (error) {\n      logger.error('Storage estimate error:', error);\n    }\n  }\n  return { usage: 0, quota: 0 };\n}\n\n// \nexport async function getCount(storeName: string): Promise<number> {\n  try {\n    const db = await initDB();\n    return new Promise((resolve, reject) => {\n      const transaction = db.transaction(storeName, 'readonly');\n      const store = transaction.objectStore(storeName);\n      const request = store.count();\n\n      request.onsuccess = () => resolve(request.result);\n      request.onerror = () => reject(request.error);\n    });\n  } catch (error) {\n    logger.error('getCount error:', error);\n    return 0;\n  }\n}\n\n// DB\nexport async function deleteDatabase(): Promise<boolean> {\n  return new Promise((resolve) => {\n    if (dbInstance) {\n      dbInstance.close();\n      dbInstance = null;\n    }\n\n    const request = indexedDB.deleteDatabase(DB_NAME);\n    request.onsuccess = () => {\n      logger.log(' Database deleted');\n      resolve(true);\n    };\n    request.onerror = () => {\n      logger.error('Database delete error');\n      resolve(false);\n    };\n  });\n}\n","//  - LocalStorageIndexedDB\n\nimport {\n  initDB,\n  isIndexedDBSupported,\n  putToDB,\n  getFromDB,\n  STORES,\n} from '@/storage/indexedDB/indexedDBStorage';\nimport { logger } from '@/utils/logger';\n\nconst MIGRATION_FLAG_KEY = 'indexeddb-migration-completed';\nconst MIGRATION_VERSION = '1.1'; // \n\n// \nexport function isMigrationCompleted(): boolean {\n  try {\n    const flag = localStorage.getItem(MIGRATION_FLAG_KEY);\n    return flag === MIGRATION_VERSION;\n  } catch {\n    return false;\n  }\n}\n\n// \nfunction setMigrationCompleted(): void {\n  try {\n    localStorage.setItem(MIGRATION_FLAG_KEY, MIGRATION_VERSION);\n    logger.log(' Migration flag set');\n  } catch (error) {\n    logger.error('Failed to set migration flag:', error);\n  }\n}\n\n// LocalStorageJSON\nfunction getLocalStorageData(key: string): any {\n  try {\n    const data = localStorage.getItem(key);\n    if (!data) return null;\n\n    // JSON\n    if (\n      key.includes('lastLogin') ||\n      key.includes('Date') ||\n      key.includes('daily-plan') ||\n      key.includes('score-board')\n    ) {\n      return null; // \n    }\n\n    return JSON.parse(data);\n  } catch {\n    // JSON\n    logger.warn(`${key} is not valid JSON (skipping)`);\n    return null;\n  }\n}\n\n// LocalStorage\nfunction getLocalStorageRawData(key: string): string | null {\n  try {\n    return localStorage.getItem(key);\n  } catch (_error) {\n    logger.error(`Failed to get ${key} from localStorage:`, _error);\n    return null;\n  }\n}\n\n// progress-data\nasync function migrateProgressData(): Promise<boolean> {\n  try {\n    const progressData = getLocalStorageData('progress-data');\n    if (progressData) {\n      // \n      if (!progressData.wordProgress) {\n        progressData.wordProgress = {};\n      }\n      if (!progressData.results) {\n        progressData.results = [];\n      }\n      if (!progressData.statistics) {\n        progressData.statistics = {\n          totalQuizzes: 0,\n          totalQuestions: 0,\n          totalCorrect: 0,\n          averageScore: 0,\n          bestScore: 0,\n          streakDays: 0,\n          lastStudyDate: 0,\n          studyDates: [],\n        };\n      }\n      if (!progressData.questionSetStats) {\n        progressData.questionSetStats = {};\n      }\n\n      await putToDB(STORES.PROGRESS, progressData, 'main');\n      logger.log(\n        ' Progress data migrated:',\n        Object.keys(progressData.wordProgress || {}).length,\n        'words'\n      );\n      return true;\n    }\n\n    // LocalStorage\n    logger.log(' No progress data to migrate, creating initial data');\n    const initialData = {\n      wordProgress: {},\n      results: [],\n      statistics: {\n        totalQuizzes: 0,\n        totalQuestions: 0,\n        totalCorrect: 0,\n        averageScore: 0,\n        bestScore: 0,\n        streakDays: 0,\n        lastStudyDate: 0,\n        studyDates: [],\n      },\n      questionSetStats: {},\n    };\n    await putToDB(STORES.PROGRESS, initialData, 'main');\n    return true;\n  } catch (error) {\n    logger.error('Progress data migration error:', error);\n    return false;\n  }\n}\n\n// session-history\nasync function migrateSessionHistory(): Promise<boolean> {\n  try {\n    const modes = ['translation', 'spelling'];\n    let totalMigrated = 0;\n\n    for (const mode of modes) {\n      const key = `session-history-${mode}`;\n      const history = getLocalStorageData(key);\n\n      if (history && Array.isArray(history)) {\n        // IndexedDB\n        for (const item of history) {\n          await putToDB(STORES.SESSION_HISTORY, {\n            mode,\n            status: item.status,\n            word: item.word,\n            timestamp: item.timestamp,\n          });\n          totalMigrated++;\n        }\n      }\n    }\n\n    if (totalMigrated > 0) {\n      logger.log(' Session history migrated:', totalMigrated, 'items');\n    }\n    return true;\n  } catch (error) {\n    logger.error('Session history migration error:', error);\n    return false;\n  }\n}\n\n// studyStats-{date}90\nasync function migrateDailyStats(): Promise<boolean> {\n  try {\n    const now = new Date();\n    const ninetyDaysAgo = new Date(now.getTime() - 90 * 24 * 60 * 60 * 1000);\n    let migratedCount = 0;\n    let cleanedCount = 0;\n\n    // LocalStorage\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key && key.startsWith('studyStats-')) {\n        const dateStr = key.replace('studyStats-', '');\n        const statDate = new Date(dateStr);\n\n        if (statDate >= ninetyDaysAgo) {\n          // 90: \n          const stats = getLocalStorageData(key);\n          if (stats) {\n            await putToDB(STORES.DAILY_STATS, { date: dateStr, ...stats });\n            migratedCount++;\n          }\n        } else {\n          // 90: \n          localStorage.removeItem(key);\n          cleanedCount++;\n        }\n      }\n    }\n\n    if (migratedCount > 0 || cleanedCount > 0) {\n      logger.log(` Daily stats: migrated ${migratedCount}, cleaned ${cleanedCount}`);\n    }\n    return true;\n  } catch (error) {\n    logger.error('Daily stats migration error:', error);\n    return false;\n  }\n}\n\n// \nasync function migrateSettings(): Promise<boolean> {\n  try {\n    // JSON\n    const jsonSettingsKeys = [\n      'user-goal-level',\n      'loginStreak',\n      'radar-improvement-progress',\n      'skip-exclude-groups',\n    ];\n\n    // JSON.parse\n    const rawSettingsKeys = [\n      'lastLoginDate',\n      'lastLoginData', // typo\n    ];\n\n    let migratedCount = 0;\n\n    // JSON\n    for (const key of jsonSettingsKeys) {\n      try {\n        // lastLogin\n        if (key.includes('lastLogin')) {\n          logger.warn(`Skipping ${key} from JSON migration`);\n          continue;\n        }\n\n        const value = getLocalStorageData(key);\n        if (value !== null) {\n          await putToDB(STORES.SETTINGS, value, key);\n          migratedCount++;\n        }\n      } catch (error) {\n        logger.warn(`Failed to migrate ${key}:`, error);\n      }\n    }\n\n    // \n    for (const key of rawSettingsKeys) {\n      try {\n        const value = getLocalStorageRawData(key);\n        if (value !== null) {\n          await putToDB(STORES.SETTINGS, value, key);\n          migratedCount++;\n        }\n      } catch (error) {\n        logger.warn(`Failed to migrate ${key}:`, error);\n      }\n    }\n\n    // daily-plan-target  score-board-goal \n    const modes = ['translation', 'spelling', 'reading'];\n    for (const mode of modes) {\n      const planKey = `daily-plan-target-${mode}`;\n      const goalKey = `score-board-goal-${mode}`;\n\n      try {\n        const planValue = localStorage.getItem(planKey);\n        if (planValue) {\n          await putToDB(STORES.SETTINGS, planValue, planKey);\n          migratedCount++;\n        }\n      } catch (error) {\n        logger.warn(`Failed to migrate ${planKey}:`, error);\n      }\n\n      try {\n        const goalValue = localStorage.getItem(goalKey);\n        if (goalValue) {\n          await putToDB(STORES.SETTINGS, goalValue, goalKey);\n          migratedCount++;\n        }\n      } catch (error) {\n        logger.warn(`Failed to migrate ${goalKey}:`, error);\n      }\n    }\n\n    if (migratedCount > 0) {\n      logger.log(' Settings migrated:', migratedCount, 'items');\n    }\n    return true;\n  } catch (error) {\n    logger.error('Settings migration error:', error);\n    return false;\n  }\n}\n\n// \nasync function verifyMigration(): Promise<boolean> {\n  try {\n    // \n    const progressData = (await getFromDB(STORES.PROGRESS, 'main')) as any;\n\n    if (!progressData) {\n      logger.warn(' Progress data verification failed - no data found');\n      return false;\n    }\n\n    // wordProgress\n    if (!progressData.wordProgress || typeof progressData.wordProgress !== 'object') {\n      logger.warn(' Progress data verification failed - invalid wordProgress');\n      return false;\n    }\n\n    logger.log(' Migration verification passed');\n    return true;\n  } catch (error) {\n    logger.error('Migration verification error:', error);\n    return false;\n  }\n}\n\n// \nexport async function migrateToIndexedDB(): Promise<boolean> {\n  // \n  if (isMigrationCompleted()) {\n    logger.log(' Migration already completed');\n    return true;\n  }\n\n  // IndexedDB\n  if (!isIndexedDBSupported()) {\n    logger.warn(' IndexedDB not supported, using localStorage');\n    return false;\n  }\n\n  logger.log(' Starting data migration to IndexedDB...');\n\n  try {\n    // DB\n    await initDB();\n\n    // \n    const results = await Promise.all([\n      migrateProgressData(),\n      migrateSessionHistory(),\n      migrateDailyStats(),\n      migrateSettings(),\n    ]);\n\n    // \n    const labels = ['Progress', 'SessionHistory', 'DailyStats', 'Settings'];\n    results.forEach((result, index) => {\n      if (!result) {\n        logger.warn(` ${labels[index]} migration incomplete (may be empty)`);\n      }\n    });\n\n    // OK\n    const criticalSuccess = results[0]; // Progress data\n\n    if (criticalSuccess || results.some((r) => r)) {\n      // \n      const verified = await verifyMigration();\n\n      if (verified) {\n        // \n        setMigrationCompleted();\n        logger.log(' Migration completed successfully!');\n        return true;\n      } else {\n        logger.warn(' Migration verification failed, but marking as complete');\n        setMigrationCompleted();\n        return true;\n      }\n    } else {\n      logger.warn(' All migrations returned false, marking as complete anyway');\n      setMigrationCompleted();\n      return true;\n    }\n  } catch (error) {\n    logger.error(' Migration failed:', error);\n    return false;\n  }\n}\n\n// \nexport function resetMigrationFlag(): void {\n  try {\n    localStorage.removeItem(MIGRATION_FLAG_KEY);\n    logger.log(' Migration flag reset');\n  } catch (error) {\n    logger.error('Failed to reset migration flag:', error);\n  }\n}\n\n// \nexport function getMigrationInfo(): {\n  completed: boolean;\n  indexedDBSupported: boolean;\n  version: string;\n} {\n  return {\n    completed: isMigrationCompleted(),\n    indexedDBSupported: isIndexedDBSupported(),\n    version: MIGRATION_VERSION,\n  };\n}\n","//  - IndexedDBlocalStorage\n\nimport {\n  isIndexedDBSupported,\n  getFromDB,\n  putToDB,\n  STORES,\n} from '@/storage/indexedDB/indexedDBStorage';\nimport { isMigrationCompleted } from '@/storage/migration/dataMigration';\nimport { logger } from '@/utils/logger';\n\n// \nlet useIndexedDB = false;\n\nexport function initStorageStrategy(): void {\n  useIndexedDB = isIndexedDBSupported() && isMigrationCompleted();\n  logger.log(` Storage strategy: ${useIndexedDB ? 'IndexedDB' : 'localStorage'}`);\n}\n\n// \nexport async function saveProgressData(data: unknown): Promise<boolean> {\n  try {\n    if (useIndexedDB) {\n      // IndexedDB\n      return await putToDB(STORES.PROGRESS, data, 'main');\n    } else {\n      // LocalStorage\n      localStorage.setItem('progress-data', JSON.stringify(data));\n      return true;\n    }\n  } catch (error) {\n    logger.error('saveProgressData error:', error);\n    // IndexedDBLocalStorage\n    try {\n      localStorage.setItem('progress-data', JSON.stringify(data));\n      return true;\n    } catch (fallbackError) {\n      logger.error('localStorage fallback failed:', fallbackError);\n      return false;\n    }\n  }\n}\n\n// \nexport async function loadProgressData(): Promise<unknown | null> {\n  try {\n    if (useIndexedDB) {\n      // IndexedDB\n      const data = await getFromDB(STORES.PROGRESS, 'main');\n      if (data) return data;\n\n      // IndexedDBLocalStorage\n      const fallbackData = localStorage.getItem('progress-data');\n      return fallbackData ? JSON.parse(fallbackData) : null;\n    } else {\n      // LocalStorage\n      const data = localStorage.getItem('progress-data');\n      return data ? JSON.parse(data) : null;\n    }\n  } catch (error) {\n    logger.error('loadProgressData error:', error);\n    return null;\n  }\n}\n\n// \nexport async function saveSetting(key: string, value: unknown): Promise<boolean> {\n  try {\n    if (useIndexedDB) {\n      return await putToDB(STORES.SETTINGS, value, key);\n    } else {\n      localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));\n      return true;\n    }\n  } catch (error) {\n    logger.error(`saveSetting(${key}) error:`, error);\n    // \n    try {\n      localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));\n      return true;\n    } catch {\n      return false;\n    }\n  }\n}\n\n// \nexport async function loadSetting(key: string): Promise<unknown | null> {\n  try {\n    if (useIndexedDB) {\n      const data = await getFromDB(STORES.SETTINGS, key);\n      if (data !== null) return data;\n\n      // IndexedDBLocalStorage\n      const fallbackData = localStorage.getItem(key);\n      return fallbackData || null;\n    } else {\n      const data = localStorage.getItem(key);\n      return data || null;\n    }\n  } catch (error) {\n    logger.error(`loadSetting(${key}) error:`, error);\n    return null;\n  }\n}\n\n// LocalStorage\nexport function saveToLocalStorage(key: string, value: unknown): boolean {\n  try {\n    localStorage.setItem(key, typeof value === 'string' ? value : JSON.stringify(value));\n    return true;\n  } catch (error) {\n    logger.error(`saveToLocalStorage(${key}) error:`, error);\n    return false;\n  }\n}\n\n// LocalStorage\nexport function loadFromLocalStorage(key: string): unknown | null {\n  try {\n    return localStorage.getItem(key);\n  } catch (error) {\n    logger.error(`loadFromLocalStorage(${key}) error:`, error);\n    return null;\n  }\n}\n\n// \nexport function getStorageUsage(): { localStorage: number; indexedDB: boolean } {\n  let localStorageSize = 0;\n\n  try {\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key) {\n        const value = localStorage.getItem(key);\n        if (value) {\n          localStorageSize += key.length + value.length;\n        }\n      }\n    }\n  } catch (error) {\n    logger.error('Failed to calculate localStorage size:', error);\n  }\n\n  return {\n    localStorage: localStorageSize,\n    indexedDB: useIndexedDB,\n  };\n}\n","// \n\nimport { logger } from '@/utils/logger';\nimport type { StudySettings } from './types';\n\n// \nconst DEFAULT_STUDY_SETTINGS: StudySettings = {\n  maxReviewCount: 10,\n};\n\n/**\n * \n */\nexport function getStudySettings(): StudySettings {\n  try {\n    const stored = localStorage.getItem('study-settings');\n    if (stored) {\n      const settings = JSON.parse(stored);\n      return {\n        maxReviewCount: settings.maxReviewCount ?? DEFAULT_STUDY_SETTINGS.maxReviewCount,\n      };\n    }\n  } catch (e) {\n    logger.error(':', e);\n  }\n  return { ...DEFAULT_STUDY_SETTINGS };\n}\n\n/**\n * \n */\nexport function saveStudySettings(settings: StudySettings): boolean {\n  try {\n    localStorage.setItem('study-settings', JSON.stringify(settings));\n    return true;\n  } catch (e) {\n    logger.error(':', e);\n    return false;\n  }\n}\n\n/**\n * \n */\nexport function updateStudySettings(partialSettings: Partial<StudySettings>): boolean {\n  const currentSettings = getStudySettings();\n  const newSettings = { ...currentSettings, ...partialSettings };\n  return saveStudySettings(newSettings);\n}\n","// \n\nimport { logger } from '@/utils/logger';\nimport {\n  putToDB,\n  queryByIndex,\n  STORES,\n  isIndexedDBSupported,\n} from '@/storage/indexedDB/indexedDBStorage';\nimport { isMigrationCompleted } from '@/storage/migration/dataMigration';\nimport type { SessionHistoryItem } from './types';\n\nconst SESSION_HISTORY_KEY = 'session-history';\nconst MAX_SESSION_HISTORY = 50;\n\n/**\n * IndexedDB/LocalStorage\n */\nexport async function addSessionHistory(\n  item: SessionHistoryItem,\n  mode: 'translation' | 'spelling' | 'grammar' | 'memorization'\n): Promise<void> {\n  const useIndexedDB = isIndexedDBSupported() && isMigrationCompleted();\n\n  try {\n    if (useIndexedDB) {\n      // IndexedDB\n      await putToDB(STORES.SESSION_HISTORY, {\n        mode,\n        status: item.status,\n        word: item.word,\n        timestamp: item.timestamp,\n      });\n    } else {\n      // LocalStorage\n      const key = `${SESSION_HISTORY_KEY}-${mode}`;\n      const stored = localStorage.getItem(key);\n      const history: SessionHistoryItem[] = stored ? JSON.parse(stored) : [];\n\n      history.push(item);\n\n      // 50\n      if (history.length > MAX_SESSION_HISTORY) {\n        history.shift();\n      }\n\n      localStorage.setItem(key, JSON.stringify(history));\n    }\n  } catch (e) {\n    logger.error(':', e);\n  }\n}\n\n/**\n * IndexedDB/LocalStorage\n */\nexport async function getSessionHistory(\n  mode: 'translation' | 'spelling' | 'grammar' | 'memorization',\n  limit: number = 20\n): Promise<SessionHistoryItem[]> {\n  const useIndexedDB = isIndexedDBSupported() && isMigrationCompleted();\n\n  try {\n    if (useIndexedDB) {\n      // IndexedDB\n      const results = await queryByIndex<Record<string, unknown>>(\n        STORES.SESSION_HISTORY,\n        'mode',\n        mode,\n        limit\n      );\n\n      return results.map((r) => ({\n        status: r.status as SessionHistoryItem['status'],\n        word: r.word as string,\n        timestamp: r.timestamp as number,\n      }));\n    } else {\n      // LocalStorage\n      const key = `${SESSION_HISTORY_KEY}-${mode}`;\n      const stored = localStorage.getItem(key);\n      const history: SessionHistoryItem[] = stored ? JSON.parse(stored) : [];\n\n      // limit\n      return history.slice(-limit);\n    }\n  } catch (e) {\n    logger.error(':', e);\n    return [];\n  }\n}\n\n/**\n * \n */\nexport function clearSessionHistory(\n  mode: 'translation' | 'spelling' | 'grammar' | 'memorization'\n): void {\n  try {\n    const key = `${SESSION_HISTORY_KEY}-${mode}`;\n    localStorage.removeItem(key);\n  } catch (e) {\n    logger.error(':', e);\n  }\n}\n","/**\n * \n * \n */\n\nimport {\n  loadProgressSync,\n  checkFlexibleMastery,\n  autoDetectWordDifficulty,\n} from './progressStorage';\nimport type { QuizResult, DetailedRetentionStats, WordProgress } from './types';\n\n// \nexport function getStatsByMode(mode: 'translation' | 'spelling' | 'reading'): {\n  totalQuizzes: number;\n  averageScore: number;\n  bestScore: number;\n} {\n  const progress = loadProgressSync();\n  const modeResults = progress.results.filter((r) => r.mode === mode);\n\n  if (modeResults.length === 0) {\n    return { totalQuizzes: 0, averageScore: 0, bestScore: 0 };\n  }\n\n  const totalScore = modeResults.reduce((sum, r) => sum + r.percentage, 0);\n  const bestScore = Math.max(...modeResults.map((r) => r.percentage));\n\n  return {\n    totalQuizzes: modeResults.length,\n    averageScore: totalScore / modeResults.length,\n    bestScore,\n  };\n}\n\n// \nexport function getRecentResults(limit: number = 10): QuizResult[] {\n  const progress = loadProgressSync();\n  return progress.results.slice(-limit).reverse();\n}\n\n// \nexport function getStatsByCategory(): Map<\n  string,\n  { correctCount: number; totalCount: number; accuracy: number }\n> {\n  const progress = loadProgressSync();\n  const categoryStats = new Map<string, { correctCount: number; totalCount: number }>();\n\n  progress.results.forEach((result) => {\n    if (result.category) {\n      const existing = categoryStats.get(result.category) || { correctCount: 0, totalCount: 0 };\n      categoryStats.set(result.category, {\n        correctCount: existing.correctCount + result.score,\n        totalCount: existing.totalCount + result.total,\n      });\n    }\n  });\n\n  const statsWithAccuracy = new Map<\n    string,\n    { correctCount: number; totalCount: number; accuracy: number }\n  >();\n  categoryStats.forEach((stats, category) => {\n    statsWithAccuracy.set(category, {\n      correctCount: stats.correctCount,\n      totalCount: stats.totalCount,\n      accuracy: stats.totalCount > 0 ? (stats.correctCount / stats.totalCount) * 100 : 0,\n    });\n  });\n\n  return statsWithAccuracy;\n}\n\n// \nexport function getStatsByDifficulty(): Map<\n  string,\n  { correctCount: number; totalCount: number; accuracy: number }\n> {\n  const progress = loadProgressSync();\n  const difficultyStats = new Map<string, { correctCount: number; totalCount: number }>();\n\n  progress.results.forEach((result) => {\n    if (result.difficulty) {\n      const existing = difficultyStats.get(result.difficulty) || { correctCount: 0, totalCount: 0 };\n      difficultyStats.set(result.difficulty, {\n        correctCount: existing.correctCount + result.score,\n        totalCount: existing.totalCount + result.total,\n      });\n    }\n  });\n\n  const statsWithAccuracy = new Map<\n    string,\n    { correctCount: number; totalCount: number; accuracy: number }\n  >();\n  difficultyStats.forEach((stats, difficulty) => {\n    statsWithAccuracy.set(difficulty, {\n      correctCount: stats.correctCount,\n      totalCount: stats.totalCount,\n      accuracy: stats.totalCount > 0 ? (stats.correctCount / stats.totalCount) * 100 : 0,\n    });\n  });\n\n  return statsWithAccuracy;\n}\n\n// \nexport function getTodayIncorrectWords(): string[] {\n  const progress = loadProgressSync();\n  const today = new Date().toLocaleDateString('ja-JP');\n  const incorrectWords = new Set<string>();\n\n  progress.results.forEach((result) => {\n    if (new Date(result.date).toLocaleDateString('ja-JP') === today) {\n      result.incorrectWords.forEach((word) => incorrectWords.add(word));\n    }\n  });\n\n  return Array.from(incorrectWords);\n}\n\n// \nexport function getDailyStudyTime(days: number = 7): Array<{ date: string; timeSpent: number }> {\n  const progress = loadProgressSync();\n  const now = Date.now();\n  const startDate = now - days * 24 * 60 * 60 * 1000;\n\n  const dailyTime = new Map<string, number>();\n\n  progress.results\n    .filter((r) => r.date >= startDate)\n    .forEach((result) => {\n      const dateStr = new Date(result.date).toLocaleDateString('ja-JP');\n      dailyTime.set(dateStr, (dailyTime.get(dateStr) || 0) + result.timeSpent);\n    });\n\n  return Array.from(dailyTime.entries())\n    .map(([date, timeSpent]) => ({ date, timeSpent }))\n    .sort((a, b) => new Date(a.date).getTime() - new Date(b.date).getTime());\n}\n\n// \nexport function getTodayStats(\n  mode?: 'translation' | 'spelling' | 'reading' | 'grammar' | 'memorization'\n): {\n  todayCorrectCount: number;\n  todayTotalAnswered: number;\n  todayAccuracy: number;\n} {\n  const progress = loadProgressSync();\n  const today = new Date().setHours(0, 0, 0, 0);\n  const tomorrow = today + 24 * 60 * 60 * 1000;\n\n  // \n  let todayResults = progress.results.filter((r) => r.date >= today && r.date < tomorrow);\n\n  // \n  if (mode) {\n    todayResults = todayResults.filter((r) => r.mode === mode);\n  }\n\n  const todayCorrectCount = todayResults.reduce((sum, r) => sum + r.score, 0);\n  const todayTotalAnswered = todayResults.reduce((sum, r) => sum + r.total, 0);\n  const todayAccuracy =\n    todayTotalAnswered > 0 ? Math.round((todayCorrectCount / todayTotalAnswered) * 100) : 0;\n\n  return {\n    todayCorrectCount,\n    todayTotalAnswered,\n    todayAccuracy,\n  };\n}\n\n// \nexport function getWeeklyStats(): {\n  studyDays: number;\n  totalDays: number;\n  totalAnswered: number;\n  accuracy: number;\n  newMastered: number;\n  previousWeekAccuracy: number;\n} {\n  const progress = loadProgressSync();\n  const now = new Date();\n\n  // \n  const currentDay = now.getDay();\n  const mondayOffset = currentDay === 0 ? -6 : 1 - currentDay;\n  const weekStart = new Date(now);\n  weekStart.setDate(now.getDate() + mondayOffset);\n  weekStart.setHours(0, 0, 0, 0);\n\n  const weekEnd = new Date(weekStart);\n  weekEnd.setDate(weekStart.getDate() + 7);\n\n  // \n  const lastWeekStart = new Date(weekStart);\n  lastWeekStart.setDate(weekStart.getDate() - 7);\n  const lastWeekEnd = new Date(weekStart);\n\n  // \n  const thisWeekResults = progress.results.filter(\n    (r) => r.date >= weekStart.getTime() && r.date < weekEnd.getTime()\n  );\n\n  // \n  const lastWeekResults = progress.results.filter(\n    (r) => r.date >= lastWeekStart.getTime() && r.date < lastWeekEnd.getTime()\n  );\n\n  // \n  const studyDatesThisWeek = new Set<string>();\n  thisWeekResults.forEach((r) => {\n    const date = new Date(r.date).toISOString().split('T')[0];\n    studyDatesThisWeek.add(date);\n  });\n\n  // \n  const totalAnswered = thisWeekResults.reduce((sum, r) => sum + r.total, 0);\n  const totalCorrect = thisWeekResults.reduce((sum, r) => sum + r.score, 0);\n  const accuracy = totalAnswered > 0 ? (totalCorrect / totalAnswered) * 100 : 0;\n\n  // \n  const lastWeekTotalAnswered = lastWeekResults.reduce((sum, r) => sum + r.total, 0);\n  const lastWeekTotalCorrect = lastWeekResults.reduce((sum, r) => sum + r.score, 0);\n  const previousWeekAccuracy =\n    lastWeekTotalAnswered > 0 ? (lastWeekTotalCorrect / lastWeekTotalAnswered) * 100 : 0;\n\n  // \n  let newMastered = 0;\n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.masteryLevel === 'mastered' && wp.lastStudied >= weekStart.getTime()) {\n      newMastered++;\n    }\n  });\n\n  return {\n    studyDays: studyDatesThisWeek.size,\n    totalDays: 7,\n    totalAnswered,\n    accuracy,\n    newMastered,\n    previousWeekAccuracy,\n  };\n}\n\n// \nexport function getMonthlyStats(): {\n  studyDays: number;\n  totalDays: number;\n  totalAnswered: number;\n  accuracy: number;\n  newMastered: number;\n} {\n  const progress = loadProgressSync();\n  const now = new Date();\n\n  // \n  const monthStart = new Date(now.getFullYear(), now.getMonth(), 1);\n  monthStart.setHours(0, 0, 0, 0);\n\n  const monthEnd = new Date(now.getFullYear(), now.getMonth() + 1, 0);\n  monthEnd.setHours(23, 59, 59, 999);\n\n  // \n  const thisMonthResults = progress.results.filter(\n    (r) => r.date >= monthStart.getTime() && r.date <= monthEnd.getTime()\n  );\n\n  // \n  const studyDatesThisMonth = new Set<string>();\n  thisMonthResults.forEach((r) => {\n    const date = new Date(r.date).toISOString().split('T')[0];\n    studyDatesThisMonth.add(date);\n  });\n\n  // \n  const totalAnswered = thisMonthResults.reduce((sum, r) => sum + r.total, 0);\n  const totalCorrect = thisMonthResults.reduce((sum, r) => sum + r.score, 0);\n  const accuracy = totalAnswered > 0 ? (totalCorrect / totalAnswered) * 100 : 0;\n\n  // \n  let newMastered = 0;\n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.masteryLevel === 'mastered' && wp.lastStudied >= monthStart.getTime()) {\n      newMastered++;\n    }\n  });\n\n  const totalDays = monthEnd.getDate();\n\n  return {\n    studyDays: studyDatesThisMonth.size,\n    totalDays,\n    totalAnswered,\n    accuracy,\n    newMastered,\n  };\n}\n\n// \nexport function getDetailedRetentionStats(): DetailedRetentionStats {\n  const progress = loadProgressSync();\n  const allWords = Object.values(progress.wordProgress);\n  const appearedWords = allWords.filter((wp) => wp.correctCount + wp.incorrectCount > 0);\n\n  let masteredCount = 0;\n  let learningCount = 0;\n  let strugglingCount = 0;\n\n  appearedWords.forEach((wp) => {\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    const accuracy = totalAttempts > 0 ? (wp.correctCount / totalAttempts) * 100 : 0;\n\n    //  \n    const isDefinitelyMastered =\n      (totalAttempts === 1 && wp.correctCount === 1) || // 1\n      wp.consecutiveCorrect >= 3 || // 3\n      (wp.consecutiveCorrect >= 2 && accuracy >= 80); // 2 + 80%\n\n    if (isDefinitelyMastered) {\n      masteredCount++;\n    }\n    //  50%\n    else if (accuracy >= 50) {\n      learningCount++;\n    }\n    //  50%\n    else {\n      strugglingCount++;\n    }\n  });\n\n  const total = appearedWords.length;\n\n  // =1.0, =0.5, =0.0\n  const weightedScore = masteredCount * 1.0 + learningCount * 0.5;\n\n  return {\n    totalWords: allWords.length,\n    appearedWords: total,\n\n    masteredCount,\n    learningCount,\n    strugglingCount,\n\n    basicRetentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    weightedRetentionRate: total > 0 ? Math.round((weightedScore / total) * 100) : 0,\n\n    masteredPercentage: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    learningPercentage: total > 0 ? Math.round((learningCount / total) * 100) : 0,\n    strugglingPercentage: total > 0 ? Math.round((strugglingCount / total) * 100) : 0,\n\n    // \n    masteredWords: masteredCount,\n    learningWords: learningCount,\n    newWords: allWords.length - total,\n    retentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    averageAttempts: 0,\n    categoryBreakdown: {},\n    difficultyBreakdown: {},\n  };\n}\n\n// \nexport function getNearMasteryStats(): {\n  nearMasteryCount: number;\n  learningCount: number;\n  averageRemainingAnswers: number;\n  longTermMemoryCount: number;\n  superMemoryCount: number;\n} {\n  const progress = loadProgressSync();\n  let nearMasteryCount = 0;\n  let learningCount = 0;\n  let totalRemaining = 0;\n  let longTermMemoryCount = 0;\n  let superMemoryCount = 0;\n\n  Object.values(progress.wordProgress).forEach((wp) => {\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    if (totalAttempts === 0) return;\n\n    const masteryResult = checkFlexibleMastery(wp, true);\n    if (masteryResult.isMastered) {\n      // \n      if (wp.consecutiveCorrect >= 7) {\n        superMemoryCount++;\n      } else if (wp.consecutiveCorrect >= 5) {\n        longTermMemoryCount++;\n      }\n      return;\n    }\n\n    learningCount++;\n\n    // 1\n    const { consecutiveCorrect } = wp;\n    const accuracy = wp.correctCount / totalAttempts;\n\n    if (\n      consecutiveCorrect === 2 || // 2\n      (accuracy >= 0.9 && consecutiveCorrect === 1 && totalAttempts >= 2) || // \n      (totalAttempts >= 4 && accuracy >= 0.75) // \n    ) {\n      nearMasteryCount++;\n      totalRemaining += 1;\n    } else {\n      totalRemaining += Math.max(1, 3 - consecutiveCorrect);\n    }\n  });\n\n  return {\n    nearMasteryCount,\n    learningCount,\n    averageRemainingAnswers:\n      learningCount > 0 ? Math.round((totalRemaining / learningCount) * 10) / 10 : 0,\n    longTermMemoryCount,\n    superMemoryCount,\n  };\n}\n\n// \nexport function getDifficultyStatsForRadar(mode: 'translation' | 'spelling' | 'reading'): {\n  labels: string[];\n  answeredData: number[];\n  correctData: number[];\n} {\n  const progress = loadProgressSync();\n  const difficultyMap = new Map<string, { answered: number; correct: number }>();\n\n  // \n  progress.results\n    .filter((r) => r.mode === mode && r.difficulty)\n    .forEach((result) => {\n      const difficulty = result.difficulty!;\n      const existing = difficultyMap.get(difficulty) || { answered: 0, correct: 0 };\n      difficultyMap.set(difficulty, {\n        answered: existing.answered + result.total,\n        correct: existing.correct + result.score,\n      });\n    });\n\n  // :     \n  const difficultyOrder = ['', '', ''];\n  const labels: string[] = [];\n  const answeredData: number[] = [];\n  const correctData: number[] = [];\n\n  difficultyOrder.forEach((difficulty) => {\n    const stats = difficultyMap.get(difficulty);\n    if (stats) {\n      labels.push(difficulty);\n      answeredData.push(stats.answered);\n      correctData.push(stats.correct);\n    }\n  });\n\n  // \n  if (labels.length === 0) {\n    return {\n      labels: ['', '', ''],\n      answeredData: [0, 0, 0],\n      correctData: [0, 0, 0],\n    };\n  }\n\n  return { labels, answeredData, correctData };\n}\n\n// \nexport function getRecentlyMasteredWords(\n  days: number = 7,\n  limit: number = 10\n): Array<{\n  word: string;\n  masteredDate: number;\n  totalAttempts: number;\n}> {\n  const progress = loadProgressSync();\n  const cutoff = Date.now() - days * 24 * 60 * 60 * 1000;\n\n  const words = Object.entries(progress.wordProgress)\n    .filter(([_, wp]) => wp.masteryLevel === 'mastered' && wp.lastStudied >= cutoff)\n    .map(([word, wp]) => ({\n      word,\n      masteredDate: wp.lastStudied,\n      totalAttempts: wp.correctCount + wp.incorrectCount,\n    }))\n    .sort((a, b) => b.masteredDate - a.masteredDate)\n    .slice(0, limit);\n\n  return words;\n}\n\n// \nexport function getCategoryDifficultyStats(mode: 'translation' | 'spelling'): {\n  labels: string[];\n  accuracyData: { beginner: number[]; intermediate: number[]; advanced: number[] };\n  progressData: { beginner: number[]; intermediate: number[]; advanced: number[] };\n} {\n  const progress = loadProgressSync();\n\n  // \n  const statsMap = new Map<\n    string,\n    {\n      beginner: { correct: number; total: number; mastered: number; totalWords: number };\n      intermediate: { correct: number; total: number; mastered: number; totalWords: number };\n      advanced: { correct: number; total: number; mastered: number; totalWords: number };\n    }\n  >();\n\n  // \n  progress.results\n    .filter((r) => r.mode === mode && r.category && r.difficulty)\n    .forEach((result) => {\n      const category = result.category!;\n      const difficulty = result.difficulty!;\n\n      if (!statsMap.has(category)) {\n        statsMap.set(category, {\n          beginner: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n          intermediate: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n          advanced: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n        });\n      }\n\n      const stats = statsMap.get(category)!;\n      const difficultyKey =\n        difficulty === '' ? 'beginner' : difficulty === '' ? 'intermediate' : 'advanced';\n\n      stats[difficultyKey].correct += result.score;\n      stats[difficultyKey].total += result.total;\n    });\n\n  // wordProgress\n  Object.entries(progress.wordProgress).forEach(([_word, wordProg]) => {\n    if (!wordProg.category || !wordProg.difficulty) return;\n\n    const category = wordProg.category;\n    const difficulty = wordProg.difficulty;\n\n    if (!statsMap.has(category)) {\n      statsMap.set(category, {\n        beginner: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n        intermediate: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n        advanced: { correct: 0, total: 0, mastered: 0, totalWords: 0 },\n      });\n    }\n\n    const stats = statsMap.get(category)!;\n    const difficultyKey =\n      difficulty === '' ? 'beginner' : difficulty === '' ? 'intermediate' : 'advanced';\n\n    stats[difficultyKey].totalWords += 1;\n\n    // \n    const totalAttempts = wordProg.correctCount + wordProg.incorrectCount;\n    const isFirstTimeCorrect = totalAttempts === 1 && wordProg.correctCount === 1;\n    const isConsecutivelyCorrect = wordProg.consecutiveCorrect >= 3;\n    const isSkipped = wordProg.skippedCount && wordProg.skippedCount > 0;\n\n    if (isFirstTimeCorrect || isConsecutivelyCorrect || isSkipped) {\n      stats[difficultyKey].mastered += 1;\n    }\n  });\n\n  // \n  const categoryOrder = [\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n    '',\n  ];\n\n  const labels: string[] = [];\n  const accuracyBeginner: number[] = [];\n  const accuracyIntermediate: number[] = [];\n  const accuracyAdvanced: number[] = [];\n  const progressBeginner: number[] = [];\n  const progressIntermediate: number[] = [];\n  const progressAdvanced: number[] = [];\n\n  categoryOrder.forEach((category) => {\n    const stats = statsMap.get(category);\n    if (\n      stats &&\n      (stats.beginner.total > 0 || stats.intermediate.total > 0 || stats.advanced.total > 0)\n    ) {\n      labels.push(category);\n\n      // %\n      accuracyBeginner.push(\n        stats.beginner.total > 0 ? (stats.beginner.correct / stats.beginner.total) * 100 : 0\n      );\n      accuracyIntermediate.push(\n        stats.intermediate.total > 0\n          ? (stats.intermediate.correct / stats.intermediate.total) * 100\n          : 0\n      );\n      accuracyAdvanced.push(\n        stats.advanced.total > 0 ? (stats.advanced.correct / stats.advanced.total) * 100 : 0\n      );\n\n      // / %\n      progressBeginner.push(\n        stats.beginner.totalWords > 0\n          ? (stats.beginner.mastered / stats.beginner.totalWords) * 100\n          : 0\n      );\n      progressIntermediate.push(\n        stats.intermediate.totalWords > 0\n          ? (stats.intermediate.mastered / stats.intermediate.totalWords) * 100\n          : 0\n      );\n      progressAdvanced.push(\n        stats.advanced.totalWords > 0\n          ? (stats.advanced.mastered / stats.advanced.totalWords) * 100\n          : 0\n      );\n    }\n  });\n\n  return {\n    labels,\n    accuracyData: {\n      beginner: accuracyBeginner,\n      intermediate: accuracyIntermediate,\n      advanced: accuracyAdvanced,\n    },\n    progressData: {\n      beginner: progressBeginner,\n      intermediate: progressIntermediate,\n      advanced: progressAdvanced,\n    },\n  };\n}\n\n// \nexport function getStatsByModeDifficulty(mode: 'translation' | 'spelling'): {\n  labels: string[];\n  accuracyData: number[];\n  retentionData: number[];\n} {\n  const progress = loadProgressSync();\n  const difficulties = ['beginner', 'intermediate', 'advanced'];\n  const labels = ['', '', ''];\n  const accuracyData: number[] = [];\n  const retentionData: number[] = [];\n\n  // \n  const modeResults = progress.results.filter((r) => r.mode === mode);\n\n  difficulties.forEach((difficulty) => {\n    // \n    const difficultyWords = new Set<string>();\n    const masteredWords = new Set<string>();\n    let totalCorrect = 0;\n    let totalQuestions = 0;\n\n    // \n    Object.entries(progress.wordProgress).forEach(([word, stats]) => {\n      const wordDifficulty = autoDetectWordDifficulty(word, stats);\n      const totalAttempts = stats.correctCount + stats.incorrectCount;\n\n      // \n      if (wordDifficulty === difficulty && totalAttempts > 0) {\n        difficultyWords.add(word);\n\n        // \n        totalCorrect += stats.correctCount;\n        totalQuestions += totalAttempts;\n\n        //  (85%3)\n        const accuracy = totalAttempts > 0 ? (stats.correctCount / totalAttempts) * 100 : 0;\n        if (accuracy >= 85 && totalAttempts >= 3) {\n          masteredWords.add(word);\n        }\n      }\n    });\n\n    // \n    const explicitResults = modeResults.filter((r) => r.difficulty === difficulty);\n    if (explicitResults.length > 0) {\n      totalCorrect += explicitResults.reduce((sum, r) => sum + r.score, 0);\n      totalQuestions += explicitResults.reduce((sum, r) => sum + r.total, 0);\n    }\n\n    // \n    const accuracy = totalQuestions > 0 ? (totalCorrect / totalQuestions) * 100 : 0;\n    accuracyData.push(accuracy);\n\n    // \n    const retention =\n      difficultyWords.size > 0 ? (masteredWords.size / difficultyWords.size) * 100 : 0;\n    retentionData.push(Math.min(100, Math.max(0, retention)));\n  });\n\n  return { labels, accuracyData, retentionData };\n}\n\n// \nexport function getGrammarDetailedRetentionStats(): DetailedRetentionStats {\n  const progress = loadProgressSync();\n  const allWords = Object.values(progress.wordProgress);\n\n  // \n  const grammarQuestions = allWords.filter(\n    (wp) =>\n      (wp.grammarAttempts && wp.grammarAttempts > 0) ||\n      wp.word.startsWith('grammar_') ||\n      wp.word.includes('_g')\n  );\n\n  // \n  const appearedQuestions = grammarQuestions.filter(\n    (wp) =>\n      (wp.grammarAttempts && wp.grammarAttempts > 0) || wp.correctCount + wp.incorrectCount > 0\n  );\n\n  let masteredCount = 0;\n  let learningCount = 0;\n  let strugglingCount = 0;\n\n  appearedQuestions.forEach((wp) => {\n    // \n    const totalAttempts = wp.grammarAttempts || wp.correctCount + wp.incorrectCount;\n    const correctCount = wp.grammarCorrect || wp.correctCount;\n    const consecutiveCorrect = wp.grammarStreak || wp.consecutiveCorrect;\n\n    const accuracy = totalAttempts > 0 ? (correctCount / totalAttempts) * 100 : 0;\n\n    //  \n    const isDefinitelyMastered =\n      (totalAttempts === 1 && correctCount === 1) ||\n      consecutiveCorrect >= 3 ||\n      (consecutiveCorrect >= 2 && accuracy >= 80);\n\n    if (isDefinitelyMastered) {\n      masteredCount++;\n    } else if (accuracy >= 50) {\n      learningCount++;\n    } else {\n      strugglingCount++;\n    }\n  });\n\n  const total = appearedQuestions.length;\n  const weightedScore = masteredCount * 1.0 + learningCount * 0.5;\n\n  return {\n    totalWords: grammarQuestions.length,\n    appearedWords: total,\n\n    masteredCount,\n    learningCount,\n    strugglingCount,\n\n    basicRetentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    weightedRetentionRate: total > 0 ? Math.round((weightedScore / total) * 100) : 0,\n\n    masteredPercentage: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    learningPercentage: total > 0 ? Math.round((learningCount / total) * 100) : 0,\n    strugglingPercentage: total > 0 ? Math.round((strugglingCount / total) * 100) : 0,\n\n    masteredWords: masteredCount,\n    learningWords: learningCount,\n    newWords: grammarQuestions.length - total,\n    retentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    averageAttempts: 0,\n    categoryBreakdown: {},\n    difficultyBreakdown: {},\n  };\n}\n\n// \nexport function getMemorizationDetailedRetentionStats(): DetailedRetentionStats {\n  const progress = loadProgressSync();\n  const allWords = Object.values(progress.wordProgress);\n\n  // \n  const memorizationWords = allWords.filter(\n    (wp) => wp.memorizationAttempts && wp.memorizationAttempts > 0\n  );\n\n  let masteredCount = 0;\n  let learningCount = 0;\n  let strugglingCount = 0;\n\n  memorizationWords.forEach((wp) => {\n    const totalAttempts = wp.memorizationAttempts || 0;\n    const correctCount = wp.memorizationCorrect || 0;\n    const stillLearningCount = wp.memorizationStillLearning || 0;\n    const consecutiveCorrect = wp.memorizationStreak || 0;\n\n    // 0.550%\n    const effectiveCorrect = correctCount + stillLearningCount * 0.5;\n    const accuracy = totalAttempts > 0 ? (effectiveCorrect / totalAttempts) * 100 : 0;\n\n    //  \n    const isDefinitelyMastered =\n      (totalAttempts === 1 && correctCount === 1) ||\n      consecutiveCorrect >= 3 ||\n      (consecutiveCorrect >= 2 && accuracy >= 80);\n\n    if (isDefinitelyMastered) {\n      masteredCount++;\n    } else if (accuracy >= 50 || stillLearningCount > 0) {\n      //  50% or \n      learningCount++;\n    } else {\n      //  50% and \n      strugglingCount++;\n    }\n  });\n\n  const total = memorizationWords.length;\n  const weightedScore = masteredCount * 1.0 + learningCount * 0.5;\n\n  return {\n    totalWords: allWords.length,\n    appearedWords: total,\n\n    masteredCount,\n    learningCount,\n    strugglingCount,\n\n    basicRetentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    weightedRetentionRate: total > 0 ? Math.round((weightedScore / total) * 100) : 0,\n\n    masteredPercentage: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    learningPercentage: total > 0 ? Math.round((learningCount / total) * 100) : 0,\n    strugglingPercentage: total > 0 ? Math.round((strugglingCount / total) * 100) : 0,\n\n    masteredWords: masteredCount,\n    learningWords: learningCount,\n    newWords: allWords.length - total,\n    retentionRate: total > 0 ? Math.round((masteredCount / total) * 100) : 0,\n    averageAttempts: 0,\n    categoryBreakdown: {},\n    difficultyBreakdown: {},\n  };\n}\n\n// \nexport function getGrammarUnitStats(): Array<{\n  unit: string;\n  totalQuestions: number;\n  answeredQuestions: number;\n  correctCount: number;\n  incorrectCount: number;\n  masteredCount: number;\n  accuracy: number;\n  progress: number;\n  historyIcons: string;\n}> {\n  const progress = loadProgressSync();\n\n  // \n  const grammarQuestions = Object.entries(progress.wordProgress).filter(([word, _]) =>\n    word.startsWith('grammar_')\n  );\n\n  // \n  const unitMap = new Map<\n    string,\n    {\n      questions: Array<[string, WordProgress]>;\n      answered: Array<[string, WordProgress]>;\n      correct: number;\n      incorrect: number;\n      mastered: number;\n      allHistory: Array<{ timestamp: number; wasCorrect: boolean }>; // \n    }\n  >();\n\n  grammarQuestions.forEach(([word, wp]) => {\n    // ID: grammar_vf-g3-u1-001  grammar_g3-u1-q1 \n    const match = word.match(/grammar_(?:\\w+-)?g(\\d+)-u(\\d+)/);\n    if (!match) {\n      // ID\n      if (word.startsWith('grammar_') && !word.includes('unknown')) {\n        console.warn(` ID: ${word}`);\n      }\n      return;\n    }\n\n    const grade = match[1];\n    const unit = match[2];\n    const unitKey = `${grade}_Unit${unit}`;\n\n    if (!unitMap.has(unitKey)) {\n      unitMap.set(unitKey, {\n        questions: [],\n        answered: [],\n        correct: 0,\n        incorrect: 0,\n        mastered: 0,\n        allHistory: [],\n      });\n    }\n\n    const unitData = unitMap.get(unitKey)!;\n    unitData.questions.push([word, wp]);\n\n    const totalAttempts = wp.grammarAttempts || wp.correctCount + wp.incorrectCount;\n    if (totalAttempts > 0) {\n      unitData.answered.push([word, wp]);\n      const correctCount = wp.grammarCorrect || wp.correctCount || 0;\n      const incorrectCount = totalAttempts - correctCount;\n      unitData.correct += correctCount;\n      unitData.incorrect += incorrectCount;\n\n      // learningHistory10\n      if (wp.learningHistory && wp.learningHistory.length > 0) {\n        const recentHistory = wp.learningHistory.slice(-10);\n        unitData.allHistory.push(...recentHistory);\n      }\n\n      // \n      const consecutiveCorrect = wp.grammarStreak || wp.consecutiveCorrect || 0;\n      const accuracy = totalAttempts > 0 ? (correctCount / totalAttempts) * 100 : 0;\n      const isMarkedAsMastered = wp.masteryLevel === 'mastered';\n      const isOneShot = totalAttempts === 1 && correctCount === 1;\n      const isStableAccuracy = totalAttempts >= 3 && accuracy >= 85;\n\n      if (isMarkedAsMastered || isOneShot || isStableAccuracy || consecutiveCorrect >= 3) {\n        unitData.mastered++;\n      }\n    }\n  });\n\n  // \n  const result = Array.from(unitMap.entries()).map(([unit, data]) => {\n    const totalAttempts = data.correct + data.incorrect;\n    const accuracy = totalAttempts > 0 ? (data.correct / totalAttempts) * 100 : 0;\n    const progress =\n      data.questions.length > 0 ? (data.answered.length / data.questions.length) * 100 : 0;\n\n    // 10\n    const sortedHistory = data.allHistory.sort((a, b) => a.timestamp - b.timestamp).slice(-10);\n    const historyIcons = sortedHistory.map((h) => (h.wasCorrect ? '' : '')).join('');\n\n    return {\n      unit,\n      totalQuestions: data.questions.length,\n      answeredQuestions: data.answered.length,\n      correctCount: data.correct,\n      incorrectCount: data.incorrect,\n      masteredCount: data.mastered,\n      accuracy: Math.round(accuracy),\n      progress: Math.round(progress),\n      historyIcons,\n    };\n  });\n\n  // \n  result.sort((a, b) => a.unit.localeCompare(b.unit));\n\n  return result;\n}\n","// IndexedDB/LocalStorage\n\nimport {\n  saveProgressData,\n  loadProgressData,\n  saveSetting,\n  loadSetting,\n} from '@/storage/manager/storageManager';\nimport { logger } from '@/utils/logger';\nimport { formatLocalYYYYMMDD, QUIZ_RESULT_EVENT } from '@/utils';\nimport type { ReadingPassage, ReadingPhrase, ReadingSegment } from '@/types/storage';\nimport { deleteDatabase } from '@/storage/indexedDB/indexedDBStorage';\n\n// re-export\nimport type {\n  SessionHistoryItem,\n  StudySettings,\n  QuizResult,\n  WordProgress,\n  UserProgress,\n  DetailedRetentionStats,\n  MasteryPrediction,\n  DailyPlanInfo,\n  Statistics,\n  QuestionSetStats,\n} from './types';\n\nexport type {\n  SessionHistoryItem,\n  StudySettings,\n  QuizResult,\n  WordProgress,\n  UserProgress,\n  DetailedRetentionStats,\n  MasteryPrediction,\n  DailyPlanInfo,\n  Statistics,\n  QuestionSetStats,\n};\n\n// re-export\nexport { getStudySettings, saveStudySettings, updateStudySettings } from './settings';\n\n// re-export\nexport { addSessionHistory, getSessionHistory, clearSessionHistory } from './sessionHistory';\n\n// LocalStorage\nconst STORAGE_KEY = 'progress-data';\nconst _MAX_RESULTS_PER_MODE = 50; // \nconst PROGRESS_KEY = 'quiz-app-user-progress';\nconst MAX_RESULTS = 300; // \nconst MAX_RESPONSE_TIMES = 3; // \n\n// \nfunction initializeProgress(): UserProgress {\n  return {\n    results: [],\n    statistics: {\n      totalQuizzes: 0,\n      totalQuestions: 0,\n      totalCorrect: 0,\n      averageScore: 0,\n      bestScore: 0,\n      streakDays: 0,\n      lastStudyDate: 0,\n      studyDates: [],\n    },\n    questionSetStats: {},\n    categoryStats: {},\n    difficultyStats: {},\n    wordProgress: {},\n  };\n}\n\n// IndexedDB\nexport async function loadProgress(): Promise<UserProgress> {\n  try {\n    // \n    const data = await loadProgressData();\n\n    if (!data) {\n      const initialized = initializeProgress();\n      updateProgressCache(initialized);\n      return initialized;\n    }\n\n    // ProgressDataUserProgressPhase 3\n    const rawData = data as Record<string, unknown>;\n    const progress: UserProgress = {\n      results: (rawData.results || []) as unknown as QuizResult[],\n      statistics: (rawData.statistics || {\n        totalQuizzes: 0,\n        totalQuestions: 0,\n        totalCorrect: 0,\n        averageScore: 0,\n        bestScore: 0,\n        streakDays: 0,\n        lastStudyDate: 0,\n        studyDates: [],\n      }) as Statistics,\n      questionSetStats: (rawData.questionSetStats || {}) as Record<string, QuestionSetStats>,\n      categoryStats: {},\n      difficultyStats: {},\n      wordProgress: (rawData.wordProgress || {}) as unknown as { [word: string]: WordProgress },\n    };\n\n    // \n    if (!progress.statistics) {\n      progress.statistics = {\n        totalQuizzes: 0,\n        totalQuestions: 0,\n        totalCorrect: 0,\n        averageScore: 0,\n        bestScore: 0,\n        streakDays: 0,\n        lastStudyDate: 0,\n        studyDates: [],\n      };\n    }\n    if (!progress.questionSetStats) {\n      progress.questionSetStats = {};\n    }\n    if (!progress.wordProgress) {\n      progress.wordProgress = {};\n    }\n    if (!progress.results) {\n      progress.results = [];\n    }\n\n    // \n    compressProgressData(progress);\n\n    // \n    updateProgressCache(progress);\n\n    return progress;\n  } catch (error) {\n    logger.error(':', error);\n    const initialized = initializeProgress();\n    updateProgressCache(initialized);\n    return initialized;\n  }\n}\n\n// loadProgress - \nlet progressCache: UserProgress | null = null;\n\n// \nfunction ensureProgressCache(): UserProgress {\n  if (!progressCache) {\n    progressCache = initializeProgress();\n    logger.log(' Progress cache initialized with default data');\n  }\n  return progressCache;\n}\n\nexport function loadProgressSync(): UserProgress {\n  if (progressCache) {\n    // statistics\n    if (!progressCache.statistics) {\n      logger.warn(' Cache missing statistics, reinitializing');\n      progressCache = initializeProgress();\n    }\n    return progressCache;\n  }\n\n  // \n  ensureProgressCache();\n\n  // LocalStorage\n  try {\n    const data = localStorage.getItem(STORAGE_KEY);\n    if (!data) {\n      const initialized = initializeProgress();\n      progressCache = initialized;\n      return initialized;\n    }\n    const progress = JSON.parse(data) as UserProgress;\n\n    // \n    if (!progress.statistics) {\n      progress.statistics = {\n        totalQuizzes: 0,\n        totalQuestions: 0,\n        totalCorrect: 0,\n        averageScore: 0,\n        bestScore: 0,\n        streakDays: 0,\n        lastStudyDate: 0,\n        studyDates: [],\n      };\n    }\n    if (!progress.questionSetStats) {\n      progress.questionSetStats = {};\n    }\n    if (!progress.wordProgress) {\n      progress.wordProgress = {};\n    }\n    if (!progress.results) {\n      progress.results = [];\n    }\n    if (!progress.results) {\n      progress.results = [];\n    }\n\n    compressProgressData(progress);\n    progressCache = progress;\n    return progress;\n  } catch (error) {\n    logger.error(':', error);\n    const initialized = initializeProgress();\n    progressCache = initialized;\n    return initialized;\n  }\n}\n\n// \nexport function updateProgressCache(progress: UserProgress): void {\n  progressCache = progress;\n  logger.log(' progressCache - results:', progress.results.length);\n}\n\n// IndexedDB\nexport async function saveProgress(progress: UserProgress): Promise<void> {\n  try {\n    // : \n    compressProgressData(progress);\n\n    // \n    updateProgressCache(progress);\n\n    // LocalStorage\n    try {\n      localStorage.setItem(STORAGE_KEY, JSON.stringify(progress));\n    } catch (e) {\n      logger.warn('LocalStorage:', e);\n    }\n\n    // UserProgressProgressData\n    const progressData: import('@/types/storage').ProgressData = {\n      quizzes: {},\n      lastUpdated: Date.now(),\n      totalAnswered: {},\n      totalMastered: {},\n      results: progress.results as unknown as import('@/types/storage').QuizResult[],\n      statistics: progress.statistics,\n      questionSetStats: progress.questionSetStats,\n      wordProgress: progress.wordProgress as unknown as {\n        [word: string]: import('@/types/storage').WordProgress;\n      },\n    };\n\n    // \n    const saved = await saveProgressData(progressData);\n\n    if (!saved) {\n      logger.error('');\n    }\n  } catch (error) {\n    logger.error(':', error);\n  }\n}\n\n// : \nfunction compressProgressData(progress: UserProgress): void {\n  // 1. 500\n  if (progress.results.length > MAX_RESULTS) {\n    progress.results.sort((a, b) => b.date - a.date);\n    progress.results = progress.results.slice(0, MAX_RESULTS);\n  }\n\n  // 2.  - \n  // \n\n  // 3. \n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.responseTimes && wp.responseTimes.length > MAX_RESPONSE_TIMES) {\n      wp.responseTimes = wp.responseTimes.slice(-MAX_RESPONSE_TIMES);\n    }\n  });\n}\n\n// : \nfunction _emergencyCompress(progress: UserProgress): void {\n  logger.log('...');\n\n  // 1. 300\n  if (progress.results.length > 300) {\n    progress.results.sort((a, b) => b.date - a.date);\n    progress.results = progress.results.slice(0, 300);\n  }\n\n  // 2. 2000\n  const wordEntries = Object.entries(progress.wordProgress);\n  if (wordEntries.length > 2000) {\n    wordEntries.sort((a, b) => b[1].lastStudied - a[1].lastStudied);\n    progress.wordProgress = Object.fromEntries(wordEntries.slice(0, 2000));\n  }\n\n  // 3. 3\n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.responseTimes && wp.responseTimes.length > 3) {\n      wp.responseTimes = wp.responseTimes.slice(-3);\n    }\n  });\n\n  // 4. 180\n  if (progress.statistics.studyDates.length > 180) {\n    progress.statistics.studyDates.sort((a, b) => b - a);\n    progress.statistics.studyDates = progress.statistics.studyDates.slice(0, 180);\n  }\n\n  logger.log('');\n}\n\n// \nexport async function addQuizResult(result: QuizResult): Promise<void> {\n  const progress = await loadProgress();\n  progress.results.push(result);\n\n  logger.log(' addQuizResult:', {\n    mode: result.mode,\n    score: result.score,\n    total: result.total,\n    date: new Date(result.date).toISOString(),\n    resultsCount: progress.results.length,\n  });\n\n  // \n  updateStatistics(progress, result);\n\n  await saveProgress(progress);\n\n  logger.log(' saveProgress - results:', progress.results.length);\n\n  // StatsView\n  try {\n    if (typeof window !== 'undefined') {\n      const evt = new CustomEvent(QUIZ_RESULT_EVENT, { detail: { result } });\n      window.dispatchEvent(evt);\n    }\n  } catch {\n    // SSRwindow\n  }\n}\n\n// \nfunction updateStatistics(progress: UserProgress, result: QuizResult): void {\n  const stats = progress.statistics;\n\n  // \n  stats.totalQuizzes++;\n  stats.totalQuestions += result.total;\n  stats.totalCorrect += result.score;\n  stats.averageScore =\n    stats.totalQuestions > 0 ? (stats.totalCorrect / stats.totalQuestions) * 100 : 0;\n  stats.bestScore = Math.max(stats.bestScore, result.percentage);\n  stats.lastStudyDate = result.date;\n\n  // \n  const today = new Date(result.date).setHours(0, 0, 0, 0);\n  if (!stats.studyDates.includes(today)) {\n    stats.studyDates.push(today);\n    stats.studyDates.sort((a, b) => b - a); // \n  }\n\n  // \n  stats.streakDays = calculateStreakDays(stats.studyDates);\n\n  // \n  if (!progress.questionSetStats[result.questionSetId]) {\n    progress.questionSetStats[result.questionSetId] = {\n      attempts: 0,\n      bestScore: 0,\n      averageScore: 0,\n      lastAttempt: 0,\n      totalTimeSpent: 0,\n    };\n  }\n\n  const setStats = progress.questionSetStats[result.questionSetId];\n  setStats.attempts++;\n  setStats.bestScore = Math.max(setStats.bestScore, result.percentage);\n  setStats.lastAttempt = result.date;\n  setStats.totalTimeSpent += result.timeSpent;\n\n  // \n  const setResults = progress.results.filter((r) => r.questionSetId === result.questionSetId);\n  const totalScore = setResults.reduce((sum, r) => sum + r.percentage, 0);\n  setStats.averageScore = totalScore / setResults.length;\n}\n\n// \nfunction calculateStreakDays(studyDates: number[]): number {\n  if (studyDates.length === 0) return 0;\n\n  const today = new Date().setHours(0, 0, 0, 0);\n  const yesterday = today - 24 * 60 * 60 * 1000;\n\n  // \n  const latestStudy = studyDates[0];\n  if (latestStudy !== today && latestStudy !== yesterday) {\n    return 0;\n  }\n\n  let streak = 1;\n  for (let i = 1; i < studyDates.length; i++) {\n    const diff = studyDates[i - 1] - studyDates[i];\n    const daysDiff = diff / (24 * 60 * 60 * 1000);\n\n    if (daysDiff === 1) {\n      streak++;\n    } else {\n      break;\n    }\n  }\n\n  return streak;\n}\n\n// \nexport function getResultsByDateRange(startDate: number, endDate: number): QuizResult[] {\n  const progress = loadProgressSync();\n  return progress.results.filter((r) => r.date >= startDate && r.date <= endDate);\n}\n\n// getTodayIncorrectWords, getStatsByModestatistics.ts\n\n// \nexport function exportProgress(): string {\n  const progress = loadProgressSync();\n  return JSON.stringify(progress, null, 2);\n}\n\n// \nexport function importProgress(jsonData: string): boolean {\n  try {\n    const progress = JSON.parse(jsonData) as UserProgress;\n\n    // \n    if (!progress.results || !progress.statistics || !progress.questionSetStats) {\n      throw new Error('');\n    }\n\n    saveProgress(progress);\n    return true;\n  } catch (error) {\n    logger.error(':', error);\n    return false;\n  }\n}\n\n// \nexport function clearProgress(): void {\n  if (confirm('')) {\n    localStorage.removeItem(PROGRESS_KEY);\n    alert('');\n  }\n}\n\n// \nexport function getWeakWords(limit: number = 10): Array<{ word: string; mistakes: number }> {\n  const progress = loadProgressSync();\n  const wordMistakes = new Map<string, number>();\n\n  progress.results.forEach((result) => {\n    result.incorrectWords.forEach((word) => {\n      wordMistakes.set(word, (wordMistakes.get(word) || 0) + 1);\n    });\n  });\n\n  return Array.from(wordMistakes.entries())\n    .map(([word, mistakes]) => ({ word, mistakes }))\n    .sort((a, b) => b.mistakes - a.mistakes)\n    .slice(0, limit);\n}\n\n/**\n * \n * : 52080% & 3\n */\nexport function getOvercomeWeakWords(limit: number = 10): Array<{\n  word: string;\n  totalMistakes: number;\n  recentAccuracy: number;\n  overcomeScore: number; // \n}> {\n  const progress = loadProgressSync();\n\n  // \n  const wordMistakes = new Map<string, number>();\n  progress.results.forEach((result) => {\n    result.incorrectWords.forEach((word) => {\n      wordMistakes.set(word, (wordMistakes.get(word) || 0) + 1);\n    });\n  });\n\n  const overcomeWords: Array<{\n    word: string;\n    totalMistakes: number;\n    recentAccuracy: number;\n    overcomeScore: number;\n  }> = [];\n\n  // 5\n  wordMistakes.forEach((mistakes, word) => {\n    if (mistakes < 5) return;\n\n    const wp = progress.wordProgress[word];\n    if (!wp) return;\n\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    if (totalAttempts === 0) return;\n\n    // 20\n    const _recentAttempts = Math.min(totalAttempts, 20);\n    const accuracy = (wp.correctCount / totalAttempts) * 100;\n\n    // :\n    // 1. 80%\n    // 2. 1 OR 3 OR 85%\n    const hasHighAccuracy = accuracy >= 80;\n    const isFirstTimeCorrect = totalAttempts === 1 && wp.correctCount === 1;\n    const isCurrentlyMastered = isFirstTimeCorrect || wp.consecutiveCorrect >= 3 || accuracy >= 85;\n\n    if (hasHighAccuracy && isCurrentlyMastered) {\n      //  =   \n      const overcomeScore = mistakes * accuracy;\n\n      overcomeWords.push({\n        word,\n        totalMistakes: mistakes,\n        recentAccuracy: Math.round(accuracy),\n        overcomeScore,\n      });\n    }\n  });\n\n  // \n  return overcomeWords.sort((a, b) => b.overcomeScore - a.overcomeScore).slice(0, limit);\n}\n\n/**\n * \n * \n */\nexport function getCurrentWeakWords(limit: number = 10): Array<{\n  word: string;\n  mistakes: number;\n  recentAccuracy: number;\n  meaning?: string;\n  reading?: string;\n}> {\n  const progress = loadProgressSync();\n\n  // \n  const wordMistakes = new Map<string, number>();\n  progress.results.forEach((result) => {\n    result.incorrectWords.forEach((word) => {\n      wordMistakes.set(word, (wordMistakes.get(word) || 0) + 1);\n    });\n  });\n\n  const currentWeakWords: Array<{\n    word: string;\n    mistakes: number;\n    recentAccuracy: number;\n    meaning?: string;\n    reading?: string;\n  }> = [];\n\n  wordMistakes.forEach((mistakes, word) => {\n    const wp = progress.wordProgress[word];\n\n    // WordProgress\n    if (!wp) {\n      currentWeakWords.push({\n        word,\n        mistakes,\n        recentAccuracy: 0,\n        meaning: undefined,\n        reading: undefined,\n      });\n      return;\n    }\n\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    const accuracy = totalAttempts > 0 ? (wp.correctCount / totalAttempts) * 100 : 0;\n\n    // getOvercomeWeakWords\n    const isFirstTimeCorrect = totalAttempts === 1 && wp.correctCount === 1;\n    const isOvercome =\n      mistakes >= 5 &&\n      accuracy >= 80 &&\n      (isFirstTimeCorrect || wp.consecutiveCorrect >= 3 || accuracy >= 85);\n\n    // \n    if (!isOvercome) {\n      currentWeakWords.push({\n        word,\n        mistakes,\n        recentAccuracy: Math.round(accuracy),\n        meaning: wp.meaning,\n        reading: wp.reading,\n      });\n    }\n  });\n\n  // \n  return currentWeakWords.sort((a, b) => b.mistakes - a.mistakes).slice(0, limit);\n}\n\n// getDailyStudyTime, getTodayStatsstatistics.ts\n\n// ==========  ==========\n\n// \nfunction initializeWordProgress(word: string): WordProgress {\n  return {\n    word,\n    correctCount: 0,\n    incorrectCount: 0,\n    consecutiveCorrect: 0,\n    consecutiveIncorrect: 0,\n    lastStudied: 0,\n    totalResponseTime: 0,\n    averageResponseTime: 0,\n    difficultyScore: 50, // \n    masteryLevel: 'new',\n    responseTimes: [], // \n  };\n}\n\n// 0-100\nfunction calculateDifficultyScore(wordProgress: WordProgress): number {\n  const total = wordProgress.correctCount + wordProgress.incorrectCount;\n  if (total === 0) return 50; // \n\n  const accuracy = wordProgress.correctCount / total;\n  const baseScore = (1 - accuracy) * 100; // \n\n  // +20\n  const consecutivePenalty = Math.min(wordProgress.consecutiveIncorrect * 5, 20);\n\n  // +15\n  const avgTime = wordProgress.averageResponseTime / 1000; // \n  const timePenalty = Math.min(avgTime > 5 ? (avgTime - 5) * 3 : 0, 15);\n\n  // \n  const userRatingBonus = wordProgress.userDifficultyRating\n    ? (wordProgress.userDifficultyRating - 5.5) * 5 // 1-10-22.5+22.5\n    : 0;\n\n  const finalScore = baseScore + consecutivePenalty + timePenalty + userRatingBonus;\n\n  return Math.max(0, Math.min(100, finalScore)); // 0-100\n}\n\n/**\n * \n * \n * \n */\ninterface MasteryResult {\n  isMastered: boolean;\n  excludeDays: number; // \n  reason: string; // \n  confidence: number; // 0-1\n  masteryLevel: number; // 1-7\n}\n\n/**\n * SM-2\n * \n *\n * :\n * - : \n * - : \n * -  (LTP): \n *\n * :\n * 1: 1\n * 2: 3\n * 3: 7    \n * 4: 14\n * 5: 30   \n * 6: 90   \n * 7: 180  \n * 8: 365  1\n */\nfunction calculateExponentialInterval(consecutiveCorrect: number): number {\n  // \n  const intervals = [\n    1, // 0: \n    1, // 1: 1\n    3, // 2: 3\n    7, // 3: 1\n    14, // 4: 2\n    30, // 5: 1\n    90, // 6: 3\n    180, // 7: 6\n    365, // 8: 1\n  ];\n\n  // 8365\n  if (consecutiveCorrect >= intervals.length) {\n    return 365;\n  }\n\n  return intervals[consecutiveCorrect] || 1;\n}\n\nexport function checkFlexibleMastery(\n  wordProgress: WordProgress,\n  isCorrect: boolean\n): MasteryResult {\n  const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n  const accuracy = totalAttempts > 0 ? wordProgress.correctCount / totalAttempts : 0;\n  const { consecutiveCorrect, lastStudied } = wordProgress;\n\n  // \n  const hoursSinceLastStudy = (Date.now() - lastStudied) / (1000 * 60 * 60);\n  const daysSinceLastStudy = hoursSinceLastStudy / 24;\n\n  // ===  ===\n\n  // 1: 1\n  if (totalAttempts === 1 && isCorrect) {\n    const excludeDays = calculateExponentialInterval(1);\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `1${excludeDays}`,\n      confidence: 0.85,\n      masteryLevel: 1,\n    };\n  }\n\n  // 2: \n  if (consecutiveCorrect >= 2 && isCorrect) {\n    const excludeDays = calculateExponentialInterval(consecutiveCorrect);\n    const masteryLevel = Math.min(7, Math.floor(consecutiveCorrect / 1));\n\n    let reason = '';\n    if (consecutiveCorrect >= 7) {\n      reason = `${consecutiveCorrect}${excludeDays}`;\n    } else if (consecutiveCorrect >= 5) {\n      reason = `${consecutiveCorrect}${excludeDays}`;\n    } else if (consecutiveCorrect >= 3) {\n      reason = `${consecutiveCorrect}${excludeDays}`;\n    } else {\n      reason = `${consecutiveCorrect}${excludeDays}`;\n    }\n\n    return {\n      isMastered: true,\n      excludeDays,\n      reason,\n      confidence: Math.min(0.99, 0.75 + consecutiveCorrect * 0.05),\n      masteryLevel,\n    };\n  }\n\n  // ===  ===\n\n  // 3: 90% + 2\n  if (totalAttempts >= 3 && accuracy >= 0.9 && consecutiveCorrect >= 2) {\n    const excludeDays = calculateExponentialInterval(consecutiveCorrect);\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `${Math.round(accuracy * 100)}%${excludeDays}`,\n      confidence: 0.88,\n      masteryLevel: 2,\n    };\n  }\n\n  // 4: 72\n  //   \n  if (consecutiveCorrect >= 2 && daysSinceLastStudy >= 7 && isCorrect) {\n    const baseInterval = calculateExponentialInterval(consecutiveCorrect);\n    const excludeDays = Math.floor(baseInterval * 1.5); // 1.5\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `7${excludeDays}`,\n      confidence: 0.92,\n      masteryLevel: 3,\n    };\n  }\n\n  // 5: 32\n  if (consecutiveCorrect >= 2 && daysSinceLastStudy >= 3 && isCorrect) {\n    const baseInterval = calculateExponentialInterval(consecutiveCorrect);\n    const excludeDays = Math.floor(baseInterval * 1.2); // 1.2\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `3${excludeDays}`,\n      confidence: 0.85,\n      masteryLevel: 2,\n    };\n  }\n\n  // 6: 242 + 85%\n  if (\n    consecutiveCorrect >= 2 &&\n    daysSinceLastStudy <= 1 &&\n    accuracy >= 0.85 &&\n    totalAttempts >= 4\n  ) {\n    const excludeDays = calculateExponentialInterval(consecutiveCorrect);\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `24${excludeDays}`,\n      confidence: 0.8,\n      masteryLevel: 1,\n    };\n  }\n\n  // 7: 5 + 80% + \n  if (totalAttempts >= 5 && accuracy >= 0.8 && isCorrect) {\n    const excludeDays = Math.max(7, calculateExponentialInterval(2));\n    return {\n      isMastered: true,\n      excludeDays,\n      reason: `${totalAttempts}${Math.round(accuracy * 100)}%${excludeDays}`,\n      confidence: 0.83,\n      masteryLevel: 2,\n    };\n  }\n\n  // 8: 2 + 75%\n  if (consecutiveCorrect >= 2 && accuracy >= 0.75 && totalAttempts >= 3) {\n    if (isCorrect) {\n      const excludeDays = calculateExponentialInterval(consecutiveCorrect);\n      return {\n        isMastered: true,\n        excludeDays,\n        reason: `${excludeDays}`,\n        confidence: 0.78,\n        masteryLevel: 1,\n      };\n    }\n  }\n\n  // ===  ===\n  return {\n    isMastered: false,\n    excludeDays: 0,\n    reason: '',\n    confidence: 1.0,\n    masteryLevel: 0,\n  };\n}\n\n// \nfunction determineMasteryLevel(wordProgress: WordProgress): 'new' | 'learning' | 'mastered' {\n  const total = wordProgress.correctCount + wordProgress.incorrectCount;\n\n  if (total === 0) return 'new';\n\n  const accuracy = wordProgress.correctCount / total;\n\n  // :\n  // 1.   \n  // 2. 2100%  2\n  // 3. 585%  \n  // 4. 390%  \n  // 5. 5  \n  // 6. 1075%2  \n  const isOneShot = total === 1 && wordProgress.correctCount === 1;\n  const isTwoShotPerfect = total === 2 && accuracy === 1.0; // 2100%\n  const isStableAccuracy = total >= 5 && accuracy >= 0.85;\n  const isHighAccuracy = total >= 3 && accuracy >= 0.9;\n  const isStrongStreak = wordProgress.consecutiveCorrect >= 5;\n  const isLongTermLearning =\n    total >= 10 && accuracy >= 0.75 && wordProgress.consecutiveCorrect >= 2;\n\n  if (\n    isOneShot ||\n    isTwoShotPerfect ||\n    isStableAccuracy ||\n    isHighAccuracy ||\n    isStrongStreak ||\n    isLongTermLearning\n  ) {\n    return 'mastered';\n  }\n\n  return 'learning';\n}\n\n// \nexport async function updateWordProgress(\n  word: string,\n  isCorrect: boolean,\n  responseTime: number, // \n  userRating?: number, // 1-10\n  _mode?: 'translation' | 'spelling' | 'reading' | 'grammar' | 'memorization', // \n  isStillLearning?: boolean // : \n): Promise<void> {\n  const progress = await loadProgress();\n\n  if (!progress.wordProgress[word]) {\n    progress.wordProgress[word] = initializeWordProgress(word);\n  }\n\n  const wordProgress = progress.wordProgress[word];\n\n  // \n  // incorrectCount\n  if (isCorrect) {\n    wordProgress.correctCount++;\n    wordProgress.consecutiveCorrect++;\n    wordProgress.consecutiveIncorrect = 0;\n  } else if (isStillLearning) {\n    // 50%\n    // incorrectCountconsecutiveIncorrect\n    wordProgress.incorrectCount++;\n    wordProgress.consecutiveCorrect = 0;\n    wordProgress.consecutiveIncorrect = 0; // \n  } else {\n    wordProgress.incorrectCount++;\n    wordProgress.consecutiveIncorrect++;\n    wordProgress.consecutiveCorrect = 0;\n  }\n\n  // \n  const mode = _mode;\n  if (mode === 'translation') {\n    wordProgress.translationAttempts = (wordProgress.translationAttempts || 0) + 1;\n    if (isCorrect) {\n      wordProgress.translationCorrect = (wordProgress.translationCorrect || 0) + 1;\n      wordProgress.translationStreak = (wordProgress.translationStreak || 0) + 1;\n    } else {\n      wordProgress.translationStreak = 0;\n    }\n  } else if (mode === 'spelling') {\n    wordProgress.spellingAttempts = (wordProgress.spellingAttempts || 0) + 1;\n    if (isCorrect) {\n      wordProgress.spellingCorrect = (wordProgress.spellingCorrect || 0) + 1;\n      wordProgress.spellingStreak = (wordProgress.spellingStreak || 0) + 1;\n    } else {\n      wordProgress.spellingStreak = 0;\n    }\n  } else if (mode === 'grammar') {\n    // \n    wordProgress.grammarAttempts = (wordProgress.grammarAttempts || 0) + 1;\n    if (isCorrect) {\n      wordProgress.grammarCorrect = (wordProgress.grammarCorrect || 0) + 1;\n      wordProgress.grammarStreak = (wordProgress.grammarStreak || 0) + 1;\n    } else {\n      wordProgress.grammarStreak = 0;\n    }\n  } else if (mode === 'memorization') {\n    // \n    wordProgress.memorizationAttempts = (wordProgress.memorizationAttempts || 0) + 1;\n    if (isCorrect) {\n      wordProgress.memorizationCorrect = (wordProgress.memorizationCorrect || 0) + 1;\n      wordProgress.memorizationStreak = (wordProgress.memorizationStreak || 0) + 1;\n    } else if (isStillLearning) {\n      // \n      wordProgress.memorizationStillLearning = (wordProgress.memorizationStillLearning || 0) + 1;\n      // memorizationStreak\n    } else {\n      // \n      wordProgress.memorizationStreak = 0;\n    }\n  }\n\n  // \n  wordProgress.totalAttempts =\n    (wordProgress.translationAttempts || 0) +\n    (wordProgress.spellingAttempts || 0) +\n    (wordProgress.grammarAttempts || 0) +\n    (wordProgress.memorizationAttempts || 0);\n\n  // \n  wordProgress.totalResponseTime += responseTime;\n  const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n  wordProgress.averageResponseTime = wordProgress.totalResponseTime / totalAttempts;\n\n  // \n  if (userRating !== undefined) {\n    wordProgress.userDifficultyRating = userRating;\n  }\n\n  // \n  wordProgress.lastStudied = Date.now();\n\n  // Spaced Repetition - \n  if (mode === 'memorization') {\n    // EF: Easiness Factor\n    if (wordProgress.easinessFactor === undefined) {\n      wordProgress.easinessFactor = 2.5; // \n    }\n\n    // EF\n    if (isCorrect) {\n      //   EF = \n      wordProgress.easinessFactor = Math.min(2.5, wordProgress.easinessFactor + 0.1);\n    } else if (isStillLearning) {\n      //   EF\n      // \n    } else {\n      //   EF = \n      wordProgress.easinessFactor = Math.max(1.3, wordProgress.easinessFactor - 0.2);\n    }\n\n    // \n    const streak = wordProgress.memorizationStreak || 0;\n    const ef = wordProgress.easinessFactor;\n\n    let newInterval = 0;\n    if (streak === 0) {\n      newInterval = 0; // \n    } else if (streak === 1) {\n      newInterval = 1; // 1\n    } else if (streak === 2) {\n      newInterval = 3; // 3\n    } else if (streak === 3) {\n      newInterval = 7; // 7\n    } else {\n      // 4  EF\n      const previousInterval = wordProgress.reviewInterval || 7;\n      newInterval = Math.round(previousInterval * ef);\n    }\n\n    wordProgress.reviewInterval = newInterval;\n    wordProgress.lastReviewDate = Date.now();\n    wordProgress.totalReviews = (wordProgress.totalReviews || 0) + 1;\n\n    // \n    if (!wordProgress.avgResponseSpeed) {\n      wordProgress.avgResponseSpeed = responseTime;\n    } else {\n      // \n      wordProgress.avgResponseSpeed = wordProgress.avgResponseSpeed * 0.8 + responseTime * 0.2;\n    }\n\n    // EF\n    if (responseTime < 2000 && isCorrect) {\n      // 2  \n      wordProgress.easinessFactor = Math.min(2.5, wordProgress.easinessFactor + 0.05);\n    }\n  }\n\n  // AI20\n  if (!wordProgress.learningHistory) {\n    wordProgress.learningHistory = [];\n  }\n  wordProgress.learningHistory.push({\n    timestamp: Date.now(),\n    wasCorrect: isCorrect,\n    responseTime,\n    sessionIndex: 0, // App.tsx\n  });\n\n  // 20\n  if (wordProgress.learningHistory.length > 20) {\n    wordProgress.learningHistory = wordProgress.learningHistory.slice(-20);\n  }\n\n  // \n  wordProgress.difficultyScore = calculateDifficultyScore(wordProgress);\n\n  // \n  const oldMasteryLevel = wordProgress.masteryLevel;\n  wordProgress.masteryLevel = determineMasteryLevel(wordProgress);\n\n  // : \n  if (oldMasteryLevel !== wordProgress.masteryLevel) {\n    logger.log(\n      ` ${word}: ${oldMasteryLevel}  ${wordProgress.masteryLevel} (: ${wordProgress.correctCount}, : ${wordProgress.incorrectCount}, : ${wordProgress.consecutiveCorrect})`\n    );\n  }\n\n  // \n  const masteryResult = checkFlexibleMastery(wordProgress, isCorrect);\n\n  if (masteryResult.isMastered) {\n    wordProgress.skipExcludeUntil = Date.now() + masteryResult.excludeDays * 24 * 60 * 60 * 1000;\n    // \n    removeFromReadingUnknownWords(word);\n\n    // : \n    if (masteryResult.reason !== '') {\n      logger.log(\n        ` ${word} : ${masteryResult.reason} (: ${masteryResult.excludeDays})`\n      );\n    }\n  }\n\n  // resultsScoreBoard\n  if (mode) {\n    const questionSetName =\n      mode === 'translation'\n        ? ''\n        : mode === 'spelling'\n          ? ''\n          : mode === 'grammar'\n            ? ''\n            : mode === 'memorization'\n              ? ''\n              : '';\n\n    progress.results.push({\n      id: `word-${word}-${Date.now()}`,\n      questionSetId: 'individual-word',\n      questionSetName,\n      score: isCorrect ? 1 : 0,\n      total: 1,\n      percentage: isCorrect ? 100 : 0,\n      date: Date.now(),\n      timeSpent: responseTime / 1000,\n      incorrectWords: isCorrect ? [] : [word],\n      mode: mode as 'translation' | 'spelling' | 'reading' | 'grammar' | 'memorization',\n      difficulty:\n        wordProgress.difficultyScore > 0.7\n          ? 'advanced'\n          : wordProgress.difficultyScore > 0.4\n            ? 'intermediate'\n            : 'beginner',\n    });\n  }\n\n  await saveProgress(progress);\n\n  // StatsView\n  try {\n    if (typeof window !== 'undefined') {\n      const evt = new CustomEvent(QUIZ_RESULT_EVENT, {\n        detail: {\n          word,\n          isCorrect,\n          responseTime,\n          mode,\n        },\n      });\n      window.dispatchEvent(evt);\n    }\n  } catch {\n    // SSRwindow\n  }\n}\n\n/**\n * \n */\nfunction removeFromReadingUnknownWords(word: string): void {\n  // LocalStorage\n  const readingDataKey = 'reading-passages-data';\n  const storedData = localStorage.getItem(readingDataKey);\n\n  if (!storedData) return;\n\n  try {\n    const passages: ReadingPassage[] = JSON.parse(storedData);\n    let modified = false;\n\n    // \n    passages.forEach((passage: ReadingPassage) => {\n      if (passage.phrases) {\n        passage.phrases.forEach((phrase: ReadingPhrase) => {\n          if (phrase.segments) {\n            phrase.segments.forEach((segment: ReadingSegment) => {\n              if (segment.word.toLowerCase() === word.toLowerCase() && segment.isUnknown) {\n                segment.isUnknown = false;\n                modified = true;\n              }\n            });\n          }\n        });\n      }\n    });\n\n    // \n    if (modified) {\n      try {\n        localStorage.setItem(readingDataKey, JSON.stringify(passages));\n      } catch (error) {\n        if (error instanceof DOMException && error.name === 'QuotaExceededError') {\n          logger.warn('');\n          // \n          localStorage.removeItem(readingDataKey);\n          logger.log('');\n        } else {\n          throw error;\n        }\n      }\n    }\n  } catch (err) {\n    logger.error(':', err);\n  }\n}\n\n// \n// AI: \nexport function recordWordSkip(\n  word: string,\n  excludeDays: number = 30 // 30\n): void {\n  const progress = loadProgressSync();\n\n  if (!progress.wordProgress[word]) {\n    progress.wordProgress[word] = initializeWordProgress(word);\n  }\n\n  const wordProgress = progress.wordProgress[word];\n\n  // \n  // \n\n  // \n  wordProgress.skippedCount = (wordProgress.skippedCount || 0) + 1;\n  wordProgress.lastSkipped = Date.now();\n  wordProgress.skipExcludeUntil = Date.now() + excludeDays * 24 * 60 * 60 * 1000;\n\n  // AI: \n  // learningAssistant.ts\n\n  saveProgress(progress);\n}\n\n// \nexport function isWordSkipExcluded(word: string): boolean {\n  const progress = loadProgressSync();\n  const wordProgress = progress.wordProgress[word];\n\n  if (!wordProgress) {\n    return false;\n  }\n\n  // \n  if (wordProgress.skipExcludeUntil && Date.now() < wordProgress.skipExcludeUntil) {\n    return true;\n  }\n\n  // \n  if (\n    wordProgress.masteryLevel === 'mastered' &&\n    wordProgress.nextReviewDate &&\n    Date.now() < wordProgress.nextReviewDate\n  ) {\n    return true;\n  }\n\n  return false;\n}\n\n// \nexport function filterSkippedWords<T extends { word: string }>(questions: T[]): T[] {\n  return questions.filter((q) => !isWordSkipExcluded(q.word));\n}\n\n// \nexport function getWordProgress(word: string): WordProgress | null {\n  const progress = loadProgressSync();\n  return progress.wordProgress[word] || null;\n}\n\n// \nexport function getAllWordProgress(): WordProgress[] {\n  const progress = loadProgressSync();\n  return Object.values(progress.wordProgress);\n}\n\n// \nexport function getWordsByMasteryLevel(level: 'new' | 'learning' | 'mastered'): string[] {\n  const progress = loadProgressSync();\n  return Object.values(progress.wordProgress)\n    .filter((wp) => wp.masteryLevel === level)\n    .map((wp) => wp.word);\n}\n\n// \nexport function getWordsSortedByDifficulty(limit?: number): WordProgress[] {\n  const allWords = getAllWordProgress();\n  const sorted = allWords.sort((a, b) => b.difficultyScore - a.difficultyScore);\n  return limit ? sorted.slice(0, limit) : sorted;\n}\n\n// 50\nexport function getWeakWordsAdvanced(limit: number = 20): WordProgress[] {\n  const allWords = getAllWordProgress();\n  return allWords\n    .filter((wp) => wp.difficultyScore >= 50)\n    .sort((a, b) => b.difficultyScore - a.difficultyScore)\n    .slice(0, limit);\n}\n\n// \nexport function getWordsNeedingReview(hoursThreshold: number = 24): WordProgress[] {\n  const now = Date.now();\n  const threshold = hoursThreshold * 60 * 60 * 1000;\n\n  const allWords = getAllWordProgress();\n  return allWords\n    .filter((wp) => {\n      const timeSinceLastStudy = now - wp.lastStudied;\n      return wp.masteryLevel === 'learning' && timeSinceLastStudy >= threshold;\n    })\n    .sort((a, b) => b.difficultyScore - a.difficultyScore);\n}\n\n/**\n * \n * @param confusedWord \n * @param actualWord \n */\nexport async function recordConfusion(confusedWord: string, actualWord: string): Promise<void> {\n  const progress = await loadProgress();\n\n  if (!progress.wordProgress[confusedWord]) {\n    // \n    progress.wordProgress[confusedWord] = {\n      word: confusedWord,\n      correctCount: 0,\n      incorrectCount: 0,\n      consecutiveCorrect: 0,\n      consecutiveIncorrect: 0,\n      lastStudied: Date.now(),\n      totalResponseTime: 0,\n      averageResponseTime: 0,\n      difficultyScore: 0,\n      masteryLevel: 'new',\n      responseTimes: [],\n      confusedWith: [],\n      confusionCount: 0,\n      lastConfused: Date.now(),\n    };\n  }\n\n  const wordProgress = progress.wordProgress[confusedWord];\n\n  // \n  if (!wordProgress.confusedWith) {\n    wordProgress.confusedWith = [];\n  }\n\n  wordProgress.confusedWith.push({\n    word: actualWord,\n    timestamp: Date.now(),\n  });\n\n  // 10\n  if (wordProgress.confusedWith.length > 10) {\n    wordProgress.confusedWith = wordProgress.confusedWith.slice(-10);\n  }\n\n  // \n  wordProgress.confusionCount = (wordProgress.confusionCount || 0) + 1;\n  wordProgress.lastConfused = Date.now();\n\n  // \n  wordProgress.difficultyScore = Math.min(100, (wordProgress.difficultyScore || 0) + 5);\n\n  await saveProgress(progress);\n  updateProgressCache(progress);\n}\n\n/**\n * \n */\nexport function getConfusedWords(limit: number = 20): WordProgress[] {\n  const allWords = getAllWordProgress();\n  return allWords\n    .filter((wp) => (wp.confusionCount || 0) > 0)\n    .sort((a, b) => {\n      // \n      const countDiff = (b.confusionCount || 0) - (a.confusionCount || 0);\n      if (countDiff !== 0) return countDiff;\n      return (b.lastConfused || 0) - (a.lastConfused || 0);\n    })\n    .slice(0, limit);\n}\n\n// \nexport function getWordProgressSummary(): {\n  total: number;\n  new: number;\n  learning: number;\n  mastered: number;\n  averageDifficulty: number;\n} {\n  const allWords = getAllWordProgress();\n\n  const summary = {\n    total: allWords.length,\n    new: allWords.filter((wp) => wp.masteryLevel === 'new').length,\n    learning: allWords.filter((wp) => wp.masteryLevel === 'learning').length,\n    mastered: allWords.filter((wp) => wp.masteryLevel === 'mastered').length,\n    averageDifficulty: 0,\n  };\n\n  if (allWords.length > 0) {\n    const totalDifficulty = allWords.reduce((sum, wp) => sum + wp.difficultyScore, 0);\n    summary.averageDifficulty = totalDifficulty / allWords.length;\n  }\n\n  return summary;\n}\n\n/**\n * \n * : 1  3  \n */\nexport function getMasteredWordsCount(words: string[]): number {\n  const progress = loadProgressSync();\n  let masteredCount = 0;\n\n  for (const word of words) {\n    const wordProgress = progress.wordProgress[word];\n    if (!wordProgress) continue;\n\n    const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n\n    // : 1  3  \n    const isFirstTimeCorrect = totalAttempts === 1 && wordProgress.correctCount === 1;\n    const isConsecutivelyCorrect = wordProgress.consecutiveCorrect >= 3;\n    const isSkipped = wordProgress.skippedCount && wordProgress.skippedCount > 0;\n\n    if (isFirstTimeCorrect || isConsecutivelyCorrect || isSkipped) {\n      masteredCount++;\n    }\n  }\n\n  return masteredCount;\n}\n\n/**\n * \n */\nexport function getMasteredWords(words: string[]): string[] {\n  const progress = loadProgressSync();\n  const masteredWords: string[] = [];\n\n  for (const word of words) {\n    const wordProgress = progress.wordProgress[word];\n    if (!wordProgress) continue;\n\n    const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n\n    // : 1  3  \n    const isFirstTimeCorrect = totalAttempts === 1 && wordProgress.correctCount === 1;\n    const isConsecutivelyCorrect = wordProgress.consecutiveCorrect >= 3;\n    const isSkipped = wordProgress.skippedCount && wordProgress.skippedCount > 0;\n\n    if (isFirstTimeCorrect || isConsecutivelyCorrect || isSkipped) {\n      masteredWords.push(word);\n    }\n  }\n\n  return masteredWords;\n}\n\n/**\n *  - statistics.ts\n */\n\n/**\n * \n * @param mode translation, spelling, reading, grammar\n */\nexport function getTotalAnsweredCount(\n  mode?: 'translation' | 'spelling' | 'reading' | 'grammar' | 'memorization'\n): number {\n  const progress = loadProgressSync();\n  let results = progress.results;\n\n  // \n  if (mode) {\n    results = results.filter((r) => r.mode === mode);\n  }\n\n  return results.reduce((sum, r) => sum + r.total, 0);\n}\n\n/**\n * \n * @param mode translation, spelling, reading\n */\nexport function getUniqueQuestionedWordsCount(\n  _mode?: 'translation' | 'spelling' | 'reading'\n): number {\n  const progress = loadProgressSync();\n  const uniqueWords = new Set<string>();\n\n  // wordProgress\n  for (const [word, wordProgress] of Object.entries(progress.wordProgress)) {\n    const hasBeenAnswered = wordProgress.correctCount > 0 || wordProgress.incorrectCount > 0;\n    const hasBeenSkipped = wordProgress.skippedCount && wordProgress.skippedCount > 0;\n\n    if (hasBeenAnswered || hasBeenSkipped) {\n      uniqueWords.add(word);\n    }\n  }\n\n  return uniqueWords.size;\n}\n\n/**\n * \n */\nexport function getTotalMasteredWordsCount(): number {\n  const progress = loadProgressSync();\n  let masteredCount = 0;\n\n  for (const wordProgress of Object.values(progress.wordProgress)) {\n    const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n\n    // :\n    // 1. 1100%\n    // 2. 3\n    // 3. \n    const isFirstTimeCorrect = totalAttempts === 1 && wordProgress.correctCount === 1;\n    const isConsecutivelyCorrect = wordProgress.consecutiveCorrect >= 3;\n    const isSkipped = wordProgress.skippedCount && wordProgress.skippedCount > 0;\n\n    if (isFirstTimeCorrect || isConsecutivelyCorrect || isSkipped) {\n      masteredCount++;\n    }\n  }\n\n  return masteredCount;\n}\n\n/**\n * AI\n *  = AIretentionScore >= 80%\n */\nexport function getRetentionRateWithAI(): {\n  retentionRate: number;\n  masteredCount: number;\n  appearedCount: number;\n} {\n  const progress = loadProgressSync();\n  const wordProgresses = Object.values(progress.wordProgress);\n  const appearedWords = wordProgresses.filter((wp) => wp.correctCount + wp.incorrectCount > 0);\n\n  let masteredCount = 0;\n\n  // \n  appearedWords.forEach((wp) => {\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    const accuracy = totalAttempts > 0 ? (wp.correctCount / totalAttempts) * 100 : 0;\n\n    // :\n    // 1. masteryLevel  'mastered' \n    // 2. 11\n    // 3. 585%\n    // 4. 390%\n    // 5. 5\n    // 6. 1075%\n    const isMarkedAsMastered = wp.masteryLevel === 'mastered';\n    const isOneShot = totalAttempts === 1 && wp.correctCount === 1;\n    const isStableAccuracy = totalAttempts >= 5 && accuracy >= 85;\n    const isHighAccuracy = totalAttempts >= 3 && accuracy >= 90;\n    const isStrongStreak = wp.consecutiveCorrect >= 5;\n    const isLongTermLearning = totalAttempts >= 10 && accuracy >= 75;\n\n    if (\n      isMarkedAsMastered ||\n      isOneShot ||\n      isStableAccuracy ||\n      isHighAccuracy ||\n      isStrongStreak ||\n      isLongTermLearning\n    ) {\n      masteredCount++;\n    }\n  });\n\n  const retentionRate = appearedWords.length > 0 ? (masteredCount / appearedWords.length) * 100 : 0;\n\n  // 0-100%\n  const normalizedRetentionRate = Math.min(100, Math.max(0, retentionRate));\n\n  return {\n    retentionRate: Math.round(normalizedRetentionRate),\n    masteredCount,\n    appearedCount: appearedWords.length,\n  };\n}\n\n/**\n * \n * \n */\nexport function getMasteryPredictions(limit: number = 10): MasteryPrediction[] {\n  const progress = loadProgressSync();\n  const predictions: MasteryPrediction[] = [];\n\n  Object.entries(progress.wordProgress).forEach(([word, wp]) => {\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    if (totalAttempts === 0) return; // \n\n    const accuracy = wp.correctCount / totalAttempts;\n    const { consecutiveCorrect } = wp;\n\n    // \n    const masteryResult = checkFlexibleMastery(wp, true);\n    if (masteryResult.isMastered) return;\n\n    // \n    let remainingCorrectAnswers = 0;\n    let nextMilestone = '';\n    let estimatedDays = 0;\n    let confidence = 0;\n    let currentStatus = '';\n\n    // 1: \n    if (consecutiveCorrect === 2) {\n      remainingCorrectAnswers = 1;\n      nextMilestone = '3';\n      estimatedDays = 1;\n      confidence = 90;\n      currentStatus = `${consecutiveCorrect}`;\n    } else if (consecutiveCorrect === 1 && accuracy >= 0.9 && totalAttempts >= 2) {\n      // 2: 90%\n      remainingCorrectAnswers = 1;\n      nextMilestone = '2';\n      estimatedDays = 1;\n      confidence = 85;\n      currentStatus = `${Math.round(accuracy * 100)}%`;\n    } else if (consecutiveCorrect === 1) {\n      remainingCorrectAnswers = 2;\n      nextMilestone = '3';\n      estimatedDays = 2;\n      confidence = 75;\n      currentStatus = `${consecutiveCorrect}`;\n    }\n    // 3: \n    else if (totalAttempts >= 4 && accuracy >= 0.75) {\n      remainingCorrectAnswers = 1;\n      nextMilestone = '';\n      estimatedDays = 1;\n      confidence = 80;\n      currentStatus = `${totalAttempts}${Math.round(accuracy * 100)}%`;\n    }\n    // 4: \n    else if (consecutiveCorrect >= 2 && accuracy >= 0.7 && totalAttempts >= 3) {\n      remainingCorrectAnswers = 1;\n      nextMilestone = '';\n      estimatedDays = 1;\n      confidence = 75;\n      currentStatus = `${consecutiveCorrect}${Math.round(accuracy * 100)}%`;\n    }\n    // 5: \n    else if (accuracy >= 0.6) {\n      const neededConsecutive = 3 - consecutiveCorrect;\n      remainingCorrectAnswers = Math.max(neededConsecutive, 2);\n      nextMilestone = `${3}`;\n      estimatedDays = remainingCorrectAnswers;\n      confidence = 60;\n      currentStatus = `${Math.round(accuracy * 100)}%`;\n    }\n    // 6: \n    else {\n      remainingCorrectAnswers = 3;\n      nextMilestone = '';\n      estimatedDays = 5;\n      confidence = 40;\n      currentStatus = `${Math.round(accuracy * 100)}%`;\n    }\n\n    predictions.push({\n      word,\n      currentStatus,\n      remainingCorrectAnswers,\n      confidence,\n      nextMilestone,\n      estimatedDays,\n    });\n  });\n\n  //   \n  return predictions\n    .sort((a, b) => {\n      const aRemaining = a.remainingCorrectAnswers ?? 999;\n      const bRemaining = b.remainingCorrectAnswers ?? 999;\n      if (aRemaining !== bRemaining) {\n        return aRemaining - bRemaining;\n      }\n      return b.confidence - a.confidence;\n    })\n    .slice(0, limit);\n}\n\n/**\n * \n * \n */\nexport function getDailyPlanInfo(): DailyPlanInfo {\n  const progress = loadProgressSync();\n  const now = Date.now();\n  const today = new Date().setHours(0, 0, 0, 0);\n  const tomorrow = today + 24 * 60 * 60 * 1000;\n\n  const reviewWords: string[] = [];\n  const scheduledWords: string[] = [];\n\n  Object.entries(progress.wordProgress).forEach(([word, wp]) => {\n    const totalAttempts = wp.correctCount + wp.incorrectCount;\n    if (totalAttempts === 0) return; // \n\n    // \n    const isExcluded = wp.skipExcludeUntil && wp.skipExcludeUntil > now;\n\n    if (isExcluded) {\n      //  = \n      if (wp.skipExcludeUntil && wp.skipExcludeUntil < tomorrow) {\n        scheduledWords.push(word);\n      }\n    } else {\n      //  = \n      // 24\n      const hoursSinceLastStudy = (now - wp.lastStudied) / (1000 * 60 * 60);\n      if (hoursSinceLastStudy >= 24) {\n        reviewWords.push(word);\n      }\n    }\n  });\n\n  return {\n    reviewWordsCount: reviewWords.length,\n    scheduledWordsCount: scheduledWords.length,\n    totalPlannedCount: reviewWords.length + scheduledWords.length,\n    reviewWords,\n    scheduledWords,\n  };\n}\n\n/**\n * \n * : \n */\nexport function autoDetectWordDifficulty(\n  word: string,\n  stats: WordProgress\n): 'beginner' | 'intermediate' | 'advanced' {\n  // 1. \n  if (stats.difficulty) {\n    return stats.difficulty as 'beginner' | 'intermediate' | 'advanced';\n  }\n\n  const totalAttempts = stats.correctCount + stats.incorrectCount;\n  const accuracy = totalAttempts > 0 ? (stats.correctCount / totalAttempts) * 100 : 0;\n\n  // 2. \n  let baseScore = 0;\n  if (word.length <= 5)\n    baseScore = 1; // \n  else if (word.length <= 8)\n    baseScore = 2; // \n  else baseScore = 3; // \n\n  // 3. \n  if (totalAttempts >= 3) {\n    if (accuracy < 50) {\n      // 50% =   \n      baseScore = Math.min(3, baseScore + 1);\n    } else if (accuracy > 90 && stats.consecutiveCorrect >= 3) {\n      // 90%3 =   \n      baseScore = Math.max(1, baseScore - 1);\n    }\n  }\n\n  // 4. \n  if (baseScore === 1) return 'beginner';\n  if (baseScore === 2) return 'intermediate';\n  return 'advanced';\n}\n\n/**\n * \n */\nexport function resetStatsByModeDifficulty(\n  mode: 'translation' | 'spelling',\n  difficulty: string\n): void {\n  const progress = loadProgressSync();\n\n  // \n  const removedResults = progress.results.filter(\n    (r) => r.mode === mode && r.difficulty === difficulty\n  );\n  progress.results = progress.results.filter(\n    (r) => !(r.mode === mode && r.difficulty === difficulty)\n  );\n\n  // \n  const affectedWords = new Set<string>();\n  removedResults.forEach((result) => {\n    // \n    const _totalWords = result.total;\n    const incorrectWords = result.incorrectWords || [];\n\n    // \n    incorrectWords.forEach((word) => affectedWords.add(word.toLowerCase()));\n\n    // results\n    // questionSet\n  });\n\n  // questionSetStats\n  Object.keys(progress.questionSetStats).forEach((setId) => {\n    // ID\n    if (setId.includes(difficulty)) {\n      delete progress.questionSetStats[setId];\n    }\n  });\n\n  // \n  Object.keys(progress.wordProgress).forEach((word) => {\n    const wordStat = progress.wordProgress[word];\n\n    // \n    if (wordStat.difficulty === difficulty) {\n      // \n      if (mode === 'translation') {\n        wordStat.translationAttempts = 0;\n        wordStat.translationCorrect = 0;\n        wordStat.translationStreak = 0;\n      } else if (mode === 'spelling') {\n        wordStat.spellingAttempts = 0;\n        wordStat.spellingCorrect = 0;\n        wordStat.spellingStreak = 0;\n      }\n\n      // \n      const transAttempts = wordStat.translationAttempts || 0;\n      const transCorrect = wordStat.translationCorrect || 0;\n      const spellAttempts = wordStat.spellingAttempts || 0;\n      const spellCorrect = wordStat.spellingCorrect || 0;\n\n      wordStat.totalAttempts = transAttempts + spellAttempts;\n      wordStat.correctCount = transCorrect + spellCorrect;\n      wordStat.incorrectCount = transAttempts - transCorrect + (spellAttempts - spellCorrect);\n      wordStat.consecutiveCorrect = Math.max(\n        wordStat.translationStreak || 0,\n        wordStat.spellingStreak || 0\n      );\n\n      // 0\n      if (wordStat.totalAttempts === 0 || wordStat.totalAttempts === undefined) {\n        delete progress.wordProgress[word];\n      } else {\n        // masteryLevel\n        const accuracy =\n          wordStat.totalAttempts > 0 ? wordStat.correctCount / wordStat.totalAttempts : 0;\n\n        if (wordStat.consecutiveCorrect >= 3 || accuracy >= 0.9) {\n          wordStat.masteryLevel = 'mastered';\n        } else if (wordStat.totalAttempts > 0) {\n          wordStat.masteryLevel = 'learning';\n        } else {\n          wordStat.masteryLevel = 'new';\n        }\n\n        // difficultyScore\n        wordStat.difficultyScore = calculateDifficultyScore(wordStat);\n      }\n    }\n  });\n\n  // \n  recalculateStatistics(progress);\n\n  saveProgress(progress);\n\n  logger.log(`${mode}${difficulty}: ${removedResults.length}`);\n}\n\n/**\n * \n */\nfunction recalculateStatistics(progress: UserProgress): void {\n  const stats = progress.statistics;\n\n  // results\n  stats.totalQuizzes = progress.results.length;\n  stats.totalQuestions = progress.results.reduce((sum, r) => sum + r.total, 0);\n  stats.totalCorrect = progress.results.reduce((sum, r) => sum + r.score, 0);\n  stats.averageScore =\n    stats.totalQuestions > 0 ? Math.round((stats.totalCorrect / stats.totalQuestions) * 100) : 0;\n  stats.bestScore =\n    progress.results.length > 0 ? Math.max(...progress.results.map((r) => r.percentage)) : 0;\n\n  // \n  // \n}\n\n// \nfunction _loadAllQuestions(): Array<{ word: string; difficulty: string }> {\n  try {\n    const stored = localStorage.getItem('all-questions-cache');\n    if (stored) {\n      return JSON.parse(stored);\n    }\n  } catch (e) {\n    logger.error('Failed to load questions cache:', e);\n  }\n  return [];\n}\n\n/**\n * \n */\nexport async function resetAllProgress(): Promise<void> {\n  // 1. IndexedDB\n  try {\n    await deleteDatabase();\n    logger.log(' IndexedDB');\n  } catch (error) {\n    logger.error('IndexedDB:', error);\n  }\n\n  // 2. LocalStorage\n  const keysToRemove: string[] = [];\n\n  for (let i = 0; i < localStorage.length; i++) {\n    const key = localStorage.key(i);\n    if (\n      key &&\n      (key.startsWith('quiz-result-') ||\n        key === 'quiz-app-user-progress' ||\n        key === 'progress-data' ||\n        key.startsWith('session-history-') ||\n        key === 'session-history' ||\n        key === 'skipped-words' ||\n        key === 'skip-groups' ||\n        key === 'improvement-progress' ||\n        key === 'study-settings' ||\n        key === 'reading-passages-data' ||\n        key === 'all-questions-cache')\n    ) {\n      keysToRemove.push(key);\n    }\n  }\n\n  // \n  keysToRemove.forEach((key) => {\n    try {\n      localStorage.removeItem(key);\n    } catch (e) {\n      logger.error(`Failed to remove ${key}:`, e);\n    }\n  });\n\n  // 3. \n  const initialProgress = initializeProgress();\n  saveProgress(initialProgress);\n\n  logger.log(` : LocalStorage ${keysToRemove.length}`);\n\n  // 4. \n  window.location.reload();\n}\n\n/**\n * N\n */\nexport function getStudyCalendarData(days: number = 90): Array<{\n  date: string; // YYYY-MM-DD\n  count: number; // \n  accuracy: number; // \n}> {\n  const progress = loadProgressSync();\n  const now = new Date();\n  const calendarData: Array<{ date: string; count: number; accuracy: number }> = [];\n\n  // UTC\n\n  logger.log(' getStudyCalendarData - progress.results:', progress.results.length);\n\n  // N\n  for (let i = days - 1; i >= 0; i--) {\n    const date = new Date(now);\n    date.setDate(date.getDate() - i);\n    const dateStr = formatLocalYYYYMMDD(date);\n\n    // \n    const dayStart = new Date(date).setHours(0, 0, 0, 0);\n    const dayEnd = new Date(date).setHours(23, 59, 59, 999);\n    const dayResults = progress.results.filter((r) => r.date >= dayStart && r.date <= dayEnd);\n\n    if (i === 0) {\n      // \n      logger.log(' :', {\n        dateStr,\n        dayStart: new Date(dayStart).toISOString(),\n        dayEnd: new Date(dayEnd).toISOString(),\n        dayResults: dayResults.length,\n        sampleResults: dayResults.slice(0, 3).map((r) => ({\n          mode: r.mode,\n          score: r.score,\n          total: r.total,\n          date: new Date(r.date).toISOString(),\n        })),\n      });\n    }\n\n    const totalAnswered = dayResults.reduce((sum, r) => sum + r.total, 0);\n    const totalCorrect = dayResults.reduce((sum, r) => sum + r.score, 0);\n    const accuracy = totalAnswered > 0 ? (totalCorrect / totalAnswered) * 100 : 0;\n\n    calendarData.push({\n      date: dateStr,\n      count: totalAnswered,\n      accuracy: accuracy,\n    });\n  }\n\n  return calendarData;\n}\n\n/**\n * \n */\nexport function getCumulativeProgressData(weeks: number = 12): Array<{\n  weekLabel: string; // : \"11/01\"\n  cumulativeMastered: number; // \n  weeklyMastered: number; // \n  cumulativeAnswered: number; // \n  weeklyAnswered: number; // \n}> {\n  const progress = loadProgressSync();\n  const now = new Date();\n  const data: Array<{\n    weekLabel: string;\n    cumulativeMastered: number;\n    weeklyMastered: number;\n    cumulativeAnswered: number;\n    weeklyAnswered: number;\n  }> = [];\n\n  let cumulativeMastered = 0;\n  let cumulativeAnswered = 0;\n\n  for (let i = weeks - 1; i >= 0; i--) {\n    const weekEnd = new Date(now);\n    weekEnd.setDate(now.getDate() - i * 7);\n    weekEnd.setHours(23, 59, 59, 999);\n\n    const weekStart = new Date(weekEnd);\n    weekStart.setDate(weekEnd.getDate() - 6);\n    weekStart.setHours(0, 0, 0, 0);\n\n    // \n    const weekResults = progress.results.filter(\n      (r) => r.date >= weekStart.getTime() && r.date <= weekEnd.getTime()\n    );\n\n    const weeklyAnswered = weekResults.reduce((sum, r) => sum + r.total, 0);\n    cumulativeAnswered += weeklyAnswered;\n\n    // \n    let weeklyMastered = 0;\n    Object.values(progress.wordProgress).forEach((wp) => {\n      if (\n        wp.masteryLevel === 'mastered' &&\n        wp.lastStudied >= weekStart.getTime() &&\n        wp.lastStudied <= weekEnd.getTime()\n      ) {\n        weeklyMastered++;\n      }\n    });\n    cumulativeMastered += weeklyMastered;\n\n    const weekLabel = `${weekStart.getMonth() + 1}/${weekStart.getDate()}`;\n\n    data.push({\n      weekLabel,\n      cumulativeMastered,\n      weeklyMastered,\n      cumulativeAnswered,\n      weeklyAnswered,\n    });\n  }\n\n  return data;\n}\n\n/**\n * \n */\nexport function getRetentionTrend(): {\n  last7Days: number;\n  last30Days: number;\n  allTime: number;\n} {\n  const progress = loadProgressSync();\n  const now = Date.now();\n\n  const day7Ago = now - 7 * 24 * 60 * 60 * 1000;\n  const day30Ago = now - 30 * 24 * 60 * 60 * 1000;\n\n  // \n  const words7Days = new Set<string>();\n  const mastered7Days = new Set<string>();\n  const words30Days = new Set<string>();\n  const mastered30Days = new Set<string>();\n  const wordsAllTime = new Set<string>();\n  const masteredAllTime = new Set<string>();\n\n  progress.results.forEach((result) => {\n    result.incorrectWords.forEach((word) => {\n      wordsAllTime.add(word);\n      if (result.date >= day30Ago) {\n        words30Days.add(word);\n      }\n      if (result.date >= day7Ago) {\n        words7Days.add(word);\n      }\n    });\n  });\n\n  Object.entries(progress.wordProgress).forEach(([word, wp]) => {\n    if (wp.masteryLevel === 'mastered') {\n      masteredAllTime.add(word);\n      if (wp.lastStudied >= day30Ago) {\n        mastered30Days.add(word);\n      }\n      if (wp.lastStudied >= day7Ago) {\n        mastered7Days.add(word);\n      }\n    }\n  });\n\n  return {\n    last7Days: Math.min(\n      100,\n      Math.max(0, words7Days.size > 0 ? (mastered7Days.size / words7Days.size) * 100 : 0)\n    ),\n    last30Days: Math.min(\n      100,\n      Math.max(0, words30Days.size > 0 ? (mastered30Days.size / words30Days.size) * 100 : 0)\n    ),\n    allTime: Math.min(\n      100,\n      Math.max(0, wordsAllTime.size > 0 ? (masteredAllTime.size / wordsAllTime.size) * 100 : 0)\n    ),\n  };\n}\n\n/**\n * \n */\n/**\n * \n */\nexport function getWordDetailedData(word: string): {\n  correctCount: number;\n  totalCount: number;\n  accuracyHistory: string; // \n  retentionRate: number; // 0-100%\n  status: 'mastered' | 'learning' | 'struggling' | 'new'; // \n  statusLabel: string; // \n  statusIcon: string; // \n} | null {\n  const progress = loadProgressSync();\n  const wordProgress = progress.wordProgress[word];\n\n  if (!wordProgress) {\n    return null;\n  }\n\n  const correctCount = wordProgress.correctCount;\n  const totalCount = wordProgress.correctCount + wordProgress.incorrectCount;\n\n  // learningHistory10\n  const learningHistory = wordProgress.learningHistory || [];\n  const recentHistory = learningHistory.slice(-10);\n  const accuracyHistory = recentHistory.map((h) => (h.wasCorrect ? '' : '')).join('');\n\n  // \n  let retentionRate = 0;\n\n  if (totalCount === 0) {\n    retentionRate = 0;\n  } else {\n    // 0-70%\n    const baseAccuracy = (correctCount / totalCount) * 70;\n\n    // 0-20%\n    const consecutiveBonus = Math.min(20, (wordProgress.consecutiveCorrect || 0) * 5);\n\n    // 0-10%\n    const daysSinceStudy = (Date.now() - wordProgress.lastStudied) / (24 * 60 * 60 * 1000);\n    const timePenalty = Math.min(10, Math.max(0, (daysSinceStudy - 1) * 2));\n\n    retentionRate = Math.min(100, Math.max(0, baseAccuracy + consecutiveBonus - timePenalty));\n\n    // \n    if (wordProgress.masteryLevel === 'mastered') {\n      retentionRate = Math.max(90, retentionRate);\n    }\n  }\n\n  // \n  let status: 'mastered' | 'learning' | 'struggling' | 'new' = 'new';\n  let statusLabel = '';\n  let statusIcon = '';\n\n  if (totalCount === 0) {\n    status = 'new';\n    statusLabel = '';\n    statusIcon = '';\n  } else if (wordProgress.masteryLevel === 'mastered' || retentionRate >= 80) {\n    status = 'mastered';\n    statusLabel = '';\n    statusIcon = '';\n  } else if (retentionRate >= 50) {\n    status = 'learning';\n    statusLabel = '';\n    statusIcon = '';\n  } else {\n    status = 'struggling';\n    statusLabel = '';\n    statusIcon = '';\n  }\n\n  return {\n    correctCount,\n    totalCount,\n    accuracyHistory,\n    retentionRate: Math.round(retentionRate),\n    status,\n    statusLabel,\n    statusIcon,\n  };\n}\n\n// ===========================\n// \n// ===========================\n\n// \nexport async function saveMemorizationCardSettings(\n  settings: import('@/types').MemorizationCardState\n): Promise<void> {\n  try {\n    await saveSetting('memorization-card-settings', settings);\n  } catch (error) {\n    logger.error(':', error);\n    // : localStorage\n    localStorage.setItem('memorization-card-settings', JSON.stringify(settings));\n  }\n}\n\n// \nexport async function getMemorizationCardSettings(): Promise<\n  import('@/types').MemorizationCardState | null\n> {\n  try {\n    const settings = await loadSetting('memorization-card-settings');\n    if (!settings) return null;\n    if (typeof settings === 'string') {\n      return JSON.parse(settings) as import('@/types').MemorizationCardState;\n    }\n    // ProgressData, SessionHistory, AppSettingsStorageValue\n    if (typeof settings === 'object' && 'showFurigana' in settings) {\n      return settings as unknown as import('@/types').MemorizationCardState;\n    }\n    return null;\n  } catch (error) {\n    logger.error(':', error);\n    // : localStorage\n    const stored = localStorage.getItem('memorization-card-settings');\n    return stored ? JSON.parse(stored) : null;\n  }\n}\n\n// \nexport async function saveMemorizationSettings(\n  settings: import('@/types').MemorizationSettings\n): Promise<void> {\n  try {\n    await saveSetting('memorization-settings', settings);\n  } catch (error) {\n    logger.error(':', error);\n    localStorage.setItem('memorization-settings', JSON.stringify(settings));\n  }\n}\n\n// \nexport async function getMemorizationSettings(): Promise<\n  import('@/types').MemorizationSettings | null\n> {\n  try {\n    const settings = await loadSetting('memorization-settings');\n    if (!settings) return null;\n    if (typeof settings === 'string') {\n      return JSON.parse(settings) as import('@/types').MemorizationSettings;\n    }\n    if (typeof settings === 'object' && 'shuffleOrder' in settings) {\n      return settings as unknown as import('@/types').MemorizationSettings;\n    }\n    return null;\n  } catch (error) {\n    logger.error(':', error);\n    const stored = localStorage.getItem('memorization-settings');\n    return stored ? JSON.parse(stored) : null;\n  }\n}\n\n// \nexport async function recordMemorizationBehavior(\n  behavior: import('@/types').MemorizationBehavior\n): Promise<void> {\n  try {\n    // \n    const existingBehaviors = await loadSetting('memorization-behaviors');\n    const behaviors = existingBehaviors\n      ? typeof existingBehaviors === 'string'\n        ? JSON.parse(existingBehaviors)\n        : existingBehaviors\n      : [];\n\n    // 1000\n    const updated = [...behaviors, behavior].slice(-1000);\n\n    await saveSetting('memorization-behaviors', updated);\n  } catch (error) {\n    logger.error(':', error);\n  }\n}\n\n// \nexport async function getMemorizationHistory(\n  word?: string,\n  limit: number = 100\n): Promise<import('@/types').MemorizationBehavior[]> {\n  try {\n    const behaviorData = await loadSetting('memorization-behaviors');\n    const behaviors = behaviorData\n      ? typeof behaviorData === 'string'\n        ? JSON.parse(behaviorData)\n        : behaviorData\n      : [];\n\n    let filtered = behaviors;\n    if (word) {\n      filtered = behaviors.filter((b: import('@/types').MemorizationBehavior) => b.word === word);\n    }\n\n    return filtered.slice(-limit);\n  } catch (error) {\n    logger.error(':', error);\n    return [];\n  }\n}\n\n// \nexport async function updateMemorizationCurve(\n  word: string,\n  curve: import('@/types').MemorizationCurve\n): Promise<void> {\n  try {\n    const key = `memorization-curve-${word}`;\n    await saveSetting(key, curve);\n  } catch (error) {\n    logger.error(':', error);\n  }\n}\n\n// \nexport async function getMemorizationCurve(\n  word: string\n): Promise<import('@/types').MemorizationCurve | null> {\n  try {\n    const key = `memorization-curve-${word}`;\n    const curveData = await loadSetting(key);\n    if (!curveData) return null;\n    if (typeof curveData === 'string') {\n      return JSON.parse(curveData) as import('@/types').MemorizationCurve;\n    }\n    if (typeof curveData === 'object' && 'correctHistory' in curveData) {\n      return curveData as unknown as import('@/types').MemorizationCurve;\n    }\n    return null;\n  } catch (error) {\n    logger.error(':', error);\n    return null;\n  }\n}\n\n// ============================================\n// \n// ============================================\n\nconst CUSTOM_QUESTION_SETS_KEY = 'custom-question-sets';\n\n// \nexport async function getCustomQuestionSets(): Promise<import('@/types').CustomQuestionSet[]> {\n  try {\n    const data = await loadSetting(CUSTOM_QUESTION_SETS_KEY);\n    if (!data) return [];\n    if (typeof data === 'string') {\n      return JSON.parse(data) as import('@/types').CustomQuestionSet[];\n    }\n    if (Array.isArray(data)) {\n      return data as import('@/types').CustomQuestionSet[];\n    }\n    return [];\n  } catch (error) {\n    logger.error(':', error);\n    return [];\n  }\n}\n\n// \nexport async function saveCustomQuestionSet(\n  questionSet: import('@/types').CustomQuestionSet\n): Promise<void> {\n  try {\n    const sets = await getCustomQuestionSets();\n    const existingIndex = sets.findIndex((s) => s.id === questionSet.id);\n\n    if (existingIndex >= 0) {\n      // \n      sets[existingIndex] = {\n        ...questionSet,\n        updatedAt: Date.now(),\n      };\n    } else {\n      // \n      sets.push(questionSet);\n    }\n\n    await saveSetting(CUSTOM_QUESTION_SETS_KEY, sets);\n  } catch (error) {\n    logger.error(':', error);\n    throw error;\n  }\n}\n\n// \nexport async function deleteCustomQuestionSet(id: string): Promise<void> {\n  try {\n    const sets = await getCustomQuestionSets();\n    const filtered = sets.filter((s) => s.id !== id);\n    await saveSetting(CUSTOM_QUESTION_SETS_KEY, filtered);\n  } catch (error) {\n    logger.error(':', error);\n    throw error;\n  }\n}\n\n// \nexport async function createWeakWordsQuestionSet(\n  name: string,\n  limit: number = 20,\n  minMistakes: number = 3,\n  maxAccuracy: number = 60,\n  allQuestions: import('@/types').Question[]\n): Promise<import('@/types').CustomQuestionSet> {\n  // \n  const weakWords = getCurrentWeakWords(100); // \n\n  // \n  const filtered = weakWords\n    .filter((w) => w.mistakes >= minMistakes && w.recentAccuracy <= maxAccuracy)\n    .slice(0, limit);\n\n  // allQuestionsQuestion\n  const questions: import('@/types').Question[] = filtered.map((w) => {\n    const questionData = allQuestions.find((q) => q.word.toLowerCase() === w.word.toLowerCase());\n\n    if (questionData) {\n      return questionData;\n    }\n\n    // allQuestions\n    return {\n      word: w.word,\n      reading: w.reading || '',\n      meaning: w.meaning || '',\n      etymology: '',\n      relatedWords: '',\n      relatedFields: '',\n      difficulty: 'intermediate',\n    };\n  });\n\n  const questionSet: import('@/types').CustomQuestionSet = {\n    id: `weak-words-${Date.now()}`,\n    name,\n    source: 'weak-words',\n    questions,\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    isAutoUpdate: true,\n    autoUpdateConfig: {\n      limit,\n      minMistakes,\n      maxAccuracy,\n    },\n    metadata: {\n      description: `${minMistakes}${maxAccuracy}%`,\n      totalWords: questions.length,\n    },\n  };\n\n  return questionSet;\n}\n\n// \nexport async function createReadingQuestionSet(\n  name: string,\n  questions: import('@/types').Question[]\n): Promise<import('@/types').CustomQuestionSet> {\n  const questionSet: import('@/types').CustomQuestionSet = {\n    id: `reading-${Date.now()}`,\n    name,\n    source: 'reading',\n    questions,\n    createdAt: Date.now(),\n    updatedAt: Date.now(),\n    isAutoUpdate: false,\n    metadata: {\n      description: '',\n      totalWords: questions.length,\n    },\n  };\n\n  return questionSet;\n}\n\n// \nexport async function updateAutoUpdateQuestionSets(\n  allQuestions: import('@/types').Question[]\n): Promise<void> {\n  try {\n    const sets = await getCustomQuestionSets();\n    let updated = false;\n\n    for (const set of sets) {\n      if (set.isAutoUpdate && set.source === 'weak-words' && set.autoUpdateConfig) {\n        // \n        const newSet = await createWeakWordsQuestionSet(\n          set.name,\n          set.autoUpdateConfig.limit,\n          set.autoUpdateConfig.minMistakes,\n          set.autoUpdateConfig.maxAccuracy,\n          allQuestions\n        );\n\n        set.questions = newSet.questions;\n        set.updatedAt = Date.now();\n        set.metadata = newSet.metadata;\n        updated = true;\n      }\n    }\n\n    if (updated) {\n      await saveSetting(CUSTOM_QUESTION_SETS_KEY, sets);\n    }\n  } catch (error) {\n    logger.error(':', error);\n  }\n}\n\n/**\n * \n */\nexport function getGrammarRetentionRateWithAI(): {\n  retentionRate: number;\n  masteredCount: number;\n  appearedCount: number;\n} {\n  const progress = loadProgressSync();\n  const allWords = Object.values(progress.wordProgress);\n\n  // \n  const grammarQuestions = allWords.filter(\n    (wp) =>\n      (wp.grammarAttempts && wp.grammarAttempts > 0) ||\n      wp.word.startsWith('grammar_') ||\n      wp.word.includes('_g')\n  );\n\n  const appearedQuestions = grammarQuestions.filter(\n    (wp) =>\n      (wp.grammarAttempts && wp.grammarAttempts > 0) || wp.correctCount + wp.incorrectCount > 0\n  );\n\n  let masteredCount = 0;\n\n  appearedQuestions.forEach((wp) => {\n    const totalAttempts = wp.grammarAttempts || wp.correctCount + wp.incorrectCount;\n    const correctCount = wp.grammarCorrect || wp.correctCount;\n    const consecutiveCorrect = wp.grammarStreak || wp.consecutiveCorrect;\n    const accuracy = totalAttempts > 0 ? (correctCount / totalAttempts) * 100 : 0;\n\n    // \n    const isMarkedAsMastered = wp.masteryLevel === 'mastered';\n    const isOneShot = totalAttempts === 1 && correctCount === 1;\n    const isStableAccuracy = totalAttempts >= 5 && accuracy >= 85;\n    const isHighAccuracy = totalAttempts >= 3 && accuracy >= 90;\n    const isStrongStreak = consecutiveCorrect >= 5;\n    const isLongTermLearning = totalAttempts >= 10 && accuracy >= 75;\n\n    if (\n      isMarkedAsMastered ||\n      isOneShot ||\n      isStableAccuracy ||\n      isHighAccuracy ||\n      isStrongStreak ||\n      isLongTermLearning\n    ) {\n      masteredCount++;\n    }\n  });\n\n  const retentionRate =\n    appearedQuestions.length > 0 ? (masteredCount / appearedQuestions.length) * 100 : 0;\n\n  const normalizedRetentionRate = Math.min(100, Math.max(0, retentionRate));\n\n  return {\n    retentionRate: Math.round(normalizedRetentionRate),\n    masteredCount,\n    appearedCount: appearedQuestions.length,\n  };\n}\n\n// \nexport async function getGrammarUnitStatsWithTitles(): Promise<\n  Array<{\n    unit: string;\n    title: string;\n    totalQuestions: number;\n    answeredQuestions: number;\n    correctCount: number;\n    incorrectCount: number;\n    masteredCount: number;\n    accuracy: number;\n    progress: number;\n    historyIcons: string;\n  }>\n> {\n  const baseStats = getGrammarUnitStats();\n\n  // \n  const statsWithTitles = await Promise.all(\n    baseStats.map(\n      async (stat: {\n        unit: string;\n        totalQuestions: number;\n        answeredQuestions: number;\n        correctCount: number;\n        incorrectCount: number;\n        masteredCount: number;\n        accuracy: number;\n        progress: number;\n        historyIcons: string;\n      }) => {\n        // 1_Unit1  grade=1, unit=1\n        const match = stat.unit.match(/(\\d+)_Unit(\\d+)/);\n        if (!match) {\n          return null;\n        }\n\n        const grade = match[1];\n        const unitNum = match[2];\n\n        try {\n          const res = await fetch(`/data/grammar/grammar_grade${grade}_unit${unitNum}.json`);\n          if (res.ok) {\n            const data = await res.json();\n            // enabled === false \n            if (data.enabled === false) {\n              return null;\n            }\n            return {\n              ...stat,\n              title: data.title || '',\n            };\n          }\n        } catch {\n          // fetchnull\n          return null;\n        }\n\n        return null;\n      }\n    )\n  );\n\n  // null\n  return statsWithTitles.filter((stat): stat is NonNullable<typeof stat> => stat !== null);\n}\n\n// ==========  ==========\nexport {\n  getStatsByMode,\n  getRecentResults,\n  getStatsByCategory,\n  getStatsByDifficulty,\n  getTodayIncorrectWords,\n  getDailyStudyTime,\n  getTodayStats,\n  getWeeklyStats,\n  getMonthlyStats,\n  getDetailedRetentionStats,\n  getNearMasteryStats,\n  getDifficultyStatsForRadar,\n  getRecentlyMasteredWords,\n  getCategoryDifficultyStats,\n  getStatsByModeDifficulty,\n  getGrammarDetailedRetentionStats,\n  getMemorizationDetailedRetentionStats,\n  getGrammarUnitStats,\n} from './statistics';\n\n// getGrammarUnitStatsimport\nimport { getGrammarUnitStats } from './statistics';\n","import { Question, isValidCategory, OFFICIAL_CATEGORIES } from './types';\nimport { logger } from '@/utils/logger';\n\n/**\n * CSV\n * quiz-app7: ,,,,,,\n *\n * RFC 4180CSV\n *\n *  :\n * - 10console.warn\n * - \n */\nexport function parseCSV(csvText: string): Question[] {\n  const lines = csvText.trim().split('\\n');\n  if (lines.length === 0) return [];\n\n  /**\n   * CSV\n   */\n  function parseCSVLine(line: string): string[] {\n    const result: string[] = [];\n    let current = '';\n    let inQuotes = false;\n\n    for (let i = 0; i < line.length; i++) {\n      const char = line[i];\n      const nextChar = line[i + 1];\n\n      if (char === '\"') {\n        if (inQuotes && nextChar === '\"') {\n          // \n          current += '\"';\n          i++; // \n        } else {\n          // /\n          inQuotes = !inQuotes;\n        }\n      } else if (char === ',' && !inQuotes) {\n        // \n        result.push(current.trim());\n        current = '';\n      } else {\n        current += char;\n      }\n    }\n\n    // \n    result.push(current.trim());\n\n    return result;\n  }\n\n  let startIndex = 0;\n\n  // \n  const firstLine = lines[0].trim();\n  if (\n    firstLine.includes('') ||\n    firstLine.includes('term') ||\n    firstLine.includes('') ||\n    firstLine.includes('reading') ||\n    firstLine.includes('') ||\n    firstLine.includes('meaning')\n  ) {\n    startIndex = 1;\n  }\n\n  const questions: Question[] = [];\n\n  for (let i = startIndex; i < lines.length; i++) {\n    const line = lines[i].trim();\n\n    // \n    if (!line || line.startsWith('//') || line.startsWith('#')) {\n      continue;\n    }\n\n    const columns = parseCSVLine(line);\n\n    if (columns.length >= 3) {\n      const word = columns[0] || '';\n      const reading = columns[1] || '';\n      const meaning = columns[2] || '';\n      const etymology = columns[3] || '';\n\n      // CSV8\n      let relatedWords = '';\n      let relatedFields = '';\n      let difficultyRaw = '';\n\n      if (columns.length >= 8) {\n        // 82\n        relatedWords = (columns[4] || '') + (columns[5] || '');\n        relatedFields = columns[6] || '';\n        difficultyRaw = columns[7] || '';\n      } else {\n        // 7\n        relatedWords = columns[4] || '';\n        relatedFields = columns[5] || '';\n        difficultyRaw = columns[6] || '';\n      }\n\n      // \n      let difficulty = '';\n      if (difficultyRaw.includes('') || difficultyRaw === 'beginner') {\n        difficulty = 'beginner';\n      } else if (difficultyRaw.includes('') || difficultyRaw === 'intermediate') {\n        difficulty = 'intermediate';\n      } else if (difficultyRaw.includes('') || difficultyRaw === 'advanced') {\n        difficulty = 'advanced';\n      }\n\n      //  : 10\n      if (relatedFields && !isValidCategory(relatedFields)) {\n        logger.warn(\n          `[] : \"${relatedFields}\" (: \"${word}\")\\n` +\n            `: ${OFFICIAL_CATEGORIES.join(', ')}\\n` +\n            `: docs/19-junior-high-vocabulary.md`\n        );\n      }\n\n      if (word && meaning) {\n        questions.push({\n          word,\n          reading,\n          meaning,\n          etymology,\n          relatedWords,\n          relatedFields,\n          category: relatedFields, // category\n          difficulty,\n        });\n      }\n    }\n  }\n\n  return questions;\n}\n\n/**\n * \n */\nexport function shuffle<T>(array: T[]): T[] {\n  const newArray = [...array];\n  for (let i = newArray.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [newArray[i], newArray[j]] = [newArray[j], newArray[i]];\n  }\n  return newArray;\n}\n\n/**\n * 1 + 2 + \n */\nexport function generateChoices(\n  correctAnswer: string,\n  allQuestions: Question[],\n  currentIndex: number\n): string[] {\n  const wrongAnswers: string[] = [];\n  const otherQuestions = allQuestions.filter((_, idx) => idx !== currentIndex);\n  const shuffledOthers = shuffle(otherQuestions);\n\n  for (let i = 0; i < shuffledOthers.length && wrongAnswers.length < 2; i++) {\n    const wrongAnswer = shuffledOthers[i].meaning;\n    if (wrongAnswer !== correctAnswer && !wrongAnswers.includes(wrongAnswer)) {\n      wrongAnswers.push(wrongAnswer);\n    }\n  }\n\n  // \n  while (wrongAnswers.length < 2) {\n    wrongAnswers.push(`${wrongAnswers.length + 1}`);\n  }\n\n  // 3\n  const shuffledFirst3 = shuffle([correctAnswer, ...wrongAnswers]);\n  return [...shuffledFirst3, ''];\n}\n\n/**\n * Question\n * 1 + 2 + 4\n */\nexport function generateChoicesWithQuestions(\n  currentQuestion: Question,\n  allQuestions: Question[],\n  currentIndex: number\n): Array<{ text: string; question: Question | null }> {\n  const wrongQuestions: Question[] = [];\n  const otherQuestions = allQuestions.filter((_, idx) => idx !== currentIndex);\n  const shuffledOthers = shuffle(otherQuestions);\n\n  // 232\n  for (let i = 0; i < shuffledOthers.length && wrongQuestions.length < 2; i++) {\n    const wrongQuestion = shuffledOthers[i];\n    if (\n      wrongQuestion.meaning !== currentQuestion.meaning &&\n      !wrongQuestions.some((q) => q.meaning === wrongQuestion.meaning)\n    ) {\n      wrongQuestions.push(wrongQuestion);\n    }\n  }\n\n  // \n  while (wrongQuestions.length < 2) {\n    wrongQuestions.push({\n      word: `${wrongQuestions.length + 1}`,\n      meaning: `${wrongQuestions.length + 1}`,\n      reading: '',\n      etymology: '',\n      relatedWords: '',\n      relatedFields: '',\n      category: '',\n      difficulty: '',\n    });\n  }\n\n  // 2\n  const firstThreeChoices = shuffle([\n    { text: currentQuestion.meaning, question: currentQuestion },\n    ...wrongQuestions.map((q) => ({ text: q.meaning, question: q })),\n  ]);\n\n  return [...firstThreeChoices, { text: '', question: null }];\n}\n\n/**\n * : \n */\nexport function generateSpellingPuzzle(word: string): {\n  displayWord: string[];\n  missingIndices: number[];\n  letterChoices: string[];\n} {\n  if (!word || word.length === 0) {\n    return { displayWord: [], missingIndices: [], letterChoices: [] };\n  }\n\n  const wordUpper = word.toUpperCase();\n  const wordArray = wordUpper.split('');\n\n  // \n  const numBlanks = Math.min(Math.ceil(word.length / 2), 5);\n  const missingIndices: number[] = [];\n\n  // \n  const availableIndices = Array.from({ length: word.length }, (_, i) => i);\n  const shuffledIndices = shuffle(availableIndices);\n\n  for (let i = 0; i < numBlanks && i < shuffledIndices.length; i++) {\n    missingIndices.push(shuffledIndices[i]);\n  }\n\n  missingIndices.sort((a, b) => a - b);\n\n  // \n  const correctLetters = missingIndices.map((idx) => wordArray[idx]);\n\n  // \n  const allLetters = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ'.split('');\n  const usedLetters = new Set(correctLetters);\n  const dummyLetters: string[] = [];\n\n  const shuffledAll = shuffle(allLetters);\n  for (const letter of shuffledAll) {\n    if (!usedLetters.has(letter) && dummyLetters.length < 6) {\n      dummyLetters.push(letter);\n    }\n  }\n\n  // \n  const letterChoices = shuffle([...correctLetters, ...dummyLetters]);\n\n  return {\n    displayWord: wordArray,\n    missingIndices,\n    letterChoices,\n  };\n}\n\n// ========== QuestionSet  ==========\n\nimport type { QuestionSet, ReadingPassage } from './types';\n\nconst QUESTION_SETS_KEY = 'quizApp_questionSets';\n\n/**\n *  localStorage \n */\nexport function saveQuestionSets(sets: QuestionSet[]): void {\n  try {\n    localStorage.setItem(QUESTION_SETS_KEY, JSON.stringify(sets));\n  } catch (error) {\n    logger.error('Failed to save question sets:', error);\n  }\n}\n\n// ==========  ==========\n\n/**\n * YYYY-MM-DD\n * UTC\n */\nexport function formatLocalYYYYMMDD(d: Date): string {\n  const y = d.getFullYear();\n  const m = String(d.getMonth() + 1).padStart(2, '0');\n  const day = String(d.getDate()).padStart(2, '0');\n  return `${y}-${m}-${day}`;\n}\n\n/**\n * typo\n */\nexport const QUIZ_RESULT_EVENT = 'quiz-result-added';\n\n/**\n *  localStorage \n */\nexport function loadQuestionSets(): QuestionSet[] {\n  try {\n    const data = localStorage.getItem(QUESTION_SETS_KEY);\n    if (!data) return [];\n    return JSON.parse(data) as QuestionSet[];\n  } catch (error) {\n    logger.error('Failed to load question sets:', error);\n    return [];\n  }\n}\n\n/**\n * \n */\nexport function saveQuestionSet(set: QuestionSet): void {\n  const sets = loadQuestionSets();\n  const index = sets.findIndex((s) => s.id === set.id);\n\n  if (index >= 0) {\n    sets[index] = set;\n  } else {\n    sets.push(set);\n  }\n\n  saveQuestionSets(sets);\n}\n\n/**\n * \n */\nexport function deleteQuestionSet(id: string): boolean {\n  const sets = loadQuestionSets();\n  const set = sets.find((s) => s.id === id);\n\n  if (set?.isBuiltIn) {\n    return false; // \n  }\n\n  const filtered = sets.filter((s) => s.id !== id);\n  saveQuestionSets(filtered);\n  return true;\n}\n\n/**\n * ID\n */\nexport function generateId(): string {\n  return `${Date.now()}-${Math.random().toString(36).substr(2, 9)}`;\n}\n\n// ==========  JSON / ==========\n\n/**\n * ReadingPassage  JSON \n */\nexport function exportPassagesJSON(passages: ReadingPassage[]): string {\n  return JSON.stringify(passages, null, 2);\n}\n\n/**\n * JSON  ReadingPassage \n */\nexport function importPassagesJSON(jsonText: string): ReadingPassage[] {\n  try {\n    const parsed = JSON.parse(jsonText);\n    if (!Array.isArray(parsed)) {\n      throw new Error('Invalid format: expected array');\n    }\n    // \n    for (const p of parsed) {\n      if (!p.id || !p.title || !Array.isArray(p.phrases)) {\n        throw new Error('Invalid passage structure');\n      }\n    }\n    return parsed as ReadingPassage[];\n  } catch (error) {\n    logger.error('Failed to import passages:', error);\n    throw error;\n  }\n}\n\n/**\n * ReadingPassage  JSON \n */\nexport function downloadPassagesJSON(\n  passages: ReadingPassage[],\n  filename: string = 'passages.json'\n): void {\n  const json = exportPassagesJSON(passages);\n  const blob = new Blob([json], { type: 'application/json' });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = filename;\n  link.click();\n\n  URL.revokeObjectURL(url);\n}\n\n/**\n *  CSV \n */\nexport function exportQuestionSetCSV(set: QuestionSet): string {\n  const header = ',,,,,,';\n  const rows = set.questions.map((q) => {\n    return [\n      q.word,\n      q.reading,\n      q.meaning,\n      q.etymology,\n      q.relatedWords,\n      q.relatedFields,\n      q.difficulty,\n    ]\n      .map((field) => {\n        // \n        if (field.includes(',') || field.includes('\"') || field.includes('\\n')) {\n          return `\"${field.replace(/\"/g, '\"\"')}\"`;\n        }\n        return field;\n      })\n      .join(',');\n  });\n\n  return [header, ...rows].join('\\n');\n}\n\n/**\n *  CSV \n */\nexport function downloadQuestionSetCSV(set: QuestionSet): void {\n  const csv = exportQuestionSetCSV(set);\n  const blob = new Blob([csv], { type: 'text/csv;charset=utf-8;' });\n  const url = URL.createObjectURL(blob);\n\n  const link = document.createElement('a');\n  link.href = url;\n  link.download = `${set.name.replace(/[^a-zA-Z0-9]/g, '_')}.csv`;\n  link.click();\n\n  URL.revokeObjectURL(url);\n}\n\n// ==========  ==========\n\nimport { getAllWordProgress, getWordProgress } from './storage/progress/progressStorage';\n\n/**\n * \n * - : 30% ( or masteryLevel='new')\n * - : 50% ( masteryLevel='learning')\n * - : 20% ( masteryLevel='mastered')\n */\nexport function selectAdaptiveQuestions(allQuestions: Question[], count: number = 10): Question[] {\n  if (allQuestions.length === 0) return [];\n\n  // \n  const wordProgressMap = new Map<string, any>();\n  const allProgress = getAllWordProgress();\n  allProgress.forEach((wp) => {\n    wordProgressMap.set(wp.word.toLowerCase(), wp);\n  });\n\n  // \n  const newWords: Question[] = [];\n  const learningWords: Question[] = [];\n  const masteredWords: Question[] = [];\n\n  allQuestions.forEach((q) => {\n    const progress = wordProgressMap.get(q.word.toLowerCase());\n\n    if (!progress || progress.masteryLevel === 'new') {\n      newWords.push(q);\n    } else if (progress.masteryLevel === 'learning') {\n      learningWords.push(q);\n    } else if (progress.masteryLevel === 'mastered') {\n      masteredWords.push(q);\n    }\n  });\n\n  // \n  const newCount = Math.ceil(count * 0.3);\n  const learningCount = Math.ceil(count * 0.5);\n  const masteredCount = Math.floor(count * 0.2);\n\n  const selected: Question[] = [];\n\n  // 1. \n  const learningWithScores = learningWords.map((q) => {\n    const progress = wordProgressMap.get(q.word.toLowerCase());\n    // +20\n    const memorizationBonus = Math.min((progress?.memorizationCorrect || 0) * 2, 20);\n    const adjustedScore = (progress?.difficultyScore || 50) + memorizationBonus;\n    return { question: q, score: adjustedScore };\n  });\n  learningWithScores.sort((a, b) => b.score - a.score);\n\n  const selectedLearning = learningWithScores\n    .slice(0, Math.min(learningCount, learningWithScores.length))\n    .map((item) => item.question);\n  selected.push(...selectedLearning);\n\n  // 2. \n  const newWordsWithMemorization = newWords.map((q) => {\n    const progress = wordProgressMap.get(q.word.toLowerCase());\n    // \n    const memorizationBonus = (progress?.memorizationCorrect || 0) * 10;\n    return { question: q, priority: memorizationBonus };\n  });\n  // \n  newWordsWithMemorization.sort((a, b) => {\n    if (b.priority !== a.priority) return b.priority - a.priority;\n    return Math.random() - 0.5; // \n  });\n  const selectedNew = newWordsWithMemorization\n    .slice(0, Math.min(newCount, newWordsWithMemorization.length))\n    .map((item) => item.question);\n  selected.push(...selectedNew);\n\n  // 3. \n  const shuffledMastered = shuffle(masteredWords);\n  const selectedMastered = shuffledMastered.slice(\n    0,\n    Math.min(masteredCount, shuffledMastered.length)\n  );\n  selected.push(...selectedMastered);\n\n  // \n  const remaining = count - selected.length;\n  if (remaining > 0) {\n    const allRemaining = [...newWords, ...learningWords, ...masteredWords].filter(\n      (q) => !selected.includes(q)\n    );\n    const shuffledRemaining = shuffle(allRemaining);\n    selected.push(...shuffledRemaining.slice(0, remaining));\n  }\n\n  // \n  return shuffle(selected).slice(0, count);\n}\n\n/**\n * 50\n */\nexport function selectWeakQuestions(allQuestions: Question[], count: number = 10): Question[] {\n  const allProgress = getAllWordProgress();\n  const weakWords = allProgress\n    .filter((wp) => wp.difficultyScore >= 50)\n    .sort((a, b) => b.difficultyScore - a.difficultyScore)\n    .map((wp) => wp.word.toLowerCase());\n\n  const weakQuestions = allQuestions.filter((q) => weakWords.includes(q.word.toLowerCase()));\n\n  return shuffle(weakQuestions).slice(0, Math.min(count, weakQuestions.length));\n}\n\n/**\n * 24\n */\nexport function selectReviewQuestions(\n  allQuestions: Question[],\n  count: number = 10,\n  hoursThreshold: number = 24\n): Question[] {\n  const now = Date.now();\n  const threshold = hoursThreshold * 60 * 60 * 1000;\n\n  const allProgress = getAllWordProgress();\n  const needReviewWords = allProgress\n    .filter((wp) => {\n      const timeSinceLastStudy = now - wp.lastStudied;\n      return wp.masteryLevel === 'learning' && timeSinceLastStudy >= threshold;\n    })\n    .sort((a, b) => b.difficultyScore - a.difficultyScore)\n    .map((wp) => wp.word.toLowerCase());\n\n  const reviewQuestions = allQuestions.filter((q) =>\n    needReviewWords.includes(q.word.toLowerCase())\n  );\n\n  return shuffle(reviewQuestions).slice(0, Math.min(count, reviewQuestions.length));\n}\n\n/**\n * \n */\nexport function selectQuestionsByMasteryLevel(\n  allQuestions: Question[],\n  masteryLevel: 'new' | 'learning' | 'mastered',\n  count?: number\n): Question[] {\n  const allProgress = getAllWordProgress();\n  const targetWords = allProgress\n    .filter((wp) => wp.masteryLevel === masteryLevel)\n    .map((wp) => wp.word.toLowerCase());\n\n  const filteredQuestions = allQuestions.filter((q) => {\n    const progress = getWordProgress(q.word);\n\n    // 'new'\n    if (!progress && masteryLevel === 'new') {\n      return true;\n    }\n\n    return targetWords.includes(q.word.toLowerCase());\n  });\n\n  const shuffled = shuffle(filteredQuestions);\n  return count ? shuffled.slice(0, count) : shuffled;\n}\n\n/**\n * \n * @param phrase - : \"look forward to\", \"break the ice\"\n * @returns 'phrasal-verb' | 'idiom' | 'collocation' | 'other'\n */\nexport function classifyPhraseType(phrase: string): string {\n  // \n  if (!phrase.includes(' ')) {\n    return 'word';\n  }\n\n  const lowerPhrase = phrase.toLowerCase();\n  const words = lowerPhrase.split(' ');\n\n  // :  + /\n  const commonVerbs = [\n    'get',\n    'go',\n    'come',\n    'take',\n    'make',\n    'put',\n    'look',\n    'turn',\n    'break',\n    'bring',\n    'call',\n    'carry',\n    'check',\n    'figure',\n    'fill',\n    'find',\n    'give',\n    'hand',\n    'hang',\n    'hold',\n    'keep',\n    'knock',\n    'lay',\n    'let',\n    'pass',\n    'pick',\n    'pull',\n    'push',\n    'run',\n    'set',\n    'show',\n    'shut',\n    'sit',\n    'stand',\n    'stay',\n    'stick',\n    'take',\n    'talk',\n    'think',\n    'throw',\n    'try',\n    'work',\n    'write',\n  ];\n\n  const particles = [\n    'up',\n    'down',\n    'in',\n    'out',\n    'on',\n    'off',\n    'away',\n    'back',\n    'over',\n    'through',\n    'around',\n    'across',\n    'along',\n    'about',\n    'after',\n    'for',\n    'from',\n    'into',\n    'to',\n    'with',\n  ];\n\n  // : /\n  if (words.length >= 2 && commonVerbs.includes(words[0])) {\n    const hasParticle = words.slice(1).some((w) => particles.includes(w));\n    if (hasParticle) {\n      return 'phrasal-verb';\n    }\n  }\n\n  // \n  const idiomPatterns = [\n    /^a .+ of$/, // a piece of, a drop in the bucket\n    /^the .+ (of|in)$/, // the tip of the iceberg, the elephant in the room\n    /^(break|beat|hit|kick) (the|a)/, // break the ice, beat around the bush\n    /^(catch|have|take|make) (a|an|the)/, // catch one's eye, have a blast\n    /(eye|eyes|face|hand|tongue|ear|nose|heart|mind|bone)/i, // \n    /^once in a/, // once in a blue moon\n    /^(cost|pay|worth) (an|a)/, // cost an arm and a leg\n    /^at .+ (heart|first|last|once)/, // at heart, at first sight\n  ];\n\n  const isIdiom = idiomPatterns.some((pattern) => pattern.test(lowerPhrase));\n  if (isIdiom) {\n    return 'idiom';\n  }\n\n  // : ++\n  const collocPatterns = [\n    /^(in|on|at|by|with|from|to) (the|a|an) /, // \n    /^(make|take|do|have|get) (a|an|the) /, // ++\n    /(strong|weak|heavy|light|high|low|good|bad|big|small) /i, // +\n  ];\n\n  const isCollocation = collocPatterns.some((pattern) => pattern.test(lowerPhrase));\n  if (isCollocation) {\n    return 'collocation';\n  }\n\n  // \n  return 'other';\n}\n\n/**\n * \n */\nexport function getPhraseTypeLabel(phraseType: string): string {\n  const labels: Record<string, string> = {\n    word: '',\n    'phrasal-verb': '',\n    idiom: '',\n    collocation: '',\n    other: '',\n  };\n  return labels[phraseType] || '';\n}\n\n// ========== 90 ==========\n\nimport type { LearningSchedule, DailyStudyPlan } from './types';\n\n/**\n * \n * @param allQuestions \n * @param months : 1, 2, 3, 6\n * @param startDate \n */\nexport function generateLearningPlan(\n  allQuestions: Question[],\n  months: number = 3,\n  startDate: number = Date.now()\n): LearningSchedule {\n  const totalDays = months * 30; // 1=30\n  const totalWords = allQuestions.length;\n\n  // 1\n  const dailyNewWords = Math.ceil(totalWords / totalDays);\n  const dailyReviewWords = Math.ceil(dailyNewWords * 1.5);\n  const dailyMinutes = Math.ceil((dailyNewWords + dailyReviewWords) * 0.5); // 10.5\n\n  // \n  const milestones = generateMilestones(totalDays, dailyNewWords);\n\n  const schedule: LearningSchedule = {\n    userId: 'default',\n    startDate,\n    currentDay: 1,\n    totalDays,\n    planDurationMonths: months,\n    phase: 1,\n\n    dailyGoals: {\n      newWords: dailyNewWords,\n      reviewWords: dailyReviewWords,\n      timeMinutes: dailyMinutes,\n    },\n\n    weeklyProgress: [],\n    milestones,\n  };\n\n  return schedule;\n}\n\n/**\n * \n */\nfunction generateMilestones(totalDays: number, dailyNewWords: number) {\n  const milestones = [];\n\n  // 1\n  if (totalDays >= 7) {\n    milestones.push({\n      day: 7,\n      title: '1',\n      wordsTarget: dailyNewWords * 7,\n      achieved: false,\n    });\n  }\n\n  // 2\n  if (totalDays >= 14) {\n    milestones.push({\n      day: 14,\n      title: '2',\n      wordsTarget: dailyNewWords * 14,\n      achieved: false,\n    });\n  }\n\n  // 3\n  if (totalDays >= 21) {\n    milestones.push({\n      day: 21,\n      title: '3',\n      wordsTarget: dailyNewWords * 21,\n      achieved: false,\n    });\n  }\n\n  // 1\n  if (totalDays >= 30) {\n    milestones.push({\n      day: 30,\n      title: '1',\n      wordsTarget: dailyNewWords * 30,\n      achieved: false,\n    });\n  }\n\n  // \n  const halfDay = Math.floor(totalDays / 2);\n  if (totalDays >= 60 && halfDay > 30) {\n    milestones.push({\n      day: halfDay,\n      title: '',\n      wordsTarget: dailyNewWords * halfDay,\n      achieved: false,\n    });\n  }\n\n  // 2\n  if (totalDays >= 60) {\n    milestones.push({\n      day: 60,\n      title: '2',\n      wordsTarget: dailyNewWords * 60,\n      achieved: false,\n    });\n  }\n\n  // 75%\n  const threeQuarterDay = Math.floor(totalDays * 0.75);\n  if (totalDays >= 90 && threeQuarterDay > 60) {\n    milestones.push({\n      day: threeQuarterDay,\n      title: '',\n      wordsTarget: dailyNewWords * threeQuarterDay,\n      achieved: false,\n    });\n  }\n\n  // 3\n  if (totalDays >= 90) {\n    milestones.push({\n      day: 90,\n      title: '3',\n      wordsTarget: dailyNewWords * 90,\n      achieved: false,\n    });\n  }\n\n  // 6\n  if (totalDays >= 180) {\n    milestones.push({\n      day: 180,\n      title: '6',\n      wordsTarget: dailyNewWords * 180,\n      achieved: false,\n    });\n  }\n\n  // \n  if (!milestones.find((m) => m.day === totalDays)) {\n    milestones.push({\n      day: totalDays,\n      title: `${Math.floor(totalDays / 30)}`,\n      wordsTarget: dailyNewWords * totalDays,\n      achieved: false,\n    });\n  }\n\n  return milestones.sort((a, b) => a.day - b.day);\n}\n\n/**\n * \n */\nexport function generate90DayPlan(\n  allQuestions: Question[],\n  startDate: number = Date.now()\n): LearningSchedule {\n  return generateLearningPlan(allQuestions, 3, startDate);\n}\n\n/**\n * 1-3\n * @param dayNumber \n * @param totalDays \n */\nfunction getPhase(dayNumber: number, totalDays: number = 90): 1 | 2 | 3 {\n  const phase1End = Math.floor(totalDays / 3);\n  const phase2End = Math.floor((totalDays * 2) / 3);\n\n  if (dayNumber <= phase1End) return 1;\n  if (dayNumber <= phase2End) return 2;\n  return 3;\n}\n\n/**\n * \n */\nfunction getUnlearnedWords(allQuestions: Question[]): Question[] {\n  const allProgress = getAllWordProgress();\n  const progressMap = new Map<string, any>();\n\n  allProgress.forEach((wp) => {\n    progressMap.set(wp.word.toLowerCase(), wp);\n  });\n\n  return allQuestions.filter((q) => {\n    const progress = progressMap.get(q.word.toLowerCase());\n    return !progress || progress.masteryLevel === 'new';\n  });\n}\n\n/**\n * \n */\nfunction getReviewDueWords(allQuestions: Question[]): Question[] {\n  const now = Date.now();\n  const allProgress = getAllWordProgress();\n  const progressMap = new Map<string, any>();\n\n  allProgress.forEach((wp) => {\n    progressMap.set(wp.word.toLowerCase(), wp);\n  });\n\n  return allQuestions.filter((q) => {\n    const progress = progressMap.get(q.word.toLowerCase());\n    if (!progress) return false;\n\n    const daysSinceLastStudy = (now - progress.lastStudied) / (1000 * 60 * 60 * 24);\n\n    // : \n    let dueInterval: number;\n\n    switch (progress.masteryLevel) {\n      case 'new':\n        dueInterval = 1;\n        break;\n      case 'learning':\n        dueInterval = Math.min(7, progress.consecutiveCorrect + 1);\n        break;\n      case 'mastered':\n        dueInterval = Math.min(30, progress.consecutiveCorrect * 2);\n        break;\n      default:\n        dueInterval = 1;\n    }\n\n    return daysSinceLastStudy >= dueInterval;\n  });\n}\n\n/**\n * \n */\nfunction selectNewWordsForPhase(\n  unlearnedWords: Question[],\n  phase: 1 | 2 | 3,\n  count: number\n): Question[] {\n  let filtered: Question[];\n\n  switch (phase) {\n    case 1: // Phase 1: \n      filtered = unlearnedWords.filter((q) => q.difficulty === '');\n      if (filtered.length < count) {\n        // \n        filtered = [...filtered, ...unlearnedWords.filter((q) => q.difficulty === '')];\n      }\n      break;\n\n    case 2: // Phase 2: +\n      const beginner = unlearnedWords.filter((q) => q.difficulty === '');\n      const intermediate = unlearnedWords.filter((q) => q.difficulty === '');\n      filtered = [...beginner, ...intermediate];\n      break;\n\n    case 3: // Phase 3: +\n      const mid = unlearnedWords.filter((q) => q.difficulty === '');\n      const adv = unlearnedWords.filter((q) => q.difficulty === '');\n      filtered = [...mid, ...adv];\n      break;\n  }\n\n  return shuffle(filtered).slice(0, count);\n}\n\n/**\n * \n */\nexport function generateDailyPlan(\n  schedule: LearningSchedule,\n  allQuestions: Question[]\n): DailyStudyPlan {\n  const dayNumber = schedule.currentDay;\n  const phase = getPhase(dayNumber, schedule.totalDays);\n\n  // \n  const unlearnedWords = getUnlearnedWords(allQuestions);\n\n  // \n  const reviewDueWords = getReviewDueWords(allQuestions);\n\n  // : \n  const morningCount = Math.ceil(schedule.dailyGoals.newWords * 0.3);\n  const morningWords = selectNewWordsForPhase(unlearnedWords, phase, morningCount);\n\n  // : \n  const afternoonCount = Math.ceil(schedule.dailyGoals.reviewWords * 0.4);\n  const afternoonWords = selectWeakQuestions(\n    reviewDueWords.length > 0 ? reviewDueWords : allQuestions,\n    afternoonCount\n  );\n\n  // : +\n  const eveningNewCount = Math.floor(morningCount * 0.3);\n  const eveningReviewCount = Math.ceil(schedule.dailyGoals.reviewWords * 0.3);\n  const eveningWords = [\n    ...shuffle(morningWords).slice(0, eveningNewCount),\n    ...shuffle(reviewDueWords.length > 0 ? reviewDueWords : allQuestions).slice(\n      0,\n      eveningReviewCount\n    ),\n  ];\n\n  return {\n    date: schedule.startDate + (dayNumber - 1) * 24 * 60 * 60 * 1000,\n    dayNumber,\n    phase,\n\n    morning: {\n      newWords: morningWords,\n      duration: Math.ceil(schedule.dailyGoals.timeMinutes * 0.35),\n      mode: 'discovery',\n    },\n\n    afternoon: {\n      reviewWords: afternoonWords,\n      duration: Math.ceil(schedule.dailyGoals.timeMinutes * 0.3),\n      mode: 'weakness',\n    },\n\n    evening: {\n      mixedWords: shuffle(eveningWords),\n      duration: Math.ceil(schedule.dailyGoals.timeMinutes * 0.35),\n      mode: 'mixed',\n    },\n\n    completed: false,\n    actualAccuracy: 0,\n  };\n}\n\n/**\n * \n */\nexport function calculateProgress(schedule: LearningSchedule): {\n  totalLearned: number;\n  totalReviewed: number;\n  averageAccuracy: number;\n  estimatedCompletion: number;\n} {\n  const allProgress = getAllWordProgress();\n\n  const totalLearned = allProgress.filter((wp) => wp.masteryLevel !== 'new').length;\n\n  const totalReviewed = allProgress.reduce(\n    (sum, wp) => sum + wp.correctCount + wp.incorrectCount,\n    0\n  );\n\n  const totalCorrect = allProgress.reduce((sum, wp) => sum + wp.correctCount, 0);\n\n  const averageAccuracy = totalReviewed > 0 ? (totalCorrect / totalReviewed) * 100 : 0;\n\n  // \n  const dailyAverage = totalLearned / schedule.currentDay;\n  const remaining = 4700 - totalLearned;\n  const estimatedDays = remaining / (dailyAverage || 50);\n\n  return {\n    totalLearned,\n    totalReviewed,\n    averageAccuracy,\n    estimatedCompletion: Math.ceil(estimatedDays),\n  };\n}\n\n/**\n * \n */\nexport function calculateWeeklyAchievement(schedule: LearningSchedule): number {\n  const weekNumber = Math.ceil(schedule.currentDay / 7);\n  const targetPerWeek = schedule.dailyGoals.newWords * 7;\n\n  const weekProgress = schedule.weeklyProgress.find((w) => w.week === weekNumber);\n  if (!weekProgress) return 0;\n\n  return (weekProgress.wordsLearned / targetPerWeek) * 100;\n}\n","/**\n * \n * \n */\n\nimport { useState } from 'react';\n\nexport function useQuizSettings() {\n  const [autoAdvance] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoAdvance');\n    return saved ? JSON.parse(saved) : false;\n  });\n\n  const [autoAdvanceDelay] = useState<number>(() => {\n    const saved = localStorage.getItem('autoAdvanceDelay');\n    return saved ? parseInt(saved, 10) : 1500;\n  });\n\n  return {\n    autoAdvance,\n    autoAdvanceDelay,\n  };\n}\n","/**\n * \n * \n */\n\nimport { useState } from 'react';\n// App.tsx\ntype DifficultyLevel = 'all' | 'beginner' | 'intermediate' | 'advanced';\ntype WordPhraseFilter = 'all' | 'words-only' | 'phrases-only';\ntype PhraseTypeFilter = 'all' | 'phrasal-verb' | 'idiom' | 'collocation' | 'other';\ntype DataSource = 'all' | 'junior' | 'intermediate' | 'advanced' | 'standard' | string;\n\nexport function useQuizFilters() {\n  const [categoryList, setCategoryList] = useState<string[]>([]);\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedDifficulty, setSelectedDifficulty] = useState<DifficultyLevel>('all');\n  const [selectedWordPhraseFilter, setSelectedWordPhraseFilter] = useState<WordPhraseFilter>('all');\n  const [selectedPhraseTypeFilter, setSelectedPhraseTypeFilter] = useState<PhraseTypeFilter>('all');\n\n  const [selectedDataSource, setSelectedDataSource] = useState<DataSource>(() => {\n    const saved = localStorage.getItem('selectedDataSource');\n    if (saved) {\n      try {\n        return JSON.parse(saved);\n      } catch {\n        return 'all';\n      }\n    }\n    return 'all';\n  });\n\n  return {\n    categoryList,\n    setCategoryList,\n    selectedCategory,\n    setSelectedCategory,\n    selectedDifficulty,\n    setSelectedDifficulty,\n    selectedWordPhraseFilter,\n    setSelectedWordPhraseFilter,\n    selectedPhraseTypeFilter,\n    setSelectedPhraseTypeFilter,\n    selectedDataSource,\n    setSelectedDataSource,\n  };\n}\n","import { useState } from 'react';\nimport type { Question, QuizState } from '@/types';\n\n// \ninterface SessionStats {\n  correct: number;\n  incorrect: number;\n  review: number;\n  mastered: number;\n  newQuestions: number;      // \n  reviewQuestions: number;   // \n  consecutiveNew: number;    // \n  consecutiveReview: number; // \n}\n\n/**\n * \n * - quizState: \n * - sessionStats: \n * - reviewFocusMode: \n * - reviewQuestionPool: \n * - reviewCorrectStreak: \n */\nexport function useQuizState() {\n  // \n  const [sessionStats, setSessionStats] = useState<SessionStats>({\n    correct: 0,\n    incorrect: 0,\n    review: 0,\n    mastered: 0,\n    newQuestions: 0,\n    reviewQuestions: 0,\n    consecutiveNew: 0,\n    consecutiveReview: 0,\n  });\n\n  // \n  const [quizState, setQuizState] = useState<QuizState>({\n    questions: [],\n    currentIndex: 0,\n    score: 0,\n    totalAnswered: 0,\n    answered: false,\n    selectedAnswer: null,\n  });\n\n  // \n  const [reviewFocusMode, setReviewFocusMode] = useState<boolean>(false);\n  const [reviewQuestionPool, setReviewQuestionPool] = useState<Question[]>([]);\n  const [reviewCorrectStreak, setReviewCorrectStreak] = useState<Map<string, number>>(new Map());\n\n  return {\n    sessionStats,\n    setSessionStats,\n    quizState,\n    setQuizState,\n    reviewFocusMode,\n    setReviewFocusMode,\n    reviewQuestionPool,\n    setReviewQuestionPool,\n    reviewCorrectStreak,\n    setReviewCorrectStreak,\n  };\n}\n","import type { CustomQuestionSet, CustomQuestionState, CustomWord } from '../types/customQuestions';\n\nconst STORAGE_KEY = 'customQuestionSets';\n\n/**\n * LocalStorage\n */\nexport function loadCustomQuestionState(): CustomQuestionState {\n  try {\n    const stored = localStorage.getItem(STORAGE_KEY);\n    if (stored) {\n      const parsed = JSON.parse(stored);\n      return {\n        sets: parsed.sets || [],\n        activeSetId: parsed.activeSetId || null,\n        recentSetIds: parsed.recentSetIds || [],\n      };\n    }\n  } catch (error) {\n    console.error('Failed to load custom question state:', error);\n  }\n\n  return {\n    sets: [],\n    activeSetId: null,\n    recentSetIds: [],\n  };\n}\n\n/**\n * LocalStorage\n */\nexport function saveCustomQuestionState(state: CustomQuestionState): void {\n  try {\n    localStorage.setItem(STORAGE_KEY, JSON.stringify(state));\n  } catch (error) {\n    console.error('Failed to save custom question state:', error);\n  }\n}\n\n/**\n * \n */\nexport function createCustomQuestionSet(\n  name: string,\n  description?: string,\n  icon?: string,\n  color?: string\n): CustomQuestionSet {\n  const now = new Date().toISOString();\n  return {\n    id: `set_${Date.now()}_${Math.random().toString(36).substr(2, 9)}`,\n    name,\n    description,\n    words: [],\n    createdAt: now,\n    updatedAt: now,\n    icon,\n    color,\n  };\n}\n\n/**\n * \n */\nexport function addWordToSet(\n  state: CustomQuestionState,\n  setId: string,\n  word: CustomWord\n): CustomQuestionState {\n  const sets = state.sets.map((set) => {\n    if (set.id !== setId) return set;\n\n    // \n    if (set.words.some((w) => w.word === word.word)) {\n      return set;\n    }\n\n    return {\n      ...set,\n      words: [...set.words, { ...word, addedAt: new Date().toISOString() }],\n      updatedAt: new Date().toISOString(),\n    };\n  });\n\n  return {\n    ...state,\n    sets,\n    recentSetIds: updateRecentSetIds(state.recentSetIds, setId),\n  };\n}\n\n/**\n * \n */\nexport function removeWordFromSet(\n  state: CustomQuestionState,\n  setId: string,\n  word: CustomWord\n): CustomQuestionState {\n  const sets = state.sets.map((set) => {\n    if (set.id !== setId) return set;\n\n    return {\n      ...set,\n      words: set.words.filter((w) => w.word !== word.word),\n      updatedAt: new Date().toISOString(),\n    };\n  });\n\n  return { ...state, sets };\n}\n\n/**\n * \n */\nexport function deleteCustomQuestionSet(\n  state: CustomQuestionState,\n  setId: string\n): CustomQuestionState {\n  return {\n    ...state,\n    sets: state.sets.filter((set) => set.id !== setId),\n    activeSetId: state.activeSetId === setId ? null : state.activeSetId,\n    recentSetIds: state.recentSetIds.filter((id) => id !== setId),\n  };\n}\n\n/**\n * \n */\nexport function updateCustomQuestionSet(\n  state: CustomQuestionState,\n  setId: string,\n  updates: Partial<Pick<CustomQuestionSet, 'name' | 'description' | 'icon' | 'color'>>\n): CustomQuestionState {\n  const sets = state.sets.map((set) => {\n    if (set.id !== setId) return set;\n\n    return {\n      ...set,\n      ...updates,\n      updatedAt: new Date().toISOString(),\n    };\n  });\n\n  return { ...state, sets };\n}\n\n/**\n * ID5\n */\nfunction updateRecentSetIds(recentSetIds: string[], setId: string): string[] {\n  const filtered = recentSetIds.filter((id) => id !== setId);\n  const updated = [setId, ...filtered];\n  return updated.slice(0, 5);\n}\n\n/**\n * \n */\nexport function isWordInSet(set: CustomQuestionSet, word: string): boolean {\n  return set.words.some((w) => w.word === word);\n}\n\n/**\n * \n */\nexport function isWordInAnySets(sets: CustomQuestionSet[], word: string): boolean {\n  return sets.some((set) => isWordInSet(set, word));\n}\n\n/**\n * \n */\nexport function getSetsContainingWord(\n  sets: CustomQuestionSet[],\n  word: string\n): CustomQuestionSet[] {\n  return sets.filter((set) => isWordInSet(set, word));\n}\n\n/**\n * ID\n */\nexport function getSetById(\n  sets: CustomQuestionSet[],\n  setId: string\n): CustomQuestionSet | undefined {\n  return sets.find((set) => set.id === setId);\n}\n\n/**\n * \n */\nexport function getAllUniqueWords(sets: CustomQuestionSet[]): CustomWord[] {\n  const wordMap = new Map<string, CustomWord>();\n\n  sets.forEach((set) => {\n    set.words.forEach((word) => {\n      if (!wordMap.has(word.word)) {\n        wordMap.set(word.word, word);\n      }\n    });\n  });\n\n  return Array.from(wordMap.values());\n}\n\n/**\n * \n */\nexport function getSetStatistics(set: CustomQuestionSet) {\n  const totalWords = set.words.length;\n  const sources = set.words.reduce(\n    (acc, word) => {\n      const source = word.source || 'unknown';\n      acc[source] = (acc[source] || 0) + 1;\n      return acc;\n    },\n    {} as Record<string, number>\n  );\n\n  const tags = set.words.reduce(\n    (acc, word) => {\n      (word.tags || []).forEach((tag) => {\n        acc[tag] = (acc[tag] || 0) + 1;\n      });\n      return acc;\n    },\n    {} as Record<string, number>\n  );\n\n  return {\n    totalWords,\n    sources,\n    tags,\n    hasIPA: set.words.filter((w) => w.ipa).length,\n    hasKatakana: set.words.filter((w) => w.katakana).length,\n  };\n}\n","/**\n * questionPrioritySorter.ts\n *\n * \n * AI\n *\n * @author AI Assistant\n * @version 1.0\n * @since 2025-12-16\n */\n\nimport { Question } from '../types';\nimport { logger } from '@/utils/logger';\n\ninterface WordStatus {\n  category: 'new' | 'incorrect' | 'still_learning' | 'mastered';\n  priority: number;\n  lastStudied: number;\n  attempts: number;\n  correct: number;\n  streak: number;\n  forgettingRisk: number;\n  reviewInterval: number;\n}\n\ninterface SortOptions {\n  isReviewFocusMode?: boolean;\n  learningLimit?: number | null;\n  reviewLimit?: number | null;\n  mode: 'translation' | 'spelling' | 'grammar' | 'memorization';\n}\n\n/**\n * \n */\nfunction calculateForgettingRisk(\n  lastStudied: number,\n  reviewInterval: number,\n  accuracy: number\n): number {\n  if (lastStudied === 0) return 0;\n\n  const daysSinceLastStudy = (Date.now() - lastStudied) / (1000 * 60 * 60 * 24);\n  const intervalRatio = reviewInterval > 0 ? daysSinceLastStudy / reviewInterval : 0;\n\n  let risk = intervalRatio * 100;\n  if (accuracy < 50) risk *= 1.5;\n  else if (accuracy >= 80) risk *= 0.7;\n\n  return Math.round(Math.min(risk, 200));\n}\n\n/**\n * \n */\nfunction calculateOptimalInterval(streak: number, easinessFactor: number = 2.5): number {\n  if (streak === 0) return 0;\n  if (streak === 1) return 1;\n  if (streak === 2) return 3;\n  if (streak === 3) return 7;\n\n  const baseInterval = 7;\n  return Math.round(baseInterval * Math.pow(easinessFactor, streak - 3));\n}\n\n/**\n * \n */\nfunction getWordStatus(word: string, mode: string): WordStatus | null {\n  const key = 'english-progress';\n  const stored = localStorage.getItem(key);\n  if (!stored) return null;\n\n  try {\n    const progress = JSON.parse(stored);\n    const wordProgress = progress.wordProgress?.[word];\n    if (!wordProgress) return null;\n\n    // \n    const modeKey = mode === 'memorization' ? 'memorization' : 'default';\n    const attempts =\n      mode === 'memorization' ? wordProgress.memorizationAttempts || 0 : wordProgress.attempts || 0;\n    const correct =\n      mode === 'memorization' ? wordProgress.memorizationCorrect || 0 : wordProgress.correct || 0;\n    const stillLearning = mode === 'memorization' ? wordProgress.memorizationStillLearning || 0 : 0;\n    const streak =\n      mode === 'memorization' ? wordProgress.memorizationStreak || 0 : wordProgress.streak || 0;\n    const lastStudied = wordProgress.lastStudied || 0;\n\n    const easinessFactor = wordProgress.easinessFactor || 2.5;\n    const reviewInterval =\n      wordProgress.reviewInterval || calculateOptimalInterval(streak, easinessFactor);\n\n    if (attempts === 0) {\n      return {\n        category: 'new',\n        priority: 3,\n        lastStudied,\n        attempts,\n        correct,\n        streak,\n        forgettingRisk: 0,\n        reviewInterval: 0,\n      };\n    }\n\n    const effectiveCorrect = correct + stillLearning * 0.5;\n    const accuracy = attempts > 0 ? (effectiveCorrect / attempts) * 100 : 0;\n    const forgettingRisk = calculateForgettingRisk(lastStudied, reviewInterval, accuracy);\n\n    // \n    if (streak >= 3 || (streak >= 2 && accuracy >= 80)) {\n      return {\n        category: 'mastered',\n        priority: 5,\n        lastStudied,\n        attempts,\n        correct,\n        streak,\n        forgettingRisk,\n        reviewInterval,\n      };\n    } else if (accuracy >= 50 || stillLearning > 0) {\n      return {\n        category: 'still_learning',\n        priority: 2,\n        lastStudied,\n        attempts,\n        correct,\n        streak,\n        forgettingRisk,\n        reviewInterval,\n      };\n    } else {\n      return {\n        category: 'incorrect',\n        priority: 1,\n        lastStudied,\n        attempts,\n        correct,\n        streak,\n        forgettingRisk,\n        reviewInterval,\n      };\n    }\n  } catch (error) {\n    logger.error(':', error);\n    return null;\n  }\n}\n\n/**\n * \n */\nexport function sortQuestionsByPriority(questions: Question[], options: SortOptions): Question[] {\n  const { isReviewFocusMode = false, learningLimit, reviewLimit, mode } = options;\n\n  // \n  const questionsWithStatus = questions.map((q, index) => ({\n    question: q,\n    status: getWordStatus(q.word, mode),\n    index,\n  }));\n\n  // \n  const counts = {\n    mastered: questionsWithStatus.filter((q) => q.status?.category === 'mastered').length,\n    still_learning: questionsWithStatus.filter((q) => q.status?.category === 'still_learning')\n      .length,\n    incorrect: questionsWithStatus.filter((q) => q.status?.category === 'incorrect').length,\n    new: questionsWithStatus.filter((q) => q.status?.category === 'new').length,\n  };\n\n  // \n  const shouldFocusOnStillLearning =\n    learningLimit !== null && learningLimit !== undefined && counts.still_learning >= learningLimit;\n  const shouldFocusOnIncorrect =\n    reviewLimit !== null && reviewLimit !== undefined && counts.incorrect >= reviewLimit;\n\n  // \n  const totalStudied = counts.mastered + counts.still_learning + counts.incorrect;\n  const needsReview = counts.still_learning + counts.incorrect;\n  const reviewRatio = totalStudied > 0 ? needsReview / totalStudied : 0;\n  const shouldSuppressNew = reviewRatio >= 0.2;\n\n  // \n  const effectiveLimit: number =\n    learningLimit !== null && learningLimit !== undefined\n      ? learningLimit\n      : reviewLimit !== null && reviewLimit !== undefined\n        ? reviewLimit\n        : 50;\n  const concentrationThreshold = Math.max(3, Math.floor(effectiveLimit * 0.6));\n  const newQuestionThreshold = Math.max(2, Math.floor(effectiveLimit * 0.3));\n\n  const hasLargeIncorrectBacklog = counts.incorrect > concentrationThreshold;\n  const canIntroduceNewQuestions = counts.incorrect <= newQuestionThreshold;\n\n  // \n  const sorted = questionsWithStatus.sort((a, b) => {\n    const statusA = a.status;\n    const statusB = b.status;\n\n    let priorityA = statusA?.priority || 3;\n    let priorityB = statusB?.priority || 3;\n\n    // 3\n    const hasSessionPriorityA = a.question.sessionPriority !== undefined;\n    const hasSessionPriorityB = b.question.sessionPriority !== undefined;\n\n    if (hasSessionPriorityA && !hasSessionPriorityB) return -1;\n    if (!hasSessionPriorityA && hasSessionPriorityB) return 1;\n    if (hasSessionPriorityA && hasSessionPriorityB) {\n      // \n      return (a.question.sessionPriority || 0) - (b.question.sessionPriority || 0);\n    }\n\n    // \n    if (isReviewFocusMode) {\n      if (statusA?.category === 'incorrect') priorityA = 0;\n      if (statusB?.category === 'incorrect') priorityB = 0;\n\n      if (statusA?.category === 'still_learning' && priorityA !== 0) priorityA = 0.5;\n      if (statusB?.category === 'still_learning' && priorityB !== 0) priorityB = 0.5;\n\n      if (statusA?.category === 'mastered' && priorityA > 1) priorityA = 10;\n      if (statusB?.category === 'mastered' && priorityB > 1) priorityB = 10;\n      if (statusA?.category === 'new' && priorityA > 1) priorityA = 8;\n      if (statusB?.category === 'new' && priorityB > 1) priorityB = 8;\n    } else {\n      // \n      const riskA = statusA?.forgettingRisk || 0;\n      const riskB = statusB?.forgettingRisk || 0;\n\n      if (riskA >= 150) priorityA = 0.1;\n      if (riskB >= 150) priorityB = 0.1;\n\n      if (riskA >= 100 && riskA < 150) priorityA = 0.2;\n      if (riskB >= 100 && riskB < 150) priorityB = 0.2;\n\n      // \n      if (statusA?.category === 'incorrect' && priorityA > 0.2) {\n        if (hasLargeIncorrectBacklog) {\n          const isRecentA = statusA.lastStudied && Date.now() - statusA.lastStudied < 86400000;\n          priorityA = isRecentA ? 0.1 : 0.3;\n        } else {\n          priorityA = 0.3;\n        }\n      }\n      if (statusB?.category === 'incorrect' && priorityB > 0.2) {\n        if (hasLargeIncorrectBacklog) {\n          const isRecentB = statusB.lastStudied && Date.now() - statusB.lastStudied < 86400000;\n          priorityB = isRecentB ? 0.1 : 0.3;\n        } else {\n          priorityB = 0.3;\n        }\n      }\n\n      // \n      if (statusA?.category === 'still_learning' && priorityA > 0.3) priorityA = 0.8;\n      if (statusB?.category === 'still_learning' && priorityB > 0.3) priorityB = 0.8;\n\n      // \n      if (statusA?.category === 'mastered') {\n        if (riskA >= 50 && priorityA > 1) priorityA = 2.0;\n        else if (priorityA > 2) priorityA = 4.5;\n      }\n      if (statusB?.category === 'mastered') {\n        if (riskB >= 50 && priorityB > 1) priorityB = 2.0;\n        else if (priorityB > 2) priorityB = 4.5;\n      }\n\n      // \n      if (statusA?.category === 'new' && priorityA > 3) {\n        if (hasLargeIncorrectBacklog) {\n          priorityA = 10;\n        } else if (canIntroduceNewQuestions) {\n          priorityA = 3.5;\n        } else {\n          priorityA = shouldSuppressNew ? 5 : 3.5;\n        }\n      }\n      if (statusB?.category === 'new' && priorityB > 3) {\n        if (hasLargeIncorrectBacklog) {\n          priorityB = 10;\n        } else if (canIntroduceNewQuestions) {\n          priorityB = 3.5;\n        } else {\n          priorityB = shouldSuppressNew ? 5 : 3.5;\n        }\n      }\n\n      // \n      if (shouldFocusOnIncorrect) {\n        if (statusA?.category === 'incorrect') priorityA = 0;\n        if (statusB?.category === 'incorrect') priorityB = 0;\n      }\n      if (shouldFocusOnStillLearning) {\n        if (statusA?.category === 'still_learning') priorityA = 0.05;\n        if (statusB?.category === 'still_learning') priorityB = 0.05;\n      }\n    }\n\n    // \n    if (priorityA !== priorityB) {\n      return priorityA - priorityB;\n    }\n\n    // \n    const lastStudiedA = statusA?.lastStudied || 0;\n    const lastStudiedB = statusB?.lastStudied || 0;\n    if (lastStudiedA !== lastStudiedB) {\n      return lastStudiedA - lastStudiedB;\n    }\n\n    // \n    return (a as any).index - (b as any).index;\n  });\n\n  // /\n  const sortedQuestions = sorted.map((item) => item.question);\n\n  // \n  const sessionPriorityQuestions = sortedQuestions.filter(q => q.sessionPriority !== undefined);\n  const otherQuestions = sortedQuestions.filter(q => q.sessionPriority === undefined);\n\n  // sessionPriority\n  const reviewQuestions: Question[] = [];\n  const newQuestions: Question[] = [];\n\n  otherQuestions.forEach(q => {\n    // incorrect, still_learning, mastered\n    const status = getWordStatus(q.word, mode);\n    if (status && status.category !== 'new') {\n      reviewQuestions.push(q);\n    } else {\n      newQuestions.push(q);\n    }\n  });\n\n  // 73\n  const result: Question[] = [];\n  let reviewIndex = 0;\n  let newIndex = 0;\n\n  // \n  result.push(...sessionPriorityQuestions);\n\n  // 7:3\n  while (reviewIndex < reviewQuestions.length || newIndex < newQuestions.length) {\n    // 7\n    for (let i = 0; i < 7 && reviewIndex < reviewQuestions.length; i++) {\n      result.push(reviewQuestions[reviewIndex++]);\n    }\n    // 3\n    for (let i = 0; i < 3 && newIndex < newQuestions.length; i++) {\n      result.push(newQuestions[newIndex++]);\n    }\n  }\n\n  return result;\n}\n","/**\n * useQuestionRequeue.ts\n *\n * \n * \n *\n * @author AI Assistant\n * @version 2.0\n * @since 2025-12-16\n */\n\nimport { useState, useCallback } from 'react';\nimport { sessionKpi } from '../metrics/sessionKpi';\n\nexport interface RequeuableQuestion {\n  sessionPriority?: number;\n  reAddedCount?: number;\n  [key: string]: any;\n}\n\n// \ninterface UseQuestionRequeueResult<T extends RequeuableQuestion, TStats = any> {\n  // \n  reAddQuestion: (question: T, questions: T[], currentIndex: number) => T[];\n\n  // \n  clearExpiredFlags: (questions: T[], currentIndex: number) => T[];\n\n  // /\n  isReviewQuestion: (question: T) => boolean;\n\n  // \n  updateRequeueStats: (\n    question: T,\n    currentStats: TStats,\n    setter: (updater: (prev: TStats) => TStats) => void\n  ) => void;\n}\n\n/**\n * \n */\nexport function useQuestionRequeue<T extends RequeuableQuestion, TStats = any>(): UseQuestionRequeueResult<T, TStats> {\n  /**\n   * \n   * 3-5\n   */\n  const reAddQuestion = useCallback((\n    question: T,\n    questions: T[],\n    currentIndex: number\n  ): T[] => {\n    const qid = (question as any).id ?? (question as any).word ?? String((question as any).japanese ?? '');\n    const reAddedQuestion = {\n      ...question,\n      sessionPriority: Date.now(),\n      reAddedCount: (question.reAddedCount || 0) + 1,\n    } as T;\n\n    // (5)ID\n    const windowEnd = Math.min(currentIndex + 6, questions.length);\n    const upcoming = questions.slice(currentIndex + 1, windowEnd);\n    const existsNearby = upcoming.some((q: any) => {\n      const id = q?.id ?? q?.word ?? String(q?.japanese ?? '');\n      return id === qid;\n    });\n    if (existsNearby) {\n      return questions;\n    }\n\n    // \n    const prevCount = question.reAddedCount || 0;\n    const offset = Math.max(1, Math.min(5, prevCount === 0 ? 2 : 1));\n    const insertPosition = Math.min(currentIndex + 1 + offset, questions.length);\n\n    return [\n      ...questions.slice(0, insertPosition),\n      reAddedQuestion,\n      ...questions.slice(insertPosition),\n    ];\n  }, []);\n\n  /**\n   * sessionPriority\n   * 5\n   */\n  const clearExpiredFlags = useCallback((\n    questions: T[],\n    currentIndex: number\n  ): T[] => {\n    if (currentIndex >= questions.length - 1) return questions;\n\n    return questions.map((q, idx) => {\n      // 5\n      if (q.sessionPriority && idx > currentIndex && idx - currentIndex > 5) {\n        const { sessionPriority, ...rest } = q;\n        return rest as T;\n      }\n      return q;\n    });\n  }, []);\n\n  /**\n   * \n   */\n  const isReviewQuestion = useCallback((question: T): boolean => {\n    return (question.reAddedCount || 0) > 0;\n  }, []);\n\n  /**\n   * \n   */\n  const updateRequeueStats = useCallback((\n    question: T,\n    currentStats: TStats,\n    setter: (updater: (prev: TStats) => TStats) => void\n  ) => {\n    const isReview = (question.reAddedCount || 0) > 0;\n\n    setter((prev: any) => ({\n      ...prev,\n      newQuestions: isReview ? prev.newQuestions : (prev.newQuestions || 0) + 1,\n      reviewQuestions: isReview ? (prev.reviewQuestions || 0) + 1 : prev.reviewQuestions || 0,\n      consecutiveNew: isReview ? 0 : (prev.consecutiveNew || 0) + 1,\n      consecutiveReview: isReview ? (prev.consecutiveReview || 0) + 1 : 0,\n    }));\n  }, []);\n\n  return {\n    reAddQuestion,\n    clearExpiredFlags,\n    isReviewQuestion,\n    updateRequeueStats,\n  };\n}\n","/**\n * sessionKpi.ts\n * KPI\n * - 2\n * - \n * - :\n */\n\ntype ItemStats = {\n  timesShown: number;\n  timesWrong: number;\n  lastWrongIndex?: number;\n  lags: number[];\n  readds: number;\n};\n\nclass SessionKpi {\n  private map = new Map<string, ItemStats>();\n  private seqIndex = 0;\n  private startedAt = Date.now();\n\n  reset() {\n    this.map.clear();\n    this.seqIndex = 0;\n    this.startedAt = Date.now();\n  }\n\n  onShown(id: string) {\n    const s = this.map.get(id) || { timesShown: 0, timesWrong: 0, lags: [], readds: 0 };\n    s.timesShown += 1;\n    this.map.set(id, s);\n    this.seqIndex += 1;\n  }\n\n  onAnswer(id: string, isCorrect: boolean) {\n    const s = this.map.get(id) || { timesShown: 0, timesWrong: 0, lags: [], readds: 0 };\n    if (!isCorrect) {\n      s.timesWrong += 1;\n      s.lastWrongIndex = this.seqIndex;\n    } else if (s.lastWrongIndex !== undefined) {\n      const lag = Math.max(0, this.seqIndex - s.lastWrongIndex);\n      s.lags.push(lag);\n      s.lastWrongIndex = undefined;\n    }\n    this.map.set(id, s);\n  }\n\n  onReAdd(id: string) {\n    const s = this.map.get(id) || { timesShown: 0, timesWrong: 0, lags: [], readds: 0 };\n    s.readds += 1;\n    this.map.set(id, s);\n  }\n\n  summarize() {\n    const items = Array.from(this.map.values());\n    const total = items.length;\n    const shownTwice = items.filter((x) => x.timesShown >= 2).length;\n    const reappearanceRate = total > 0 ? shownTwice / total : 0;\n    const allLags = items.flatMap((x) => x.lags);\n    const medianLag = allLags.length\n      ? [...allLags].sort((a, b) => a - b)[Math.floor(allLags.length / 2)]\n      : 0;\n    const p90Lag = allLags.length\n      ? [...allLags].sort((a, b) => a - b)[Math.floor(allLags.length * 0.9)]\n      : 0;\n    return {\n      totalItems: total,\n      reappearanceRate,\n      medianLag,\n      p90Lag,\n      durationSec: Math.round((Date.now() - this.startedAt) / 1000),\n    };\n  }\n}\n\nexport const sessionKpi = new SessionKpi();\n","// AI - \nimport { logger } from '@/utils/logger';\n\nimport { loadProgressSync, saveProgress } from '../../storage/progress/progressStorage';\n\n// \nexport interface SkipGroup {\n  timestamp: number; // \n  words: string[]; // \n  verificationStatus: 'pending' | 'verified' | 'suspicious'; // \n  suspiciousWords: string[]; // \n}\n\nconst SKIP_GROUP_KEY = 'learning-assistant-skip-groups';\nconst SKIP_GROUP_TIME_WINDOW = 5 * 60 * 1000; // 5\n\n// \nfunction loadSkipGroups(): SkipGroup[] {\n  try {\n    const data = localStorage.getItem(SKIP_GROUP_KEY);\n    return data ? JSON.parse(data) : [];\n  } catch (error) {\n    logger.error(':', error);\n    return [];\n  }\n}\n\n// \nfunction saveSkipGroups(groups: SkipGroup[]): void {\n  try {\n    localStorage.setItem(SKIP_GROUP_KEY, JSON.stringify(groups));\n  } catch (error) {\n    logger.error(':', error);\n  }\n}\n\n/**\n * \n * \n */\nexport function addToSkipGroup(word: string): void {\n  const groups = loadSkipGroups();\n  const now = Date.now();\n\n  // 5\n  const currentGroup = groups.find(\n    (g) => g.verificationStatus === 'pending' && now - g.timestamp < SKIP_GROUP_TIME_WINDOW\n  );\n\n  if (currentGroup) {\n    // \n    if (!currentGroup.words.includes(word)) {\n      currentGroup.words.push(word);\n    }\n  } else {\n    // \n    groups.push({\n      timestamp: now,\n      words: [word],\n      verificationStatus: 'pending',\n      suspiciousWords: [],\n    });\n  }\n\n  saveSkipGroups(groups);\n}\n\n/**\n * \n * \n */\nexport function handleSkippedWordIncorrect(word: string): void {\n  const groups = loadSkipGroups();\n  const progress = loadProgressSync();\n\n  // \n  const group = groups.find((g) => g.words.includes(word));\n\n  if (group && group.verificationStatus === 'pending') {\n    // \n    group.verificationStatus = 'suspicious';\n\n    // suspiciousWords\n    group.suspiciousWords = group.words.filter((w) => w !== word);\n\n    // skipExcludeUntil\n    group.suspiciousWords.forEach((suspiciousWord) => {\n      if (progress.wordProgress[suspiciousWord]) {\n        const wordProgress = progress.wordProgress[suspiciousWord];\n\n        // \n        delete wordProgress.skipExcludeUntil;\n\n        // \n        wordProgress.masteryLevel = 'learning';\n        wordProgress.consecutiveCorrect = 0;\n\n        // \n        wordProgress.needsVerification = true;\n        wordProgress.verificationReason = `${word}`;\n      }\n    });\n\n    saveProgress(progress);\n    saveSkipGroups(groups);\n\n    logger.log(\n      `AI: ${word}${group.suspiciousWords.length}`\n    );\n  }\n}\n\n/**\n * \n */\nexport function handleSkippedWordCorrect(word: string): void {\n  const groups = loadSkipGroups();\n  const progress = loadProgressSync();\n\n  // \n  const group = groups.find((g) => g.words.includes(word));\n\n  if (group) {\n    // \n    group.suspiciousWords = group.suspiciousWords.filter((w) => w !== word);\n\n    // \n    const allVerified = group.words.every((w) => {\n      const wp = progress.wordProgress[w];\n      return wp && (wp.correctCount > 0 || wp.incorrectCount > 0);\n    });\n\n    if (allVerified && group.suspiciousWords.length === 0) {\n      group.verificationStatus = 'verified';\n    }\n\n    // \n    if (progress.wordProgress[word]) {\n      delete progress.wordProgress[word].needsVerification;\n      delete progress.wordProgress[word].verificationReason;\n    }\n\n    saveProgress(progress);\n    saveSkipGroups(groups);\n  }\n}\n\n/**\n * \n */\nexport function getWordsNeedingVerification(): string[] {\n  const progress = loadProgressSync();\n  return Object.values(progress.wordProgress)\n    .filter((wp) => wp.needsVerification)\n    .map((wp) => wp.word);\n}\n\n/**\n * \n */\nexport function prioritizeVerificationWords<T extends { word: string }>(\n  questions: T[],\n  maxVerificationWords: number = 5\n): T[] {\n  const verificationWords = getWordsNeedingVerification();\n\n  if (verificationWords.length === 0) {\n    return questions;\n  }\n\n  // \n  const verificationQuestions = questions\n    .filter((q) => verificationWords.includes(q.word))\n    .slice(0, maxVerificationWords);\n\n  // \n  const otherQuestions = questions.filter((q) => !verificationWords.includes(q.word));\n\n  // \n  return [...verificationQuestions, ...otherQuestions];\n}\n\n/**\n * AI\n */\nexport function generateAssistantMessage(word: string): string | null {\n  const progress = loadProgressSync();\n  const wordProgress = progress.wordProgress[word];\n\n  if (!wordProgress || !wordProgress.needsVerification) {\n    return null;\n  }\n\n  return ` : ${wordProgress.verificationReason}`;\n}\n\n/**\n * \n */\nexport function getSkipGroupStats(): {\n  totalGroups: number;\n  pendingGroups: number;\n  suspiciousGroups: number;\n  verifiedGroups: number;\n  wordsNeedingVerification: number;\n} {\n  const groups = loadSkipGroups();\n  const verificationWords = getWordsNeedingVerification();\n\n  return {\n    totalGroups: groups.length,\n    pendingGroups: groups.filter((g) => g.verificationStatus === 'pending').length,\n    suspiciousGroups: groups.filter((g) => g.verificationStatus === 'suspicious').length,\n    verifiedGroups: groups.filter((g) => g.verificationStatus === 'verified').length,\n    wordsNeedingVerification: verificationWords.length,\n  };\n}\n","/**\n * AI - \n *\n * \n * 1. \n * 2. \n * 3. \n * 4. \n */\n\nimport { Question } from '@/types';\nimport { loadProgressSync } from '@/storage/progress/progressStorage';\n\n/**\n * \n */\nexport interface RadarAnalysis {\n  weakCategories: CategoryWeakness[];\n  strongCategories: CategoryStrength[];\n  balanceScore: number; // 0-100100\n  improvementPlan: ImprovementPlan;\n  aiRecommendations: string[];\n}\n\nexport interface CategoryWeakness {\n  category: string;\n  accuracy: number; // \n  totalAttempts: number;\n  masteredWords: number;\n  totalWords: number;\n  weaknessLevel: 'critical' | 'moderate' | 'minor'; // \n  priorityScore: number; // \n  estimatedImprovementDays: number; // \n}\n\nexport interface CategoryStrength {\n  category: string;\n  accuracy: number;\n  totalAttempts: number;\n  masteredWords: number;\n  totalWords: number;\n  strengthLevel: 'expert' | 'proficient' | 'good';\n}\n\nexport interface ImprovementPlan {\n  targetCategories: string[]; // \n  dailyQuestions: { [category: string]: number }; // 1\n  estimatedCompletionDays: number; // \n  milestones: Milestone[]; // \n}\n\nexport interface Milestone {\n  day: number;\n  category: string;\n  targetAccuracy: number;\n  description: string;\n}\n\n/**\n * \n */\nexport function analyzeRadarChart(allQuestions: Question[], categoryList: string[]): RadarAnalysis {\n  const progress = loadProgressSync();\n  const categoryStats = new Map<\n    string,\n    {\n      correct: number;\n      total: number;\n      mastered: number;\n      wordCount: number;\n    }\n  >();\n\n  // \n  categoryList.forEach((category) => {\n    categoryStats.set(category, {\n      correct: 0,\n      total: 0,\n      mastered: 0,\n      wordCount: 0,\n    });\n  });\n\n  // \n  progress.results.forEach((result) => {\n    if (result.category && categoryStats.has(result.category)) {\n      const stats = categoryStats.get(result.category)!;\n      stats.correct += result.score;\n      stats.total += result.total;\n    }\n  });\n\n  // \n  allQuestions.forEach((q) => {\n    const category = q.category;\n    if (!category || !categoryStats.has(category)) return;\n\n    const stats = categoryStats.get(category)!;\n    stats.wordCount++;\n\n    const wordProgress = progress.wordProgress[q.word];\n    if (wordProgress) {\n      const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n      const isDefinitelyMastered =\n        (totalAttempts === 1 && wordProgress.correctCount === 1) ||\n        wordProgress.consecutiveCorrect >= 3 ||\n        (wordProgress.skippedCount && wordProgress.skippedCount > 0);\n\n      const isLikelyMastered =\n        totalAttempts >= 3 &&\n        wordProgress.correctCount / totalAttempts >= 0.8 &&\n        wordProgress.consecutiveCorrect >= 2;\n\n      if (isDefinitelyMastered || isLikelyMastered) {\n        stats.mastered++;\n      }\n    }\n  });\n\n  // \n  const weakCategories: CategoryWeakness[] = [];\n  const strongCategories: CategoryStrength[] = [];\n\n  categoryStats.forEach((stats, category) => {\n    if (stats.total === 0 && stats.wordCount === 0) return; // \n\n    const accuracy = stats.total > 0 ? (stats.correct / stats.total) * 100 : 0;\n    const masteryRate = stats.wordCount > 0 ? (stats.mastered / stats.wordCount) * 100 : 0;\n\n    // 60% + 40%\n    const overallScore = accuracy * 0.6 + masteryRate * 0.4;\n\n    if (overallScore < 60) {\n      // \n      let weaknessLevel: 'critical' | 'moderate' | 'minor';\n      let priorityScore: number;\n      let estimatedDays: number;\n\n      if (overallScore < 40) {\n        weaknessLevel = 'critical';\n        priorityScore = 100;\n        estimatedDays = 14;\n      } else if (overallScore < 50) {\n        weaknessLevel = 'moderate';\n        priorityScore = 70;\n        estimatedDays = 10;\n      } else {\n        weaknessLevel = 'minor';\n        priorityScore = 40;\n        estimatedDays = 7;\n      }\n\n      // \n      if (stats.total < 10) {\n        priorityScore += 20;\n      }\n\n      weakCategories.push({\n        category,\n        accuracy,\n        totalAttempts: stats.total,\n        masteredWords: stats.mastered,\n        totalWords: stats.wordCount,\n        weaknessLevel,\n        priorityScore,\n        estimatedImprovementDays: estimatedDays,\n      });\n    } else if (overallScore >= 75) {\n      // \n      let strengthLevel: 'expert' | 'proficient' | 'good';\n      if (overallScore >= 90) {\n        strengthLevel = 'expert';\n      } else if (overallScore >= 80) {\n        strengthLevel = 'proficient';\n      } else {\n        strengthLevel = 'good';\n      }\n\n      strongCategories.push({\n        category,\n        accuracy,\n        totalAttempts: stats.total,\n        masteredWords: stats.mastered,\n        totalWords: stats.wordCount,\n        strengthLevel,\n      });\n    }\n  });\n\n  // \n  weakCategories.sort((a, b) => b.priorityScore - a.priorityScore);\n  strongCategories.sort((a, b) => b.accuracy - a.accuracy);\n\n  // \n  const balanceScore = calculateBalanceScore(categoryStats);\n\n  // \n  const improvementPlan = generateImprovementPlan(weakCategories);\n\n  // AI\n  const aiRecommendations = generateAIRecommendations(\n    weakCategories,\n    strongCategories,\n    balanceScore\n  );\n\n  return {\n    weakCategories,\n    strongCategories,\n    balanceScore,\n    improvementPlan,\n    aiRecommendations,\n  };\n}\n\n/**\n * \n */\nfunction calculateBalanceScore(\n  categoryStats: Map<\n    string,\n    { correct: number; total: number; mastered: number; wordCount: number }\n  >\n): number {\n  const accuracies: number[] = [];\n\n  categoryStats.forEach((stats) => {\n    if (stats.total > 0) {\n      const accuracy = (stats.correct / stats.total) * 100;\n      accuracies.push(accuracy);\n    }\n  });\n\n  if (accuracies.length === 0) return 50;\n\n  // \n  const mean = accuracies.reduce((sum, val) => sum + val, 0) / accuracies.length;\n  const variance =\n    accuracies.reduce((sum, val) => sum + Math.pow(val - mean, 2), 0) / accuracies.length;\n  const stdDev = Math.sqrt(variance);\n\n  // 0-100\n  const balanceScore = Math.max(0, Math.min(100, 100 - stdDev * 2));\n\n  return Math.round(balanceScore);\n}\n\n/**\n * \n */\nfunction generateImprovementPlan(weakCategories: CategoryWeakness[]): ImprovementPlan {\n  const targetCategories: string[] = [];\n  const dailyQuestions: { [category: string]: number } = {};\n  const milestones: Milestone[] = [];\n\n  // 3\n  const topWeak = weakCategories.slice(0, 3);\n\n  topWeak.forEach((weak) => {\n    targetCategories.push(weak.category);\n\n    // \n    let questionsPerDay: number;\n    if (weak.weaknessLevel === 'critical') {\n      questionsPerDay = 15;\n    } else if (weak.weaknessLevel === 'moderate') {\n      questionsPerDay = 10;\n    } else {\n      questionsPerDay = 5;\n    }\n\n    dailyQuestions[weak.category] = questionsPerDay;\n\n    // \n    const milestone: Milestone = {\n      day: Math.ceil(weak.estimatedImprovementDays / 2),\n      category: weak.category,\n      targetAccuracy: Math.min(weak.accuracy + 20, 80),\n      description: `${weak.category}${Math.round(weak.accuracy)}%${Math.min(weak.accuracy + 20, 80)}%`,\n    };\n    milestones.push(milestone);\n  });\n\n  // \n  const estimatedCompletionDays =\n    topWeak.length > 0 ? Math.max(...topWeak.map((w) => w.estimatedImprovementDays)) : 0;\n\n  return {\n    targetCategories,\n    dailyQuestions,\n    estimatedCompletionDays,\n    milestones,\n  };\n}\n\n/**\n * AI\n */\nfunction generateAIRecommendations(\n  weakCategories: CategoryWeakness[],\n  strongCategories: CategoryStrength[],\n  balanceScore: number\n): string[] {\n  const recommendations: string[] = [];\n\n  // \n  if (weakCategories.length > 0) {\n    const topWeak = weakCategories[0];\n    recommendations.push(\n      ` : ${topWeak.category}${Math.round(topWeak.accuracy)}%  80%`\n    );\n\n    if (topWeak.weaknessLevel === 'critical') {\n      recommendations.push(\n        ` ${topWeak.category}15`\n      );\n    }\n\n    // \n    if (weakCategories.length >= 3) {\n      recommendations.push(\n        ` ${weakCategories.length}1`\n      );\n    }\n  }\n\n  // \n  if (balanceScore < 50) {\n    recommendations.push(\n      ` : ${balanceScore}%`\n    );\n  } else if (balanceScore >= 80) {\n    recommendations.push(\n      ` : ${balanceScore}%`\n    );\n  }\n\n  // \n  if (strongCategories.length > 0 && weakCategories.length > 0) {\n    const topStrong = strongCategories[0];\n    recommendations.push(\n      ` ${topStrong.category}${Math.round(topStrong.accuracy)}%`\n    );\n  }\n\n  // \n  if (weakCategories.length > 0) {\n    recommendations.push(` AI`);\n  }\n\n  // \n  const totalAttempts = [...weakCategories, ...strongCategories].reduce(\n    (sum, cat) => sum + cat.totalAttempts,\n    0\n  );\n  if (totalAttempts < 50) {\n    recommendations.push(` 50`);\n  }\n\n  return recommendations;\n}\n\n/**\n * \n */\nexport function prioritizeWeakCategoryQuestions(\n  questions: Question[],\n  weakCategories: CategoryWeakness[],\n  targetCount: number = 30\n): Question[] {\n  if (weakCategories.length === 0) {\n    // \n    return questions.slice(0, targetCount);\n  }\n\n  const prioritized: Question[] = [];\n  const categoryQuotas = new Map<string, number>();\n\n  // \n  const totalPriority = weakCategories.slice(0, 3).reduce((sum, cat) => sum + cat.priorityScore, 0);\n\n  weakCategories.slice(0, 3).forEach((weak) => {\n    const quota = Math.ceil((weak.priorityScore / totalPriority) * targetCount * 0.7); // 70%\n    categoryQuotas.set(weak.category, quota);\n  });\n\n  // \n  weakCategories.slice(0, 3).forEach((weak) => {\n    const quota = categoryQuotas.get(weak.category) || 0;\n    const categoryQuestions = questions.filter((q) => q.category === weak.category);\n\n    // \n    const progress = loadProgressSync();\n    const unmastered = categoryQuestions.filter((q) => {\n      const wp = progress.wordProgress[q.word];\n      if (!wp) return true; // \n      return wp.consecutiveCorrect < 3; // \n    });\n\n    const selected = shuffleArray(unmastered).slice(0, quota);\n    prioritized.push(...selected);\n  });\n\n  // \n  const remainingCount = targetCount - prioritized.length;\n  const weakCategorySet = new Set(weakCategories.slice(0, 3).map((w) => w.category));\n  const otherQuestions = questions.filter((q) => !weakCategorySet.has(q.category || ''));\n\n  const selectedWords = new Set(prioritized.map((q) => q.word));\n  const remaining = otherQuestions.filter((q) => !selectedWords.has(q.word));\n\n  prioritized.push(...shuffleArray(remaining).slice(0, remainingCount));\n\n  return shuffleArray(prioritized);\n}\n\n/**\n * \n */\nfunction shuffleArray<T>(array: T[]): T[] {\n  const shuffled = [...array];\n  for (let i = shuffled.length - 1; i > 0; i--) {\n    const j = Math.floor(Math.random() * (i + 1));\n    [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];\n  }\n  return shuffled;\n}\n\n/**\n * \n */\nexport interface RadarImprovementProgress {\n  startDate: number;\n  currentDay: number;\n  targetCategories: string[];\n  initialAccuracies: { [category: string]: number };\n  currentAccuracies: { [category: string]: number };\n  improvements: { [category: string]: number }; // %\n  overallProgress: number; // 0-100%\n  isCompleted: boolean;\n}\n\n/**\n * \n */\nexport function saveImprovementProgress(analysis: RadarAnalysis): void {\n  const progress: RadarImprovementProgress = {\n    startDate: Date.now(),\n    currentDay: 1,\n    targetCategories: analysis.improvementPlan.targetCategories,\n    initialAccuracies: {},\n    currentAccuracies: {},\n    improvements: {},\n    overallProgress: 0,\n    isCompleted: false,\n  };\n\n  analysis.weakCategories.forEach((weak) => {\n    if (analysis.improvementPlan.targetCategories.includes(weak.category)) {\n      progress.initialAccuracies[weak.category] = weak.accuracy;\n      progress.currentAccuracies[weak.category] = weak.accuracy;\n      progress.improvements[weak.category] = 0;\n    }\n  });\n\n  localStorage.setItem('radar-improvement-progress', JSON.stringify(progress));\n}\n\n/**\n * \n */\nexport function getImprovementProgress(): RadarImprovementProgress | null {\n  const stored = localStorage.getItem('radar-improvement-progress');\n  if (!stored) return null;\n\n  try {\n    return JSON.parse(stored) as RadarImprovementProgress;\n  } catch {\n    return null;\n  }\n}\n\n/**\n * \n */\nexport function updateImprovementProgress(currentAnalysis: RadarAnalysis): void {\n  const progress = getImprovementProgress();\n  if (!progress) return;\n\n  const daysSinceStart = Math.floor((Date.now() - progress.startDate) / (1000 * 60 * 60 * 24));\n  progress.currentDay = daysSinceStart + 1;\n\n  let completedCount = 0;\n\n  progress.targetCategories.forEach((category) => {\n    const weak = currentAnalysis.weakCategories.find((w) => w.category === category);\n    const current = weak?.accuracy || 80; // 80%\n\n    progress.currentAccuracies[category] = current;\n    const improvement = current - progress.initialAccuracies[category];\n    progress.improvements[category] = improvement;\n\n    // 80%\n    if (current >= 80) {\n      completedCount++;\n    }\n  });\n\n  progress.overallProgress = (completedCount / progress.targetCategories.length) * 100;\n  progress.isCompleted = completedCount === progress.targetCategories.length;\n\n  localStorage.setItem('radar-improvement-progress', JSON.stringify(progress));\n}\n","/**\n * AI - \n *\n * :\n * 1. \n * 2. \n * 3. \n * 4. \n */\n\nimport { Question } from '@/types';\nimport { WordProgress } from '@/storage/progress/progressStorage';\n\n/**\n * \n */\nexport interface WordLearningHistory {\n  word: string;\n  attempts: LearningAttempt[];\n  confusedWith: ConfusionPattern[];\n  learningCurve: LearningCurveData;\n  predictionModel: PredictionModel;\n}\n\n/**\n * \n */\nexport interface LearningAttempt {\n  timestamp: number;\n  wasCorrect: boolean;\n  responseTime: number; // \n  userAnswer?: string; // \n  confidenceLevel: 'instant' | 'hesitant' | 'guessed'; // \n  sessionContext: {\n    questionIndex: number; // \n    previousQuestions: string[]; // 3\n    sessionFatigue: number; // 0-1: \n  };\n}\n\n/**\n * \n */\nexport interface ConfusionPattern {\n  confusedWord: string; // \n  frequency: number; // \n  lastConfusion: number; // \n  confusionType: 'spelling' | 'meaning' | 'pronunciation'; // \n  similarity: number; //  0-1\n}\n\n/**\n * \n */\nexport interface LearningCurveData {\n  // \n  accuracyHistory: Array<{ timestamp: number; accuracy: number }>;\n\n  // \n  stabilityScore: number; // 0-100\n\n  // \n  stage: 'initial' | 'struggling' | 'improving' | 'consolidating' | 'mastered';\n\n  // \n  forgettingPattern: {\n    typicalDecayDays: number; // \n    lastForgetDate?: number; // \n    forgettingCount: number; // \n  };\n\n  // \n  efficiency: {\n    attemptsToMastery: number; // \n    currentProgress: number; // 0-100%\n    estimatedDaysToMastery: number; // \n  };\n}\n\n/**\n * \n */\nexport interface PredictionModel {\n  // 0-100%\n  nextCorrectProbability: number;\n\n  // \n  predictors: {\n    recentAccuracy: number; // 5\n    stabilityFactor: number; // \n    timeSinceLastStudy: number; // \n    confusionRisk: number; // 0-1\n  };\n\n  // \n  confidence: number; // 0-1\n}\n\n/**\n * \n */\nexport interface QuestionPriority {\n  word: string;\n  priority: number; // 0-100\n  reason: string;\n  strategy:\n    | 'immediate_review'\n    | 'spaced_repetition'\n    | 'confusion_resolution'\n    | 'consolidation'\n    | 'new_learning';\n  estimatedSuccessRate: number; // \n  learningImpact: number; // 0-100\n}\n\n/**\n * \n */\nexport function analyzeLearningHistory(\n  word: string,\n  wordProgress: WordProgress,\n  allAttempts: LearningAttempt[]\n): WordLearningHistory {\n  // \n  const learningCurve = calculateLearningCurve(allAttempts);\n\n  // \n  const confusedWith = extractConfusionPatterns(allAttempts);\n\n  // \n  const predictionModel = buildPredictionModel(wordProgress, allAttempts, learningCurve);\n\n  return {\n    word,\n    attempts: allAttempts,\n    confusedWith,\n    learningCurve,\n    predictionModel,\n  };\n}\n\n/**\n * \n */\nfunction calculateLearningCurve(attempts: LearningAttempt[]): LearningCurveData {\n  if (attempts.length === 0) {\n    return {\n      accuracyHistory: [],\n      stabilityScore: 0,\n      stage: 'initial',\n      forgettingPattern: {\n        typicalDecayDays: 7,\n        forgettingCount: 0,\n      },\n      efficiency: {\n        attemptsToMastery: 10,\n        currentProgress: 0,\n        estimatedDaysToMastery: 30,\n      },\n    };\n  }\n\n  // 5\n  const accuracyHistory: Array<{ timestamp: number; accuracy: number }> = [];\n  const windowSize = 5;\n\n  for (let i = 0; i < attempts.length; i++) {\n    const start = Math.max(0, i - windowSize + 1);\n    const window = attempts.slice(start, i + 1);\n    const accuracy = (window.filter((a) => a.wasCorrect).length / window.length) * 100;\n\n    accuracyHistory.push({\n      timestamp: attempts[i].timestamp,\n      accuracy,\n    });\n  }\n\n  // 10\n  const recentAttempts = attempts.slice(-10);\n  const recentAccuracies = recentAttempts.map((_, i) => {\n    const start = Math.max(0, recentAttempts.length - 5);\n    const window = recentAttempts.slice(start, i + 1);\n    return (window.filter((a) => a.wasCorrect).length / window.length) * 100;\n  });\n\n  const mean = recentAccuracies.reduce((sum, acc) => sum + acc, 0) / recentAccuracies.length;\n  const variance =\n    recentAccuracies.reduce((sum, acc) => sum + Math.pow(acc - mean, 2), 0) /\n    recentAccuracies.length;\n  const stdDev = Math.sqrt(variance);\n\n  // 0-300-100\n  const stabilityScore = Math.max(0, Math.min(100, 100 - (stdDev / 30) * 100));\n\n  // \n  const recentCorrectRate =\n    recentAttempts.filter((a) => a.wasCorrect).length / recentAttempts.length;\n  let stage: LearningCurveData['stage'];\n\n  if (attempts.length < 3) {\n    stage = 'initial';\n  } else if (recentCorrectRate < 0.3) {\n    stage = 'struggling';\n  } else if (recentCorrectRate < 0.7 && stabilityScore < 50) {\n    stage = 'improving';\n  } else if (recentCorrectRate >= 0.7 && stabilityScore >= 50) {\n    stage = 'consolidating';\n  } else if (recentCorrectRate >= 0.9 && stabilityScore >= 80) {\n    stage = 'mastered';\n  } else {\n    stage = 'improving';\n  }\n\n  // \n  const incorrectAttempts = attempts.filter((a) => !a.wasCorrect);\n  const forgettingCount = incorrectAttempts.length;\n  let typicalDecayDays = 7;\n\n  if (incorrectAttempts.length >= 2) {\n    const intervals = [];\n    for (let i = 1; i < incorrectAttempts.length; i++) {\n      const days =\n        (incorrectAttempts[i].timestamp - incorrectAttempts[i - 1].timestamp) /\n        (1000 * 60 * 60 * 24);\n      intervals.push(days);\n    }\n    typicalDecayDays = intervals.reduce((sum, d) => sum + d, 0) / intervals.length;\n  }\n\n  // \n  const currentProgress = Math.min(100, (recentCorrectRate * 100 + stabilityScore) / 2);\n  const attemptsToMastery = attempts.length < 5 ? 10 : Math.ceil(10 / (currentProgress / 100));\n  const estimatedDaysToMastery = Math.max(1, Math.ceil((100 - currentProgress) / 5));\n\n  return {\n    accuracyHistory,\n    stabilityScore,\n    stage,\n    forgettingPattern: {\n      typicalDecayDays,\n      lastForgetDate:\n        incorrectAttempts.length > 0\n          ? incorrectAttempts[incorrectAttempts.length - 1].timestamp\n          : undefined,\n      forgettingCount,\n    },\n    efficiency: {\n      attemptsToMastery,\n      currentProgress,\n      estimatedDaysToMastery,\n    },\n  };\n}\n\n/**\n * \n */\nfunction extractConfusionPatterns(attempts: LearningAttempt[]): ConfusionPattern[] {\n  const confusionMap = new Map<string, ConfusionPattern>();\n\n  attempts.forEach((attempt) => {\n    if (!attempt.wasCorrect && attempt.userAnswer) {\n      const key = attempt.userAnswer;\n\n      if (confusionMap.has(key)) {\n        const pattern = confusionMap.get(key)!;\n        pattern.frequency++;\n        pattern.lastConfusion = attempt.timestamp;\n      } else {\n        confusionMap.set(key, {\n          confusedWord: attempt.userAnswer,\n          frequency: 1,\n          lastConfusion: attempt.timestamp,\n          confusionType: 'meaning', // \n          similarity: 0.7, // \n        });\n      }\n    }\n  });\n\n  return Array.from(confusionMap.values())\n    .sort((a, b) => b.frequency - a.frequency)\n    .slice(0, 5); // 5\n}\n\n/**\n * \n */\nfunction buildPredictionModel(\n  _wordProgress: WordProgress,\n  attempts: LearningAttempt[],\n  learningCurve: LearningCurveData\n): PredictionModel {\n  // 5\n  const recent5 = attempts.slice(-5);\n  const recentAccuracy =\n    recent5.length > 0 ? (recent5.filter((a) => a.wasCorrect).length / recent5.length) * 100 : 50;\n\n  // \n  const stabilityFactor = learningCurve.stabilityScore / 100;\n\n  // \n  const timeSinceLastStudy =\n    attempts.length > 0\n      ? (Date.now() - attempts[attempts.length - 1].timestamp) / (1000 * 60 * 60 * 24)\n      : 0;\n\n  // \n  const recentConfusions = attempts.slice(-10).filter((a) => !a.wasCorrect && a.userAnswer);\n  const confusionRisk = Math.min(1, recentConfusions.length / 5);\n\n  // \n  // : \n  let probability = recentAccuracy;\n\n  // \n  probability += stabilityFactor * 20;\n\n  // \n  const decayFactor = Math.exp(\n    -timeSinceLastStudy / learningCurve.forgettingPattern.typicalDecayDays\n  );\n  probability *= decayFactor;\n\n  // \n  probability -= confusionRisk * 30;\n\n  // 0-100\n  probability = Math.max(0, Math.min(100, probability));\n\n  // \n  const confidence = Math.min(1, attempts.length / 10);\n\n  return {\n    nextCorrectProbability: probability,\n    predictors: {\n      recentAccuracy,\n      stabilityFactor,\n      timeSinceLastStudy,\n      confusionRisk,\n    },\n    confidence,\n  };\n}\n\n/**\n * \n */\nexport function calculateQuestionPriorities(\n  questions: Question[],\n  wordProgressMap: { [word: string]: WordProgress },\n  learningHistories: Map<string, WordLearningHistory>\n): QuestionPriority[] {\n  const priorities: QuestionPriority[] = [];\n\n  questions.forEach((question) => {\n    const wordProgress = wordProgressMap[question.word];\n    const history = learningHistories.get(question.word);\n\n    const priority = calculateSingleWordPriority(question, wordProgress, history);\n    priorities.push(priority);\n  });\n\n  // \n  return priorities.sort((a, b) => b.priority - a.priority);\n}\n\n/**\n * \n */\nfunction calculateSingleWordPriority(\n  question: Question,\n  _wordProgress: WordProgress | undefined,\n  history: WordLearningHistory | undefined\n): QuestionPriority {\n  // \n  if (!_wordProgress || !history) {\n    return {\n      word: question.word,\n      priority: 50, // \n      reason: '',\n      strategy: 'new_learning',\n      estimatedSuccessRate: 50,\n      learningImpact: 60,\n    };\n  }\n\n  const curve = history.learningCurve;\n  const prediction = history.predictionModel;\n\n  // \n  switch (curve.stage) {\n    case 'struggling':\n      //   \n      return {\n        word: question.word,\n        priority: 90,\n        reason: `${prediction.predictors.recentAccuracy.toFixed(0)}%`,\n        strategy: 'immediate_review',\n        estimatedSuccessRate: prediction.nextCorrectProbability,\n        learningImpact: 80, // \n      };\n\n    case 'improving': {\n      //   \n      const daysSince = prediction.predictors.timeSinceLastStudy;\n      const isOptimalTiming = daysSince >= 1 && daysSince <= 3;\n\n      return {\n        word: question.word,\n        priority: isOptimalTiming ? 85 : 70,\n        reason: `${daysSince.toFixed(1)}${prediction.nextCorrectProbability.toFixed(0)}%`,\n        strategy: isOptimalTiming ? 'consolidation' : 'spaced_repetition',\n        estimatedSuccessRate: prediction.nextCorrectProbability,\n        learningImpact: 75,\n      };\n    }\n\n    case 'consolidating': {\n      //   \n      const optimalInterval = curve.forgettingPattern.typicalDecayDays * 0.7;\n      const currentInterval = prediction.predictors.timeSinceLastStudy;\n      const isNearOptimal = Math.abs(currentInterval - optimalInterval) < 2;\n\n      return {\n        word: question.word,\n        priority: isNearOptimal ? 60 : 40,\n        reason: `${Math.max(0, optimalInterval - currentInterval).toFixed(1)}`,\n        strategy: 'spaced_repetition',\n        estimatedSuccessRate: prediction.nextCorrectProbability,\n        learningImpact: 50,\n      };\n    }\n\n    case 'mastered':\n      //   \n      return {\n        word: question.word,\n        priority: 20,\n        reason: '',\n        strategy: 'spaced_repetition',\n        estimatedSuccessRate: prediction.nextCorrectProbability,\n        learningImpact: 20,\n      };\n\n    default:\n      return {\n        word: question.word,\n        priority: 50,\n        reason: '',\n        strategy: 'new_learning',\n        estimatedSuccessRate: 50,\n        learningImpact: 60,\n      };\n  }\n}\n\n/**\n * \n */\nexport function detectConfusionRisks(\n  learningHistories: Map<string, WordLearningHistory>\n): Array<{ word1: string; word2: string; riskScore: number }> {\n  const risks: Array<{ word1: string; word2: string; riskScore: number }> = [];\n\n  learningHistories.forEach((history1, word1) => {\n    history1.confusedWith.forEach((confusion) => {\n      const word2 = confusion.confusedWord;\n      const riskScore = confusion.frequency * 10 + confusion.similarity * 50;\n\n      risks.push({ word1, word2, riskScore });\n    });\n  });\n\n  return risks.sort((a, b) => b.riskScore - a.riskScore).slice(0, 10);\n}\n\n/**\n * : \n */\nexport function planConsolidationSequence(\n  strugglingWords: QuestionPriority[],\n  sessionLength: number\n): QuestionPriority[] {\n  // \n  const struggling = strugglingWords.filter((p) => p.strategy === 'immediate_review');\n\n  if (struggling.length === 0) return strugglingWords;\n\n  // \n  const sequence: QuestionPriority[] = [];\n\n  // 1. 3\n  const topStruggling = struggling.slice(0, 3);\n  sequence.push(...topStruggling);\n\n  // 2. \n  const improving = strugglingWords.filter((p) => p.strategy === 'consolidation');\n  if (improving.length > 0) {\n    sequence.push(improving[0]);\n  }\n\n  // 3. \n  if (topStruggling.length > 0 && sessionLength >= 10) {\n    sequence.push(topStruggling[0]); // \n  }\n\n  // 4. \n  const remaining = strugglingWords.filter((p) => !sequence.includes(p));\n  sequence.push(...remaining);\n\n  return sequence.slice(0, sessionLength);\n}\n","/**\n * AI - \n *\n * :\n * 1. \n * 2. \n * 3. : : \n * 4. \n */\n\nimport { logger } from '@/utils/logger';\n\nimport { QuestionPriority } from '@/ai/analysis/learningCurveAI';\n\n/**\n * \n */\nexport interface CognitiveLoadMonitor {\n  // 0-100\n  fatigueLevel: number;\n\n  // 0-100\n  concentrationLevel: number;\n\n  // \n  recentPerformance: {\n    last5Accuracy: number; // 5\n    last10Accuracy: number; // 10\n    isDecreasing: boolean; // \n    averageResponseTime: number; // \n  };\n\n  // \n  sessionStats: {\n    duration: number; // \n    questionsAnswered: number; // \n    correctCount: number; // \n    startTime: number; // \n  };\n\n  // \n  breakRecommendation?: {\n    shouldBreak: boolean;\n    reason: string;\n    suggestedDuration: number; // \n  };\n\n  // \n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n}\n\n/**\n * \n */\nexport interface SessionResponse {\n  timestamp: number;\n  wasCorrect: boolean;\n  responseTime: number; // \n  questionDifficulty: number; // 0-1\n}\n\n/**\n * \n */\nexport function calculateCognitiveLoad(\n  responses: SessionResponse[],\n  sessionStartTime: number\n): CognitiveLoadMonitor {\n  const now = Date.now();\n  const sessionDuration = (now - sessionStartTime) / (1000 * 60); // \n\n  // \n  const last5 = responses.slice(-5);\n  const last10 = responses.slice(-10);\n\n  const last5Accuracy =\n    last5.length > 0 ? (last5.filter((r) => r.wasCorrect).length / last5.length) * 100 : 100;\n\n  const last10Accuracy =\n    last10.length > 0 ? (last10.filter((r) => r.wasCorrect).length / last10.length) * 100 : 100;\n\n  // \n  const isDecreasing = last10Accuracy - last5Accuracy > 10;\n\n  // \n  const averageResponseTime =\n    responses.length > 0\n      ? responses.reduce((sum, r) => sum + r.responseTime, 0) / responses.length\n      : 3000;\n\n  // \n  const recentResponseTimes = responses.slice(-5).map((r) => r.responseTime);\n  const responseTimeIncrease = calculateTrend(recentResponseTimes);\n\n  // \n  let fatigueLevel = 0;\n\n  // 1. \n  fatigueLevel += Math.min(40, sessionDuration * 2); // 2040pt\n\n  // 2. \n  if (isDecreasing) {\n    fatigueLevel += 25;\n  }\n\n  // 3. \n  if (responseTimeIncrease > 1.3) {\n    // 30%\n    fatigueLevel += 20;\n  }\n\n  // 4. \n  const recentErrors = responses.slice(-3).filter((r) => !r.wasCorrect).length;\n  if (recentErrors >= 2) {\n    fatigueLevel += 15;\n  }\n\n  // 0-100\n  fatigueLevel = Math.min(100, Math.max(0, fatigueLevel));\n\n  // \n  const concentrationLevel = 100 - fatigueLevel;\n\n  // \n  const hour = new Date().getHours();\n  let timeOfDay: CognitiveLoadMonitor['timeOfDay'];\n  if (hour >= 6 && hour < 12) timeOfDay = 'morning';\n  else if (hour >= 12 && hour < 18) timeOfDay = 'afternoon';\n  else if (hour >= 18 && hour < 22) timeOfDay = 'evening';\n  else timeOfDay = 'night';\n\n  // \n  const breakRecommendation = determineBreakRecommendation(\n    fatigueLevel,\n    sessionDuration,\n    isDecreasing\n  );\n\n  return {\n    fatigueLevel,\n    concentrationLevel,\n    recentPerformance: {\n      last5Accuracy,\n      last10Accuracy,\n      isDecreasing,\n      averageResponseTime,\n    },\n    sessionStats: {\n      duration: sessionDuration,\n      questionsAnswered: responses.length,\n      correctCount: responses.filter((r) => r.wasCorrect).length,\n      startTime: sessionStartTime,\n    },\n    breakRecommendation,\n    timeOfDay,\n  };\n}\n\n/**\n *  > 1,  < 1\n */\nfunction calculateTrend(values: number[]): number {\n  if (values.length < 2) return 1;\n\n  const recent = values.slice(-3);\n  const earlier = values.slice(0, Math.max(1, values.length - 3));\n\n  const recentAvg = recent.reduce((sum, v) => sum + v, 0) / recent.length;\n  const earlierAvg = earlier.reduce((sum, v) => sum + v, 0) / earlier.length;\n\n  return earlierAvg > 0 ? recentAvg / earlierAvg : 1;\n}\n\n/**\n * \n */\nfunction determineBreakRecommendation(\n  fatigueLevel: number,\n  sessionDuration: number,\n  isDecreasing: boolean\n): CognitiveLoadMonitor['breakRecommendation'] {\n  // \n  if (fatigueLevel >= 70) {\n    return {\n      shouldBreak: true,\n      reason: '5',\n      suggestedDuration: 5,\n    };\n  }\n\n  // \n  if (sessionDuration >= 25 && fatigueLevel >= 50) {\n    return {\n      shouldBreak: true,\n      reason: '25',\n      suggestedDuration: 5,\n    };\n  }\n\n  // \n  if (isDecreasing && fatigueLevel >= 40) {\n    return {\n      shouldBreak: true,\n      reason: '',\n      suggestedDuration: 3,\n    };\n  }\n\n  return undefined;\n}\n\n/**\n * \n */\nexport function adjustDifficultyByCognitiveLoad(\n  priorities: QuestionPriority[],\n  cognitiveLoad: CognitiveLoadMonitor\n): QuestionPriority[] {\n  const { fatigueLevel, concentrationLevel, timeOfDay, sessionStats } = cognitiveLoad;\n\n  logger.log(\n    ` AI: ${fatigueLevel}%, ${concentrationLevel}%, : ${timeOfDay}`\n  );\n\n  // : \n  if (fatigueLevel >= 70) {\n    logger.log('   : ');\n    return priorities\n      .filter((p) => p.estimatedSuccessRate >= 70 || p.strategy === 'spaced_repetition')\n      .map((p) => ({\n        ...p,\n        priority: p.priority + (p.estimatedSuccessRate >= 80 ? 20 : 0),\n        reason: p.reason + ' ()',\n      }));\n  }\n\n  // : \n  if (fatigueLevel >= 40) {\n    logger.log('   : ');\n    return priorities.map((p) => {\n      // \n      if (p.estimatedSuccessRate < 40) {\n        return { ...p, priority: p.priority - 20 };\n      }\n      return p;\n    });\n  }\n\n  // : \n  if (concentrationLevel >= 70 && sessionStats.duration < 15) {\n    logger.log('   : ');\n\n    return priorities.map((p) => {\n      // \n      if (p.strategy === 'new_learning') {\n        return { ...p, priority: p.priority + 30, reason: p.reason + ' ()' };\n      }\n\n      // \n      if (p.strategy === 'immediate_review' && p.estimatedSuccessRate < 60) {\n        return { ...p, priority: p.priority + 20, reason: p.reason + ' ()' };\n      }\n\n      return p;\n    });\n  }\n\n  // : \n  return adjustByTimeOfDay(priorities, timeOfDay);\n}\n\n/**\n * \n */\nfunction adjustByTimeOfDay(\n  priorities: QuestionPriority[],\n  timeOfDay: CognitiveLoadMonitor['timeOfDay']\n): QuestionPriority[] {\n  switch (timeOfDay) {\n    case 'morning':\n      // : \n      logger.log('   : ');\n      return priorities.map((p) => {\n        if (p.strategy === 'new_learning') {\n          return { ...p, priority: p.priority + 15, reason: p.reason + ' ()' };\n        }\n        return p;\n      });\n\n    case 'afternoon':\n      // : \n      logger.log('   : ');\n      return priorities;\n\n    case 'evening':\n      // : \n      logger.log('   : ');\n      return priorities.map((p) => {\n        if (p.strategy === 'spaced_repetition' || p.strategy === 'consolidation') {\n          return { ...p, priority: p.priority + 10, reason: p.reason + ' ()' };\n        }\n        return p;\n      });\n\n    case 'night':\n      // : \n      logger.log('   : ');\n      return priorities\n        .filter((p) => p.strategy !== 'new_learning' || p.estimatedSuccessRate >= 60)\n        .map((p) => {\n          if (p.estimatedSuccessRate >= 70) {\n            return { ...p, priority: p.priority + 15, reason: p.reason + ' ()' };\n          }\n          return p;\n        });\n\n    default:\n      return priorities;\n  }\n}\n\n/**\n * \n */\nexport function generateFatigueMessage(cognitiveLoad: CognitiveLoadMonitor): string {\n  const { fatigueLevel, breakRecommendation } = cognitiveLoad;\n\n  if (breakRecommendation?.shouldBreak) {\n    return ` ${breakRecommendation.reason}`;\n  }\n\n  if (fatigueLevel >= 60) {\n    return ' ';\n  }\n\n  if (fatigueLevel <= 20) {\n    return ' ';\n  }\n\n  return '';\n}\n\n/**\n * \n */\nexport function calculateLearningEfficiency(cognitiveLoad: CognitiveLoadMonitor): number {\n  const { concentrationLevel, recentPerformance } = cognitiveLoad;\n\n  //   \n  const efficiency = (concentrationLevel / 100) * (recentPerformance.last5Accuracy / 100);\n\n  return Math.round(efficiency * 100);\n}\n","/**\n * AI (Error Prediction AI)\n *\n * :\n * - \n * - \n * - \n *\n * :\n * 1. : \n * 2. : 0-100%\n * 3. : \n * 4. : \n */\n\nimport { WordProgress } from '@/storage/progress/progressStorage';\n\n/**\n * \n */\nexport type ErrorPattern =\n  | 'similar_spelling' // \n  | 'similar_meaning' // \n  | 'similar_sound' // \n  | 'confusion_pair' // \n  | 'grammar_error' // \n  | 'length_based' // \n  | 'category_weakness' // \n  | 'timing_based'; // \n\n/**\n * \n */\nexport interface ErrorPrediction {\n  word: string;\n  errorRisk: number; // 0-100%: \n  confidence: number; // 0-100%: \n  primaryPattern: ErrorPattern;\n  riskFactors: RiskFactor[];\n  warningLevel: 'low' | 'medium' | 'high' | 'critical';\n  suggestedSupport: SupportStrategy;\n}\n\n/**\n * \n */\nexport interface RiskFactor {\n  type: ErrorPattern;\n  weight: number; // 0-1: \n  description: string;\n  evidence: string[]; // \n}\n\n/**\n * \n */\nexport interface SupportStrategy {\n  showWarning: boolean;\n  warningMessage: string;\n  hints: string[];\n  reviewWords: string[]; // \n  confidenceBooster: string; // \n}\n\n/**\n * \n */\nexport interface ConfusionPair {\n  word1: string;\n  word2: string;\n  confusionCount: number;\n  lastConfusion: number; // timestamp\n  pattern: ErrorPattern;\n}\n\n/**\n * \n */\nexport interface ErrorAnalysis {\n  totalErrors: number;\n  errorsByPattern: Map<ErrorPattern, number>;\n  confusionPairs: ConfusionPair[];\n  weakCategories: string[];\n  recentErrorRate: number; // 10\n  errorTrend: 'improving' | 'stable' | 'declining';\n}\n\n/**\n * \n */\nexport function analyzeErrorPatterns(\n  wordProgress: Record<string, WordProgress>,\n  recentAnswers: Array<{ word: string; wasCorrect: boolean; userAnswer?: string }>\n): ErrorAnalysis {\n  const errorsByPattern = new Map<ErrorPattern, number>();\n  const confusionPairs: ConfusionPair[] = [];\n  const weakCategories: string[] = [];\n\n  let totalErrors = 0;\n  const last10 = recentAnswers.slice(-10);\n  const recentErrorRate =\n    last10.length > 0 ? (last10.filter((a) => !a.wasCorrect).length / last10.length) * 100 : 0;\n\n  // \n  Object.entries(wordProgress).forEach(([word, progress]) => {\n    totalErrors += progress.incorrectCount;\n\n    // \n    if (progress.learningHistory) {\n      const errors = progress.learningHistory.filter((h) => !h.wasCorrect);\n\n      errors.forEach((error) => {\n        // \n        if (error.userAnswer && isSpellingError(word, error.userAnswer)) {\n          errorsByPattern.set(\n            'similar_spelling',\n            (errorsByPattern.get('similar_spelling') || 0) + 1\n          );\n        }\n\n        // \n        if (error.userAnswer) {\n          const existingPair = confusionPairs.find(\n            (p) =>\n              (p.word1 === word && p.word2 === error.userAnswer) ||\n              (p.word2 === word && p.word1 === error.userAnswer)\n          );\n\n          if (existingPair) {\n            existingPair.confusionCount++;\n            existingPair.lastConfusion = error.timestamp;\n          } else if (error.userAnswer !== word) {\n            confusionPairs.push({\n              word1: word,\n              word2: error.userAnswer,\n              confusionCount: 1,\n              lastConfusion: error.timestamp,\n              pattern: 'confusion_pair',\n            });\n          }\n        }\n      });\n    }\n  });\n\n  // \n  const last5 = recentAnswers.slice(-5);\n  const last5ErrorRate =\n    last5.length > 0 ? (last5.filter((a) => !a.wasCorrect).length / last5.length) * 100 : 0;\n\n  const errorTrend: 'improving' | 'stable' | 'declining' =\n    last5ErrorRate < recentErrorRate - 10\n      ? 'improving'\n      : last5ErrorRate > recentErrorRate + 10\n        ? 'declining'\n        : 'stable';\n\n  return {\n    totalErrors,\n    errorsByPattern,\n    confusionPairs: confusionPairs.sort((a, b) => b.confusionCount - a.confusionCount),\n    weakCategories,\n    recentErrorRate,\n    errorTrend,\n  };\n}\n\n/**\n * \n */\nexport function predictErrorRisk(\n  word: string,\n  wordProgress: WordProgress | undefined,\n  errorAnalysis: ErrorAnalysis,\n  currentFatigue: number, // 0-100\n  recentErrors: number // \n): ErrorPrediction {\n  const riskFactors: RiskFactor[] = [];\n  let baseRisk = 30; // \n\n  // 1. \n  if (wordProgress) {\n    const total = wordProgress.correctCount + wordProgress.incorrectCount;\n    if (total > 0) {\n      const errorRate = (wordProgress.incorrectCount / total) * 100;\n      if (errorRate > 50) {\n        baseRisk += 30;\n        riskFactors.push({\n          type: 'category_weakness',\n          weight: 0.3,\n          description: '',\n          evidence: [`: ${errorRate.toFixed(0)}%`],\n        });\n      }\n    }\n\n    // \n    if (wordProgress.learningHistory && wordProgress.learningHistory.length > 0) {\n      const last3 = wordProgress.learningHistory.slice(-3);\n      const last3ErrorRate = (last3.filter((h) => !h.wasCorrect).length / last3.length) * 100;\n\n      if (last3ErrorRate > 66) {\n        baseRisk += 25;\n        riskFactors.push({\n          type: 'timing_based',\n          weight: 0.25,\n          description: '32',\n          evidence: [`3: ${last3ErrorRate.toFixed(0)}%`],\n        });\n      }\n    }\n\n    // \n    if (wordProgress.lastStudied) {\n      const daysSinceReview = (Date.now() - wordProgress.lastStudied) / (1000 * 60 * 60 * 24);\n      if (daysSinceReview > 7) {\n        const forgettingRisk = Math.min(20, daysSinceReview * 2);\n        baseRisk += forgettingRisk;\n        riskFactors.push({\n          type: 'timing_based',\n          weight: forgettingRisk / 100,\n          description: '',\n          evidence: [`${daysSinceReview.toFixed(1)}`],\n        });\n      }\n    }\n  } else {\n    // \n    baseRisk += 20;\n    riskFactors.push({\n      type: 'category_weakness',\n      weight: 0.2,\n      description: '',\n      evidence: [''],\n    });\n  }\n\n  // 2. \n  const confusionPair = errorAnalysis.confusionPairs.find(\n    (p) => p.word1 === word || p.word2 === word\n  );\n  if (confusionPair && confusionPair.confusionCount >= 2) {\n    baseRisk += 15;\n    const otherWord = confusionPair.word1 === word ? confusionPair.word2 : confusionPair.word1;\n    riskFactors.push({\n      type: 'confusion_pair',\n      weight: 0.15,\n      description: `\"${otherWord}\"`,\n      evidence: [`${confusionPair.confusionCount}`],\n    });\n  }\n\n  // 3. \n  if (currentFatigue > 60) {\n    const fatigueRisk = (currentFatigue - 60) / 2;\n    baseRisk += fatigueRisk;\n    riskFactors.push({\n      type: 'timing_based',\n      weight: fatigueRisk / 100,\n      description: '',\n      evidence: [`: ${currentFatigue.toFixed(0)}%`],\n    });\n  }\n\n  // 4. \n  if (recentErrors >= 2) {\n    baseRisk += 10;\n    riskFactors.push({\n      type: 'timing_based',\n      weight: 0.1,\n      description: '',\n      evidence: [`${recentErrors}`],\n    });\n  }\n\n  // 5. \n  if (errorAnalysis.errorTrend === 'declining') {\n    baseRisk += 10;\n    riskFactors.push({\n      type: 'category_weakness',\n      weight: 0.1,\n      description: '',\n      evidence: [`10: ${errorAnalysis.recentErrorRate.toFixed(0)}%`],\n    });\n  }\n\n  const errorRisk = Math.min(100, Math.max(0, baseRisk));\n\n  // \n  const warningLevel: 'low' | 'medium' | 'high' | 'critical' =\n    errorRisk >= 80 ? 'critical' : errorRisk >= 60 ? 'high' : errorRisk >= 40 ? 'medium' : 'low';\n\n  // \n  const suggestedSupport = generateSupportStrategy(\n    word,\n    errorRisk,\n    warningLevel,\n    riskFactors,\n    confusionPair\n  );\n\n  // \n  const confidence = calculatePredictionConfidence(wordProgress, riskFactors.length);\n\n  return {\n    word,\n    errorRisk,\n    confidence,\n    primaryPattern: riskFactors.length > 0 ? riskFactors[0].type : 'category_weakness',\n    riskFactors,\n    warningLevel,\n    suggestedSupport,\n  };\n}\n\n/**\n * \n */\nfunction generateSupportStrategy(\n  word: string,\n  errorRisk: number,\n  warningLevel: 'low' | 'medium' | 'high' | 'critical',\n  riskFactors: RiskFactor[],\n  confusionPair?: ConfusionPair\n): SupportStrategy {\n  const hints: string[] = [];\n  const reviewWords: string[] = [];\n  let warningMessage = '';\n  let confidenceBooster = '';\n\n  // \n  if (warningLevel === 'critical') {\n    warningMessage = ` : : ${errorRisk.toFixed(0)}%`;\n    confidenceBooster = '';\n  } else if (warningLevel === 'high') {\n    warningMessage = ` : ${errorRisk.toFixed(0)}%`;\n    confidenceBooster = '';\n  } else if (warningLevel === 'medium') {\n    warningMessage = ` : ${errorRisk.toFixed(0)}%`;\n    confidenceBooster = '';\n  }\n\n  // \n  riskFactors.forEach((factor) => {\n    switch (factor.type) {\n      case 'confusion_pair':\n        if (confusionPair) {\n          const otherWord =\n            confusionPair.word1 === word ? confusionPair.word2 : confusionPair.word1;\n          hints.push(`\"${otherWord}\"`);\n          reviewWords.push(otherWord);\n        }\n        break;\n      case 'similar_spelling':\n        hints.push('');\n        break;\n      case 'timing_based':\n        if (factor.description.includes('')) {\n          hints.push('');\n        } else if (factor.description.includes('')) {\n          hints.push('');\n        }\n        break;\n      case 'category_weakness':\n        hints.push('');\n        break;\n    }\n  });\n\n  return {\n    showWarning: warningLevel !== 'low',\n    warningMessage,\n    hints: hints.slice(0, 2), // 2\n    reviewWords,\n    confidenceBooster,\n  };\n}\n\n/**\n * \n */\nfunction calculatePredictionConfidence(\n  wordProgress: WordProgress | undefined,\n  riskFactorCount: number\n): number {\n  let confidence = 50; // \n\n  // \n  if (wordProgress) {\n    const totalAttempts = wordProgress.correctCount + wordProgress.incorrectCount;\n    confidence += Math.min(30, totalAttempts * 5);\n\n    // \n    if (wordProgress.learningHistory && wordProgress.learningHistory.length >= 3) {\n      confidence += 10;\n    }\n  }\n\n  // \n  confidence += Math.min(10, riskFactorCount * 3);\n\n  return Math.min(100, confidence);\n}\n\n/**\n * \n */\nfunction isSpellingError(correctWord: string, userAnswer: string): boolean {\n  // \n  const distance = calculateLevenshteinDistance(\n    correctWord.toLowerCase(),\n    userAnswer.toLowerCase()\n  );\n\n  // 1-2\n  return distance > 0 && distance <= 2;\n}\n\n/**\n * \n */\nfunction calculateLevenshteinDistance(a: string, b: string): number {\n  const matrix: number[][] = [];\n\n  for (let i = 0; i <= b.length; i++) {\n    matrix[i] = [i];\n  }\n\n  for (let j = 0; j <= a.length; j++) {\n    matrix[0][j] = j;\n  }\n\n  for (let i = 1; i <= b.length; i++) {\n    for (let j = 1; j <= a.length; j++) {\n      if (b.charAt(i - 1) === a.charAt(j - 1)) {\n        matrix[i][j] = matrix[i - 1][j - 1];\n      } else {\n        matrix[i][j] = Math.min(\n          matrix[i - 1][j - 1] + 1,\n          matrix[i][j - 1] + 1,\n          matrix[i - 1][j] + 1\n        );\n      }\n    }\n  }\n\n  return matrix[b.length][a.length];\n}\n\n/**\n * \n */\nexport function batchPredictErrors(\n  words: string[],\n  wordProgress: Record<string, WordProgress>,\n  errorAnalysis: ErrorAnalysis,\n  currentFatigue: number,\n  recentErrors: number\n): Map<string, ErrorPrediction> {\n  const predictions = new Map<string, ErrorPrediction>();\n\n  words.forEach((word) => {\n    const prediction = predictErrorRisk(\n      word,\n      wordProgress[word],\n      errorAnalysis,\n      currentFatigue,\n      recentErrors\n    );\n    predictions.set(word, prediction);\n  });\n\n  return predictions;\n}\n\n/**\n * \n */\nexport function getHighRiskQuestions(\n  predictions: Map<string, ErrorPrediction>,\n  threshold: number = 60\n): ErrorPrediction[] {\n  return Array.from(predictions.values())\n    .filter((p) => p.errorRisk >= threshold)\n    .sort((a, b) => b.errorRisk - a.errorRisk);\n}\n","/**\n * AI (Contextual Learning AI)\n *\n * :\n * - \n * - \n * - \n *\n * :\n * 1. : \n * 2. : \n * 3. : \n * 4. : \n */\n\nimport { Question } from '@/types';\nimport { WordProgress } from '@/storage/progress/progressStorage';\n\n/**\n * \n */\nexport type SemanticRelationType =\n  | 'synonym' // \n  | 'antonym' // \n  | 'category' // \n  | 'theme' // \n  | 'word_family' // \n  | 'collocation' // \n  | 'context'; // \n\n/**\n * \n */\nexport interface SemanticCluster {\n  id: string;\n  name: string;\n  theme: string;\n  words: string[];\n  relationType: SemanticRelationType;\n  priority: number; // \n}\n\n/**\n * \n */\nexport interface WordRelation {\n  word1: string;\n  word2: string;\n  relationType: SemanticRelationType;\n  strength: number; // 0-1: \n  description: string;\n}\n\n/**\n * \n */\nexport interface ContextualSequence {\n  clusters: SemanticCluster[];\n  sequence: string[]; // \n  transitions: Array<{\n    from: string;\n    to: string;\n    reason: string;\n  }>;\n}\n\n/**\n * \n */\nconst SEMANTIC_THEMES = {\n  emotions: {\n    name: '',\n    keywords: [\n      'happy',\n      'sad',\n      'angry',\n      'excited',\n      'worried',\n      'nervous',\n      'calm',\n      'joy',\n      'fear',\n      'love',\n      'hate',\n      'surprise',\n    ],\n    relatedCategories: [''],\n  },\n  movement: {\n    name: '',\n    keywords: [\n      'walk',\n      'run',\n      'jump',\n      'fly',\n      'swim',\n      'climb',\n      'move',\n      'go',\n      'come',\n      'enter',\n      'leave',\n      'return',\n    ],\n    relatedCategories: [''],\n  },\n  time: {\n    name: '',\n    keywords: [\n      'day',\n      'night',\n      'morning',\n      'evening',\n      'week',\n      'month',\n      'year',\n      'today',\n      'tomorrow',\n      'yesterday',\n      'always',\n      'never',\n      'sometimes',\n    ],\n    relatedCategories: ['', ''],\n  },\n  weather: {\n    name: '',\n    keywords: [\n      'sunny',\n      'rainy',\n      'cloudy',\n      'windy',\n      'snowy',\n      'hot',\n      'cold',\n      'warm',\n      'cool',\n      'weather',\n      'temperature',\n    ],\n    relatedCategories: ['', ''],\n  },\n  food: {\n    name: '',\n    keywords: [\n      'food',\n      'eat',\n      'drink',\n      'cook',\n      'meal',\n      'breakfast',\n      'lunch',\n      'dinner',\n      'hungry',\n      'thirsty',\n      'delicious',\n    ],\n    relatedCategories: ['', '', ''],\n  },\n  nature: {\n    name: '',\n    keywords: [\n      'tree',\n      'flower',\n      'mountain',\n      'river',\n      'sea',\n      'sky',\n      'sun',\n      'moon',\n      'star',\n      'nature',\n      'plant',\n      'animal',\n    ],\n    relatedCategories: [''],\n  },\n  family: {\n    name: '',\n    keywords: [\n      'family',\n      'father',\n      'mother',\n      'brother',\n      'sister',\n      'parent',\n      'child',\n      'friend',\n      'teacher',\n      'student',\n    ],\n    relatedCategories: [''],\n  },\n  size: {\n    name: '',\n    keywords: [\n      'big',\n      'small',\n      'large',\n      'tiny',\n      'huge',\n      'long',\n      'short',\n      'tall',\n      'high',\n      'low',\n      'wide',\n      'narrow',\n    ],\n    relatedCategories: [''],\n  },\n  communication: {\n    name: '',\n    keywords: [\n      'say',\n      'speak',\n      'talk',\n      'tell',\n      'ask',\n      'answer',\n      'listen',\n      'hear',\n      'write',\n      'read',\n      'call',\n      'email',\n    ],\n    relatedCategories: [''],\n  },\n  learning: {\n    name: '',\n    keywords: [\n      'learn',\n      'study',\n      'teach',\n      'understand',\n      'know',\n      'remember',\n      'forget',\n      'practice',\n      'improve',\n      'test',\n      'exam',\n    ],\n    relatedCategories: ['', ''],\n  },\n};\n\n/**\n * \n */\nconst ANTONYM_PAIRS = [\n  ['big', 'small'],\n  ['large', 'small'],\n  ['long', 'short'],\n  ['tall', 'short'],\n  ['high', 'low'],\n  ['wide', 'narrow'],\n  ['deep', 'shallow'],\n  ['heavy', 'light'],\n  ['strong', 'weak'],\n  ['hard', 'soft'],\n  ['hot', 'cold'],\n  ['warm', 'cool'],\n  ['fast', 'slow'],\n  ['quick', 'slow'],\n  ['early', 'late'],\n  ['young', 'old'],\n  ['new', 'old'],\n  ['happy', 'sad'],\n  ['good', 'bad'],\n  ['right', 'wrong'],\n  ['easy', 'difficult'],\n  ['simple', 'complex'],\n  ['start', 'end'],\n  ['begin', 'finish'],\n  ['open', 'close'],\n  ['love', 'hate'],\n  ['day', 'night'],\n  ['morning', 'evening'],\n  ['always', 'never'],\n  ['often', 'rarely'],\n  ['many', 'few'],\n  ['much', 'little'],\n  ['more', 'less'],\n  ['increase', 'decrease'],\n  ['rise', 'fall'],\n  ['up', 'down'],\n  ['front', 'back'],\n  ['before', 'after'],\n  ['first', 'last'],\n  ['enter', 'leave'],\n  ['come', 'go'],\n  ['push', 'pull'],\n  ['give', 'take'],\n  ['buy', 'sell'],\n  ['win', 'lose'],\n  ['remember', 'forget'],\n  ['find', 'lose'],\n];\n\n/**\n * \n */\nconst SYNONYM_GROUPS = [\n  ['big', 'large', 'huge', 'enormous'],\n  ['small', 'little', 'tiny'],\n  ['happy', 'glad', 'joyful', 'pleased'],\n  ['sad', 'unhappy', 'sorrowful'],\n  ['angry', 'mad', 'furious'],\n  ['beautiful', 'pretty', 'lovely'],\n  ['ugly', 'unattractive'],\n  ['important', 'significant', 'essential'],\n  ['difficult', 'hard', 'tough', 'challenging'],\n  ['easy', 'simple'],\n  ['fast', 'quick', 'rapid', 'swift'],\n  ['slow', 'sluggish'],\n  ['smart', 'intelligent', 'clever', 'bright'],\n  ['stupid', 'foolish', 'dumb'],\n  ['funny', 'amusing', 'humorous'],\n  ['boring', 'dull', 'tedious'],\n  ['interesting', 'fascinating', 'engaging'],\n  ['tired', 'exhausted', 'weary'],\n  ['afraid', 'scared', 'frightened', 'terrified'],\n  ['brave', 'courageous', 'bold'],\n  ['kind', 'nice', 'gentle', 'friendly'],\n  ['mean', 'cruel', 'unkind'],\n  ['rich', 'wealthy', 'affluent'],\n  ['poor', 'needy'],\n  ['famous', 'well-known', 'renowned'],\n  ['strange', 'odd', 'weird', 'unusual'],\n  ['normal', 'ordinary', 'common', 'typical'],\n];\n\n/**\n * \n */\nexport function generateSemanticClusters(\n  questions: Question[],\n  wordProgress: Record<string, WordProgress>\n): SemanticCluster[] {\n  const clusters: SemanticCluster[] = [];\n  const processedWords = new Set<string>();\n\n  // 1. \n  Object.entries(SEMANTIC_THEMES).forEach(([themeId, theme]) => {\n    const themeWords = questions\n      .filter((q) => {\n        const word = q.word.toLowerCase();\n        const meaning = q.meaning.toLowerCase();\n        return (\n          theme.keywords.some((keyword) => word.includes(keyword) || meaning.includes(keyword)) &&\n          !processedWords.has(q.word)\n        );\n      })\n      .map((q) => q.word);\n\n    if (themeWords.length >= 2) {\n      themeWords.forEach((w) => processedWords.add(w));\n\n      // : \n      const weakWords = themeWords.filter((w) => {\n        const progress = wordProgress[w];\n        return progress && progress.incorrectCount > progress.correctCount;\n      });\n      const priority = 50 + (weakWords.length / themeWords.length) * 50;\n\n      clusters.push({\n        id: `theme_${themeId}`,\n        name: theme.name,\n        theme: themeId,\n        words: themeWords,\n        relationType: 'theme',\n        priority,\n      });\n    }\n  });\n\n  // 2. \n  ANTONYM_PAIRS.forEach((pair, index) => {\n    const [word1, word2] = pair;\n    const matchingWords = questions\n      .filter((q) => {\n        const word = q.word.toLowerCase();\n        return (word === word1 || word === word2) && !processedWords.has(q.word);\n      })\n      .map((q) => q.word);\n\n    if (matchingWords.length === 2) {\n      matchingWords.forEach((w) => processedWords.add(w));\n\n      clusters.push({\n        id: `antonym_${index}`,\n        name: `: ${word1}  ${word2}`,\n        theme: 'antonyms',\n        words: matchingWords,\n        relationType: 'antonym',\n        priority: 70, // \n      });\n    }\n  });\n\n  // 3. \n  SYNONYM_GROUPS.forEach((group, index) => {\n    const matchingWords = questions\n      .filter((q) => {\n        const word = q.word.toLowerCase();\n        return group.includes(word) && !processedWords.has(q.word);\n      })\n      .map((q) => q.word);\n\n    if (matchingWords.length >= 2) {\n      matchingWords.forEach((w) => processedWords.add(w));\n\n      clusters.push({\n        id: `synonym_${index}`,\n        name: `: ${group.join(', ')}`,\n        theme: 'synonyms',\n        words: matchingWords,\n        relationType: 'synonym',\n        priority: 60,\n      });\n    }\n  });\n\n  // 4. \n  const categoryMap = new Map<string, string[]>();\n  questions.forEach((q) => {\n    if (!processedWords.has(q.word) && q.category) {\n      const words = categoryMap.get(q.category) || [];\n      words.push(q.word);\n      categoryMap.set(q.category, words);\n    }\n  });\n\n  categoryMap.forEach((words, category) => {\n    if (words.length >= 3) {\n      words.forEach((w) => processedWords.add(w));\n\n      clusters.push({\n        id: `category_${category}`,\n        name: `: ${category}`,\n        theme: category,\n        words,\n        relationType: 'category',\n        priority: 40,\n      });\n    }\n  });\n\n  return clusters.sort((a, b) => b.priority - a.priority);\n}\n\n/**\n * \n */\nexport function detectWordRelations(word1: string, word2: string): WordRelation | null {\n  const w1 = word1.toLowerCase();\n  const w2 = word2.toLowerCase();\n\n  // \n  for (const pair of ANTONYM_PAIRS) {\n    if ((pair[0] === w1 && pair[1] === w2) || (pair[0] === w2 && pair[1] === w1)) {\n      return {\n        word1,\n        word2,\n        relationType: 'antonym',\n        strength: 0.9,\n        description: `\"${word1}\"\"${word2}\"`,\n      };\n    }\n  }\n\n  // \n  for (const group of SYNONYM_GROUPS) {\n    if (group.includes(w1) && group.includes(w2)) {\n      return {\n        word1,\n        word2,\n        relationType: 'synonym',\n        strength: 0.8,\n        description: `\"${word1}\"\"${word2}\"`,\n      };\n    }\n  }\n\n  // \n  for (const [, theme] of Object.entries(SEMANTIC_THEMES)) {\n    const matchesTheme1 = theme.keywords.some((k) => w1.includes(k) || k.includes(w1));\n    const matchesTheme2 = theme.keywords.some((k) => w2.includes(k) || k.includes(w2));\n\n    if (matchesTheme1 && matchesTheme2) {\n      return {\n        word1,\n        word2,\n        relationType: 'theme',\n        strength: 0.6,\n        description: `\"${word1}\"\"${word2}\"${theme.name}`,\n      };\n    }\n  }\n\n  return null;\n}\n\n/**\n * \n */\nexport function generateContextualSequence(\n  questions: Question[],\n  wordProgress: Record<string, WordProgress>,\n  recentlyStudied: string[] = []\n): ContextualSequence {\n  const clusters = generateSemanticClusters(questions, wordProgress);\n  const sequence: string[] = [];\n  const transitions: Array<{ from: string; to: string; reason: string }> = [];\n  const used = new Set<string>();\n\n  // \n  recentlyStudied.forEach((w) => used.add(w));\n\n  // \n  clusters.forEach((cluster) => {\n    const availableWords = cluster.words.filter((w) => !used.has(w));\n\n    if (availableWords.length === 0) return;\n\n    // \n    const sortedWords = availableWords.sort((a, b) => {\n      const progressA = wordProgress[a];\n      const progressB = wordProgress[b];\n\n      if (!progressA && !progressB) return 0;\n      if (!progressA) return -1; // \n      if (!progressB) return 1;\n\n      // \n      const errorRateA =\n        progressA.incorrectCount / (progressA.correctCount + progressA.incorrectCount || 1);\n      const errorRateB =\n        progressB.incorrectCount / (progressB.correctCount + progressB.incorrectCount || 1);\n\n      return errorRateB - errorRateA;\n    });\n\n    // \n    sortedWords.forEach((word) => {\n      if (used.has(word)) return;\n\n      const prevWord = sequence[sequence.length - 1];\n      if (prevWord) {\n        const relation = detectWordRelations(prevWord, word);\n        transitions.push({\n          from: prevWord,\n          to: word,\n          reason: relation ? relation.description : `${cluster.name}`,\n        });\n      }\n\n      sequence.push(word);\n      used.add(word);\n    });\n  });\n\n  // \n  questions.forEach((q) => {\n    if (!used.has(q.word)) {\n      sequence.push(q.word);\n      used.add(q.word);\n    }\n  });\n\n  return {\n    clusters,\n    sequence,\n    transitions,\n  };\n}\n\n/**\n * \n */\nexport function getRelatedWordsForReview(\n  word: string,\n  allQuestions: Question[],\n  _wordProgress: Record<string, WordProgress>,\n  maxSuggestions: number = 3\n): string[] {\n  const suggestions: Array<{ word: string; strength: number; reason: string }> = [];\n\n  allQuestions.forEach((q) => {\n    if (q.word === word) return;\n\n    const relation = detectWordRelations(word, q.word);\n    if (relation) {\n      suggestions.push({\n        word: q.word,\n        strength: relation.strength,\n        reason: relation.description,\n      });\n    }\n  });\n\n  // \n  return suggestions\n    .sort((a, b) => b.strength - a.strength)\n    .slice(0, maxSuggestions)\n    .map((s) => s.word);\n}\n\n/**\n * \n */\nexport function analyzeClusterProgress(\n  cluster: SemanticCluster,\n  wordProgress: Record<string, WordProgress>\n): {\n  masteredWords: string[];\n  learningWords: string[];\n  newWords: string[];\n  completionRate: number;\n  averageAccuracy: number;\n} {\n  const masteredWords: string[] = [];\n  const learningWords: string[] = [];\n  const newWords: string[] = [];\n  let totalAttempts = 0;\n  let totalCorrect = 0;\n\n  cluster.words.forEach((word) => {\n    const progress = wordProgress[word];\n\n    if (!progress || (progress.correctCount === 0 && progress.incorrectCount === 0)) {\n      newWords.push(word);\n    } else if (progress.masteryLevel === 'mastered') {\n      masteredWords.push(word);\n      totalAttempts += progress.correctCount + progress.incorrectCount;\n      totalCorrect += progress.correctCount;\n    } else {\n      learningWords.push(word);\n      totalAttempts += progress.correctCount + progress.incorrectCount;\n      totalCorrect += progress.correctCount;\n    }\n  });\n\n  const completionRate = (masteredWords.length / cluster.words.length) * 100;\n  const averageAccuracy = totalAttempts > 0 ? (totalCorrect / totalAttempts) * 100 : 0;\n\n  return {\n    masteredWords,\n    learningWords,\n    newWords,\n    completionRate,\n    averageAccuracy,\n  };\n}\n","/**\n * AI (Learning Style AI)\n *\n * :\n * - \n * - \n * - \n *\n * :\n * 1. : ///\n * 2. : \n * 3. :  vs \n * 4. : \n */\n\nimport { logger } from '@/utils/logger';\n\n/**\n * \n */\nexport interface SessionStats {\n  sessionId: string;\n  startTime: number; // timestamp\n  endTime: number; // timestamp\n  duration: number; // \n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n  questionsAnswered: number;\n  correctAnswers: number;\n  accuracy: number; // 0-100%\n  averageResponseTime: number; // \n  fatigueLevel: number; // 0-100%\n  newWordsLearned: number;\n  reviewedWords: number;\n}\n\n/**\n * \n */\nexport interface TimeOfDayPerformance {\n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n  sessionCount: number;\n  totalQuestions: number;\n  averageAccuracy: number;\n  averageResponseTime: number;\n  averageFatigue: number;\n  efficiencyScore: number; // 0-100: \n  bestForNewLearning: boolean;\n  bestForReview: boolean;\n}\n\n/**\n * \n */\nexport interface SessionLengthAnalysis {\n  optimalDuration: number; // \n  currentAverageDuration: number; // \n  performanceByDuration: Array<{\n    durationRange: string; // \"0-5\", \"5-10\", \"10-15\"\n    accuracy: number;\n    efficiency: number;\n  }>;\n  recommendation: string;\n}\n\n/**\n * \n */\nexport type LearningStyleType =\n  | 'short_burst' // 5-10\n  | 'moderate' // 10-20\n  | 'extended' // 20\n  | 'distributed'; // 1\n\n/**\n * \n */\nexport interface LearningStyleProfile {\n  userId: string;\n  primaryStyle: LearningStyleType;\n  secondaryStyle?: LearningStyleType;\n  bestTimeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n  optimalSessionLength: number; // \n  optimalDailyFrequency: number; // 1\n  strengths: string[];\n  improvements: string[];\n  personalizedRecommendations: string[];\n}\n\n/**\n * \n */\nexport interface LearningEfficiencyMetrics {\n  overallEfficiency: number; // 0-100\n  timeEfficiency: number; // \n  retentionRate: number; // \n  learningVelocity: number; // \n  consistencyScore: number; // \n}\n\n/**\n * \n */\nexport function getTimeOfDay(\n  timestamp: number = Date.now()\n): 'morning' | 'afternoon' | 'evening' | 'night' {\n  const hour = new Date(timestamp).getHours();\n\n  if (hour >= 5 && hour < 12) return 'morning';\n  if (hour >= 12 && hour < 17) return 'afternoon';\n  if (hour >= 17 && hour < 21) return 'evening';\n  return 'night';\n}\n\n/**\n * \n */\nexport function recordSessionStats(\n  startTime: number,\n  endTime: number,\n  questionsAnswered: number,\n  correctAnswers: number,\n  averageResponseTime: number,\n  fatigueLevel: number,\n  newWordsLearned: number,\n  reviewedWords: number\n): SessionStats {\n  const duration = (endTime - startTime) / (1000 * 60); // \n  const accuracy = questionsAnswered > 0 ? (correctAnswers / questionsAnswered) * 100 : 0;\n\n  return {\n    sessionId: `session_${startTime}`,\n    startTime,\n    endTime,\n    duration,\n    timeOfDay: getTimeOfDay(startTime),\n    questionsAnswered,\n    correctAnswers,\n    accuracy,\n    averageResponseTime,\n    fatigueLevel,\n    newWordsLearned,\n    reviewedWords,\n  };\n}\n\n/**\n * \n */\nexport function analyzeTimeOfDayPerformance(sessions: SessionStats[]): TimeOfDayPerformance[] {\n  const timeSlots: Array<'morning' | 'afternoon' | 'evening' | 'night'> = [\n    'morning',\n    'afternoon',\n    'evening',\n    'night',\n  ];\n\n  return timeSlots\n    .map((timeOfDay) => {\n      const timeSessions = sessions.filter((s) => s.timeOfDay === timeOfDay);\n\n      if (timeSessions.length === 0) {\n        return {\n          timeOfDay,\n          sessionCount: 0,\n          totalQuestions: 0,\n          averageAccuracy: 0,\n          averageResponseTime: 0,\n          averageFatigue: 0,\n          efficiencyScore: 0,\n          bestForNewLearning: false,\n          bestForReview: false,\n        };\n      }\n\n      const totalQuestions = timeSessions.reduce((sum, s) => sum + s.questionsAnswered, 0);\n      const totalCorrect = timeSessions.reduce((sum, s) => sum + s.correctAnswers, 0);\n      const averageAccuracy = (totalCorrect / totalQuestions) * 100;\n      const averageResponseTime =\n        timeSessions.reduce((sum, s) => sum + s.averageResponseTime, 0) / timeSessions.length;\n      const averageFatigue =\n        timeSessions.reduce((sum, s) => sum + s.fatigueLevel, 0) / timeSessions.length;\n      const totalNewWords = timeSessions.reduce((sum, s) => sum + s.newWordsLearned, 0);\n      const totalReviewWords = timeSessions.reduce((sum, s) => sum + s.reviewedWords, 0);\n\n      //  = (40%) + (30%) + (30%)\n      const accuracyScore = averageAccuracy;\n      const speedScore = Math.max(0, 100 - averageResponseTime / 50); // 5\n      const fatigueScore = 100 - averageFatigue;\n      const efficiencyScore = accuracyScore * 0.4 + speedScore * 0.3 + fatigueScore * 0.3;\n\n      return {\n        timeOfDay,\n        sessionCount: timeSessions.length,\n        totalQuestions,\n        averageAccuracy,\n        averageResponseTime,\n        averageFatigue,\n        efficiencyScore,\n        bestForNewLearning: totalNewWords > totalReviewWords,\n        bestForReview: totalReviewWords >= totalNewWords,\n      };\n    })\n    .sort((a, b) => b.efficiencyScore - a.efficiencyScore);\n}\n\n/**\n * \n */\nexport function analyzeSessionLength(sessions: SessionStats[]): SessionLengthAnalysis {\n  if (sessions.length === 0) {\n    return {\n      optimalDuration: 15,\n      currentAverageDuration: 0,\n      performanceByDuration: [],\n      recommendation:\n        '15',\n    };\n  }\n\n  const currentAverageDuration = sessions.reduce((sum, s) => sum + s.duration, 0) / sessions.length;\n\n  // 5\n  const durationRanges = [\n    { min: 0, max: 5, label: '0-5' },\n    { min: 5, max: 10, label: '5-10' },\n    { min: 10, max: 15, label: '10-15' },\n    { min: 15, max: 20, label: '15-20' },\n    { min: 20, max: 30, label: '20-30' },\n    { min: 30, max: 999, label: '30' },\n  ];\n\n  const performanceByDuration = durationRanges\n    .map((range) => {\n      const rangeSessions = sessions.filter(\n        (s) => s.duration >= range.min && s.duration < range.max\n      );\n\n      if (rangeSessions.length === 0) {\n        return {\n          durationRange: range.label,\n          accuracy: 0,\n          efficiency: 0,\n        };\n      }\n\n      const avgAccuracy =\n        rangeSessions.reduce((sum, s) => sum + s.accuracy, 0) / rangeSessions.length;\n      const avgFatigue =\n        rangeSessions.reduce((sum, s) => sum + s.fatigueLevel, 0) / rangeSessions.length;\n      const efficiency = avgAccuracy - avgFatigue * 0.5; // \n\n      return {\n        durationRange: range.label,\n        accuracy: avgAccuracy,\n        efficiency,\n      };\n    })\n    .filter((p) => p.efficiency > 0);\n\n  // \n  const bestRange = performanceByDuration.reduce(\n    (best, current) => (current.efficiency > best.efficiency ? current : best),\n    performanceByDuration[0] || { durationRange: '10-15', efficiency: 0 }\n  );\n\n  // \n  const optimalDuration = bestRange ? parseInt(bestRange.durationRange.split('-')[0]) + 5 : 15;\n\n  // \n  let recommendation = '';\n  if (optimalDuration < 10) {\n    recommendation = `${optimalDuration}1`;\n  } else if (optimalDuration < 20) {\n    recommendation = `${optimalDuration}`;\n  } else {\n    recommendation = `${optimalDuration}`;\n  }\n\n  return {\n    optimalDuration,\n    currentAverageDuration,\n    performanceByDuration,\n    recommendation,\n  };\n}\n\n/**\n * \n */\nexport function determineLearningStyle(sessions: SessionStats[]): LearningStyleType {\n  if (sessions.length < 5) {\n    return 'moderate'; // \n  }\n\n  const avgDuration = sessions.reduce((sum, s) => sum + s.duration, 0) / sessions.length;\n\n  // 1\n  const dates = new Set(sessions.map((s) => new Date(s.startTime).toDateString()));\n  const avgSessionsPerDay = sessions.length / dates.size;\n\n  if (avgDuration < 10 && avgSessionsPerDay >= 2) {\n    return 'distributed'; // \n  } else if (avgDuration < 10) {\n    return 'short_burst'; // \n  } else if (avgDuration < 20) {\n    return 'moderate'; // \n  } else {\n    return 'extended'; // \n  }\n}\n\n/**\n * \n */\nexport function generateLearningStyleProfile(\n  userId: string,\n  sessions: SessionStats[]\n): LearningStyleProfile {\n  const primaryStyle = determineLearningStyle(sessions);\n  const timePerformance = analyzeTimeOfDayPerformance(sessions);\n  const sessionLengthAnalysis = analyzeSessionLength(sessions);\n\n  const bestTimeOfDay = timePerformance[0]?.timeOfDay || 'morning';\n  const optimalSessionLength = sessionLengthAnalysis.optimalDuration;\n\n  // 1\n  let optimalDailyFrequency = 1;\n  if (primaryStyle === 'distributed' || primaryStyle === 'short_burst') {\n    optimalDailyFrequency = 3;\n  } else if (primaryStyle === 'moderate') {\n    optimalDailyFrequency = 2;\n  }\n\n  // \n  const strengths: string[] = [];\n  const improvements: string[] = [];\n\n  if (timePerformance[0]?.averageAccuracy > 80) {\n    strengths.push(\n      `${timePerformance[0].timeOfDay}${timePerformance[0].averageAccuracy.toFixed(0)}%`\n    );\n  }\n\n  if (primaryStyle === 'distributed') {\n    strengths.push('');\n  } else if (primaryStyle === 'extended') {\n    strengths.push('');\n  }\n\n  const avgFatigue = sessions.reduce((sum, s) => sum + s.fatigueLevel, 0) / sessions.length;\n  if (avgFatigue > 60) {\n    improvements.push('');\n  }\n\n  if (timePerformance[timePerformance.length - 1]?.averageAccuracy < 60) {\n    improvements.push(\n      `${timePerformance[timePerformance.length - 1].timeOfDay}`\n    );\n  }\n\n  // \n  const personalizedRecommendations: string[] = [];\n\n  personalizedRecommendations.push(\n    `: ${\n      bestTimeOfDay === 'morning'\n        ? ''\n        : bestTimeOfDay === 'afternoon'\n          ? ''\n          : bestTimeOfDay === 'evening'\n            ? ''\n            : ''\n    }`\n  );\n\n  personalizedRecommendations.push(`: ${optimalSessionLength}`);\n\n  personalizedRecommendations.push(`1: ${optimalDailyFrequency}`);\n\n  if (primaryStyle === 'distributed') {\n    personalizedRecommendations.push(\n      ''\n    );\n  } else if (primaryStyle === 'extended') {\n    personalizedRecommendations.push(\n      ''\n    );\n  }\n\n  return {\n    userId,\n    primaryStyle,\n    bestTimeOfDay,\n    optimalSessionLength,\n    optimalDailyFrequency,\n    strengths,\n    improvements,\n    personalizedRecommendations,\n  };\n}\n\n/**\n * \n */\nexport function calculateLearningEfficiency(sessions: SessionStats[]): LearningEfficiencyMetrics {\n  if (sessions.length === 0) {\n    return {\n      overallEfficiency: 0,\n      timeEfficiency: 0,\n      retentionRate: 0,\n      learningVelocity: 0,\n      consistencyScore: 0,\n    };\n  }\n\n  // \n  const avgAccuracy = sessions.reduce((sum, s) => sum + s.accuracy, 0) / sessions.length;\n  const avgFatigue = sessions.reduce((sum, s) => sum + s.fatigueLevel, 0) / sessions.length;\n  const overallEfficiency = avgAccuracy - avgFatigue * 0.3;\n\n  // 1\n  const totalNewWords = sessions.reduce((sum, s) => sum + s.newWordsLearned, 0);\n  const totalHours = sessions.reduce((sum, s) => sum + s.duration, 0) / 60;\n  const timeEfficiency = totalHours > 0 ? totalNewWords / totalHours : 0;\n\n  // \n  const reviewSessions = sessions.filter((s) => s.reviewedWords > 0);\n  const retentionRate =\n    reviewSessions.length > 0\n      ? reviewSessions.reduce((sum, s) => sum + s.accuracy, 0) / reviewSessions.length\n      : avgAccuracy;\n\n  // \n  const recentSessions = sessions.slice(-10);\n  const recentNewWords = recentSessions.reduce((sum, s) => sum + s.newWordsLearned, 0);\n  const learningVelocity = recentSessions.length > 0 ? recentNewWords / recentSessions.length : 0;\n\n  // \n  // 30\n  const thirtyDaysAgo = Date.now() - 30 * 24 * 60 * 60 * 1000;\n  const recentDates = sessions\n    .filter((s) => s.startTime >= thirtyDaysAgo)\n    .map((s) => new Date(s.startTime).toDateString());\n  const recentUniqueDates = new Set(recentDates);\n  const consistencyScore = (recentUniqueDates.size / 30) * 100;\n\n  return {\n    overallEfficiency,\n    timeEfficiency,\n    retentionRate,\n    learningVelocity,\n    consistencyScore,\n  };\n}\n\n/**\n * \n */\nexport function saveSessionToHistory(session: SessionStats): void {\n  try {\n    const key = 'learning-style-sessions';\n    const stored = localStorage.getItem(key);\n    const sessions: SessionStats[] = stored ? JSON.parse(stored) : [];\n\n    sessions.push(session);\n\n    // 100\n    const trimmed = sessions.slice(-100);\n\n    localStorage.setItem(key, JSON.stringify(trimmed));\n  } catch (error) {\n    logger.error('Failed to save session history:', error);\n  }\n}\n\n/**\n * \n */\nexport function loadSessionHistory(): SessionStats[] {\n  try {\n    const key = 'learning-style-sessions';\n    const stored = localStorage.getItem(key);\n    return stored ? JSON.parse(stored) : [];\n  } catch (error) {\n    logger.error('Failed to load session history:', error);\n    return [];\n  }\n}\n\n/**\n * \n */\nexport function generateRecommendationMessage(\n  profile: LearningStyleProfile,\n  currentTimeOfDay: 'morning' | 'afternoon' | 'evening' | 'night'\n): string {\n  const isBestTime = currentTimeOfDay === profile.bestTimeOfDay;\n\n  const timeNames = {\n    morning: '',\n    afternoon: '',\n    evening: '',\n    night: '',\n  };\n\n  if (isBestTime) {\n    return ` ${timeNames[currentTimeOfDay]}${profile.optimalSessionLength}`;\n  } else {\n    return ` ${timeNames[profile.bestTimeOfDay]}${timeNames[currentTimeOfDay]}`;\n  }\n}\n","/**\n * AI - \n *\n * :\n * 1. : \n * 2. : \n * 3. : \n * 4. : \n * 5. : /\n * 6. : \n */\n\n// ============================================================================\n// \n// ============================================================================\n\n/**\n * \n */\nexport enum BadgeType {\n  // \n  FIRST_SESSION = 'first_session', // \n  STREAK_3_DAYS = 'streak_3_days', // 3\n  STREAK_7_DAYS = 'streak_7_days', // 1\n  STREAK_30_DAYS = 'streak_30_days', // 1\n  TOTAL_100_WORDS = 'total_100_words', // 100\n  TOTAL_500_WORDS = 'total_500_words', // 500\n  TOTAL_1000_WORDS = 'total_1000_words', // 1000\n\n  // \n  PERFECT_SESSION = 'perfect_session', // \n  ACCURACY_90 = 'accuracy_90', // 90%10\n  ACCURACY_95 = 'accuracy_95', // 95%10\n\n  // \n  EARLY_BIRD = 'early_bird', // 5\n  NIGHT_OWL = 'night_owl', // 5\n  SPEED_MASTER = 'speed_master', // 2\n\n  // \n  REVIEW_CHAMPION = 'review_champion', // 50\n  MASTER_100 = 'master_100', // 100\n\n  // \n  COMEBACK = 'comeback', // 1\n  MARATHON = 'marathon', // 1\n  FOCUSED = 'focused', // 10\n}\n\n/**\n * \n */\nexport interface Badge {\n  type: BadgeType;\n  name: string;\n  description: string;\n  icon: string;\n  rarity: 'common' | 'rare' | 'epic' | 'legendary';\n  earnedAt?: Date;\n}\n\n/**\n * \n */\nexport interface UserLevel {\n  level: number;\n  currentXP: number;\n  requiredXP: number;\n  totalXP: number;\n}\n\n/**\n * \n */\nexport interface Streak {\n  current: number;\n  longest: number;\n  lastStudyDate: string; // YYYY-MM-DD\n}\n\n/**\n * \n */\nexport interface Milestone {\n  id: string;\n  title: string;\n  description: string;\n  target: number;\n  current: number;\n  reward: {\n    xp: number;\n    badge?: BadgeType;\n  };\n  completed: boolean;\n  completedAt?: Date;\n}\n\n/**\n * \n */\nexport interface Challenge {\n  id: string;\n  title: string;\n  description: string;\n  type: 'daily' | 'weekly' | 'monthly';\n  startDate: Date;\n  endDate: Date;\n  target: number;\n  progress: number;\n  reward: {\n    xp: number;\n    badge?: BadgeType;\n  };\n  completed: boolean;\n}\n\n/**\n * \n */\nexport interface GamificationStats {\n  level: UserLevel;\n  badges: Badge[];\n  streak: Streak;\n  milestones: Milestone[];\n  challenges: Challenge[];\n  totalSessions: number;\n  totalWordsLearned: number;\n  totalCorrectAnswers: number;\n  averageAccuracy: number;\n  lastSessionDate?: Date;\n}\n\n/**\n * \n */\nexport interface Feedback {\n  type: 'encouragement' | 'praise' | 'milestone' | 'streak' | 'level_up';\n  message: string;\n  icon: string;\n  priority: number; // 1-5 (5)\n}\n\n// ============================================================================\n// \n// ============================================================================\n\n/**\n * \n */\nexport const BADGE_DEFINITIONS: Record<BadgeType, Omit<Badge, 'earnedAt'>> = {\n  [BadgeType.FIRST_SESSION]: {\n    type: BadgeType.FIRST_SESSION,\n    name: '',\n    description: '',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.STREAK_3_DAYS]: {\n    type: BadgeType.STREAK_3_DAYS,\n    name: '',\n    description: '3',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.STREAK_7_DAYS]: {\n    type: BadgeType.STREAK_7_DAYS,\n    name: '',\n    description: '7',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.STREAK_30_DAYS]: {\n    type: BadgeType.STREAK_30_DAYS,\n    name: '',\n    description: '30',\n    icon: '',\n    rarity: 'epic',\n  },\n  [BadgeType.TOTAL_100_WORDS]: {\n    type: BadgeType.TOTAL_100_WORDS,\n    name: '',\n    description: '100',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.TOTAL_500_WORDS]: {\n    type: BadgeType.TOTAL_500_WORDS,\n    name: '',\n    description: '500',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.TOTAL_1000_WORDS]: {\n    type: BadgeType.TOTAL_1000_WORDS,\n    name: '',\n    description: '1000',\n    icon: '',\n    rarity: 'epic',\n  },\n  [BadgeType.PERFECT_SESSION]: {\n    type: BadgeType.PERFECT_SESSION,\n    name: '',\n    description: '1',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.ACCURACY_90]: {\n    type: BadgeType.ACCURACY_90,\n    name: '',\n    description: '90%10',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.ACCURACY_95]: {\n    type: BadgeType.ACCURACY_95,\n    name: '',\n    description: '95%10',\n    icon: '',\n    rarity: 'epic',\n  },\n  [BadgeType.EARLY_BIRD]: {\n    type: BadgeType.EARLY_BIRD,\n    name: '',\n    description: '6-95',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.NIGHT_OWL]: {\n    type: BadgeType.NIGHT_OWL,\n    name: '',\n    description: '21-245',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.SPEED_MASTER]: {\n    type: BadgeType.SPEED_MASTER,\n    name: '',\n    description: '210',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.REVIEW_CHAMPION]: {\n    type: BadgeType.REVIEW_CHAMPION,\n    name: '',\n    description: '50',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.MASTER_100]: {\n    type: BadgeType.MASTER_100,\n    name: '',\n    description: '100',\n    icon: '',\n    rarity: 'epic',\n  },\n  [BadgeType.COMEBACK]: {\n    type: BadgeType.COMEBACK,\n    name: '',\n    description: '1',\n    icon: '',\n    rarity: 'common',\n  },\n  [BadgeType.MARATHON]: {\n    type: BadgeType.MARATHON,\n    name: '',\n    description: '1',\n    icon: '',\n    rarity: 'rare',\n  },\n  [BadgeType.FOCUSED]: {\n    type: BadgeType.FOCUSED,\n    name: '',\n    description: '10',\n    icon: '',\n    rarity: 'rare',\n  },\n};\n\n/**\n * \n */\nexport const XP_PER_LEVEL = (level: number): number => {\n  return Math.floor(100 * Math.pow(1.15, level - 1));\n};\n\n/**\n * \n */\nexport const XP_REWARDS = {\n  CORRECT_ANSWER: 10, // \n  PERFECT_SESSION: 100, // \n  FIRST_TRY_CORRECT: 15, // \n  REVIEW_CORRECT: 20, // \n  STREAK_BONUS_PER_DAY: 5, // 1\n  SESSION_COMPLETION: 50, // \n  BADGE_EARNED: 200, // \n  CHALLENGE_COMPLETED: 500, // \n};\n\n// ============================================================================\n// \n// ============================================================================\n\n/**\n * LocalStorage\n */\nexport const loadGamificationStats = (): GamificationStats => {\n  const stored = localStorage.getItem('gamificationStats');\n  if (stored) {\n    const parsed = JSON.parse(stored);\n    // Date\n    if (parsed.lastSessionDate) {\n      parsed.lastSessionDate = new Date(parsed.lastSessionDate);\n    }\n    parsed.badges = parsed.badges.map((b: Badge) => ({\n      ...b,\n      earnedAt: b.earnedAt ? new Date(b.earnedAt) : undefined,\n    }));\n    parsed.milestones = parsed.milestones.map((m: Milestone) => ({\n      ...m,\n      completedAt: m.completedAt ? new Date(m.completedAt) : undefined,\n    }));\n    parsed.challenges = parsed.challenges.map((c: Challenge) => ({\n      ...c,\n      startDate: new Date(c.startDate),\n      endDate: new Date(c.endDate),\n    }));\n    return parsed;\n  }\n\n  // \n  return {\n    level: {\n      level: 1,\n      currentXP: 0,\n      requiredXP: XP_PER_LEVEL(1),\n      totalXP: 0,\n    },\n    badges: [],\n    streak: {\n      current: 0,\n      longest: 0,\n      lastStudyDate: '',\n    },\n    milestones: generateInitialMilestones(),\n    challenges: [],\n    totalSessions: 0,\n    totalWordsLearned: 0,\n    totalCorrectAnswers: 0,\n    averageAccuracy: 0,\n  };\n};\n\n/**\n * LocalStorage\n */\nexport const saveGamificationStats = (stats: GamificationStats): void => {\n  localStorage.setItem('gamificationStats', JSON.stringify(stats));\n};\n\n/**\n * \n */\nconst generateInitialMilestones = (): Milestone[] => {\n  return [\n    {\n      id: 'first_10_words',\n      title: '10',\n      description: '10',\n      target: 10,\n      current: 0,\n      reward: { xp: 100 },\n      completed: false,\n    },\n    {\n      id: 'first_50_words',\n      title: '50',\n      description: '50',\n      target: 50,\n      current: 0,\n      reward: { xp: 300, badge: BadgeType.TOTAL_100_WORDS },\n      completed: false,\n    },\n    {\n      id: 'accuracy_80',\n      title: '80%',\n      description: '80%',\n      target: 80,\n      current: 0,\n      reward: { xp: 200 },\n      completed: false,\n    },\n  ];\n};\n\n/**\n * \n */\nexport const addExperience = (\n  stats: GamificationStats,\n  xp: number\n): { stats: GamificationStats; leveledUp: boolean; newLevel?: number } => {\n  const newStats = { ...stats };\n  newStats.level.currentXP += xp;\n  newStats.level.totalXP += xp;\n\n  let leveledUp = false;\n  let newLevel: number | undefined;\n\n  // \n  while (newStats.level.currentXP >= newStats.level.requiredXP) {\n    newStats.level.currentXP -= newStats.level.requiredXP;\n    newStats.level.level += 1;\n    newStats.level.requiredXP = XP_PER_LEVEL(newStats.level.level);\n    leveledUp = true;\n    newLevel = newStats.level.level;\n  }\n\n  return { stats: newStats, leveledUp, newLevel };\n};\n\n/**\n * \n */\nexport const updateStreak = (stats: GamificationStats): GamificationStats => {\n  const today = new Date().toISOString().split('T')[0];\n  const lastDate = stats.streak.lastStudyDate;\n\n  if (!lastDate) {\n    // \n    return {\n      ...stats,\n      streak: {\n        current: 1,\n        longest: 1,\n        lastStudyDate: today,\n      },\n    };\n  }\n\n  if (lastDate === today) {\n    // \n    return stats;\n  }\n\n  const yesterday = new Date();\n  yesterday.setDate(yesterday.getDate() - 1);\n  const yesterdayStr = yesterday.toISOString().split('T')[0];\n\n  if (lastDate === yesterdayStr) {\n    // \n    const newCurrent = stats.streak.current + 1;\n    return {\n      ...stats,\n      streak: {\n        current: newCurrent,\n        longest: Math.max(newCurrent, stats.streak.longest),\n        lastStudyDate: today,\n      },\n    };\n  } else {\n    // \n    return {\n      ...stats,\n      streak: {\n        current: 1,\n        longest: stats.streak.longest,\n        lastStudyDate: today,\n      },\n    };\n  }\n};\n\n/**\n * \n */\nexport const checkAndAwardBadges = (\n  stats: GamificationStats,\n  sessionData: {\n    accuracy: number;\n    avgResponseTime: number;\n    wordsLearned: number;\n    perfectScore: boolean;\n    timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n    sessionDuration: number; // \n    focused: boolean;\n  }\n): { stats: GamificationStats; newBadges: Badge[] } => {\n  const newBadges: Badge[] = [];\n  const earnedBadgeTypes = new Set(stats.badges.map((b) => b.type));\n\n  const awardBadge = (type: BadgeType) => {\n    if (!earnedBadgeTypes.has(type)) {\n      const badge: Badge = {\n        ...BADGE_DEFINITIONS[type],\n        earnedAt: new Date(),\n      };\n      newBadges.push(badge);\n      earnedBadgeTypes.add(type);\n    }\n  };\n\n  // \n  if (stats.totalSessions === 1 && !earnedBadgeTypes.has(BadgeType.FIRST_SESSION)) {\n    awardBadge(BadgeType.FIRST_SESSION);\n  }\n\n  // \n  if (stats.streak.current >= 3) awardBadge(BadgeType.STREAK_3_DAYS);\n  if (stats.streak.current >= 7) awardBadge(BadgeType.STREAK_7_DAYS);\n  if (stats.streak.current >= 30) awardBadge(BadgeType.STREAK_30_DAYS);\n\n  // \n  if (stats.totalWordsLearned >= 100) awardBadge(BadgeType.TOTAL_100_WORDS);\n  if (stats.totalWordsLearned >= 500) awardBadge(BadgeType.TOTAL_500_WORDS);\n  if (stats.totalWordsLearned >= 1000) awardBadge(BadgeType.TOTAL_1000_WORDS);\n\n  // \n  if (sessionData.perfectScore) awardBadge(BadgeType.PERFECT_SESSION);\n\n  // 90%10\n  const highAccuracySessions = stats.totalSessions; // : \n  if (sessionData.accuracy >= 90 && highAccuracySessions >= 10) {\n    awardBadge(BadgeType.ACCURACY_90);\n  }\n  if (sessionData.accuracy >= 95 && highAccuracySessions >= 10) {\n    awardBadge(BadgeType.ACCURACY_95);\n  }\n\n  // : 5\n  if (sessionData.timeOfDay === 'morning' && stats.totalSessions >= 5) {\n    awardBadge(BadgeType.EARLY_BIRD);\n  }\n  if (sessionData.timeOfDay === 'night' && stats.totalSessions >= 5) {\n    awardBadge(BadgeType.NIGHT_OWL);\n  }\n\n  // \n  if (sessionData.avgResponseTime <= 2000 && stats.totalSessions >= 10) {\n    awardBadge(BadgeType.SPEED_MASTER);\n  }\n\n  // \n  if (sessionData.sessionDuration >= 60) {\n    awardBadge(BadgeType.MARATHON);\n  }\n\n  // \n  if (sessionData.focused && stats.totalSessions >= 10) {\n    awardBadge(BadgeType.FOCUSED);\n  }\n\n  // 1\n  if (stats.lastSessionDate) {\n    const daysSinceLastSession =\n      (new Date().getTime() - stats.lastSessionDate.getTime()) / (1000 * 60 * 60 * 24);\n    if (daysSinceLastSession >= 7) {\n      awardBadge(BadgeType.COMEBACK);\n    }\n  }\n\n  const updatedStats = {\n    ...stats,\n    badges: [...stats.badges, ...newBadges],\n  };\n\n  return { stats: updatedStats, newBadges };\n};\n\n/**\n * \n */\nexport const updateMilestones = (\n  stats: GamificationStats\n): { stats: GamificationStats; completedMilestones: Milestone[] } => {\n  const completedMilestones: Milestone[] = [];\n\n  const updatedMilestones = stats.milestones.map((milestone) => {\n    if (milestone.completed) return milestone;\n\n    let newCurrent = milestone.current;\n\n    // \n    if (milestone.id.includes('words')) {\n      newCurrent = stats.totalWordsLearned;\n    } else if (milestone.id.includes('accuracy')) {\n      newCurrent = stats.averageAccuracy;\n    }\n\n    const isCompleted = newCurrent >= milestone.target && !milestone.completed;\n\n    if (isCompleted) {\n      const completed = {\n        ...milestone,\n        current: newCurrent,\n        completed: true,\n        completedAt: new Date(),\n      };\n      completedMilestones.push(completed);\n      return completed;\n    }\n\n    return { ...milestone, current: newCurrent };\n  });\n\n  return {\n    stats: { ...stats, milestones: updatedMilestones },\n    completedMilestones,\n  };\n};\n\n/**\n * \n */\nexport const processSessionEnd = (\n  correctAnswers: number,\n  totalQuestions: number,\n  avgResponseTime: number,\n  sessionDuration: number,\n  wordsLearned: number,\n  fatigueLevel: number\n): {\n  stats: GamificationStats;\n  feedback: Feedback[];\n  xpGained: number;\n  leveledUp: boolean;\n  newLevel?: number;\n} => {\n  let stats = loadGamificationStats();\n  const feedback: Feedback[] = [];\n  let totalXP = 0;\n\n  // \n  stats.totalSessions += 1;\n  stats.totalWordsLearned += wordsLearned;\n  stats.totalCorrectAnswers += correctAnswers;\n  stats.averageAccuracy =\n    (stats.averageAccuracy * (stats.totalSessions - 1) + (correctAnswers / totalQuestions) * 100) /\n    stats.totalSessions;\n  stats.lastSessionDate = new Date();\n\n  // \n  const oldStreak = stats.streak.current;\n  stats = updateStreak(stats);\n  if (stats.streak.current > oldStreak) {\n    feedback.push({\n      type: 'streak',\n      message: ` ${stats.streak.current}`,\n      icon: '',\n      priority: 4,\n    });\n    totalXP += XP_REWARDS.STREAK_BONUS_PER_DAY * stats.streak.current;\n  }\n\n  // \n  const accuracy = (correctAnswers / totalQuestions) * 100;\n  const perfectScore = correctAnswers === totalQuestions;\n\n  totalXP += correctAnswers * XP_REWARDS.CORRECT_ANSWER;\n  totalXP += XP_REWARDS.SESSION_COMPLETION;\n  if (perfectScore) {\n    totalXP += XP_REWARDS.PERFECT_SESSION;\n    feedback.push({\n      type: 'praise',\n      message: ' ',\n      icon: '',\n      priority: 5,\n    });\n  }\n\n  // \n  const hour = new Date().getHours();\n  let timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night';\n  if (hour >= 6 && hour < 12) timeOfDay = 'morning';\n  else if (hour >= 12 && hour < 18) timeOfDay = 'afternoon';\n  else if (hour >= 18 && hour < 21) timeOfDay = 'evening';\n  else timeOfDay = 'night';\n\n  // \n  const focused = fatigueLevel < 0.3;\n\n  // \n  const badgeResult = checkAndAwardBadges(stats, {\n    accuracy,\n    avgResponseTime,\n    wordsLearned,\n    perfectScore,\n    timeOfDay,\n    sessionDuration,\n    focused,\n  });\n  stats = badgeResult.stats;\n\n  if (badgeResult.newBadges.length > 0) {\n    badgeResult.newBadges.forEach((badge) => {\n      feedback.push({\n        type: 'milestone',\n        message: ` : ${badge.name}`,\n        icon: badge.icon,\n        priority: 5,\n      });\n      totalXP += XP_REWARDS.BADGE_EARNED;\n    });\n  }\n\n  // \n  const milestoneResult = updateMilestones(stats);\n  stats = milestoneResult.stats;\n\n  if (milestoneResult.completedMilestones.length > 0) {\n    milestoneResult.completedMilestones.forEach((milestone) => {\n      feedback.push({\n        type: 'milestone',\n        message: ` : ${milestone.title}`,\n        icon: '',\n        priority: 4,\n      });\n      totalXP += milestone.reward.xp;\n    });\n  }\n\n  // \n  const xpResult = addExperience(stats, totalXP);\n  stats = xpResult.stats;\n\n  if (xpResult.leveledUp && xpResult.newLevel) {\n    feedback.push({\n      type: 'level_up',\n      message: `  Lv.${xpResult.newLevel}`,\n      icon: '',\n      priority: 5,\n    });\n  }\n\n  // \n  if (accuracy < 50) {\n    feedback.push({\n      type: 'encouragement',\n      message: ' ',\n      icon: '',\n      priority: 2,\n    });\n  } else if (accuracy >= 50 && accuracy < 80) {\n    feedback.push({\n      type: 'encouragement',\n      message: ' ',\n      icon: '',\n      priority: 2,\n    });\n  } else if (accuracy >= 80 && accuracy < 95) {\n    feedback.push({\n      type: 'praise',\n      message: ' ',\n      icon: '',\n      priority: 3,\n    });\n  }\n\n  saveGamificationStats(stats);\n\n  return {\n    stats,\n    feedback: feedback.sort((a, b) => b.priority - a.priority),\n    xpGained: totalXP,\n    leveledUp: xpResult.leveledUp,\n    newLevel: xpResult.newLevel,\n  };\n};\n\n/**\n * \n */\nexport const getMotivationalMessage = (): string => {\n  const stats = loadGamificationStats();\n  const messages: string[] = [];\n\n  if (stats.streak.current > 0) {\n    messages.push(` ${stats.streak.current}`);\n  }\n\n  if (stats.level.level > 1) {\n    messages.push(`  ${stats.level.level}`);\n  }\n\n  const nextLevelProgress = (stats.level.currentXP / stats.level.requiredXP) * 100;\n  if (nextLevelProgress > 80) {\n    messages.push(``);\n  }\n\n  if (messages.length === 0) {\n    messages.push('');\n  }\n\n  return messages.join(' | ');\n};\n\n/**\n * \n */\nexport const getNextMilestone = (): Milestone | null => {\n  const stats = loadGamificationStats();\n  const incomplete = stats.milestones.filter((m) => !m.completed);\n  if (incomplete.length === 0) return null;\n\n  // \n  return incomplete.reduce((closest, current) => {\n    const closestProgress = closest.current / closest.target;\n    const currentProgress = current.current / current.target;\n    return currentProgress > closestProgress ? current : closest;\n  });\n};\n\n/**\n * \n */\nexport const getBadgeCompletionRate = (): number => {\n  const stats = loadGamificationStats();\n  const totalBadges = Object.keys(BADGE_DEFINITIONS).length;\n  const earnedBadges = stats.badges.length;\n  return (earnedBadges / totalBadges) * 100;\n};\n","// AI \n\n// \nexport function randomChoice<T>(arr: T[]): T {\n  return arr[Math.floor(Math.random() * arr.length)];\n}\n\n// \nexport interface LearningPattern {\n  totalSessions: number;\n  averageAccuracy: number;\n  strongCategories: string[];\n  weakCategories: string[];\n  recentImprovement: boolean;\n  consistencyScore: number; // 0-100\n}\n\nexport function analyzeLearningPattern(): LearningPattern {\n  const progressData = localStorage.getItem('progress-data');\n  if (!progressData) {\n    return {\n      totalSessions: 0,\n      averageAccuracy: 0,\n      strongCategories: [],\n      weakCategories: [],\n      recentImprovement: false,\n      consistencyScore: 0,\n    };\n  }\n\n  try {\n    const data = JSON.parse(progressData);\n    const results = data.results || [];\n    const recentResults = results.slice(-10); // 10\n\n    // \n    const avgAccuracy =\n      recentResults.length > 0\n        ? recentResults.reduce((sum: number, r: any) => sum + (r.score / r.total) * 100, 0) /\n          recentResults.length\n        : 0;\n\n    // \n    const categoryStats = new Map<string, { correct: number; total: number }>();\n    results.forEach((r: any) => {\n      if (r.category) {\n        const stats = categoryStats.get(r.category) || { correct: 0, total: 0 };\n        stats.correct += r.score;\n        stats.total += r.total;\n        categoryStats.set(r.category, stats);\n      }\n    });\n\n    const strongCategories: string[] = [];\n    const weakCategories: string[] = [];\n    categoryStats.forEach((stats, category) => {\n      const accuracy = stats.total > 0 ? (stats.correct / stats.total) * 100 : 0;\n      if (accuracy >= 80) strongCategories.push(category);\n      if (accuracy < 60) weakCategories.push(category);\n    });\n\n    // \n    const older = recentResults.slice(0, 5);\n    const newer = recentResults.slice(-5);\n    const olderAvg =\n      older.length > 0\n        ? older.reduce((sum: number, r: any) => sum + (r.score / r.total) * 100, 0) / older.length\n        : 0;\n    const newerAvg =\n      newer.length > 0\n        ? newer.reduce((sum: number, r: any) => sum + (r.score / r.total) * 100, 0) / newer.length\n        : 0;\n    const recentImprovement = newerAvg > olderAvg + 5; // 5%\n\n    // \n    const uniqueDates = new Set(results.map((r: any) => new Date(r.date).toDateString()));\n    const consistencyScore = Math.min(100, uniqueDates.size * 5); // 20100\n\n    return {\n      totalSessions: results.length,\n      averageAccuracy: avgAccuracy,\n      strongCategories,\n      weakCategories,\n      recentImprovement,\n      consistencyScore,\n    };\n  } catch {\n    return {\n      totalSessions: 0,\n      averageAccuracy: 0,\n      strongCategories: [],\n      weakCategories: [],\n      recentImprovement: false,\n      consistencyScore: 0,\n    };\n  }\n}\n","// AI\nimport { AIPersonality, CommentContext } from '@/types';\nimport { randomChoice, analyzeLearningPattern } from './aiCommentHelpers';\n\n// \nexport function getTimeOfDay(): 'morning' | 'afternoon' | 'evening' | 'night' {\n  const hour = new Date().getHours();\n  if (hour >= 5 && hour < 12) return 'morning';\n  if (hour >= 12 && hour < 17) return 'afternoon';\n  if (hour >= 17 && hour < 21) return 'evening';\n  return 'night';\n}\n\n//  \nclass DrillSergeantCommentGenerator {\n  generateCorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n    const pattern = analyzeLearningPattern();\n\n    // \n    if (ctx.attemptCount === 1) {\n      if (ctx.responseTime < 3000) {\n        parts.push(randomChoice(['', '', '']));\n      }\n      parts.push(randomChoice(['', '', '']));\n    } else if (ctx.attemptCount === 2) {\n      parts.push(randomChoice(['2', '']));\n    } else {\n      parts.push(`${ctx.attemptCount}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.difficulty === 'advanced' && ctx.attemptCount === 1) {\n      parts.push(randomChoice(['', '']));\n    } else if (ctx.difficulty === 'beginner' && ctx.attemptCount > 1) {\n      parts.push('');\n    }\n\n    // \n    if (ctx.correctStreak >= 10) {\n      parts.push(`${ctx.correctStreak}`);\n      parts.push(randomChoice(['', '']));\n    } else if (ctx.correctStreak >= 5) {\n      parts.push(`${ctx.correctStreak}`);\n      parts.push(randomChoice(['', '']));\n    } else if (ctx.correctStreak >= 3) {\n      parts.push('3');\n    }\n\n    // \n    if (pattern.recentImprovement && pattern.totalSessions >= 10) {\n      parts.push(randomChoice(['', '']));\n    }\n\n    // \n    if (ctx.isWeakCategory && ctx.isCorrect) {\n      parts.push(`${ctx.category}`);\n      parts.push(randomChoice(['', '']));\n    }\n\n    // \n    if (ctx.todayQuestions >= 50 && ctx.todayAccuracy >= 80) {\n      parts.push('');\n    }\n\n    // \n    if (ctx.timeOfDay === 'night' && ctx.todayQuestions >= 30) {\n      parts.push('');\n    }\n\n    // \n    if (ctx.hasSeenBefore && ctx.previousAttempts > 2) {\n      parts.push(`${ctx.previousAttempts}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.learningPhase === 'ENCODING') {\n      parts.push('');\n    } else if (ctx.learningPhase === 'INITIAL_CONSOLIDATION') {\n      parts.push('');\n    } else if (ctx.learningPhase === 'LONG_TERM_RETENTION') {\n      parts.push('');\n    } else if (ctx.learningPhase === 'MASTERED') {\n      parts.push('');\n    }\n\n    // \n    parts.push('');\n\n    return parts.join(' ');\n  }\n\n  generateIncorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    // \n    if (ctx.attemptCount === 1) {\n      parts.push('');\n    } else {\n      parts.push('');\n    }\n\n    // \n    if (ctx.difficulty === 'beginner') {\n      parts.push('');\n      parts.push('');\n    }\n\n    // \n    if (ctx.incorrectStreak >= 3) {\n      parts.push(`${ctx.incorrectStreak}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.hasSeenBefore) {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.todayAccuracy < 60) {\n      parts.push('');\n      parts.push('');\n    }\n\n    // ()\n    if (ctx.timeOfDay === 'night' && ctx.todayQuestions >= 40) {\n      parts.push('');\n      parts.push('');\n    } else {\n      parts.push('');\n    }\n\n    return parts.join(' ');\n  }\n}\n\n//  \nclass KindTeacherCommentGenerator {\n  generateCorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    // \n    parts.push('');\n\n    // isCorrect\n    if (ctx.attemptCount === 1) {\n      if (ctx.responseTime < 3000) {\n        parts.push(' ');\n      } else {\n        parts.push('');\n      }\n    } else if (ctx.attemptCount === 2) {\n      parts.push('2');\n      parts.push('');\n    } else if (ctx.attemptCount >= 3) {\n      parts.push(`${ctx.attemptCount}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.difficulty === 'advanced') {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.correctStreak >= 5) {\n      parts.push(`${ctx.correctStreak}`);\n      parts.push(' ');\n    } else if (ctx.correctStreak >= 3) {\n      parts.push('');\n    }\n\n    // \n    if (ctx.isWeakCategory) {\n      parts.push(`${ctx.category}`);\n      parts.push(' ');\n    }\n\n    // \n    if (ctx.hasSeenBefore && ctx.previousAttempts > 2) {\n      parts.push('');\n      parts.push('');\n    }\n\n    // \n    if (ctx.todayQuestions >= 50) {\n      parts.push(`${ctx.todayQuestions}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.learningPhase === 'ENCODING') {\n      parts.push(' ');\n    } else if (ctx.learningPhase === 'INITIAL_CONSOLIDATION') {\n      parts.push(' ');\n    } else if (ctx.learningPhase === 'LONG_TERM_RETENTION') {\n      parts.push(' ');\n    } else if (ctx.learningPhase === 'MASTERED') {\n      parts.push(' ');\n    }\n\n    return parts.join(' ');\n  }\n\n  generateIncorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    // \n    if (ctx.attemptCount === 1) {\n      parts.push('');\n    } else {\n      parts.push('');\n    }\n\n    // \n    parts.push('');\n\n    // \n    if (ctx.difficulty === 'advanced') {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    } else if (ctx.difficulty === 'beginner') {\n      parts.push('');\n      parts.push('');\n    }\n\n    // \n    if (ctx.incorrectStreak >= 3) {\n      parts.push('');\n      parts.push(' ');\n    }\n\n    // \n    if (ctx.hasSeenBefore) {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    // \n    if (ctx.timeOfDay === 'night') {\n      parts.push('');\n      parts.push('');\n    }\n\n    // \n    parts.push(' ');\n\n    return parts.join(' ');\n  }\n}\n\n//  ()\nclass AnalystCommentGenerator {\n  generateCorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    parts.push(``);\n    parts.push(`: ${(ctx.responseTime / 1000).toFixed(1)}`);\n\n    if (ctx.attemptCount > 1) {\n      parts.push(`: ${ctx.attemptCount}`);\n    }\n\n    if (ctx.correctStreak > 0) {\n      parts.push(`: ${ctx.correctStreak}`);\n      const newAccuracy = Math.min(100, ctx.userAccuracy + 2);\n      parts.push(`: ${ctx.userAccuracy.toFixed(0)}%  ${newAccuracy.toFixed(0)}%`);\n    }\n\n    if (ctx.difficulty === 'advanced') {\n      parts.push(`: `);\n      parts.push(``);\n    }\n\n    if (ctx.isWeakCategory) {\n      parts.push(`(${ctx.category})`);\n      const newCatAccuracy = Math.min(100, ctx.categoryAccuracy + 3);\n      parts.push(\n        `: ${ctx.categoryAccuracy.toFixed(0)}%  ${newCatAccuracy.toFixed(0)}%`\n      );\n    }\n\n    parts.push(``);\n\n    return parts.join(' ');\n  }\n\n  generateIncorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    parts.push(``);\n    parts.push(`: ${ctx.attemptCount}`);\n\n    if (ctx.incorrectStreak > 0) {\n      parts.push(`: ${ctx.incorrectStreak}`);\n      const newAccuracy = Math.max(0, ctx.userAccuracy - 2);\n      parts.push(`: ${ctx.userAccuracy.toFixed(0)}%  ${newAccuracy.toFixed(0)}%`);\n    }\n\n    if (ctx.difficulty === 'beginner') {\n      parts.push(``);\n      parts.push(``);\n    }\n\n    if (ctx.hasSeenBefore) {\n      parts.push(`: ${ctx.previousAttempts + 1}`);\n      parts.push(`: `);\n    }\n\n    parts.push(`: 80%`);\n\n    return parts.join(' ');\n  }\n}\n\n//  \nclass EnthusiasticCoachCommentGenerator {\n  generateCorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    // \n    const exclamations = ['', '', '', ''];\n    parts.push(exclamations[Math.floor(Math.random() * exclamations.length)]);\n\n    if (ctx.attemptCount === 1) {\n      parts.push('');\n    } else if (ctx.attemptCount === 2) {\n      parts.push('');\n    } else {\n      parts.push(`${ctx.attemptCount}`);\n      parts.push('');\n    }\n\n    if (ctx.correctStreak >= 5) {\n      parts.push(`${ctx.correctStreak}`);\n      parts.push('');\n    } else if (ctx.correctStreak >= 3) {\n      parts.push('');\n    }\n\n    if (ctx.difficulty === 'advanced') {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    if (ctx.isWeakCategory) {\n      parts.push(`${ctx.category}`);\n      parts.push('');\n    }\n\n    if (ctx.todayQuestions >= 50 && ctx.todayAccuracy >= 80) {\n      parts.push(`${ctx.todayQuestions}`);\n      parts.push('');\n    }\n\n    parts.push('');\n\n    return parts.join(' ');\n  }\n\n  generateIncorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    parts.push('');\n\n    if (ctx.incorrectStreak < 3) {\n      parts.push('');\n      parts.push('');\n    } else {\n      parts.push('');\n      parts.push('');\n    }\n\n    if (ctx.difficulty === 'beginner') {\n      parts.push('');\n      parts.push('');\n    }\n\n    if (ctx.hasSeenBefore) {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    if (ctx.todayAccuracy < 60) {\n      parts.push('');\n      parts.push('');\n      parts.push('');\n    } else {\n      parts.push('');\n    }\n\n    return parts.join(' ');\n  }\n}\n\n//  \nclass WiseSageCommentGenerator {\n  generateCorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    parts.push('');\n    parts.push(`${ctx.word}`);\n\n    if (ctx.attemptCount > 1) {\n      parts.push('');\n    }\n\n    if (ctx.correctStreak >= 5) {\n      parts.push(`${ctx.correctStreak}`);\n      parts.push(' ');\n    } else if (ctx.correctStreak >= 3) {\n      parts.push(' ');\n    }\n\n    if (ctx.difficulty === 'advanced') {\n      parts.push('');\n      parts.push('');\n    }\n\n    if (ctx.isWeakCategory) {\n      parts.push('');\n      parts.push('');\n    }\n\n    if (ctx.todayQuestions >= 50) {\n      parts.push(`${ctx.todayQuestions}`);\n      parts.push(' ');\n    }\n\n    return parts.join(' ');\n  }\n\n  generateIncorrectComment(ctx: CommentContext): string {\n    const parts: string[] = [];\n\n    parts.push('');\n\n    if (ctx.attemptCount === 1) {\n      parts.push('');\n    } else {\n      parts.push('');\n      parts.push(' ');\n    }\n\n    if (ctx.difficulty === 'beginner') {\n      parts.push('');\n    }\n\n    if (ctx.incorrectStreak >= 3) {\n      parts.push('');\n      parts.push('');\n    }\n\n    if (ctx.hasSeenBefore) {\n      parts.push(`${ctx.word}`);\n      parts.push('');\n    }\n\n    if (ctx.todayAccuracy < 60) {\n      parts.push('');\n      parts.push('');\n    }\n\n    parts.push(' ');\n\n    return parts.join(' ');\n  }\n}\n\n// \nexport function generateAIComment(personality: AIPersonality, context: CommentContext): string {\n  let generator;\n\n  switch (personality) {\n    case 'drill-sergeant':\n      generator = new DrillSergeantCommentGenerator();\n      break;\n    case 'kind-teacher':\n      generator = new KindTeacherCommentGenerator();\n      break;\n    case 'analyst':\n      generator = new AnalystCommentGenerator();\n      break;\n    case 'enthusiastic-coach':\n      generator = new EnthusiasticCoachCommentGenerator();\n      break;\n    case 'wise-sage':\n      generator = new WiseSageCommentGenerator();\n      break;\n  }\n\n  if (context.isCorrect) {\n    return generator.generateCorrectComment(context);\n  } else {\n    return generator.generateIncorrectComment(context);\n  }\n}\n\n// \nexport const PERSONALITY_INFO = {\n  'drill-sergeant': {\n    avatar: '',\n    name: '',\n    description: '',\n    tone: '',\n  },\n  'kind-teacher': {\n    avatar: '',\n    name: '',\n    description: '',\n    tone: '',\n  },\n  analyst: {\n    avatar: '',\n    name: '',\n    description: '',\n    tone: '',\n  },\n  'enthusiastic-coach': {\n    avatar: '',\n    name: '',\n    description: '',\n    tone: '',\n  },\n  'wise-sage': {\n    avatar: '',\n    name: '',\n    description: '',\n    tone: '',\n  },\n} as const;\n","// AI\nimport { AIPersonality } from '@/types';\nimport { getTimeOfDay } from './aiCommentGenerator';\n\nexport interface GreetingContext {\n  lastLoginDate: string | null;\n  daysSinceLastLogin: number;\n  consecutiveDays: number;\n  todayStudyCount: number;\n  todayAccuracy: number;\n}\n\n// \nexport function getLastLoginDate(): string | null {\n  return localStorage.getItem('lastLoginDate');\n}\n\nexport function updateLastLoginDate(): void {\n  const now = new Date().toISOString().split('T')[0]; // YYYY-MM-DD\n  localStorage.setItem('lastLoginDate', now);\n}\n\n// \nexport function getConsecutiveDays(): number {\n  const streak = localStorage.getItem('loginStreak');\n  return streak ? parseInt(streak, 10) : 0;\n}\n\nexport function updateConsecutiveDays(): void {\n  const today = new Date().toISOString().split('T')[0];\n  const lastLogin = getLastLoginDate();\n\n  if (!lastLogin) {\n    localStorage.setItem('loginStreak', '1');\n    updateLastLoginDate();\n    return;\n  }\n\n  const lastDate = new Date(lastLogin);\n  const todayDate = new Date(today);\n  const diffTime = todayDate.getTime() - lastDate.getTime();\n  const diffDays = Math.floor(diffTime / (1000 * 60 * 60 * 24));\n\n  if (diffDays === 0) {\n    // \n    return;\n  } else if (diffDays === 1) {\n    // \n    const currentStreak = getConsecutiveDays();\n    localStorage.setItem('loginStreak', String(currentStreak + 1));\n  } else {\n    // \n    localStorage.setItem('loginStreak', '1');\n  }\n\n  updateLastLoginDate();\n}\n\n// \nexport function getDaysSinceLastLogin(): number {\n  const lastLogin = getLastLoginDate();\n  if (!lastLogin) return 0;\n\n  const today = new Date().toISOString().split('T')[0];\n  const lastDate = new Date(lastLogin);\n  const todayDate = new Date(today);\n  const diffTime = todayDate.getTime() - lastDate.getTime();\n  return Math.floor(diffTime / (1000 * 60 * 60 * 24));\n}\n\n// \nexport function getTodayStudyStats(): { count: number; accuracy: number } {\n  const today = new Date().toISOString().split('T')[0];\n  const stats = localStorage.getItem(`studyStats-${today}`);\n\n  if (!stats) {\n    return { count: 0, accuracy: 0 };\n  }\n\n  const parsed = JSON.parse(stats);\n  return {\n    count: parsed.count || 0,\n    accuracy: parsed.correct && parsed.count ? (parsed.correct / parsed.count) * 100 : 0,\n  };\n}\n\n// \nexport function generateTimeBasedGreeting(personality: AIPersonality): string | null {\n  const timeOfDay = getTimeOfDay();\n  const daysSince = getDaysSinceLastLogin();\n  const consecutive = getConsecutiveDays();\n  const { count, accuracy } = getTodayStudyStats();\n\n  const context: GreetingContext = {\n    lastLoginDate: getLastLoginDate(),\n    daysSinceLastLogin: daysSince,\n    consecutiveDays: consecutive,\n    todayStudyCount: count,\n    todayAccuracy: accuracy,\n  };\n\n  // \n  if (daysSince >= 3) {\n    return generateReturningGreeting(personality, daysSince);\n  }\n\n  // \n  if (consecutive >= 7 && count === 0) {\n    return generateStreakGreeting(personality, consecutive);\n  }\n\n  // \n  return generateTimeGreeting(personality, timeOfDay, context);\n}\n\n// \nfunction generateReturningGreeting(personality: AIPersonality, days: number): string {\n  switch (personality) {\n    case 'drill-sergeant':\n      if (days >= 7) {\n        return `${days}`;\n      }\n      return `${days}`;\n\n    case 'kind-teacher':\n      if (days >= 7) {\n        return ` ${days}`;\n      }\n      return ` ${days}`;\n\n    case 'analyst':\n      if (days >= 7) {\n        return ` ${days}40-60%`;\n      }\n      return ` ${days}`;\n\n    case 'enthusiastic-coach':\n      if (days >= 7) {\n        return ` ${days}`;\n      }\n      return ` ${days}`;\n\n    case 'wise-sage':\n      if (days >= 7) {\n        return ` ${days}`;\n      }\n      return ` ${days}`;\n\n    default:\n      return `${days}`;\n  }\n}\n\n// \nfunction generateStreakGreeting(personality: AIPersonality, streak: number): string {\n  switch (personality) {\n    case 'drill-sergeant':\n      return `${streak}`;\n\n    case 'kind-teacher':\n      return ` ${streak}`;\n\n    case 'analyst':\n      return ` ${streak}100%`;\n\n    case 'enthusiastic-coach':\n      return ` ${streak}`;\n\n    case 'wise-sage':\n      return ` ${streak}`;\n\n    default:\n      return '';\n  }\n}\n\n// \nfunction generateTimeGreeting(\n  personality: AIPersonality,\n  timeOfDay: 'morning' | 'afternoon' | 'evening' | 'night',\n  context: GreetingContext\n): string | null {\n  const { todayStudyCount, todayAccuracy } = context;\n\n  switch (personality) {\n    case 'drill-sergeant':\n      return getDrillSergeantTimeGreeting(timeOfDay, todayStudyCount, todayAccuracy);\n\n    case 'kind-teacher':\n      return getKindTeacherTimeGreeting(timeOfDay, todayStudyCount, todayAccuracy);\n\n    case 'analyst':\n      return getAnalystTimeGreeting(timeOfDay, todayStudyCount, todayAccuracy);\n\n    case 'enthusiastic-coach':\n      return getEnthusiasticCoachTimeGreeting(timeOfDay, todayStudyCount, todayAccuracy);\n\n    case 'wise-sage':\n      return getWiseSageTimeGreeting(timeOfDay, todayStudyCount, todayAccuracy);\n\n    default:\n      return null;\n  }\n}\n\n// \nfunction getDrillSergeantTimeGreeting(timeOfDay: string, count: number, _accuracy: number): string {\n  switch (timeOfDay) {\n    case 'morning':\n      if (count === 0) {\n        return '';\n      }\n      if (count >= 20) {\n        return '';\n      }\n      return '';\n\n    case 'afternoon':\n      if (count === 0) {\n        return '';\n      }\n      if (count >= 20) {\n        return '';\n      }\n      return '';\n\n    case 'evening':\n      if (count === 0) {\n        return '';\n      }\n      if (count >= 30) {\n        return '';\n      }\n      return '';\n\n    case 'night':\n      if (count === 0) {\n        return '01';\n      }\n      if (count >= 30) {\n        return '';\n      }\n      return '';\n\n    default:\n      return '';\n  }\n}\n\n// \nfunction getKindTeacherTimeGreeting(timeOfDay: string, count: number, _accuracy: number): string {\n  switch (timeOfDay) {\n    case 'morning':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'afternoon':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'evening':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'night':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    default:\n      return ' ';\n  }\n}\n\n// \nfunction getAnalystTimeGreeting(timeOfDay: string, count: number, accuracy: number): string {\n  switch (timeOfDay) {\n    case 'morning':\n      if (count === 0) {\n        return ' +30%';\n      }\n      if (count >= 20) {\n        return ` ${count}${accuracy.toFixed(1)}%`;\n      }\n      return ' ';\n\n    case 'afternoon':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ` ${count}`;\n      }\n      return ' 153';\n\n    case 'evening':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ` ${count}`;\n      }\n      return ' ';\n\n    case 'night':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ` ${count}22-23`;\n      }\n      return ' ';\n\n    default:\n      return ' ';\n  }\n}\n\n// \nfunction getEnthusiasticCoachTimeGreeting(\n  timeOfDay: string,\n  count: number,\n  _accuracy: number\n): string {\n  switch (timeOfDay) {\n    case 'morning':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'afternoon':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'evening':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'night':\n      if (count === 0) {\n        return ' 10';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    default:\n      return ' ';\n  }\n}\n\n// \nfunction getWiseSageTimeGreeting(timeOfDay: string, count: number, _accuracy: number): string {\n  switch (timeOfDay) {\n    case 'morning':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'afternoon':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 20) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'evening':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    case 'night':\n      if (count === 0) {\n        return ' ';\n      }\n      if (count >= 30) {\n        return ' ';\n      }\n      return ' ';\n\n    default:\n      return ' ';\n  }\n}\n","// \nimport { AIPersonality } from '@/types';\n\nexport interface TeacherInteraction {\n  mainTeacher: AIPersonality;\n  otherTeacher?: AIPersonality;\n  message: string;\n  type: 'joke' | 'banter' | 'passerby' | 'argument' | 'support';\n}\n\n// 10%\nexport function generateTeacherInteraction(\n  currentPersonality: AIPersonality,\n  isCorrect: boolean,\n  streak: number\n): TeacherInteraction | null {\n  // 10%\n  if (Math.random() > 0.1) {\n    return null;\n  }\n\n  const interactions = getInteractionPatterns(currentPersonality, isCorrect, streak);\n  if (interactions.length === 0) return null;\n\n  return interactions[Math.floor(Math.random() * interactions.length)];\n}\n\n// \nfunction getInteractionPatterns(\n  mainTeacher: AIPersonality,\n  isCorrect: boolean,\n  streak: number\n): TeacherInteraction[] {\n  const patterns: TeacherInteraction[] = [];\n\n  // \n  if (mainTeacher === 'drill-sergeant') {\n    if (isCorrect && streak >= 5) {\n      patterns.push({\n        mainTeacher: 'drill-sergeant',\n        otherTeacher: 'kind-teacher',\n        message:\n          ' ... ',\n        type: 'banter',\n      });\n      patterns.push({\n        mainTeacher: 'drill-sergeant',\n        otherTeacher: 'wise-sage',\n        message: '  ...',\n        type: 'banter',\n      });\n    }\n\n    if (!isCorrect) {\n      patterns.push({\n        mainTeacher: 'drill-sergeant',\n        otherTeacher: 'kind-teacher',\n        message:\n          '...  ',\n        type: 'argument',\n      });\n      patterns.push({\n        mainTeacher: 'drill-sergeant',\n        otherTeacher: 'analyst',\n        message:\n          '  ',\n        type: 'argument',\n      });\n    }\n\n    // \n    patterns.push({\n      mainTeacher: 'drill-sergeant',\n      otherTeacher: 'enthusiastic-coach',\n      message: ' ...',\n      type: 'passerby',\n    });\n  }\n\n  // \n  if (mainTeacher === 'kind-teacher') {\n    if (isCorrect) {\n      patterns.push({\n        mainTeacher: 'kind-teacher',\n        otherTeacher: 'drill-sergeant',\n        message:\n          '  ...',\n        type: 'passerby',\n      });\n      patterns.push({\n        mainTeacher: 'kind-teacher',\n        otherTeacher: 'wise-sage',\n        message:\n          '  ',\n        type: 'support',\n      });\n    }\n\n    if (!isCorrect) {\n      patterns.push({\n        mainTeacher: 'kind-teacher',\n        otherTeacher: 'enthusiastic-coach',\n        message:\n          '  ',\n        type: 'support',\n      });\n    }\n\n    // \n    patterns.push({\n      mainTeacher: 'kind-teacher',\n      message:\n        '...  ',\n      type: 'joke',\n    });\n  }\n\n  // \n  if (mainTeacher === 'analyst') {\n    if (streak >= 10) {\n      patterns.push({\n        mainTeacher: 'analyst',\n        otherTeacher: 'enthusiastic-coach',\n        message:\n          '10  ...',\n        type: 'banter',\n      });\n    }\n\n    patterns.push({\n      mainTeacher: 'analyst',\n      otherTeacher: 'drill-sergeant',\n      message:\n        '...   ',\n      type: 'argument',\n    });\n\n    patterns.push({\n      mainTeacher: 'analyst',\n      otherTeacher: 'kind-teacher',\n      message:\n        '73.4% ... ',\n      type: 'banter',\n    });\n\n    // \n    patterns.push({\n      mainTeacher: 'analyst',\n      message:\n        '......  ',\n      type: 'joke',\n    });\n  }\n\n  // \n  if (mainTeacher === 'enthusiastic-coach') {\n    if (isCorrect && streak >= 5) {\n      patterns.push({\n        mainTeacher: 'enthusiastic-coach',\n        otherTeacher: 'wise-sage',\n        message:\n          ' ... ',\n        type: 'banter',\n      });\n      patterns.push({\n        mainTeacher: 'enthusiastic-coach',\n        otherTeacher: 'drill-sergeant',\n        message:\n          ' ... ',\n        type: 'support',\n      });\n    }\n\n    if (!isCorrect) {\n      patterns.push({\n        mainTeacher: 'enthusiastic-coach',\n        otherTeacher: 'kind-teacher',\n        message: '  ',\n        type: 'support',\n      });\n    }\n\n    // \n    patterns.push({\n      mainTeacher: 'enthusiastic-coach',\n      message: '...  ',\n      type: 'joke',\n    });\n  }\n\n  // \n  if (mainTeacher === 'wise-sage') {\n    if (isCorrect) {\n      patterns.push({\n        mainTeacher: 'wise-sage',\n        otherTeacher: 'drill-sergeant',\n        message:\n          '  ...',\n        type: 'banter',\n      });\n    }\n\n    patterns.push({\n      mainTeacher: 'wise-sage',\n      otherTeacher: 'analyst',\n      message: '  ...',\n      type: 'argument',\n    });\n\n    patterns.push({\n      mainTeacher: 'wise-sage',\n      otherTeacher: 'enthusiastic-coach',\n      message:\n        '...  ...',\n      type: 'banter',\n    });\n\n    // \n    patterns.push({\n      mainTeacher: 'wise-sage',\n      message: '...  ...',\n      type: 'joke',\n    });\n  }\n\n  // \n  const commonPatterns: TeacherInteraction[] = [\n    {\n      mainTeacher: mainTeacher,\n      message:\n        '    ...',\n      type: 'joke',\n    },\n    {\n      mainTeacher: mainTeacher,\n      message:\n        '... ...  ',\n      type: 'joke',\n    },\n    {\n      mainTeacher: mainTeacher,\n      message:\n        '... IT   ',\n      type: 'joke',\n    },\n    {\n      mainTeacher: mainTeacher,\n      message:\n        '    ',\n      type: 'banter',\n    },\n  ];\n\n  // 5%\n  if (Math.random() < 0.05) {\n    patterns.push(...commonPatterns);\n  }\n\n  return patterns;\n}\n\n// \nexport function getTimeBasedTeacherChat(): string | null {\n  const hour = new Date().getHours();\n\n  // 5%\n  if (Math.random() > 0.05) return null;\n\n  if (hour >= 6 && hour < 9) {\n    const morning = [\n      '  ',\n      ' 18 ',\n      ' 10...',\n    ];\n    return morning[Math.floor(Math.random() * morning.length)];\n  }\n\n  if (hour >= 12 && hour < 13) {\n    const lunch = [\n      '  30',\n      '  ',\n      ' ... ',\n    ];\n    return lunch[Math.floor(Math.random() * lunch.length)];\n  }\n\n  if (hour >= 17 && hour < 19) {\n    const evening = [\n      '  ',\n      ' 1732 ',\n      '   ',\n    ];\n    return evening[Math.floor(Math.random() * evening.length)];\n  }\n\n  if (hour >= 22) {\n    const lateNight = [\n      '...  ',\n      '22 ',\n      '  ...',\n    ];\n    return lateNight[Math.floor(Math.random() * lateNight.length)];\n  }\n\n  return null;\n}\n\n// \nexport function getTeacherReactionToStreak(streak: number): string | null {\n  if (streak === 10) {\n    return '10    ';\n  }\n\n  if (streak === 20) {\n    return '20...    ...';\n  }\n\n  if (streak === 50) {\n    return '50';\n  }\n\n  return null;\n}\n\n// \nexport function getSpecialDayChat(): string | null {\n  const now = new Date();\n  const month = now.getMonth() + 1;\n  const date = now.getDate();\n  const day = now.getDay();\n\n  // \n  if (day === 1) {\n    return '  ';\n  }\n\n  // \n  if (day === 5) {\n    return '  ';\n  }\n\n  // \n  if (month === 12 && date === 25) {\n    return '   ';\n  }\n\n  // \n  if (month === 1 && date === 1) {\n    return '';\n  }\n\n  return null;\n}\n","// \nimport { AIPersonality } from './types';\n\nexport interface EnglishTrivia {\n  type: 'fun-fact' | 'common-mistake' | 'cultural' | 'etymology' | 'pronunciation' | 'grammar-tip';\n  message: string;\n  teacher?: AIPersonality;\n}\n\n// \nconst ENGLISH_COMMON_MISTAKES: EnglishTrivia[] = [\n  {\n    type: 'common-mistake',\n    message:\n      '\"I\\'m exciting\"\"I\\'m excited\"ed',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'common-mistake',\n    message:\n      '\"I\\'m boring\"\"I\\'m bored\"',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'common-mistake',\n    message:\n      '\"funny\"\"fun\"\"funny\"\"fun\"',\n    teacher: 'analyst',\n  },\n  {\n    type: 'common-mistake',\n    message:\n      '\"advice\"\"an advice\"\"a piece of advice\"',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'common-mistake',\n    message: '\"How do you think?\"\"What do you think?\"',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'common-mistake',\n    message: '\"see a dream\"\"have a dream\"',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'common-mistake',\n    message:\n      '\"say\"\"tell\"...\"say\"\"tell\"\"tell me\"\"say me\"',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'common-mistake',\n    message: '\"enjoy\"-ing\"enjoy to study\"\"enjoy studying\"',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'common-mistake',\n    message:\n      '\"remember to do\"\"remember doing\"',\n    teacher: 'analyst',\n  },\n  {\n    type: 'common-mistake',\n    message: '\"I\\'m agree\"\"agree\"\"I agree\"',\n    teacher: 'drill-sergeant',\n  },\n];\n\n// \nconst ENGLISH_FUN_FACTS: EnglishTrivia[] = [\n  {\n    type: 'fun-fact',\n    message:\n      '\"re-\"returnreviewrepeat',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '',\n    teacher: 'analyst',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"however\"\"therefore\"\"moreover\"',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"-tion\"educateeducationcommunicatecommunication',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"compare A with B\"AB\"compare A to B\"AB',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      'important=significant=crucialshow=demonstrate=illustrate ',\n    teacher: 'analyst',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"un-\"\"in-\"\"dis-\"unhappyimpossibledisagree',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'fun-fact',\n    message: '\"not only A but also B\"AB',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"although\"\"though\"though',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'fun-fact',\n    message:\n      '\"-able\"readablecomfortable',\n    teacher: 'enthusiastic-coach',\n  },\n];\n\n// \nconst PRONUNCIATION_TIPS: EnglishTrivia[] = [\n  {\n    type: 'pronunciation',\n    message:\n      '2PRESentpreSENT',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      'record',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      'silent letterknifekdoubtbreceiptp',\n    teacher: 'analyst',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      '\"-ed\"3/t/walked/d/played/id/wanted',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      '\"-s\"3/s/cats/z/dogs/iz/buses',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      'PHOtographphoTOgraphyphotoGRAphic',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'pronunciation',\n    message:\n      '\"an apple\"\"\"\"\"',\n    teacher: 'analyst',\n  },\n];\n\n// \nconst CULTURAL_TIPS: EnglishTrivia[] = [\n  {\n    type: 'cultural',\n    message:\n      'IntroductionBodyConclusion3',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'cultural',\n    message:\n      '\"\"For example, For instance ',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'cultural',\n    message:\n      \"contractionsdon'tdo notit'sit is \",\n    teacher: 'analyst',\n  },\n  {\n    type: 'cultural',\n    message:\n      'I think, In my opinion, From my perspective ',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'cultural',\n    message:\n      '\"because\"\"since\"\"as\"\"due to\"',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'cultural',\n    message: '\"The experiment was conducted\"',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'cultural',\n    message:\n      '\"on the other hand\"\"in contrast\"',\n    teacher: 'wise-sage',\n  },\n];\n\n// \nconst ETYMOLOGY_TIPS: EnglishTrivia[] = [\n  {\n    type: 'etymology',\n    message:\n      '\"pre-\"previewpredictprepare',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"post-\"postponepostwarpre-',\n    teacher: 'analyst',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"tele-\"telephonetelevisiontelescope',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"bi-\"2bicyclebilingual2biweekly',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"auto-\"automaticautobiography',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"micro-\"\"macro-\"microscopemacroeconomics',\n    teacher: 'analyst',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"sub-\"subwaysubmarinesubtitle',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'etymology',\n    message:\n      '\"super-\"superiorsupernaturalsupervise',\n    teacher: 'wise-sage',\n  },\n];\n\n// \nconst GRAMMAR_TIPS: EnglishTrivia[] = [\n  {\n    type: 'grammar-tip',\n    message:\n      '\"a\"\"an\"\"an hour\"hourh',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'grammar-tip',\n    message:\n      '\"I have lost my key\"',\n    teacher: 'drill-sergeant',\n  },\n  {\n    type: 'grammar-tip',\n    message:\n      '\"fewer\"\"less\"\"fewer people\"\"less water\"',\n    teacher: 'analyst',\n  },\n  {\n    type: 'grammar-tip',\n    message:\n      '\"used to\"\"be used to\"\"get used to\"',\n    teacher: 'wise-sage',\n  },\n  {\n    type: 'grammar-tip',\n    message: '\"will\"\"be going to\"',\n    teacher: 'enthusiastic-coach',\n  },\n  {\n    type: 'grammar-tip',\n    message:\n      '\"some\"\"any\"someany\"Would you like some tea?\"some',\n    teacher: 'kind-teacher',\n  },\n  {\n    type: 'grammar-tip',\n    message: 's\"He go\"\"He goes\"',\n    teacher: 'drill-sergeant',\n  },\n];\n\n// \nconst ALL_TRIVIA: EnglishTrivia[] = [\n  ...ENGLISH_COMMON_MISTAKES,\n  ...ENGLISH_FUN_FACTS,\n  ...PRONUNCIATION_TIPS,\n  ...CULTURAL_TIPS,\n  ...ETYMOLOGY_TIPS,\n  ...GRAMMAR_TIPS,\n];\n\n// 5%\nexport function getRandomEnglishTrivia(): EnglishTrivia | null {\n  if (Math.random() > 0.05) {\n    return null;\n  }\n\n  return ALL_TRIVIA[Math.floor(Math.random() * ALL_TRIVIA.length)];\n}\n\n// \nexport function getTriviaByType(type: EnglishTrivia['type']): EnglishTrivia | null {\n  const filtered = ALL_TRIVIA.filter((t) => t.type === type);\n  if (filtered.length === 0) return null;\n\n  return filtered[Math.floor(Math.random() * filtered.length)];\n}\n\n// \nexport function getRelevantMistakeTip(isCorrect: boolean): string | null {\n  if (Math.random() > 0.08) return null; // 8%\n\n  if (isCorrect) {\n    // \n    const tips = [...ENGLISH_FUN_FACTS, ...ETYMOLOGY_TIPS, ...CULTURAL_TIPS];\n    const tip = tips[Math.floor(Math.random() * tips.length)];\n    return tip.message;\n  } else {\n    // \n    const tips = [...ENGLISH_COMMON_MISTAKES, ...GRAMMAR_TIPS];\n    const tip = tips[Math.floor(Math.random() * tips.length)];\n    return tip.message;\n  }\n}\n\n// \nexport function getBreatherTrivia(_personality?: unknown, currentWord?: string): string {\n  // \n  const isPhrase = currentWord && (currentWord.includes(' ') || currentWord.includes('-'));\n\n  const breathers = [\n    ' it, they, this',\n    ' ',\n    ' 1,0771,616885',\n    ' \"He said that he was tired\"',\n    ' ',\n    ' \"a/an\"\"the\"',\n    ' ',\n    ' 3',\n    ' \"as...as\"\"-er than\"\"the -est\"3',\n  ];\n\n  // \n  if (isPhrase) {\n    breathers.push(\n      ' '\n    );\n  }\n\n  return breathers[Math.floor(Math.random() * breathers.length)];\n}\n","import {\n  getTodayStats,\n  getTotalAnsweredCount,\n  getUniqueQuestionedWordsCount as _getUniqueQuestionedWordsCount,\n  getTotalMasteredWordsCount,\n  getRetentionRateWithAI,\n  getDetailedRetentionStats,\n  getGrammarRetentionRateWithAI,\n  getGrammarDetailedRetentionStats,\n  getMemorizationDetailedRetentionStats,\n  getGrammarUnitStatsWithTitles,\n  getDailyPlanInfo as _getDailyPlanInfo,\n  getWordDetailedData,\n  loadProgressSync,\n} from '../progressStorage';\nimport { useState, useEffect, useMemo, useRef } from 'react';\nimport { AIPersonality, CommentContext } from '../types';\nimport { generateTimeBasedGreeting } from '../timeBasedGreeting';\nimport { getTimeBasedTeacherChat, getSpecialDayChat } from '../teacherInteractions';\nimport { getBreatherTrivia } from '../englishTrivia';\nimport { generateAIComment, getTimeOfDay } from '../aiCommentGenerator';\n\ninterface ScoreBoardProps {\n  mode?: 'translation' | 'spelling' | 'reading' | 'grammar' | 'memorization'; // \n  currentScore?: number; // \n  totalAnswered?: number; // \n  sessionCorrect?: number; // \n  sessionIncorrect?: number; // \n  _sessionIncorrect?: number; // ()\n  sessionReview?: number; // \n  _sessionReview?: number; // ()\n  sessionMastered?: number; // \n  onReviewFocus?: () => void; // \n  isReviewFocusMode?: boolean; // \n  onShowSettings?: () => void; // \n  // \n  sessionStats?: {\n    correct: number;\n    incorrect: number;\n    review: number;\n    mastered: number;\n  };\n  currentWord?: string; // \n  onAnswerTime?: number; // ()\n  // AI\n  lastAnswerCorrect?: boolean; // \n  lastAnswerWord?: string; // \n  lastAnswerDifficulty?: string; // \n  correctStreak?: number; // \n  incorrectStreak?: number; // \n  // AI\n  learningPhase?: 'ENCODING' | 'INITIAL_CONSOLIDATION' | 'LONG_TERM_RETENTION' | 'MASTERED';\n  estimatedSpeed?: number; // \n  forgettingRate?: number; // \n  // \n  dataSource?: string; // \n  category?: string; // \n  difficulty?: string; // \n  wordPhraseFilter?: string; // \n  // \n  grammarUnit?: string; // : \"g1-unit0\"\n}\n\nfunction ScoreBoard({\n  mode = 'translation', // \n  currentScore = 0,\n  totalAnswered = 0,\n  sessionCorrect = 0,\n  _sessionIncorrect = 0,\n  _sessionReview = 0,\n  isReviewFocusMode = false,\n  onReviewFocus,\n  onShowSettings,\n  currentWord,\n  onAnswerTime,\n  lastAnswerCorrect,\n  lastAnswerWord,\n  lastAnswerDifficulty,\n  correctStreak = 0,\n  incorrectStreak = 0,\n  learningPhase,\n  estimatedSpeed,\n  forgettingRate,\n  dataSource = '',\n  category = '',\n  difficulty = '',\n  wordPhraseFilter = '',\n  grammarUnit,\n  sessionStats,\n}: ScoreBoardProps) {\n  const [activeTab, setActiveTab] = useState<'ai' | 'plan' | 'breakdown' | 'history' | 'settings'>(\n    'ai'\n  );\n\n  // \n  const [questionComment, setQuestionComment] = useState<string>(() => {\n    const personality = (localStorage.getItem('aiPersonality') || 'kind-teacher') as AIPersonality;\n    return generateTimeBasedGreeting(personality) || '';\n  });\n  const [answerComment, setAnswerComment] = useState<string>('');\n\n  // \n  useEffect(() => {\n    if (currentWord) {\n      const personality = (localStorage.getItem('aiPersonality') ||\n        'kind-teacher') as AIPersonality;\n      const wordData = getWordDetailedData(currentWord);\n\n      // \n      let comment = '';\n\n      if (wordData) {\n        const { totalCount, correctCount } = wordData;\n        const incorrectCount = totalCount - correctCount;\n        const accuracy = totalCount > 0 ? Math.round((correctCount / totalCount) * 100) : 0;\n\n        if (totalCount === 0) {\n          // \n          switch (personality) {\n            case 'drill-sergeant':\n              comment = '';\n              break;\n            case 'kind-teacher':\n              comment = '';\n              break;\n            case 'analyst':\n              comment = '';\n              break;\n            case 'enthusiastic-coach':\n              comment = '';\n              break;\n            case 'wise-sage':\n              comment = '';\n              break;\n            default:\n              comment = '';\n          }\n        } else if (totalCount === 1) {\n          // 2\n          const wasCorrect = correctCount === 1;\n          switch (personality) {\n            case 'drill-sergeant':\n              comment = wasCorrect\n                ? '2'\n                : '2';\n              break;\n            case 'kind-teacher':\n              comment = wasCorrect\n                ? '2'\n                : '2';\n              break;\n            case 'analyst':\n              comment = `2: ${wasCorrect ? '' : ''}`;\n              break;\n            case 'enthusiastic-coach':\n              comment = wasCorrect\n                ? '2'\n                : '2';\n              break;\n            case 'wise-sage':\n              comment = wasCorrect\n                ? '2'\n                : '2';\n              break;\n            default:\n              comment = '2';\n          }\n        } else {\n          // 3\n          switch (personality) {\n            case 'drill-sergeant':\n              if (accuracy >= 80) {\n                comment = `${totalCount}${accuracy}%`;\n              } else if (accuracy >= 50) {\n                comment = `${totalCount}${accuracy}%`;\n              } else {\n                comment = `${totalCount}${accuracy}%`;\n              }\n              break;\n            case 'kind-teacher':\n              if (accuracy >= 80) {\n                comment = `${totalCount}${accuracy}%`;\n              } else if (accuracy >= 50) {\n                comment = `${totalCount}${accuracy}%`;\n              } else {\n                comment = `${totalCount}${accuracy}%`;\n              }\n              break;\n            case 'analyst':\n              comment = `${totalCount}: ${accuracy}% (${correctCount}/${incorrectCount})`;\n              break;\n            case 'enthusiastic-coach':\n              if (accuracy >= 80) {\n                comment = `${totalCount}${accuracy}%`;\n              } else {\n                comment = `${totalCount}${accuracy}%`;\n              }\n              break;\n            case 'wise-sage':\n              if (accuracy >= 80) {\n                comment = `${totalCount}${accuracy}%`;\n              } else {\n                comment = `${totalCount}${accuracy}%`;\n              }\n              break;\n            default:\n              comment = `${totalCount}${accuracy}%`;\n          }\n        }\n      } else {\n        // \n        comment = '';\n      }\n\n      setQuestionComment(comment);\n      setAnswerComment('');\n    }\n  }, [currentWord]);\n\n  // AI\n  useEffect(() => {\n    // \n    if (lastAnswerCorrect === undefined || !lastAnswerWord) {\n      return;\n    }\n\n    // : \n    // \n    if (!currentWord || lastAnswerWord !== currentWord) {\n      return;\n    }\n\n    const personality = (localStorage.getItem('aiPersonality') || 'kind-teacher') as AIPersonality;\n\n    // \n    const todayStats = getTodayStats(mode || 'translation');\n    const todayQuestions = todayStats.todayTotalAnswered;\n    const todayAccuracy = todayStats.todayAccuracy;\n\n    // \n    const userAccuracy = totalAnswered > 0 ? ((sessionCorrect || 0) / totalAnswered) * 100 : 0;\n\n    // \n    const categoryAccuracy = userAccuracy; // \n\n    // AI\n    const context: CommentContext = {\n      isCorrect: lastAnswerCorrect,\n      word: lastAnswerWord,\n      difficulty: (lastAnswerDifficulty || difficulty || 'intermediate') as\n        | 'beginner'\n        | 'intermediate'\n        | 'advanced',\n      category: category || '',\n      attemptCount: 1, // 1\n      responseTime: 0, // \n      correctStreak: correctStreak,\n      incorrectStreak: incorrectStreak,\n      userAccuracy: userAccuracy,\n      categoryAccuracy: categoryAccuracy,\n      isWeakCategory: false, // \n      hasSeenBefore: false, // \n      previousAttempts: 0,\n      todayQuestions: todayQuestions,\n      todayAccuracy: todayAccuracy,\n      planProgress: 0,\n      timeOfDay: getTimeOfDay(),\n      learningPhase: learningPhase,\n      estimatedSpeed: estimatedSpeed,\n      forgettingRate: forgettingRate,\n    };\n\n    // AI\n    let comment = generateAIComment(personality, context);\n\n    // \n    if (Math.random() < 0.15) {\n      // 15%\n      const additionalMessages = [];\n\n      // 5%\n      if (Math.random() < 0.33) {\n        const trivia = getBreatherTrivia(personality, currentWord);\n        if (trivia) additionalMessages.push(trivia);\n      }\n      // 5%\n      else if (Math.random() < 0.5) {\n        const specialChat = getSpecialDayChat();\n        if (specialChat) additionalMessages.push(specialChat);\n      }\n      // 5%\n      else {\n        const teacherChat = getTimeBasedTeacherChat();\n        if (teacherChat) additionalMessages.push(teacherChat);\n      }\n\n      if (additionalMessages.length > 0) {\n        comment = `${comment}\\n\\n${additionalMessages[0]}`;\n      }\n    }\n\n    setAnswerComment(comment);\n  }, [\n    onAnswerTime,\n    lastAnswerCorrect,\n    lastAnswerWord,\n    lastAnswerDifficulty,\n    correctStreak,\n    incorrectStreak,\n    mode,\n    totalAnswered,\n    sessionCorrect,\n    category,\n    difficulty,\n  ]);\n\n  // Progress bar refs\n  const masteredRef = useRef<HTMLDivElement>(null);\n  const learningRef = useRef<HTMLDivElement>(null);\n  const strugglingRef = useRef<HTMLDivElement>(null);\n\n  // \n  const [learningLimit, setLearningLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem(`learning-limit-${mode}`);\n    return saved ? parseInt(saved) : null;\n  });\n\n  const [reviewLimit, setReviewLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem(`review-limit-${mode}`);\n    return saved ? parseInt(saved) : null;\n  });\n\n  // \n  const [stillLearningLimit, setStillLearningLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem('memorization-still-learning-limit');\n    return saved ? parseInt(saved) : null;\n  });\n\n  const [incorrectLimit, setIncorrectLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem('memorization-incorrect-limit');\n    return saved ? parseInt(saved) : null;\n  });\n\n  const [showPlanSettings, setShowPlanSettings] = useState(false);\n\n  // : \n  useEffect(() => {\n    if (\n      (mode === 'translation' || mode === 'spelling' || mode === 'grammar') &&\n      sessionStats &&\n      onReviewFocus\n    ) {\n      const { incorrect, review } = sessionStats;\n      const totalNeedReview = incorrect + review;\n\n      if (\n        (learningLimit !== null && totalNeedReview >= learningLimit) ||\n        (reviewLimit !== null && review >= reviewLimit)\n      ) {\n        if (!isReviewFocusMode) {\n          onReviewFocus();\n        }\n      }\n    }\n  }, [sessionStats, learningLimit, reviewLimit, isReviewFocusMode, mode, onReviewFocus]);\n\n  // state\n  const [retentionData, setRetentionData] = useState(() => {\n    if (mode === 'grammar') {\n      const { retentionRate, appearedCount } = getGrammarRetentionRateWithAI();\n      return { retentionRate, appearedCount };\n    } else {\n      const { retentionRate, appearedCount } = getRetentionRateWithAI();\n      return { retentionRate, appearedCount };\n    }\n  });\n\n  const [detailedStatsData, setDetailedStatsData] = useState(() => {\n    if (mode === 'grammar') {\n      return getGrammarDetailedRetentionStats();\n    } else if (mode === 'memorization') {\n      return getMemorizationDetailedRetentionStats();\n    } else {\n      return getDetailedRetentionStats();\n    }\n  });\n\n  // \n  const [currentWordData, setCurrentWordData] =\n    useState<ReturnType<typeof getWordDetailedData>>(null);\n\n  // \n  const attemptCounts = useMemo(() => {\n    const progress = loadProgressSync();\n    const wordProgress = progress.wordProgress || {};\n    const counts = {\n      once: 0,\n      twice: 0,\n      three: 0,\n      four: 0,\n      five: 0,\n      sixOrMore: 0,\n    };\n\n    Object.values(wordProgress).forEach((wp) => {\n      const attempts = wp.totalAttempts || 0;\n      if (attempts === 1) counts.once++;\n      else if (attempts === 2) counts.twice++;\n      else if (attempts === 3) counts.three++;\n      else if (attempts === 4) counts.four++;\n      else if (attempts === 5) counts.five++;\n      else if (attempts >= 6) counts.sixOrMore++;\n    });\n\n    return counts;\n  }, [onAnswerTime]);\n\n  // \n  const [grammarUnitStats, setGrammarUnitStats] = useState<\n    Awaited<ReturnType<typeof getGrammarUnitStatsWithTitles>>\n  >([]);\n\n  // \n  useEffect(() => {\n    if (mode === 'grammar') {\n      getGrammarUnitStatsWithTitles().then((stats) => {\n        // grammarUnit\n        if (grammarUnit) {\n          // grammarUnit: \"g1-unit0\"  1_Unit0 \n          // : g{}-unit{}  g{}-u{}\n          const match = grammarUnit.match(/g(\\d+)-(?:unit|u)(\\d+)/);\n          if (match) {\n            const targetUnit = `${match[1]}_Unit${match[2]}`;\n            const filtered = stats.filter((stat) => stat.unit === targetUnit);\n            setGrammarUnitStats(filtered);\n          } else {\n            setGrammarUnitStats(stats);\n          }\n        } else {\n          setGrammarUnitStats(stats);\n        }\n      });\n    }\n  }, [mode, onAnswerTime, grammarUnit]);\n\n  //  - onAnswerTime\n  useEffect(() => {\n    // onAnswerTime0\n    if (mode === 'grammar') {\n      const { retentionRate, appearedCount } = getGrammarRetentionRateWithAI();\n      setRetentionData({ retentionRate, appearedCount });\n      setDetailedStatsData(getGrammarDetailedRetentionStats());\n    } else if (mode === 'memorization') {\n      // \n      setDetailedStatsData(getMemorizationDetailedRetentionStats());\n      // retentionRate\n      const stats = getMemorizationDetailedRetentionStats();\n      setRetentionData({\n        retentionRate: stats.basicRetentionRate,\n        appearedCount: stats.appearedWords,\n      });\n    } else {\n      const { retentionRate, appearedCount } = getRetentionRateWithAI();\n      setRetentionData({ retentionRate, appearedCount });\n      setDetailedStatsData(getDetailedRetentionStats());\n    }\n  }, [onAnswerTime, mode]); // \n\n  // : \n  useEffect(() => {\n    if (currentWord) {\n      setCurrentWordData(getWordDetailedData(currentWord));\n    } else {\n      setCurrentWordData(null);\n    }\n  }, [currentWord, onAnswerTime]); // currentWordonAnswerTime\n\n  // Update progress bar widths using CSS variables and data attributes\n  useEffect(() => {\n    if (masteredRef.current) {\n      const masteredWidth = Math.round(detailedStatsData.masteredPercentage);\n      masteredRef.current.style.setProperty('--segment-width', String(masteredWidth));\n      masteredRef.current.setAttribute('data-width', String(masteredWidth));\n    }\n    if (learningRef.current) {\n      const learningWidth = Math.round(detailedStatsData.learningPercentage);\n      learningRef.current.style.setProperty('--segment-width', String(learningWidth));\n      learningRef.current.setAttribute('data-width', String(learningWidth));\n    }\n    if (strugglingRef.current) {\n      const strugglingWidth = Math.round(detailedStatsData.strugglingPercentage);\n      strugglingRef.current.style.setProperty('--segment-width', String(strugglingWidth));\n      strugglingRef.current.setAttribute('data-width', String(strugglingWidth));\n    }\n  }, [detailedStatsData, activeTab, mode]); // mode\n\n  //  - mode\n  const { todayAccuracy: _todayAccuracy, todayTotalAnswered: _todayTotalAnswered } = useMemo(\n    () => getTodayStats(mode),\n    [mode]\n  );\n\n  //  - mode\n  const _totalAnsweredCount = useMemo(() => getTotalAnsweredCount(mode), [mode]);\n\n  // \n  const _masteredCount = useMemo(() => getTotalMasteredWordsCount(), []);\n\n  // state\n  const { retentionRate: _retentionRate } = retentionData;\n\n  // state\n  const detailedStats = detailedStatsData;\n\n  // \n  const _currentAccuracy = useMemo(\n    () => (totalAnswered > 0 ? Math.round((currentScore / totalAnswered) * 100) : 0),\n    [currentScore, totalAnswered]\n  );\n\n  // AI- \n  const _tabs: Array<'ai' | 'plan' | 'breakdown' | 'history' | 'settings'> = [\n    'ai',\n    'plan',\n    'breakdown',\n    'history',\n    'settings',\n  ];\n\n  return (\n    <div className=\"score-board-compact\">\n      {/* : Tailwind  */}\n      <div className=\"score-board-tabs grid grid-cols-3 sm:grid-cols-5 gap-1 sm:gap-2\">\n        <button\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'ai'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n          onClick={() => setActiveTab('ai')}\n          title=\"AI\"\n        >\n          <span className=\"hidden sm:inline\"> AI</span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'plan'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n          onClick={() => setActiveTab('plan')}\n          title=\"\"\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'breakdown'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n          onClick={() => setActiveTab('breakdown')}\n          title=\"\"\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'history'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n          onClick={() => setActiveTab('history')}\n          title=\"\"\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'settings'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n          onClick={() => {\n            if (onShowSettings) {\n              onShowSettings();\n            } else {\n              setActiveTab('settings');\n            }\n          }}\n          title=\"\"\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n      </div>\n\n      {/* AI */}\n      {activeTab === 'ai' && (\n        <div className=\"score-board-content\">\n          <div className=\"bg-white rounded-lg p-3 shadow-md border border-gray-200\">\n            <div className=\"ai-comment-container\">\n              <div className=\"flex items-center gap-2 w-full\">\n                <div className=\"text-2xl flex-shrink-0\">\n                  {(() => {\n                    const personality = (localStorage.getItem('aiPersonality') ||\n                      'kind-teacher') as AIPersonality;\n                    const avatars = {\n                      'kind-teacher': '',\n                      'drill-sergeant': '',\n                      'enthusiastic-coach': '',\n                      analyst: '',\n                      'wise-sage': '',\n                    };\n                    return avatars[personality] || '';\n                  })()}\n                </div>\n                <div className=\"flex-1 min-w-0\">\n                  <div className=\"text-sm text-gray-700 leading-snug break-words\">\n                    {(answerComment || questionComment)\n                      .replace(/^[]+?/gu, '')\n                      .replace(/$/gu, '')\n                      .replace(/[]/gu, '')\n                      .trim()}\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      {activeTab === 'plan' && (\n        <div className=\"score-board-content\">\n          <div className=\"bg-white rounded-lg p-3 shadow-md border border-gray-200\">\n            {/*  */}\n            <div className=\"plan-text-line\">\n              <span className=\"stat-text-label\"> {dataSource || ''}</span>\n              <span className=\"stat-text-divider\"></span>\n              <span className=\"stat-text-label\">{category || ''}</span>\n              <span className=\"stat-text-divider\"></span>\n              <span className=\"stat-text-label\">\n                {difficulty === 'all'\n                  ? ''\n                  : difficulty === 'basic'\n                    ? ''\n                    : difficulty === 'standard'\n                      ? ''\n                      : difficulty === 'advanced'\n                        ? ''\n                        : difficulty}\n              </span>\n              {(mode === 'translation' || mode === 'spelling' || mode === 'memorization') && (\n                <>\n                  <span className=\"stat-text-divider\"></span>\n                  <button\n                    onClick={() => setShowPlanSettings(true)}\n                    className=\"stat-text-label cursor-pointer hover:text-primary transition-colors\"\n                    title=\"\"\n                  >\n                     \n                  </button>\n                </>\n              )}\n              {wordPhraseFilter && (\n                <>\n                  <span className=\"stat-text-divider\"></span>\n                  <span className=\"stat-text-label\">\n                    {wordPhraseFilter === 'all'\n                      ? ''\n                      : wordPhraseFilter === 'word'\n                        ? ''\n                        : wordPhraseFilter === 'phrase'\n                          ? ''\n                          : ''}\n                  </span>\n                </>\n              )}\n            </div>\n            {showPlanSettings && (mode === 'translation' || mode === 'spelling') && (\n              <div className=\"plan-settings-modal\">\n                <div className=\"plan-settings-content\">\n                  <h4> </h4>\n                  <p className=\"plan-settings-description\">0</p>\n                  <div className=\"plan-setting-item\">\n                    <label>:</label>\n                    <select\n                      aria-label=\"\"\n                      value={learningLimit || 0}\n                      onChange={(e) => {\n                        const value = parseInt(e.target.value);\n                        const finalValue = value === 0 ? null : value;\n                        setLearningLimit(finalValue);\n                        if (finalValue === null) {\n                          localStorage.removeItem(`learning-limit-${mode}`);\n                        } else {\n                          localStorage.setItem(`learning-limit-${mode}`, finalValue.toString());\n                        }\n                      }}\n                      className=\"select-input\"\n                    >\n                      <option value={0}></option>\n                      <option value={5}>5</option>\n                      <option value={10}>10</option>\n                      <option value={20}>20</option>\n                      <option value={30}>30</option>\n                      <option value={50}>50</option>\n                      <option value={100}>100</option>\n                      <option value={150}>150</option>\n                      <option value={200}>200</option>\n                    </select>\n                    <p className=\"setting-help\"></p>\n                  </div>\n                  <div className=\"plan-setting-item\">\n                    <label>:</label>\n                    <select\n                      aria-label=\"\"\n                      value={reviewLimit || 0}\n                      onChange={(e) => {\n                        const value = parseInt(e.target.value);\n                        const finalValue = value === 0 ? null : value;\n                        setReviewLimit(finalValue);\n                        if (finalValue === null) {\n                          localStorage.removeItem(`review-limit-${mode}`);\n                        } else {\n                          localStorage.setItem(`review-limit-${mode}`, finalValue.toString());\n                        }\n                      }}\n                      className=\"select-input\"\n                    >\n                      <option value={0}></option>\n                      <option value={5}>5</option>\n                      <option value={10}>10</option>\n                      <option value={20}>20</option>\n                      <option value={30}>30</option>\n                      <option value={50}>50</option>\n                      <option value={100}>100</option>\n                      <option value={150}>150</option>\n                      <option value={200}>200</option>\n                    </select>\n                    <p className=\"setting-help\"></p>\n                  </div>\n                  <button\n                    className=\"plan-settings-close\"\n                    onClick={() => setShowPlanSettings(false)}\n                  >\n                    \n                  </button>\n                </div>\n              </div>\n            )}\n            {showPlanSettings && mode === 'memorization' && (\n              <div className=\"plan-settings-modal\">\n                <div className=\"plan-settings-content\">\n                  <h4> </h4>\n                  <p className=\"plan-settings-description\">0</p>\n                  <div className=\"plan-setting-item\">\n                    <label>:</label>\n                    <select\n                      aria-label=\"\"\n                      value={stillLearningLimit || 0}\n                      onChange={(e) => {\n                        const value = parseInt(e.target.value);\n                        const finalValue = value === 0 ? null : value;\n                        setStillLearningLimit(finalValue);\n                        if (finalValue === null) {\n                          localStorage.removeItem('memorization-still-learning-limit');\n                        } else {\n                          localStorage.setItem(\n                            'memorization-still-learning-limit',\n                            finalValue.toString()\n                          );\n                        }\n                      }}\n                      className=\"select-input\"\n                    >\n                      <option value={0}></option>\n                      <option value={5}>5</option>\n                      <option value={10}>10</option>\n                      <option value={20}>20</option>\n                      <option value={30}>30</option>\n                      <option value={50}>50</option>\n                      <option value={100}>100</option>\n                      <option value={150}>150</option>\n                      <option value={200}>200</option>\n                    </select>\n                    <p className=\"setting-help\"></p>\n                  </div>\n                  <div className=\"plan-setting-item\">\n                    <label>:</label>\n                    <select\n                      aria-label=\"\"\n                      value={incorrectLimit || 0}\n                      onChange={(e) => {\n                        const value = parseInt(e.target.value);\n                        const finalValue = value === 0 ? null : value;\n                        setIncorrectLimit(finalValue);\n                        if (finalValue === null) {\n                          localStorage.removeItem('memorization-incorrect-limit');\n                        } else {\n                          localStorage.setItem(\n                            'memorization-incorrect-limit',\n                            finalValue.toString()\n                          );\n                        }\n                      }}\n                      className=\"select-input\"\n                    >\n                      <option value={0}></option>\n                      <option value={5}>5</option>\n                      <option value={10}>10</option>\n                      <option value={20}>20</option>\n                      <option value={30}>30</option>\n                      <option value={50}>50</option>\n                      <option value={100}>100</option>\n                      <option value={150}>150</option>\n                      <option value={200}>200</option>\n                    </select>\n                    <p className=\"setting-help\"></p>\n                  </div>\n                  <button\n                    className=\"plan-settings-close\"\n                    onClick={() => setShowPlanSettings(false)}\n                  >\n                    \n                  </button>\n                </div>\n              </div>\n            )}\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      {activeTab === 'breakdown' && (\n        <div className=\"score-board-content\">\n          <div className=\"bg-white rounded-lg p-3 shadow-md border border-gray-200\">\n            <div className=\"retention-breakdown-container\">\n              <div className=\"retention-breakdown-header\">\n                <div style={{ marginBottom: '8px', fontSize: '14px', color: '#666' }}>\n                  1 {attemptCounts.once} 2 {attemptCounts.twice} 3{' '}\n                  {attemptCounts.three} 4 {attemptCounts.four} 5 {attemptCounts.five}\n                  6 {attemptCounts.sixOrMore}\n                </div>\n                {detailedStats.appearedWords > 0 ? (\n                  <div className=\"retention-subtitle\">\n                    {mode === 'memorization' ? (\n                      <>\n                        {detailedStats.appearedWords} {' '}\n                        {detailedStats.masteredCount}  {detailedStats.learningCount}\n                         {detailedStats.strugglingCount}\n                        {onReviewFocus && (\n                          <span\n                            className={`review-mode-icon ${isReviewFocusMode ? 'active' : ''}`}\n                            onClick={onReviewFocus}\n                            title={isReviewFocusMode ? '' : ''}\n                          >\n                            \n                          </span>\n                        )}\n                      </>\n                    ) : mode === 'grammar' ? (\n                      <>\n                        {detailedStats.appearedWords}  {detailedStats.masteredCount}\n                         {detailedStats.learningCount} {' '}\n                        {detailedStats.strugglingCount}\n                        {onReviewFocus && (\n                          <span\n                            className={`review-mode-icon ${isReviewFocusMode ? 'active' : ''}`}\n                            onClick={onReviewFocus}\n                            title={isReviewFocusMode ? '' : ''}\n                          >\n                            \n                          </span>\n                        )}\n                      </>\n                    ) : (\n                      <>\n                        {detailedStats.appearedWords}  {detailedStats.masteredCount}\n                         {detailedStats.learningCount} {' '}\n                        {detailedStats.strugglingCount}\n                        {(mode === 'translation' || mode === 'spelling') && onReviewFocus && (\n                          <span\n                            className={`review-mode-icon ${isReviewFocusMode ? 'active' : ''}`}\n                            onClick={onReviewFocus}\n                            title={isReviewFocusMode ? '' : ''}\n                          >\n                            \n                          </span>\n                        )}\n                      </>\n                    )}\n                  </div>\n                ) : (\n                  <div className=\"retention-subtitle\">\n                    {mode === 'memorization'\n                      ? ''\n                      : ''}\n                  </div>\n                )}\n              </div>\n              {detailedStats.appearedWords > 0 && (\n                <>\n                  <div className=\"retention-progress-bar\">\n                    {mode === 'memorization' ? (\n                      <>\n                        {/* : //3 */}\n                        {detailedStats.masteredPercentage > 0 && (\n                          <div\n                            ref={masteredRef}\n                            className=\"retention-segment retention-mastered\"\n                            data-width={Math.round(detailedStats.masteredPercentage)}\n                            title={` : ${detailedStats.masteredCount} (${Math.round(detailedStats.masteredPercentage)}%)`}\n                          >\n                            {detailedStats.masteredPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.masteredPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                        {detailedStats.learningCount > 0 && (\n                          <div\n                            ref={learningRef}\n                            className=\"retention-segment retention-learning\"\n                            data-width={Math.round(detailedStats.learningPercentage)}\n                            title={` : ${detailedStats.learningCount} (${Math.round(detailedStats.learningPercentage)}%)`}\n                          >\n                            {detailedStats.learningPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.learningPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                        {detailedStats.strugglingCount > 0 && (\n                          <div\n                            ref={strugglingRef}\n                            className=\"retention-segment retention-struggling\"\n                            data-width={Math.round(detailedStats.strugglingPercentage)}\n                            title={` : ${detailedStats.strugglingCount} (${Math.round(detailedStats.strugglingPercentage)}%)`}\n                          >\n                            {detailedStats.strugglingPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.strugglingPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                      </>\n                    ) : (\n                      <>\n                        {/* : // */}\n                        {detailedStats.masteredPercentage > 0 && (\n                          <div\n                            ref={masteredRef}\n                            className=\"retention-segment retention-mastered\"\n                            data-width={Math.round(detailedStats.masteredPercentage)}\n                            title={` : ${detailedStats.masteredCount} (${Math.round(detailedStats.masteredPercentage)}%)`}\n                          >\n                            {detailedStats.masteredPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.masteredPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                        {detailedStats.learningPercentage > 0 && (\n                          <div\n                            ref={learningRef}\n                            className=\"retention-segment retention-learning\"\n                            data-width={Math.round(detailedStats.learningPercentage)}\n                            title={` : ${detailedStats.learningCount} (${Math.round(detailedStats.learningPercentage)}%)`}\n                          >\n                            {detailedStats.learningPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.learningPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                        {detailedStats.strugglingPercentage > 0 && (\n                          <div\n                            ref={strugglingRef}\n                            className=\"retention-segment retention-struggling\"\n                            data-width={Math.round(detailedStats.strugglingPercentage)}\n                            title={` : ${detailedStats.strugglingCount} (${Math.round(detailedStats.strugglingPercentage)}%)`}\n                          >\n                            {detailedStats.strugglingPercentage >= 10 && (\n                              <span>{Math.round(detailedStats.strugglingPercentage)}%</span>\n                            )}\n                          </div>\n                        )}\n                      </>\n                    )}\n                  </div>\n                </>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      {activeTab === 'history' && (\n        <div className=\"score-board-content\">\n          <div className=\"bg-white rounded-lg p-3 shadow-md border border-gray-200\">\n            <div className=\"history-compact\">\n              {mode === 'grammar' ? (\n                <div className=\"word-detail-container\">\n                  {grammarUnitStats.length > 0 ? (\n                    <div className=\"grammar-units-list\">\n                      {grammarUnitStats.map((stat) => {\n                        const totalAttempts = (stat.correctCount || 0) + (stat.incorrectCount || 0);\n                        const masteredCount = stat.masteredCount || 0;\n                        const answeredQuestions = stat.answeredQuestions || 0;\n                        const retentionRate =\n                          answeredQuestions > 0\n                            ? Math.round((masteredCount / answeredQuestions) * 100)\n                            : 0;\n\n                        // \n                        const historyIcons = stat.historyIcons || '';\n\n                        // \n                        let statusIcon = '';\n                        let statusLabel = '';\n                        if (masteredCount === 0 && answeredQuestions > 0) {\n                          statusIcon = '';\n                          statusLabel = '';\n                        } else if (retentionRate < 80 && answeredQuestions > 0) {\n                          statusIcon = '';\n                          statusLabel = '';\n                        }\n\n                        // unit1_Unit0_1 Unit0\n                        const gradeMatch = stat.unit.match(/(\\d+)/);\n                        const gradeDisplay = gradeMatch ? `${gradeMatch[1]}` : stat.unit;\n                        const unitMatch = stat.unit.match(/Unit(\\d+)/);\n                        const unitDisplay = unitMatch ? `Unit${unitMatch[1]}` : '';\n                        const planDisplay = unitDisplay\n                          ? `${gradeDisplay} ${unitDisplay}${stat.title}`\n                          : `${gradeDisplay}${stat.title}`;\n\n                        return (\n                          <div key={stat.unit} className=\"grammar-unit-card\">\n                            <div className=\"word-detail-title\">\n                               {planDisplay} \n                              <span className=\"word-status-badge\">\n                                {statusIcon} {statusLabel}\n                              </span>\n                            </div>\n                            <div className=\"word-detail-stats\">\n                              <span className=\"word-stat-label\">:</span>\n                              <strong className=\"word-stat-value\">\n                                {stat.correctCount}/{totalAttempts}\n                              </strong>\n                              <span className=\"word-stat-divider\"></span>\n                              {historyIcons && (\n                                <>\n                                  <span className=\"word-stat-label\">:</span>\n                                  <span className=\"word-history-icons\">{historyIcons}</span>\n                                  <span className=\"word-stat-divider\"></span>\n                                </>\n                              )}\n                              <span className=\"word-stat-label\">:</span>\n                              <strong className=\"word-stat-value word-retention-rate\">\n                                {retentionRate}%\n                              </strong>\n                            </div>\n                          </div>\n                        );\n                      })}\n                    </div>\n                  ) : (\n                    <div className=\"word-detail-empty\">\n                      <p></p>\n                      <p className=\"stat-text-sub\"></p>\n                    </div>\n                  )}\n                </div>\n              ) : currentWord && currentWordData ? (\n                <div className=\"word-detail-container\">\n                  <div className=\"word-detail-title\">\n                     {currentWord} \n                    <span className=\"word-status-badge\">\n                      {currentWordData.statusIcon} {currentWordData.statusLabel}\n                    </span>\n                  </div>\n                  <div className=\"word-detail-stats\">\n                    <span className=\"word-stat-label\">:</span>\n                    <strong className=\"word-stat-value\">\n                      {currentWordData.correctCount}/{currentWordData.totalCount}\n                    </strong>\n                    <span className=\"word-stat-divider\"></span>\n                    {currentWordData.accuracyHistory &&\n                      currentWordData.accuracyHistory.length > 0 && (\n                        <>\n                          <span className=\"word-stat-label\">:</span>\n                          <span className=\"word-history-icons\">\n                            {currentWordData.accuracyHistory}\n                          </span>\n                          <span className=\"word-stat-divider\"></span>\n                        </>\n                      )}\n                    <span className=\"word-stat-label\">:</span>\n                    <strong className=\"word-stat-value word-retention-rate\">\n                      {currentWordData.retentionRate}%\n                    </strong>\n                  </div>\n                </div>\n              ) : currentWord && !currentWordData ? (\n                <div className=\"word-detail-empty\">\n                  <p></p>\n                </div>\n              ) : (\n                <div className=\"word-detail-empty\">\n                  <p></p>\n                </div>\n              )}\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      {activeTab === 'settings' && (\n        <div className=\"score-board-content\">\n          <div className=\"bg-white rounded-lg p-3 shadow-md border border-gray-200\">\n            <div className=\"settings-tab-container\">\n              <div className=\"word-detail-empty\">\n                <p></p>\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\nexport default ScoreBoard;\n","/**\n * \n * \n */\n\nimport { loadProgressSync, getTotalMasteredWordsCount } from '@/storage/progress/progressStorage';\n\n/**\n * \n */\nexport interface GoalLevel {\n  id: string;\n  name: string;\n  requiredWords: number; // \n  requiredAccuracy: number; // %\n  description: string;\n  icon: string;\n}\n\n/**\n * \n */\nexport const GOAL_LEVELS: GoalLevel[] = [\n  {\n    id: 'beginner-basic',\n    name: '',\n    requiredWords: 600,\n    requiredAccuracy: 70,\n    description: '',\n    icon: '',\n  },\n  {\n    id: 'beginner-complete',\n    name: '',\n    requiredWords: 1077,\n    requiredAccuracy: 70,\n    description: '',\n    icon: '',\n  },\n  {\n    id: 'intermediate-half',\n    name: '',\n    requiredWords: 1900,\n    requiredAccuracy: 75,\n    description: '50%',\n    icon: '',\n  },\n  {\n    id: 'intermediate-complete',\n    name: '',\n    requiredWords: 2693,\n    requiredAccuracy: 75,\n    description: '',\n    icon: '',\n  },\n  {\n    id: 'advanced-half',\n    name: '',\n    requiredWords: 3150,\n    requiredAccuracy: 80,\n    description: '50%',\n    icon: '',\n  },\n  {\n    id: 'advanced-complete',\n    name: '',\n    requiredWords: 3578,\n    requiredAccuracy: 80,\n    description: '',\n    icon: '',\n  },\n  {\n    id: 'master',\n    name: '',\n    requiredWords: 4000,\n    requiredAccuracy: 85,\n    description: '',\n    icon: '',\n  },\n];\n\n/**\n * \n */\nexport interface GoalProgress {\n  goal: GoalLevel;\n  currentWords: number; // \n  currentAccuracy: number; // \n  wordsProgress: number; // 0-100\n  accuracyProgress: number; // 0-100\n  overallProgress: number; // 0-100\n  isAchieved: boolean; // \n  estimatedDaysToAchieve: number; // \n  recommendedDailyWords: number; // 1\n}\n\n/**\n * \n */\nexport function getCurrentGoal(): GoalLevel {\n  const saved = localStorage.getItem('user-goal-level');\n  if (saved) {\n    const goalId = JSON.parse(saved);\n    const goal = GOAL_LEVELS.find((g) => g.id === goalId);\n    if (goal) return goal;\n  }\n  // \n  return GOAL_LEVELS.find((g) => g.id === 'intermediate-complete') || GOAL_LEVELS[0];\n}\n\n/**\n * \n */\nexport function setCurrentGoal(goalId: string): void {\n  localStorage.setItem('user-goal-level', JSON.stringify(goalId));\n}\n\n/**\n * \n */\nexport function calculateGoalProgress(goal?: GoalLevel): GoalProgress {\n  const targetGoal = goal || getCurrentGoal();\n  const progress = loadProgressSync();\n\n  // \n  const currentWords = getTotalMasteredWordsCount();\n\n  // \n  let totalCorrect = 0;\n  let totalAnswered = 0;\n\n  Object.values(progress.wordProgress).forEach((wp) => {\n    totalCorrect += wp.correctCount;\n    totalAnswered += wp.correctCount + wp.incorrectCount;\n  });\n\n  const currentAccuracy = totalAnswered > 0 ? (totalCorrect / totalAnswered) * 100 : 0;\n\n  // \n  const wordsProgress = Math.min(100, (currentWords / targetGoal.requiredWords) * 100);\n  const accuracyProgress = Math.min(100, (currentAccuracy / targetGoal.requiredAccuracy) * 100);\n  const overallProgress = (wordsProgress + accuracyProgress) / 2;\n\n  // \n  const isAchieved =\n    currentWords >= targetGoal.requiredWords && currentAccuracy >= targetGoal.requiredAccuracy;\n\n  // \n  const estimatedDaysToAchieve = calculateEstimatedDays(\n    currentWords,\n    targetGoal.requiredWords,\n    currentAccuracy,\n    targetGoal.requiredAccuracy\n  );\n\n  // 1\n  const remainingWords = Math.max(0, targetGoal.requiredWords - currentWords);\n  const recommendedDailyWords =\n    estimatedDaysToAchieve > 0 ? Math.ceil(remainingWords / estimatedDaysToAchieve) : 0;\n\n  return {\n    goal: targetGoal,\n    currentWords,\n    currentAccuracy: Math.round(currentAccuracy),\n    wordsProgress: Math.round(wordsProgress),\n    accuracyProgress: Math.round(accuracyProgress),\n    overallProgress: Math.round(overallProgress),\n    isAchieved,\n    estimatedDaysToAchieve,\n    recommendedDailyWords: Math.min(50, recommendedDailyWords), // 50/\n  };\n}\n\n/**\n * \n */\nfunction calculateEstimatedDays(\n  currentWords: number,\n  requiredWords: number,\n  currentAccuracy: number,\n  requiredAccuracy: number\n): number {\n  if (currentWords >= requiredWords && currentAccuracy >= requiredAccuracy) {\n    return 0; // \n  }\n\n  const progress = loadProgressSync();\n\n  // 7\n  const now = Date.now();\n  const sevenDaysAgo = now - 7 * 24 * 60 * 60 * 1000;\n\n  let recentMastered = 0;\n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.lastStudied >= sevenDaysAgo && wp.masteryLevel === 'mastered') {\n      recentMastered++;\n    }\n  });\n\n  const dailyMasteryRate = recentMastered / 7;\n\n  // \n  const effectiveDailyRate = Math.max(5, dailyMasteryRate);\n\n  // \n  const remainingWords = Math.max(0, requiredWords - currentWords);\n\n  // \n  const daysForWords = remainingWords / effectiveDailyRate;\n\n  // \n  const accuracyGap = Math.max(0, requiredAccuracy - currentAccuracy);\n  const daysForAccuracy = accuracyGap * 2; // 1%2\n\n  // \n  const totalDays = Math.ceil(daysForWords + daysForAccuracy);\n\n  return Math.max(1, totalDays);\n}\n\n/**\n * \n */\nexport function getAllGoalProgress(): GoalProgress[] {\n  return GOAL_LEVELS.map((goal) => calculateGoalProgress(goal));\n}\n\n/**\n * \n */\nexport function getNextAchievableGoal(): GoalLevel | null {\n  const allProgress = getAllGoalProgress();\n\n  // \n  const unachieved = allProgress\n    .filter((p) => !p.isAchieved)\n    .sort((a, b) => b.overallProgress - a.overallProgress);\n\n  return unachieved.length > 0 ? unachieved[0].goal : null;\n}\n\n/**\n * \n */\nexport function generateGoalMessage(includeEncouragement: boolean = true): string {\n  const goalProgress = calculateGoalProgress();\n\n  if (goalProgress.isAchieved) {\n    return ` ${goalProgress.goal.name}`;\n  }\n\n  const messages: string[] = [];\n\n  // \n  messages.push(\n    `${goalProgress.goal.icon} ${goalProgress.goal.name} ${goalProgress.overallProgress}%`\n  );\n\n  // \n  if (goalProgress.currentWords < goalProgress.goal.requiredWords) {\n    const remaining = goalProgress.goal.requiredWords - goalProgress.currentWords;\n    messages.push(`${remaining}`);\n  }\n\n  if (goalProgress.estimatedDaysToAchieve > 0) {\n    if (goalProgress.estimatedDaysToAchieve <= 7) {\n      messages.push(`${goalProgress.estimatedDaysToAchieve}`);\n    } else if (goalProgress.estimatedDaysToAchieve <= 30) {\n      messages.push(`${Math.ceil(goalProgress.estimatedDaysToAchieve / 7)}`);\n    } else {\n      messages.push(`${Math.ceil(goalProgress.estimatedDaysToAchieve / 30)}`);\n    }\n  }\n\n  // \n  if (includeEncouragement) {\n    if (goalProgress.overallProgress >= 80) {\n      messages.push('');\n    } else if (goalProgress.overallProgress >= 50) {\n      messages.push('');\n    } else if (goalProgress.overallProgress >= 25) {\n      messages.push('');\n    }\n  }\n\n  return messages.join(' ');\n}\n\n/**\n * \n */\nexport function suggestRealisticGoal(): GoalLevel {\n  const progress = loadProgressSync();\n  const masteredCount = getTotalMasteredWordsCount();\n\n  // \n  const now = Date.now();\n  const thirtyDaysAgo = now - 30 * 24 * 60 * 60 * 1000;\n\n  let recentMastered = 0;\n  Object.values(progress.wordProgress).forEach((wp) => {\n    if (wp.lastStudied >= thirtyDaysAgo && wp.masteryLevel === 'mastered') {\n      recentMastered++;\n    }\n  });\n\n  const dailyRate = recentMastered / 30;\n  const weeklyRate = dailyRate * 7;\n\n  // 82\n  const achievableWords = masteredCount + weeklyRate * 8;\n\n  // \n  const suitableGoals = GOAL_LEVELS.filter(\n    (g) =>\n      g.requiredWords <= achievableWords * 1.2 && // \n      g.requiredWords >= masteredCount // \n  );\n\n  if (suitableGoals.length > 0) {\n    // \n    return suitableGoals[suitableGoals.length - 1];\n  }\n\n  // \n  return GOAL_LEVELS.reduce((closest, goal) => {\n    const currentDiff = Math.abs(goal.requiredWords - masteredCount);\n    const closestDiff = Math.abs(closest.requiredWords - masteredCount);\n    return currentDiff < closestDiff ? goal : closest;\n  });\n}\n","/**\n * AI\n * \n */\n\nimport { loadProgressSync, WordProgress } from '@/storage/progress/progressStorage';\nimport { Question } from '@/types';\n\n/**\n * \n */\nexport const CONFUSION_PAIRS: { [key: string]: string[] } = {\n  // \n  accept: ['except'],\n  except: ['accept'],\n  affect: ['effect'],\n  effect: ['affect'],\n  dessert: ['desert'],\n  desert: ['dessert'],\n  quiet: ['quite'],\n  quite: ['quiet'],\n  lose: ['loose'],\n  loose: ['lose'],\n  advice: ['advise'],\n  advise: ['advice'],\n  breath: ['breathe'],\n  breathe: ['breath'],\n  cloth: ['clothe', 'clothes'],\n  clothe: ['cloth', 'clothes'],\n  clothes: ['cloth', 'clothe'],\n\n  // \n  borrow: ['lend'],\n  lend: ['borrow'],\n  teach: ['learn'],\n  learn: ['teach'],\n  speak: ['talk', 'say', 'tell'],\n  talk: ['speak', 'say', 'tell'],\n  say: ['speak', 'talk', 'tell'],\n  tell: ['speak', 'talk', 'say'],\n  see: ['look', 'watch'],\n  look: ['see', 'watch'],\n  watch: ['see', 'look'],\n  hear: ['listen'],\n  listen: ['hear'],\n  bring: ['take'],\n  take: ['bring'],\n  come: ['go'],\n  go: ['come'],\n\n  // \n  in: ['on', 'at'],\n  on: ['in', 'at'],\n  at: ['in', 'on'],\n  for: ['to', 'of'],\n  to: ['for', 'of'],\n  of: ['for', 'to'],\n\n  // \n  already: ['all ready'],\n  'all ready': ['already'],\n  altogether: ['all together'],\n  'all together': ['altogether'],\n  everyday: ['every day'],\n  'every day': ['everyday'],\n};\n\n/**\n * \n */\nexport interface ConfusionGroup {\n  words: string[];\n  type: 'spelling' | 'meaning' | 'grammar';\n  description: string;\n  confusionScore: number; // 0-100\n  totalErrors: number; // \n  needsReview: boolean; // \n}\n\n/**\n * \n */\nexport function getConfusionPartners(word: string): string[] {\n  const lowerWord = word.toLowerCase();\n  return CONFUSION_PAIRS[lowerWord] || [];\n}\n\n/**\n * \n */\nexport function analyzeConfusionPatterns(): ConfusionGroup[] {\n  const progress = loadProgressSync();\n  const groups: ConfusionGroup[] = [];\n  const processedWords = new Set<string>();\n\n  // \n  Object.entries(progress.wordProgress).forEach(([word]) => {\n    if (processedWords.has(word.toLowerCase())) return;\n\n    const partners = getConfusionPartners(word);\n    if (partners.length === 0) return;\n\n    // \n    const groupWords = [word, ...partners].map((w) => w.toLowerCase());\n    const uniqueWords = Array.from(new Set(groupWords));\n\n    // \n    let totalErrors = 0;\n    let totalAttempts = 0;\n    const wordProgresses: WordProgress[] = [];\n\n    uniqueWords.forEach((w) => {\n      const wordProgress = progress.wordProgress[w];\n      if (wordProgress) {\n        totalErrors += wordProgress.incorrectCount;\n        totalAttempts += wordProgress.correctCount + wordProgress.incorrectCount;\n        wordProgresses.push(wordProgress);\n      }\n    });\n\n    //   \n    const errorRate = totalAttempts > 0 ? totalErrors / totalAttempts : 0;\n    const confusionScore = Math.min(100, errorRate * 100 * Math.log1p(totalAttempts));\n\n    // \n    let type: 'spelling' | 'meaning' | 'grammar' = 'spelling';\n    if (['speak', 'talk', 'say', 'tell', 'see', 'look', 'watch'].includes(word.toLowerCase())) {\n      type = 'meaning';\n    } else if (['in', 'on', 'at', 'for', 'to', 'of'].includes(word.toLowerCase())) {\n      type = 'grammar';\n    }\n\n    groups.push({\n      words: uniqueWords,\n      type,\n      description: getConfusionDescription(uniqueWords, type),\n      confusionScore: Math.round(confusionScore),\n      totalErrors,\n      needsReview: confusionScore > 30 || errorRate > 0.3,\n    });\n\n    // \n    uniqueWords.forEach((w) => processedWords.add(w));\n  });\n\n  // \n  return groups\n    .filter((g) => g.totalErrors > 0) // \n    .sort((a, b) => b.confusionScore - a.confusionScore);\n}\n\n/**\n * \n */\nfunction getConfusionDescription(words: string[], type: string): string {\n  if (type === 'spelling') {\n    return `: ${words.join(', ')}`;\n  } else if (type === 'meaning') {\n    return `: ${words.join(', ')}`;\n  } else {\n    return `: ${words.join(', ')}`;\n  }\n}\n\n/**\n * \n */\nexport function prioritizeConfusedWords(\n  questions: Question[],\n  maxConfusedWords: number = 10\n): Question[] {\n  const confusionGroups = analyzeConfusionPatterns();\n  const priorityWords = new Set<string>();\n\n  // \n  confusionGroups\n    .filter((g) => g.needsReview)\n    .slice(0, 3) // 3\n    .forEach((group) => {\n      group.words.forEach((word) => priorityWords.add(word));\n    });\n\n  // \n  const priorityQuestions = questions\n    .filter((q) => priorityWords.has(q.word.toLowerCase()))\n    .slice(0, maxConfusedWords);\n\n  const otherQuestions = questions.filter((q) => !priorityWords.has(q.word.toLowerCase()));\n\n  return [...priorityQuestions, ...otherQuestions];\n}\n\n/**\n * \n */\nexport function calculateGroupRetention(group: ConfusionGroup): {\n  groupRetention: number;\n  individualRetentions: { [word: string]: number };\n  variance: number; // \n} {\n  const progress = loadProgressSync();\n  const individualRetentions: { [word: string]: number } = {};\n  const retentions: number[] = [];\n\n  group.words.forEach((word) => {\n    const wp = progress.wordProgress[word];\n    if (wp) {\n      const totalAttempts = wp.correctCount + wp.incorrectCount;\n      const retention = totalAttempts > 0 ? (wp.correctCount / totalAttempts) * 100 : 0;\n      individualRetentions[word] = retention;\n      retentions.push(retention);\n    }\n  });\n\n  // \n  const groupRetention =\n    retentions.length > 0 ? retentions.reduce((sum, r) => sum + r, 0) / retentions.length : 0;\n\n  // \n  const variance =\n    retentions.length > 0\n      ? retentions.reduce((sum, r) => sum + Math.pow(r - groupRetention, 2), 0) / retentions.length\n      : 0;\n\n  return {\n    groupRetention: Math.round(groupRetention),\n    individualRetentions,\n    variance: Math.round(variance),\n  };\n}\n\n/**\n * \n */\nexport function generateConfusionAdvice(group: ConfusionGroup): string {\n  const retention = calculateGroupRetention(group);\n\n  if (retention.groupRetention < 50) {\n    return ` ${group.words.join(', ')} `;\n  } else if (retention.variance > 500) {\n    return ` ${group.words.join(', ')} `;\n  } else if (retention.groupRetention < 70) {\n    return ` ${group.words.join(', ')} `;\n  } else {\n    return ` ${group.words.join(', ')} `;\n  }\n}\n","/**\n * Web Speech API \n */\n\nimport { logger } from '@/utils/logger';\n\n/**\n * \n * : 'Tom: \"Hello, how are you?\"'  'Hello, how are you?'\n * @param text \n * @returns \n */\nexport function cleanDialogueText(text: string): string {\n  // : \": \"...\" \n  // 1: Speaker: \"text\"  text\n  // 2: Speaker: text  text\n\n  // \": \"...\" \n  const quotedPattern = /^[^:]+:\\s*[\"\"](.+?)[\"\"]$/;\n  const quotedMatch = text.match(quotedPattern);\n  if (quotedMatch) {\n    return quotedMatch[1].trim();\n  }\n\n  // \": text \n  const unquotedPattern = /^[^:]+:\\s*(.+)$/;\n  const unquotedMatch = text.match(unquotedPattern);\n  if (unquotedMatch) {\n    return unquotedMatch[1].trim();\n  }\n\n  // \n  return text;\n}\n\n/**\n * \n * @param text \n * @param options \n */\nexport function speakEnglish(\n  text: string,\n  options: {\n    rate?: number; //  (0.1 - 10, : 1)\n    pitch?: number; //  (0 - 2, : 1)\n    volume?: number; //  (0 - 1, : 1)\n    lang?: string; //  (: 'en-US')\n  } = {}\n): void {\n  // Web Speech API \n  if (!('speechSynthesis' in window)) {\n    logger.warn('Web Speech API');\n    return;\n  }\n\n  // \n  const cleanedText = cleanDialogueText(text);\n\n  // \n  // speaking/pending\n  if (window.speechSynthesis.speaking || window.speechSynthesis.pending) {\n    window.speechSynthesis.cancel();\n    // \n    setTimeout(() => {\n      startSpeech(cleanedText, options);\n    }, 50);\n    return;\n  }\n\n  startSpeech(cleanedText, options);\n}\n\n/**\n * \n */\nfunction startSpeech(\n  cleanedText: string,\n  options: {\n    rate?: number;\n    pitch?: number;\n    volume?: number;\n    lang?: string;\n  }\n): void {\n  // \n  const utterance = new SpeechSynthesisUtterance(cleanedText);\n\n  // localStorage\n  const savedRate = localStorage.getItem('speechRate');\n  const savedGender = localStorage.getItem('voiceGender');\n\n  // \n  utterance.lang = options.lang || 'en-US';\n  utterance.rate = options.rate || (savedRate ? parseFloat(savedRate) : 0.85);\n  utterance.pitch = options.pitch || 1.0;\n  utterance.volume = options.volume || 1.0;\n\n  //  - \n  const voices = window.speechSynthesis.getVoices();\n  const englishVoices = voices.filter((voice) => voice.lang.startsWith('en-'));\n\n  // \n  const highQualityVoices = [\n    'Google US English',\n    'Google UK English Female',\n    'Google UK English Male',\n    'Samantha', // macOS\n    'Alex', // macOS\n    'Microsoft Aria Online',\n    'Microsoft Guy Online',\n    'Karen', // macOS\n    'Daniel', // macOS\n  ];\n\n  if (savedGender === 'female') {\n    // \n    const femaleVoice =\n      englishVoices.find((v) => highQualityVoices.some((hq) => v.name.includes(hq))) ||\n      englishVoices.find(\n        (v) =>\n          v.name.toLowerCase().includes('female') ||\n          v.name.toLowerCase().includes('woman') ||\n          v.name.toLowerCase().includes('samantha') ||\n          v.name.toLowerCase().includes('karen') ||\n          v.name.toLowerCase().includes('aria')\n      );\n    if (femaleVoice) utterance.voice = femaleVoice;\n  } else if (savedGender === 'male') {\n    // \n    const maleVoice =\n      englishVoices.find((v) => highQualityVoices.some((hq) => v.name.includes(hq))) ||\n      englishVoices.find(\n        (v) =>\n          v.name.toLowerCase().includes('male') ||\n          v.name.toLowerCase().includes('man') ||\n          v.name.toLowerCase().includes('alex') ||\n          v.name.toLowerCase().includes('daniel') ||\n          v.name.toLowerCase().includes('guy')\n      );\n    if (maleVoice) utterance.voice = maleVoice;\n  } else {\n    // \n    const bestVoice = englishVoices.find((v) =>\n      highQualityVoices.some((hq) => v.name.includes(hq))\n    );\n    if (bestVoice) utterance.voice = bestVoice;\n  }\n\n  // \n  utterance.onerror = (event) => {\n    logger.error(':', event);\n  };\n\n  // \n  window.speechSynthesis.speak(utterance);\n}\n\n/**\n * \n */\nexport function isSpeechSynthesisSupported(): boolean {\n  return 'speechSynthesis' in window;\n}\n\n/**\n * \n */\nexport function stopSpeaking(): void {\n  if ('speechSynthesis' in window) {\n    window.speechSynthesis.cancel();\n  }\n}\n\n/**\n * \n */\nexport function pauseSpeaking(): void {\n  if ('speechSynthesis' in window && window.speechSynthesis.speaking) {\n    window.speechSynthesis.pause();\n  }\n}\n\n/**\n * \n */\nexport function resumeSpeaking(): void {\n  if ('speechSynthesis' in window && window.speechSynthesis.paused) {\n    window.speechSynthesis.resume();\n  }\n}\n\n/**\n * \n */\nexport function isSpeaking(): boolean {\n  return 'speechSynthesis' in window && window.speechSynthesis.speaking;\n}\n\n/**\n * \n */\nexport function isPaused(): boolean {\n  return 'speechSynthesis' in window && window.speechSynthesis.paused;\n}\n\n/**\n * \n */\nexport function getEnglishVoices(): SpeechSynthesisVoice[] {\n  if (!isSpeechSynthesisSupported()) {\n    return [];\n  }\n\n  const voices = window.speechSynthesis.getVoices();\n  return voices.filter((voice) => voice.lang.startsWith('en-'));\n}\n\n/**\n * \n * @param text \n * @param element \n */\nexport function speakWordWithFeedback(text: string, element?: HTMLElement): void {\n  // \n  speakEnglish(text);\n\n  // \n  if (element) {\n    element.classList.add('speaking');\n\n    // \n    setTimeout(() => {\n      element.classList.remove('speaking');\n    }, 600);\n  }\n}\n","import React, { useState } from 'react';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\n\ninterface AddToCustomButtonProps {\n  /** / */\n  word: CustomWord;\n  /**  */\n  sets: CustomQuestionSet[];\n  /**  */\n  onAddWord: (setId: string, word: CustomWord) => void;\n  /**  */\n  onRemoveWord: (setId: string, word: CustomWord) => void;\n  /**  */\n  onOpenManagement: () => void;\n  /**  */\n  size?: 'small' | 'medium' | 'large';\n  /**  */\n  variant?: 'icon' | 'text' | 'both';\n}\n\n/**\n * /\n */\nconst AddToCustomButton: React.FC<AddToCustomButtonProps> = ({\n  word,\n  sets,\n  onAddWord,\n  onRemoveWord,\n  onOpenManagement,\n  size = 'medium',\n  variant = 'icon',\n}) => {\n  const [showMenu, setShowMenu] = useState(false);\n\n  // \n  const containingSets = sets.filter((set) => set.words.some((w) => w.word === word.word));\n\n  const isInAnySet = containingSets.length > 0;\n\n  // \n  const sizeClasses = {\n    small: 'text-sm px-2 py-1',\n    medium: 'text-base px-3 py-1.5',\n    large: 'text-lg px-4 py-2',\n  };\n\n  const iconSizeClasses = {\n    small: 'text-base',\n    medium: 'text-lg',\n    large: 'text-xl',\n  };\n\n  const handleToggle = (e: React.MouseEvent) => {\n    e.stopPropagation();\n\n    if (sets.length === 0) {\n      // \n      onOpenManagement();\n      return;\n    }\n\n    if (sets.length === 1) {\n      // 1/\n      const set = sets[0];\n      if (isInAnySet) {\n        onRemoveWord(set.id, word);\n      } else {\n        onAddWord(set.id, word);\n      }\n    } else {\n      // \n      setShowMenu(!showMenu);\n    }\n  };\n\n  const handleSelectSet = (setId: string, isInSet: boolean) => {\n    if (isInSet) {\n      onRemoveWord(setId, word);\n    } else {\n      onAddWord(setId, word);\n    }\n  };\n\n  return (\n    <div className=\"relative inline-block\">\n      <button\n        onClick={handleToggle}\n        className={`\n          ${sizeClasses[size]}\n          ${\n            isInAnySet\n              ? 'bg-green-500 hover:bg-green-600 text-white'\n              : 'bg-blue-500 hover:bg-blue-600 text-white'\n          }\n          rounded-md font-medium transition-colors duration-200\n          flex items-center gap-1\n        `}\n        title={isInAnySet ? `${containingSets.length}` : ''}\n      >\n        <span className={iconSizeClasses[size]}>{isInAnySet ? '' : '+'}</span>\n        {variant !== 'icon' && <span>{isInAnySet ? '' : ''}</span>}\n      </button>\n\n      {/*  */}\n      {showMenu && (\n        <>\n          <div className=\"fixed inset-0 z-40\" onClick={() => setShowMenu(false)} />\n          <div className=\"absolute right-0 mt-2 w-64 bg-white rounded-lg shadow-xl border border-gray-200 z-50 max-h-80 overflow-y-auto\">\n            <div className=\"p-2 border-b border-gray-200\">\n              <p className=\"text-sm font-medium text-gray-700\"></p>\n            </div>\n            <div className=\"p-2\">\n              {sets.map((set) => {\n                const isInThisSet = set.words.some((w) => w.word === word.word);\n                return (\n                  <button\n                    key={set.id}\n                    onClick={() => {\n                      handleSelectSet(set.id, isInThisSet);\n                      setShowMenu(false);\n                    }}\n                    className={`\n                      w-full text-left px-3 py-2 rounded-md mb-1\n                      flex items-center justify-between\n                      ${\n                        isInThisSet\n                          ? 'bg-green-50 text-green-700'\n                          : 'hover:bg-gray-100:bg-gray-700 text-gray-700'\n                      }\n                    `}\n                  >\n                    <div className=\"flex items-center gap-2 flex-1\">\n                      <span>{set.icon || ''}</span>\n                      <div className=\"flex-1 min-w-0\">\n                        <p className=\"text-sm font-medium truncate\">{set.name}</p>\n                        <p className=\"text-xs text-gray-500\">{set.words.length}</p>\n                      </div>\n                    </div>\n                    <span className=\"text-lg ml-2\">{isInThisSet ? '' : '+'}</span>\n                  </button>\n                );\n              })}\n            </div>\n            <div className=\"p-2 border-t border-gray-200\">\n              <button\n                onClick={() => {\n                  setShowMenu(false);\n                  onOpenManagement();\n                }}\n                className=\"w-full text-left px-3 py-2 rounded-md hover:bg-gray-100:bg-gray-700 text-blue-600 text-sm font-medium\"\n              >\n                 \n              </button>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n};\n\nexport default AddToCustomButton;\n","import { Question } from '../types';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\nimport { ErrorPrediction } from '@/ai/prediction/errorPredictionAI';\nimport { generateChoicesWithQuestions } from '../utils';\nimport { useState, useRef, useEffect, useMemo } from 'react';\nimport { generateAIComment, getTimeOfDay } from '../aiCommentGenerator';\nimport { calculateGoalProgress } from '../goalSimulator';\nimport {\n  getConfusionPartners,\n  generateConfusionAdvice,\n  analyzeConfusionPatterns,\n} from '@/features/analysis/confusionPairs';\nimport { generateTeacherInteraction, getTeacherReactionToStreak } from '../teacherInteractions';\nimport { getRelevantMistakeTip } from '../englishTrivia';\nimport { speakEnglish, isSpeechSynthesisSupported } from '@/features/speech/speechSynthesis';\nimport AddToCustomButton from './AddToCustomButton';\n\ninterface QuestionCardProps {\n  question: Question;\n  questionNumber: number;\n  allQuestions: Question[];\n  currentIndex: number;\n  answered: boolean;\n  selectedAnswer: string | null;\n  onAnswer: (answer: string, correct: string, selectedQuestion?: Question | null) => void;\n  onNext: () => void;\n  onPrevious: () => void;\n  onDifficultyRate?: (rating: number) => void;\n  errorPrediction?: ErrorPrediction;\n  customQuestionSets?: CustomQuestionSet[];\n  onAddWordToCustomSet?: (setId: string, word: CustomWord) => void;\n  onRemoveWordFromCustomSet?: (setId: string, word: CustomWord) => void;\n  onOpenCustomSetManagement?: () => void;\n  onFullscreen?: () => void;\n}\n\nfunction QuestionCard({\n  question,\n  allQuestions,\n  currentIndex,\n  answered,\n  selectedAnswer,\n  onAnswer,\n  onNext,\n  onPrevious,\n  onDifficultyRate: _onDifficultyRate,\n  customQuestionSets = [],\n  onAddWordToCustomSet,\n  onRemoveWordFromCustomSet,\n  onOpenCustomSetManagement,\n  onFullscreen,\n}: QuestionCardProps) {\n  // useMemocurrentIndex\n  const choicesWithQuestions = useMemo(\n    () => generateChoicesWithQuestions(question, allQuestions, currentIndex),\n    [question.word, allQuestions, currentIndex]\n  );\n\n  const [_userRating, setUserRating] = useState<number | null>(null);\n  const [expandedChoices, setExpandedChoices] = useState<Set<number>>(new Set());\n  const [_aiComment, setAiComment] = useState<string>('');\n  const [attemptCount, setAttemptCount] = useState<number>(0);\n  const [, setCorrectStreak] = useState<number>(() => {\n    const saved = sessionStorage.getItem('currentCorrectStreak');\n    return saved ? parseInt(saved, 10) : 0;\n  });\n\n  // \n  const touchStartX = useRef<number>(0);\n  const touchEndX = useRef<number>(0);\n  const cardRef = useRef<HTMLDivElement>(null);\n  const isTouchingRef = useRef<boolean>(false);\n\n  // \n  useEffect(() => {\n    setUserRating(null);\n    setExpandedChoices(new Set());\n    setAiComment('');\n    setAttemptCount(0);\n  }, [currentIndex]);\n\n  const toggleChoiceDetails = (index: number) => {\n    setExpandedChoices((prev) => {\n      const newSet = new Set(prev);\n      // 1\n      if (answered) {\n        // \n        if (newSet.size > 0) {\n          return new Set();\n        } else {\n          return new Set(choicesWithQuestions.map((_, idx) => idx));\n        }\n      } else {\n        // \n        if (newSet.has(index)) {\n          newSet.delete(index);\n        } else {\n          newSet.add(index);\n        }\n        return newSet;\n      }\n    });\n  };\n\n  // ON/OFF\n  useEffect(() => {\n    const autoShowDetails = localStorage.getItem('autoShowDetails') !== 'false'; // true\n    if (answered && selectedAnswer && selectedAnswer !== question.meaning && autoShowDetails) {\n      // \n      setExpandedChoices(new Set(choicesWithQuestions.map((_, idx) => idx)));\n    }\n  }, [answered, selectedAnswer, question.meaning, choicesWithQuestions]);\n\n  // AI\n  useEffect(() => {\n    if (answered && selectedAnswer) {\n      const personality = (localStorage.getItem('aiPersonality') || 'kind-teacher') as any;\n      const isCorrect = selectedAnswer === question.meaning;\n\n      // \n      const currentStreak = parseInt(sessionStorage.getItem('currentCorrectStreak') || '0', 10);\n\n      // AI\n      let comment = generateAIComment(personality, {\n        isCorrect,\n        word: question.word,\n        difficulty: 'intermediate',\n        category: '',\n        attemptCount: attemptCount + 1,\n        responseTime: 0,\n        correctStreak: 0,\n        incorrectStreak: 0,\n        userAccuracy: 0,\n        categoryAccuracy: 0,\n        isWeakCategory: false,\n        hasSeenBefore: false,\n        previousAttempts: 0,\n        todayQuestions: 0,\n        todayAccuracy: 0,\n        planProgress: 0,\n        timeOfDay: getTimeOfDay(),\n      });\n\n      // \n      const additionalComments: string[] = [];\n\n      // 1. 10%\n      if (isCorrect && Math.random() < 0.1) {\n        const goalProgress = calculateGoalProgress();\n        if (goalProgress.estimatedDaysToAchieve > 0 && goalProgress.estimatedDaysToAchieve <= 30) {\n          if (goalProgress.overallProgress >= 90) {\n            additionalComments.push(` ${goalProgress.goal.name}`);\n          } else if (goalProgress.overallProgress >= 75) {\n            additionalComments.push(\n              ` ${goalProgress.estimatedDaysToAchieve}${goalProgress.goal.name}`\n            );\n          }\n        }\n      }\n\n      // 2. \n      if (!isCorrect) {\n        const confusionPartners = getConfusionPartners(question.word);\n        if (confusionPartners.length > 0) {\n          additionalComments.push(\n            ` ${question.word}${confusionPartners.join(', ')}`\n          );\n        }\n      }\n\n      // 3. 5%\n      if (!isCorrect && Math.random() < 0.05) {\n        const confusionGroups = analyzeConfusionPatterns();\n        const relevantGroup = confusionGroups.find(\n          (g) => g.words.includes(question.word.toLowerCase()) && g.needsReview\n        );\n        if (relevantGroup) {\n          additionalComments.push(generateConfusionAdvice(relevantGroup));\n        }\n      }\n\n      // 4. 10%\n      const interaction = generateTeacherInteraction(personality, isCorrect, currentStreak);\n      if (interaction) {\n        additionalComments.push(interaction.message);\n      }\n\n      // 5. \n      if (isCorrect) {\n        const streakReaction = getTeacherReactionToStreak(currentStreak + 1); // \n        if (streakReaction) {\n          additionalComments.push(streakReaction);\n        }\n      }\n\n      // 6. 8%\n      const trivia = getRelevantMistakeTip(isCorrect);\n      if (trivia) {\n        additionalComments.push(trivia);\n      }\n\n      // \n      if (isCorrect) {\n        const newStreak = currentStreak + 1;\n        setCorrectStreak(newStreak);\n        sessionStorage.setItem('currentCorrectStreak', String(newStreak));\n      } else {\n        setCorrectStreak(0);\n        sessionStorage.setItem('currentCorrectStreak', '0');\n      }\n\n      // \n      if (additionalComments.length > 0) {\n        comment = `${comment} ${additionalComments[0]}`; // 1\n      }\n\n      setAiComment(comment);\n    } else {\n      setAiComment('');\n    }\n  }, [answered, selectedAnswer, question, attemptCount]);\n\n  const handleNextClick = () => {\n    setExpandedChoices(new Set());\n    setAttemptCount(0);\n    onNext();\n  };\n\n  // \n  useEffect(() => {\n    const handleTouchStart = (e: TouchEvent) => {\n      // question-text\n      const target = e.target as HTMLElement;\n      if (\n        target.closest('.choice-btn') ||\n        target.closest('.toggle-details-btn') ||\n        target.closest('.rating-btn') ||\n        target.closest('.inline-nav-btn') ||\n        target.closest('.question-text')\n      ) {\n        return;\n      }\n      touchStartX.current = e.touches[0].clientX;\n      isTouchingRef.current = true;\n    };\n\n    const handleTouchMove = (e: TouchEvent) => {\n      if (touchStartX.current === 0) return; // \n      touchEndX.current = e.touches[0].clientX;\n    };\n\n    const handleTouchEnd = () => {\n      if (touchStartX.current === 0) {\n        // \n        isTouchingRef.current = false;\n        return;\n      }\n\n      const swipeDistance = touchStartX.current - touchEndX.current;\n      const minSwipeDistance = 80; // iOS\n\n      if (Math.abs(swipeDistance) > minSwipeDistance) {\n        if (swipeDistance > 0) {\n          //   \n          if (!answered) {\n            // handleSkip\n            onNext();\n          } else {\n            handleNextClick();\n          }\n        } else {\n          //   \n          if (currentIndex > 0) {\n            onPrevious();\n          }\n        }\n      }\n\n      touchStartX.current = 0;\n      touchEndX.current = 0;\n      setTimeout(() => {\n        isTouchingRef.current = false;\n      }, 300);\n    };\n\n    const card = cardRef.current;\n    if (card) {\n      card.addEventListener('touchstart', handleTouchStart, { passive: true });\n      card.addEventListener('touchmove', handleTouchMove, { passive: true });\n      card.addEventListener('touchend', handleTouchEnd);\n\n      return () => {\n        card.removeEventListener('touchstart', handleTouchStart);\n        card.removeEventListener('touchmove', handleTouchMove);\n        card.removeEventListener('touchend', handleTouchEnd);\n      };\n    }\n  }, [answered, currentIndex, onNext, onPrevious]);\n\n  // \n  useEffect(() => {\n    const handleKeyDown = (e: KeyboardEvent) => {\n      // 1-4: \n      if (!answered && ['1', '2', '3', '4'].includes(e.key)) {\n        const index = parseInt(e.key) - 1;\n        if (index < choicesWithQuestions.length) {\n          e.preventDefault();\n          const choice = choicesWithQuestions[index].text;\n          const choiceQuestion = choicesWithQuestions[index].question;\n          const isCorrect = choice === question.meaning;\n          if (!isCorrect) {\n            setAttemptCount((prev) => prev + 1);\n          }\n          onAnswer(choice, question.meaning, choiceQuestion);\n        }\n      }\n      // : \n      else if (!answered && e.key === ' ') {\n        e.preventDefault();\n        onNext(); // handleSkip\n      }\n      // Enter: \n      else if (e.key === 'Enter') {\n        e.preventDefault();\n        if (answered) {\n          handleNextClick();\n        } else {\n          onNext(); // handleSkip\n        }\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [answered, choicesWithQuestions, question, onAnswer, attemptCount]);\n\n  const getButtonClass = (choice: string) => {\n    // Tailwind\n    const baseClasses =\n      'w-full min-h-11 sm:min-h-14 p-2 sm:p-4 text-sm sm:text-base rounded-xl border-2 cursor-pointer transition-all duration-300 flex flex-col items-center text-center touch-manipulation select-none shadow-sm';\n    const hoverClasses =\n      'hover:border-blue-600 hover:bg-gray-100:bg-gray-800 hover:-translate-y-1 hover:shadow-lg';\n    const activeClasses = 'active:bg-gray-200:bg-gray-700 active:translate-y-0';\n\n    // \n    if (choice === '') {\n      if (!answered) {\n        return `${baseClasses} bg-gray-100 text-gray-600 border-gray-400 ${hoverClasses} ${activeClasses}`;\n      }\n      // \n      if (choice === selectedAnswer) {\n        return `${baseClasses} bg-red-600 border-red-600 text-white`;\n      }\n      return `${baseClasses} bg-gray-100 text-gray-600 border-gray-400`;\n    }\n\n    if (!answered) {\n      return `${baseClasses} bg-gray-50 text-gray-900 border-gray-300 ${hoverClasses} ${activeClasses}`;\n    }\n\n    if (choice === question.meaning) {\n      return `${baseClasses} bg-green-600 border-green-600 text-white`;\n    }\n    if (choice === selectedAnswer && choice !== question.meaning) {\n      return `${baseClasses} bg-red-600 border-red-600 text-white`;\n    }\n    return `${baseClasses} bg-gray-50 text-gray-900 border-gray-300`;\n  };\n\n  return (\n    <div className=\"question-card\" ref={cardRef}>\n      {/*  */}\n      {onFullscreen && (\n        <button\n          onClick={onFullscreen}\n          className=\"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300 transition shadow-md\"\n          aria-label=\"\"\n          title=\"\"\n        >\n          <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n            <path\n              strokeLinecap=\"round\"\n              strokeLinejoin=\"round\"\n              strokeWidth={2}\n              d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n            />\n          </svg>\n        </button>\n      )}\n      <div className=\"question-nav-row\">\n        <button\n          className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n          onClick={onPrevious}\n          disabled={currentIndex === 0}\n          title=\"\"\n        >\n          \n        </button>\n        <div\n          className={`question-content-inline ${isSpeechSynthesisSupported() ? 'clickable-pronunciation' : ''}`}\n          onClick={(e) => {\n            if (isSpeechSynthesisSupported()) {\n              e.preventDefault();\n              e.stopPropagation();\n              speakEnglish(question.word, { rate: 0.85 });\n            }\n          }}\n          onTouchEnd={(e) => {\n            if (isSpeechSynthesisSupported()) {\n              e.preventDefault();\n              e.stopPropagation();\n              speakEnglish(question.word, { rate: 0.85 });\n            }\n          }}\n          title={isSpeechSynthesisSupported() ? ' ' : ''}\n        >\n          <div\n            className={`text-2xl sm:text-3xl md:text-4xl font-bold text-gray-900 break-words ${question.word.includes(' ') ? 'phrase-text' : ''} ${isSpeechSynthesisSupported() ? 'clickable-word' : ''}`}\n          >\n            {question.word}\n            {isSpeechSynthesisSupported() && <span className=\"speaker-icon\"></span>}\n          </div>\n          {question.reading && (\n            <div className=\"question-reading text-sm sm:text-base text-gray-600 mt-1\">\n              {question.reading}\n            </div>\n          )}\n          {question.difficulty && (\n            <div className={`difficulty-badge ${question.difficulty}`}>\n              {question.difficulty === 'beginner'\n                ? ''\n                : question.difficulty === 'intermediate'\n                  ? ''\n                  : ''}\n            </div>\n          )}\n\n          {/*  */}\n          {onAddWordToCustomSet &&\n            onRemoveWordFromCustomSet &&\n            onOpenCustomSetManagement &&\n            customQuestionSets && (\n              <div className=\"mt-3 flex justify-center\">\n                <AddToCustomButton\n                  word={{\n                    word: question.word,\n                    meaning: question.meaning,\n                    katakana: question.reading,\n                    source: 'translation',\n                  }}\n                  sets={customQuestionSets}\n                  onAddWord={onAddWordToCustomSet}\n                  onRemoveWord={onRemoveWordFromCustomSet}\n                  onOpenManagement={onOpenCustomSetManagement}\n                  size=\"medium\"\n                  variant=\"both\"\n                />\n              </div>\n            )}\n        </div>\n        <button\n          className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-xl sm:text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n          onClick={handleNextClick}\n          title=\"\"\n        >\n          \n        </button>\n      </div>\n\n      <div className=\"choices\">\n        {choicesWithQuestions.map((choice, idx) => {\n          const isExpanded = expandedChoices.has(idx);\n          const choiceQuestion = choice.question;\n\n          return (\n            <div key={idx} className=\"choice-wrapper\">\n              <button\n                className={getButtonClass(choice.text)}\n                onClick={(e) => {\n                  if (answered) {\n                    // \n                    e.preventDefault();\n                    e.stopPropagation();\n                    if (choiceQuestion) {\n                      toggleChoiceDetails(idx);\n                    }\n                    return;\n                  }\n\n                  const isCorrect = choice.text === question.meaning;\n                  if (!isCorrect) {\n                    setAttemptCount((prev) => prev + 1);\n                  }\n                  onAnswer(choice.text, question.meaning, choiceQuestion);\n                }}\n                disabled={false}\n              >\n                <div className=\"choice-content\">\n                  <div className=\"choice-text\">{choice.text}</div>\n                </div>\n              </button>\n              {answered && choiceQuestion && isExpanded && (\n                <div className=\"choice-details\">\n                  <div className=\"choice-detail-item\">\n                    <span className=\"detail-label\">:</span>\n                    <span className=\"detail-text\">{choiceQuestion.word}</span>\n                  </div>\n                  {choiceQuestion.reading && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\">:</span>\n                      <span className=\"detail-text\">{choiceQuestion.reading}</span>\n                    </div>\n                  )}\n                  {choiceQuestion.meaning && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\">:</span>\n                      <span className=\"detail-text\">{choiceQuestion.meaning}</span>\n                    </div>\n                  )}\n                  {choiceQuestion.etymology && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\"> :</span>\n                      <span className=\"detail-text\">{choiceQuestion.etymology}</span>\n                    </div>\n                  )}\n                  {choiceQuestion.relatedWords && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\"> :</span>\n                      <span className=\"detail-text\">{choiceQuestion.relatedWords}</span>\n                    </div>\n                  )}\n                  {choiceQuestion.relatedFields && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\"> :</span>\n                      <span className=\"detail-text\">{choiceQuestion.relatedFields}</span>\n                    </div>\n                  )}\n                  {choiceQuestion.difficulty && (\n                    <div className=\"choice-detail-item\">\n                      <span className=\"detail-label\">:</span>\n                      <span className=\"detail-text\">{choiceQuestion.difficulty}</span>\n                    </div>\n                  )}\n                </div>\n              )}\n            </div>\n          );\n        })}\n      </div>\n    </div>\n  );\n}\n\nexport default QuestionCard;\n","interface LearningLimitsInputProps {\n  learningLimit: number;\n  reviewLimit: number;\n  onLearningLimitChange: (value: number) => void;\n  onReviewLimitChange: (value: number) => void;\n  idPrefix?: string;\n}\n\nconst LIMIT_OPTIONS = [0, 5, 10, 20, 30, 50, 100, 150, 200] as const;\n\n/**\n * \n * UI\n */\nexport default function LearningLimitsInput({\n  learningLimit,\n  reviewLimit,\n  onLearningLimitChange,\n  onReviewLimitChange,\n  idPrefix = '',\n}: LearningLimitsInputProps) {\n  return (\n    <>\n      <div className=\"filter-group\">\n        <label htmlFor={`${idPrefix}learning-limit`}> :</label>\n        <select\n          id={`${idPrefix}learning-limit`}\n          value={learningLimit}\n          onChange={(e) => onLearningLimitChange(parseInt(e.target.value))}\n          className=\"select-input\"\n        >\n          {LIMIT_OPTIONS.map((option) => (\n            <option key={option} value={option}>\n              {option === 0 ? '' : option}\n            </option>\n          ))}\n        </select>\n      </div>\n\n      <div className=\"filter-group\">\n        <label htmlFor={`${idPrefix}review-limit`}> :</label>\n        <select\n          id={`${idPrefix}review-limit`}\n          value={reviewLimit}\n          onChange={(e) => onReviewLimitChange(parseInt(e.target.value))}\n          className=\"select-input\"\n        >\n          {LIMIT_OPTIONS.map((option) => (\n            <option key={option} value={option}>\n              {option === 0 ? '' : option}\n            </option>\n          ))}\n        </select>\n      </div>\n    </>\n  );\n}\n","import { useState, useCallback } from 'react';\n\ninterface LearningLimits {\n  learningLimit: number;\n  reviewLimit: number;\n  setLearningLimit: (value: number) => void;\n  setReviewLimit: (value: number) => void;\n}\n\n/**\n * \n * @param mode  ('translation' | 'spelling' | 'grammar')\n * @returns \n */\nexport function useLearningLimits(mode: 'translation' | 'spelling' | 'grammar'): LearningLimits {\n  const [learningLimit, setLearningLimitState] = useState<number>(() => {\n    const saved = localStorage.getItem(`learning-limit-${mode}`);\n    return saved ? parseInt(saved) : 30; // : 30\n  });\n\n  const [reviewLimit, setReviewLimitState] = useState<number>(() => {\n    const saved = localStorage.getItem(`review-limit-${mode}`);\n    return saved ? parseInt(saved) : 10; // : 10\n  });\n\n  const setLearningLimit = useCallback(\n    (value: number) => {\n      const validValue = Math.max(0, value) || 30;\n      setLearningLimitState(validValue);\n      localStorage.setItem(`learning-limit-${mode}`, validValue.toString());\n    },\n    [mode]\n  );\n\n  const setReviewLimit = useCallback(\n    (value: number) => {\n      const validValue = Math.max(0, value) || 10;\n      setReviewLimitState(validValue);\n      localStorage.setItem(`review-limit-${mode}`, validValue.toString());\n    },\n    [mode]\n  );\n\n  return {\n    learningLimit,\n    reviewLimit,\n    setLearningLimit,\n    setReviewLimit,\n  };\n}\n","/**\n * \n *\n * 5\n * - ENCODING: 0-30\n * - INITIAL_CONSOLIDATION: 1\n * - INTRADAY_REVIEW: 2\n * - SHORT_TERM: 1-7\n * - LONG_TERM: 7\n */\n\nexport enum LearningPhase {\n  ENCODING = 'encoding',\n  INITIAL_CONSOLIDATION = 'initial',\n  INTRADAY_REVIEW = 'intraday',\n  SHORT_TERM = 'short_term',\n  LONG_TERM = 'long_term',\n}\n\nexport interface PhaseThresholds {\n  encodingTime: number; // 30\n  initialConsolidation: number; // 1\n  intradayWindow: number; // 24\n  shortTermWindow: number; // 7\n  longTermThreshold: number; // 7\n  correctRateThreshold: number; // 0.8\n  responseTimeThreshold: number; // 1500ms\n}\n\nexport interface PersonalParameters {\n  learningSpeed: number; // 1.0=2.0=0.5=\n  forgettingSpeed: number; // \n  consolidationThreshold: number; // \n  optimalInterval: number; // \n  sampleSize: number; // \n  confidence: number; // 0-1\n  lastUpdated: number; // \n  nextUpdateAt: number; // \n}\n\nexport interface QuestionStatus {\n  word: string;\n  reviewCount: number;\n  correctCount: number;\n  wrongCount: number;\n  lastReviewTime: number;\n  lastCorrectTime: number;\n  averageResponseTime: number;\n  consecutiveCorrect: number;\n  consecutiveWrong: number;\n}\n\nexport interface PhaseDetectionResult {\n  phase: LearningPhase;\n  reason: string;\n  matchedCondition: number;\n  metrics: {\n    reviewCount: number;\n    correctCount: number;\n    correctRate: number;\n    daysSinceLastReview: number;\n    timeSinceLastReview: number;\n    averageResponseTime: number;\n  };\n}\n\n// \nexport const DEFAULT_PHASE_THRESHOLDS: PhaseThresholds = {\n  encodingTime: 30000, // 30\n  initialConsolidation: 3600000, // 1\n  intradayWindow: 86400000, // 24\n  shortTermWindow: 604800000, // 7\n  longTermThreshold: 604800000, // 7\n  correctRateThreshold: 0.8, // 80%\n  responseTimeThreshold: 1500, // 1.5\n};\n\n// \nexport const DEFAULT_PERSONAL_PARAMETERS: PersonalParameters = {\n  learningSpeed: 1.0,\n  forgettingSpeed: 1.0,\n  consolidationThreshold: 3,\n  optimalInterval: 1.0,\n  sampleSize: 0,\n  confidence: 0.5,\n  lastUpdated: Date.now(),\n  nextUpdateAt: Date.now() + 86400000,\n};\n\n// \nconst MAX_DAYS_THRESHOLD = 1000; // \nconst MASTERY_THRESHOLD = 100; // \nconst RESET_THRESHOLD = 100; // \nconst MIN_RESPONSE_TIME = 0; // \nconst MAX_RESPONSE_TIME = 60000; // 60\nconst DEFAULT_RESPONSE_TIME = 1000; // 1\n\n/**\n * \n */\nexport class LearningPhaseDetector {\n  private thresholds: PhaseThresholds;\n  private cache: Map<string, { phase: LearningPhase; timestamp: number }>;\n  private readonly CACHE_DURATION = 5000; // 5\n\n  constructor(personalParams?: PersonalParameters, customThresholds?: Partial<PhaseThresholds>) {\n    const baseThresholds = { ...DEFAULT_PHASE_THRESHOLDS, ...customThresholds };\n\n    if (personalParams) {\n      this.thresholds = this.adjustThresholds(baseThresholds, personalParams);\n    } else {\n      this.thresholds = baseThresholds;\n    }\n\n    this.cache = new Map();\n  }\n\n  /**\n   * \n   */\n  private adjustThresholds(\n    baseThresholds: PhaseThresholds,\n    personalParams: PersonalParameters\n  ): PhaseThresholds {\n    return {\n      encodingTime: baseThresholds.encodingTime,\n      initialConsolidation: baseThresholds.initialConsolidation / personalParams.learningSpeed,\n      intradayWindow: baseThresholds.intradayWindow,\n      shortTermWindow: baseThresholds.shortTermWindow / personalParams.learningSpeed,\n      longTermThreshold: baseThresholds.longTermThreshold / personalParams.learningSpeed,\n      correctRateThreshold: baseThresholds.correctRateThreshold,\n      responseTimeThreshold: baseThresholds.responseTimeThreshold * personalParams.learningSpeed,\n    };\n  }\n\n  /**\n   * \n   */\n  detectPhase(word: string, status: QuestionStatus): LearningPhase {\n    const now = Date.now();\n    const cached = this.cache.get(word);\n\n    if (cached && now - cached.timestamp < this.CACHE_DURATION) {\n      return cached.phase;\n    }\n\n    const result = this.detectPhaseWithReason(word, status);\n    this.cache.set(word, { phase: result.phase, timestamp: now });\n\n    return result.phase;\n  }\n\n  /**\n   * \n   */\n  detectPhaseWithReason(word: string, status: QuestionStatus): PhaseDetectionResult {\n    const now = Date.now();\n\n    // \n    const lastReviewTime = this.sanitizeTimestamp(status.lastReviewTime, now);\n    const lastCorrectTime = this.sanitizeTimestamp(status.lastCorrectTime, now);\n\n    // \n    const averageResponseTime = this.sanitizeResponseTime(status.averageResponseTime);\n\n    // \n    const timeSinceLastReview = now - lastReviewTime;\n    const daysSinceLastReview = timeSinceLastReview / 86400000;\n    const correctRate = status.reviewCount > 0 ? status.correctCount / status.reviewCount : 0;\n\n    const metrics = {\n      reviewCount: status.reviewCount,\n      correctCount: status.correctCount,\n      correctRate,\n      daysSinceLastReview,\n      timeSinceLastReview,\n      averageResponseTime,\n    };\n\n    // 1: \n    if (status.reviewCount === 0) {\n      return {\n        phase: LearningPhase.ENCODING,\n        reason: 'reviewCount=0',\n        matchedCondition: 1,\n        metrics,\n      };\n    }\n\n    // 2: 30\n    if (timeSinceLastReview < this.thresholds.encodingTime) {\n      return {\n        phase: LearningPhase.ENCODING,\n        reason: `${Math.round(timeSinceLastReview / 1000)}`,\n        matchedCondition: 2,\n        metrics,\n      };\n    }\n\n    // 3: \n    if (status.correctCount === 0) {\n      return {\n        phase: LearningPhase.ENCODING,\n        reason: '',\n        matchedCondition: 3,\n        metrics,\n      };\n    }\n\n    // : \n    if (daysSinceLastReview > MAX_DAYS_THRESHOLD) {\n      return {\n        phase: LearningPhase.ENCODING,\n        reason: `${Math.round(daysSinceLastReview)}`,\n        matchedCondition: 101,\n        metrics,\n      };\n    }\n\n    // : \n    if (status.consecutiveCorrect >= MASTERY_THRESHOLD) {\n      return {\n        phase: LearningPhase.LONG_TERM,\n        reason: `${status.consecutiveCorrect}`,\n        matchedCondition: 102,\n        metrics,\n      };\n    }\n\n    // : \n    if (status.consecutiveWrong >= RESET_THRESHOLD) {\n      return {\n        phase: LearningPhase.ENCODING,\n        reason: `${status.consecutiveWrong}`,\n        matchedCondition: 103,\n        metrics,\n      };\n    }\n\n    // 4: 11\n    const hoursSinceCorrect = (now - lastCorrectTime) / 3600000;\n    if (status.correctCount === 1 && now - lastCorrectTime < this.thresholds.initialConsolidation) {\n      return {\n        phase: LearningPhase.INITIAL_CONSOLIDATION,\n        reason: `${Math.round(hoursSinceCorrect * 60)}`,\n        matchedCondition: 4,\n        metrics,\n      };\n    }\n\n    // 5: 2\n    if (this.isSameDay(now, lastCorrectTime) && status.correctCount >= 2) {\n      return {\n        phase: LearningPhase.INTRADAY_REVIEW,\n        reason: `${status.correctCount}`,\n        matchedCondition: 5,\n        metrics,\n      };\n    }\n\n    // 6: 1-7\n    if (daysSinceLastReview >= 1 && daysSinceLastReview <= 7) {\n      if (correctRate >= 0.5 && correctRate < this.thresholds.correctRateThreshold) {\n        return {\n          phase: LearningPhase.SHORT_TERM,\n          reason: `${Math.round(daysSinceLastReview)}${Math.round(correctRate * 100)}%`,\n          matchedCondition: 6,\n          metrics,\n        };\n      } else if (correctRate < 0.5) {\n        return {\n          phase: LearningPhase.ENCODING,\n          reason: `${Math.round(correctRate * 100)}%`,\n          matchedCondition: 6,\n          metrics,\n        };\n      }\n    }\n\n    // 7: 7\n    if (daysSinceLastReview > 7) {\n      if (\n        correctRate >= this.thresholds.correctRateThreshold &&\n        averageResponseTime < this.thresholds.responseTimeThreshold\n      ) {\n        return {\n          phase: LearningPhase.LONG_TERM,\n          reason: `${Math.round(daysSinceLastReview)}${Math.round(correctRate * 100)}%${Math.round(averageResponseTime)}ms`,\n          matchedCondition: 7,\n          metrics,\n        };\n      } else if (correctRate >= 0.5 && correctRate < this.thresholds.correctRateThreshold) {\n        return {\n          phase: LearningPhase.SHORT_TERM,\n          reason: `${Math.round(correctRate * 100)}%`,\n          matchedCondition: 7,\n          metrics,\n        };\n      } else {\n        return {\n          phase: LearningPhase.ENCODING,\n          reason: `${Math.round(correctRate * 100)}%`,\n          matchedCondition: 7,\n          metrics,\n        };\n      }\n    }\n\n    // : SHORT_TERM\n    return {\n      phase: LearningPhase.SHORT_TERM,\n      reason: '',\n      matchedCondition: 0,\n      metrics,\n    };\n  }\n\n  /**\n   * \n   */\n  canTransition(word: string, status: QuestionStatus, targetPhase: LearningPhase): boolean {\n    const currentPhase = this.detectPhase(word, status);\n\n    // \n    if (currentPhase === targetPhase) {\n      return true;\n    }\n\n    // \n    const phaseOrder = [\n      LearningPhase.ENCODING,\n      LearningPhase.INITIAL_CONSOLIDATION,\n      LearningPhase.INTRADAY_REVIEW,\n      LearningPhase.SHORT_TERM,\n      LearningPhase.LONG_TERM,\n    ];\n\n    const currentIndex = phaseOrder.indexOf(currentPhase);\n    const targetIndex = phaseOrder.indexOf(targetPhase);\n\n    // 1\n    if (targetIndex > currentIndex) {\n      return targetIndex - currentIndex === 1;\n    }\n\n    // \n    return true;\n  }\n\n  /**\n   * \n   */\n  private isSameDay(timestamp1: number, timestamp2: number): boolean {\n    const date1 = new Date(timestamp1);\n    const date2 = new Date(timestamp2);\n    return (\n      date1.getFullYear() === date2.getFullYear() &&\n      date1.getMonth() === date2.getMonth() &&\n      date1.getDate() === date2.getDate()\n    );\n  }\n\n  /**\n   * \n   */\n  private sanitizeResponseTime(responseTime: number): number {\n    if (\n      responseTime <= MIN_RESPONSE_TIME ||\n      responseTime > MAX_RESPONSE_TIME ||\n      isNaN(responseTime)\n    ) {\n      return DEFAULT_RESPONSE_TIME;\n    }\n    return responseTime;\n  }\n\n  /**\n   * \n   */\n  private sanitizeTimestamp(timestamp: number, now: number): number {\n    if (timestamp > now) {\n      console.warn(`: ${timestamp}`);\n      return now;\n    }\n    if (timestamp < 0 || isNaN(timestamp)) {\n      return now;\n    }\n    return timestamp;\n  }\n\n  /**\n   * \n   */\n  clearCache(): void {\n    this.cache.clear();\n  }\n\n  /**\n   * \n   */\n  updateThresholds(personalParams: PersonalParameters): void {\n    this.thresholds = this.adjustThresholds(DEFAULT_PHASE_THRESHOLDS, personalParams);\n    this.clearCache();\n  }\n}\n\n/**\n * \n */\nexport function analyzePhaseDistribution(\n  words: Array<{ word: string; status: QuestionStatus }>,\n  detector: LearningPhaseDetector\n): Record<LearningPhase, number> {\n  const distribution: Record<LearningPhase, number> = {\n    [LearningPhase.ENCODING]: 0,\n    [LearningPhase.INITIAL_CONSOLIDATION]: 0,\n    [LearningPhase.INTRADAY_REVIEW]: 0,\n    [LearningPhase.SHORT_TERM]: 0,\n    [LearningPhase.LONG_TERM]: 0,\n  };\n\n  for (const { word, status } of words) {\n    const phase = detector.detectPhase(word, status);\n    distribution[phase]++;\n  }\n\n  return distribution;\n}\n\n/**\n * : \n */\nexport function logPhaseDetection(result: PhaseDetectionResult): void {\n  console.log(`\n \n\n: ${result.phase}\n: ${result.reason}\n: ${result.matchedCondition}\n\n :\n- : ${result.metrics.reviewCount}\n- : ${result.metrics.correctCount}\n- : ${Math.round(result.metrics.correctRate * 100)}%\n- : ${Math.round(result.metrics.daysSinceLastReview)}\n- : ${Math.round(result.metrics.averageResponseTime)}ms\n\n  `);\n}\n","/**\n * \n *\n * 100\n * 4\n */\n\nexport enum QueueType {\n  IMMEDIATE = 'immediate', // 1-31\n  EARLY = 'early', // 5-1010\n  MID = 'mid', // 20-301\n  END = 'end', // \n}\n\nexport enum QuestionCategory {\n  MEMORIZATION = 'memorization',\n  TRANSLATION = 'translation',\n  SPELLING = 'spelling',\n  GRAMMAR = 'grammar',\n}\n\nexport interface AcquisitionProgress {\n  todayFirstSeen: number; // \n  todayCorrectCount: number; // \n  todayWrongCount: number; // \n  isAcquisitionComplete: boolean; // \n  currentQueue: QueueType | null; // \n  queuedAt: number; // \n  todayReviews: ReviewRecord[]; // \n}\n\nexport interface ReviewRecord {\n  timestamp: number;\n  queueType: QueueType;\n  isCorrect: boolean;\n  responseTime?: number;\n}\n\nexport interface QueueEntry {\n  word: string;\n  queueType: QueueType;\n  enqueuedAt: number; // \n  enqueuedQuestionNumber: number; // \n  targetQuestionNumber: number; // \n  targetTime: number; // \n  priority: number; // \n  difficulty: number; // \n  category: QuestionCategory;\n}\n\nexport interface TabConfig {\n  consolidationThreshold: number; // \n  enableImmediateReview: boolean;\n  enableEarlyReview: boolean;\n  enableMidReview: boolean;\n  enableEndReview: boolean;\n  newQuestionRatio: number; // \n}\n\nexport interface AcquisitionReport {\n  totalWords: number;\n  completed: number;\n  incomplete: number;\n  completionRate: number;\n  incompleteWords: string[];\n}\n\nexport interface QueueStatistics {\n  immediate: { size: number; oldestEntry?: number; averageWaitTime: number };\n  early: { size: number; oldestEntry?: number; averageWaitTime: number };\n  mid: { size: number; oldestEntry?: number; averageWaitTime: number };\n  end: { size: number; oldestEntry?: number; averageWaitTime: number };\n}\n\n// \nexport const DEFAULT_TAB_CONFIGS: Record<QuestionCategory, TabConfig> = {\n  [QuestionCategory.MEMORIZATION]: {\n    consolidationThreshold: 3,\n    enableImmediateReview: true,\n    enableEarlyReview: true,\n    enableMidReview: true,\n    enableEndReview: true,\n    newQuestionRatio: 0.6,\n  },\n  [QuestionCategory.TRANSLATION]: {\n    consolidationThreshold: 2,\n    enableImmediateReview: true,\n    enableEarlyReview: false,\n    enableMidReview: false,\n    enableEndReview: true,\n    newQuestionRatio: 0.7,\n  },\n  [QuestionCategory.SPELLING]: {\n    consolidationThreshold: 4,\n    enableImmediateReview: true,\n    enableEarlyReview: true,\n    enableMidReview: true,\n    enableEndReview: true,\n    newQuestionRatio: 0.5,\n  },\n  [QuestionCategory.GRAMMAR]: {\n    consolidationThreshold: 3,\n    enableImmediateReview: true,\n    enableEarlyReview: true,\n    enableMidReview: false,\n    enableEndReview: true,\n    newQuestionRatio: 0.6,\n  },\n};\n\n// \nconst MAX_QUEUE_SIZE = {\n  immediate: 10,\n  early: 20,\n  mid: 30,\n  end: 50,\n};\n\nconst QUEUE_EXPIRY_TIME = 7200000; // 2\nconst MAX_SAME_WORD_ATTEMPTS = 10;\n\n/**\n * \n */\nexport class AcquisitionQueueManager {\n  private queues: {\n    immediate: QueueEntry[];\n    early: QueueEntry[];\n    mid: QueueEntry[];\n    end: QueueEntry[];\n  };\n\n  private currentQuestionNumber: number = 0;\n  private sessionStartTime: number = Date.now();\n  private wordAttempts: Map<string, number> = new Map();\n  private acquisitionProgress: Map<string, AcquisitionProgress> = new Map();\n  private tabConfigs: Record<QuestionCategory, TabConfig>;\n\n  constructor(customConfigs?: Partial<Record<QuestionCategory, Partial<TabConfig>>>) {\n    this.queues = {\n      immediate: [],\n      early: [],\n      mid: [],\n      end: [],\n    };\n\n    // \n    this.tabConfigs = { ...DEFAULT_TAB_CONFIGS };\n    if (customConfigs) {\n      for (const [category, config] of Object.entries(customConfigs)) {\n        this.tabConfigs[category as QuestionCategory] = {\n          ...this.tabConfigs[category as QuestionCategory],\n          ...config,\n        };\n      }\n    }\n  }\n\n  /**\n   * \n   */\n  enqueueNewWord(word: string, difficulty: number, category: QuestionCategory): void {\n    const now = Date.now();\n    this.currentQuestionNumber++;\n    const config = this.tabConfigs[category];\n\n    // \n    if (!this.acquisitionProgress.has(word)) {\n      this.acquisitionProgress.set(word, {\n        todayFirstSeen: now,\n        todayCorrectCount: 0,\n        todayWrongCount: 0,\n        isAcquisitionComplete: false,\n        currentQueue: null,\n        queuedAt: 0,\n        todayReviews: [],\n      });\n    }\n\n    // \n    if (config.enableImmediateReview && this.shouldEnqueueImmediate(difficulty)) {\n      const gap = this.calculateImmediateGap(difficulty);\n      this.enqueueToImmediate(word, difficulty, category, gap);\n    }\n  }\n\n  /**\n   * \n   */\n  private enqueueToImmediate(\n    word: string,\n    difficulty: number,\n    category: QuestionCategory,\n    gap: number\n  ): void {\n    const now = Date.now();\n\n    if (this.isDuplicateInQueue(word, QueueType.IMMEDIATE)) {\n      return;\n    }\n\n    const entry: QueueEntry = {\n      word,\n      queueType: QueueType.IMMEDIATE,\n      enqueuedAt: now,\n      enqueuedQuestionNumber: this.currentQuestionNumber,\n      targetQuestionNumber: this.currentQuestionNumber + gap,\n      targetTime: now + 60000, // 1\n      priority: 100,\n      difficulty,\n      category,\n    };\n\n    this.enqueueWithLimit(this.queues.immediate, entry, MAX_QUEUE_SIZE.immediate);\n\n    const progress = this.acquisitionProgress.get(word)!;\n    progress.currentQueue = QueueType.IMMEDIATE;\n    progress.queuedAt = now;\n  }\n\n  /**\n   * \n   */\n  private enqueueToEarly(word: string, difficulty: number, category: QuestionCategory): void {\n    const now = Date.now();\n    const config = this.tabConfigs[category];\n\n    if (!config.enableEarlyReview || this.isDuplicateInQueue(word, QueueType.EARLY)) {\n      return;\n    }\n\n    const gap = this.calculateEarlyGap(difficulty);\n    const entry: QueueEntry = {\n      word,\n      queueType: QueueType.EARLY,\n      enqueuedAt: now,\n      enqueuedQuestionNumber: this.currentQuestionNumber,\n      targetQuestionNumber: this.currentQuestionNumber + gap,\n      targetTime: now + 600000, // 10\n      priority: 80,\n      difficulty,\n      category,\n    };\n\n    this.enqueueWithLimit(this.queues.early, entry, MAX_QUEUE_SIZE.early);\n\n    const progress = this.acquisitionProgress.get(word)!;\n    progress.currentQueue = QueueType.EARLY;\n    progress.queuedAt = now;\n  }\n\n  /**\n   * \n   */\n  private enqueueToMid(word: string, difficulty: number, category: QuestionCategory): void {\n    const now = Date.now();\n    const config = this.tabConfigs[category];\n\n    if (!config.enableMidReview || this.isDuplicateInQueue(word, QueueType.MID)) {\n      return;\n    }\n\n    const gap = this.calculateMidGap(difficulty);\n    const entry: QueueEntry = {\n      word,\n      queueType: QueueType.MID,\n      enqueuedAt: now,\n      enqueuedQuestionNumber: this.currentQuestionNumber,\n      targetQuestionNumber: this.currentQuestionNumber + gap,\n      targetTime: now + 3600000, // 1\n      priority: 60,\n      difficulty,\n      category,\n    };\n\n    this.enqueueWithLimit(this.queues.mid, entry, MAX_QUEUE_SIZE.mid);\n\n    const progress = this.acquisitionProgress.get(word)!;\n    progress.currentQueue = QueueType.MID;\n    progress.queuedAt = now;\n  }\n\n  /**\n   * \n   */\n  private enqueueToEnd(word: string, difficulty: number, category: QuestionCategory): void {\n    const now = Date.now();\n    const config = this.tabConfigs[category];\n\n    if (!config.enableEndReview || this.isDuplicateInQueue(word, QueueType.END)) {\n      return;\n    }\n\n    const entry: QueueEntry = {\n      word,\n      queueType: QueueType.END,\n      enqueuedAt: now,\n      enqueuedQuestionNumber: this.currentQuestionNumber,\n      targetQuestionNumber: Infinity,\n      targetTime: Infinity,\n      priority: 40,\n      difficulty,\n      category,\n    };\n\n    this.enqueueWithLimit(this.queues.end, entry, MAX_QUEUE_SIZE.end);\n\n    const progress = this.acquisitionProgress.get(word)!;\n    progress.currentQueue = QueueType.END;\n    progress.queuedAt = now;\n  }\n\n  /**\n   * \n   */\n  getNextReviewQuestion(): QueueEntry | null {\n    this.cleanupExpiredEntries();\n\n    const now = Date.now();\n    const currentQ = this.currentQuestionNumber;\n    const candidates: QueueEntry[] = [];\n\n    // \n    for (const entry of this.queues.immediate) {\n      if (currentQ >= entry.targetQuestionNumber || now >= entry.targetTime) {\n        candidates.push(entry);\n      }\n    }\n\n    for (const entry of this.queues.early) {\n      if (currentQ >= entry.targetQuestionNumber || now >= entry.targetTime) {\n        candidates.push(entry);\n      }\n    }\n\n    for (const entry of this.queues.mid) {\n      if (currentQ >= entry.targetQuestionNumber || now >= entry.targetTime) {\n        candidates.push(entry);\n      }\n    }\n\n    // \n    candidates.sort((a, b) => b.priority - a.priority);\n\n    if (candidates.length > 0) {\n      const selected = candidates[0];\n      this.removeFromQueue(selected);\n      return selected;\n    }\n\n    return null;\n  }\n\n  /**\n   * \n   */\n  handleCorrectAnswer(\n    word: string,\n    currentQueue: QueueType,\n    responseTime?: number,\n    difficulty?: number,\n    category?: QuestionCategory\n  ): void {\n    if (!this.trackWordAttempts(word)) {\n      return;\n    }\n\n    const progress = this.getAcquisitionProgress(word);\n    progress.todayCorrectCount++;\n    progress.todayReviews.push({\n      timestamp: Date.now(),\n      queueType: currentQueue,\n      isCorrect: true,\n      responseTime,\n    });\n\n    // \n    // difficultycategoryentry\n    let finalDifficulty = difficulty;\n    let finalCategory = category;\n\n    if (finalDifficulty === undefined || finalCategory === undefined) {\n      const entry = this.findWordInQueues(word);\n      if (entry) {\n        finalDifficulty = entry.difficulty;\n        finalCategory = entry.category;\n      }\n    }\n\n    if (finalDifficulty !== undefined && finalCategory !== undefined) {\n      if (currentQueue === QueueType.IMMEDIATE && this.shouldEnqueueEarly(word, progress)) {\n        this.enqueueToEarly(word, finalDifficulty, finalCategory);\n      } else if (currentQueue === QueueType.EARLY && this.shouldEnqueueMid(word, progress)) {\n        this.enqueueToMid(word, finalDifficulty, finalCategory);\n      } else if (currentQueue === QueueType.MID && this.shouldEnqueueEnd(word, progress)) {\n        this.enqueueToEnd(word, finalDifficulty, finalCategory);\n      }\n    }\n\n    // \n    if (this.isAcquisitionComplete(word, progress)) {\n      progress.isAcquisitionComplete = true;\n      console.log(` : ${word}`);\n    }\n  }\n\n  /**\n   * \n   */\n  handleWrongAnswer(\n    word: string,\n    currentQueue: QueueType,\n    responseTime?: number,\n    difficulty?: number,\n    category?: QuestionCategory\n  ): void {\n    if (!this.trackWordAttempts(word)) {\n      return;\n    }\n\n    const progress = this.getAcquisitionProgress(word);\n    progress.todayWrongCount++;\n    progress.todayReviews.push({\n      timestamp: Date.now(),\n      queueType: currentQueue,\n      isCorrect: false,\n      responseTime,\n    });\n\n    // \n    // difficultycategoryentry\n    let finalDifficulty = difficulty;\n    let finalCategory = category;\n\n    if (finalDifficulty === undefined || finalCategory === undefined) {\n      const entry = this.findWordInQueues(word);\n      if (entry) {\n        finalDifficulty = entry.difficulty;\n        finalCategory = entry.category;\n      }\n    }\n\n    if (finalDifficulty !== undefined && finalCategory !== undefined) {\n      // \n      this.removeFromAllQueues(word);\n\n      if (currentQueue !== QueueType.IMMEDIATE) {\n        console.log(` : ${word}`);\n      }\n\n      // \n      this.enqueueToImmediate(word, Math.min(finalDifficulty + 1, 5), finalCategory, 1);\n    }\n  }\n\n  /**\n   * \n   */\n  startSessionEndReview(): QueueEntry[] {\n    const endQueue = [...this.queues.end];\n\n    if (endQueue.length === 0) {\n      console.log('');\n      return [];\n    }\n\n    console.log(`${endQueue.length}`);\n    return endQueue;\n  }\n\n  /**\n   * \n   */\n  generateAcquisitionReport(): AcquisitionReport {\n    const allWords = Array.from(this.acquisitionProgress.keys());\n    const completed: string[] = [];\n    const incomplete: string[] = [];\n\n    for (const word of allWords) {\n      const progress = this.acquisitionProgress.get(word)!;\n      if (progress.isAcquisitionComplete) {\n        completed.push(word);\n      } else {\n        incomplete.push(word);\n      }\n    }\n\n    return {\n      totalWords: allWords.length,\n      completed: completed.length,\n      incomplete: incomplete.length,\n      completionRate: allWords.length > 0 ? completed.length / allWords.length : 0,\n      incompleteWords: incomplete,\n    };\n  }\n\n  /**\n   * \n   */\n  getQueueStatistics(): QueueStatistics {\n    return {\n      immediate: {\n        size: this.queues.immediate.length,\n        oldestEntry: this.queues.immediate[0]?.enqueuedAt,\n        averageWaitTime: this.calculateAverageWaitTime(this.queues.immediate),\n      },\n      early: {\n        size: this.queues.early.length,\n        oldestEntry: this.queues.early[0]?.enqueuedAt,\n        averageWaitTime: this.calculateAverageWaitTime(this.queues.early),\n      },\n      mid: {\n        size: this.queues.mid.length,\n        oldestEntry: this.queues.mid[0]?.enqueuedAt,\n        averageWaitTime: this.calculateAverageWaitTime(this.queues.mid),\n      },\n      end: {\n        size: this.queues.end.length,\n        oldestEntry: this.queues.end[0]?.enqueuedAt,\n        averageWaitTime: 0,\n      },\n    };\n  }\n\n  /**\n   * \n   */\n  getAcquisitionProgress(word: string): AcquisitionProgress {\n    if (!this.acquisitionProgress.has(word)) {\n      this.acquisitionProgress.set(word, {\n        todayFirstSeen: Date.now(),\n        todayCorrectCount: 0,\n        todayWrongCount: 0,\n        isAcquisitionComplete: false,\n        currentQueue: null,\n        queuedAt: 0,\n        todayReviews: [],\n      });\n    }\n    return this.acquisitionProgress.get(word)!;\n  }\n\n  /**\n   * \n   */\n  incrementQuestionNumber(): void {\n    this.currentQuestionNumber++;\n  }\n\n  /**\n   * \n   */\n  reset(): void {\n    this.queues = {\n      immediate: [],\n      early: [],\n      mid: [],\n      end: [],\n    };\n    this.currentQuestionNumber = 0;\n    this.sessionStartTime = Date.now();\n    this.wordAttempts.clear();\n    this.acquisitionProgress.clear();\n  }\n\n  /**\n   * \n   */\n  getQueueInfo(word: string): { queueType: QueueType; questionNumber: number } | null {\n    const entry = this.findWordInQueues(word);\n    if (!entry) return null;\n\n    return {\n      queueType: entry.queueType,\n      questionNumber: entry.targetQuestionNumber,\n    };\n  }\n\n  /**\n   * \n   */\n  getQueueSizes(): { immediate: number; early: number; mid: number; end: number } {\n    return {\n      immediate: this.queues.immediate.length,\n      early: this.queues.early.length,\n      mid: this.queues.mid.length,\n      end: this.queues.end.length,\n    };\n  }\n\n  /**\n   * \n   */\n  exportQueues(): {\n    immediate: QueueEntry[];\n    early: QueueEntry[];\n    mid: QueueEntry[];\n    end: QueueEntry[];\n  } {\n    return {\n      immediate: [...this.queues.immediate],\n      early: [...this.queues.early],\n      mid: [...this.queues.mid],\n      end: [...this.queues.end],\n    };\n  }\n\n  /**\n   * \n   */\n  clearQueues(): void {\n    this.queues.immediate = [];\n    this.queues.early = [];\n    this.queues.mid = [];\n    this.queues.end = [];\n  }\n\n  /**\n   * \n   */\n  recordAnswer(word: string, isCorrect: boolean, responseTime: number): void {\n    const progress = this.getAcquisitionProgress(word);\n    const currentQueue = progress.currentQueue || QueueType.IMMEDIATE;\n\n    if (isCorrect) {\n      this.handleCorrectAnswer(word, currentQueue, responseTime);\n    } else {\n      this.handleWrongAnswer(word, currentQueue, responseTime);\n    }\n  }\n\n  // ========================================\n  // \n  // ========================================\n\n  private shouldEnqueueImmediate(difficulty: number): boolean {\n    return difficulty >= 3;\n  }\n\n  private shouldEnqueueEarly(word: string, progress: AcquisitionProgress): boolean {\n    return progress.todayCorrectCount >= 1;\n  }\n\n  private shouldEnqueueMid(word: string, progress: AcquisitionProgress): boolean {\n    return progress.todayCorrectCount >= 2;\n  }\n\n  private shouldEnqueueEnd(word: string, progress: AcquisitionProgress): boolean {\n    return progress.todayCorrectCount >= 3;\n  }\n\n  private calculateImmediateGap(difficulty: number): number {\n    if (difficulty >= 4) return 1;\n    if (difficulty === 3) return 2;\n    return 3;\n  }\n\n  private calculateEarlyGap(difficulty: number): number {\n    if (difficulty >= 4) return 5;\n    if (difficulty === 3) return 7;\n    return 10;\n  }\n\n  private calculateMidGap(difficulty: number): number {\n    if (difficulty >= 4) return 20;\n    if (difficulty === 3) return 25;\n    return 30;\n  }\n\n  private isAcquisitionComplete(word: string, progress: AcquisitionProgress): boolean {\n    const entry = this.findWordInQueues(word);\n    if (!entry) return false;\n\n    const config = this.tabConfigs[entry.category];\n    const threshold = config.consolidationThreshold;\n\n    // 1: \n    if (progress.todayCorrectCount < threshold) {\n      return false;\n    }\n\n    // 2: 2\n    const uniqueQueues = new Set(\n      progress.todayReviews.filter((r) => r.isCorrect).map((r) => r.queueType)\n    );\n    if (uniqueQueues.size < 2) {\n      return false;\n    }\n\n    // 3: 2\n    const recentReviews = progress.todayReviews.slice(-2);\n    if (recentReviews.length < 2 || !recentReviews.every((r) => r.isCorrect)) {\n      return false;\n    }\n\n    return true;\n  }\n\n  private isDuplicateInQueue(word: string, queueType: QueueType): boolean {\n    return this.queues[queueType].some((entry) => entry.word === word);\n  }\n\n  private enqueueWithLimit(queue: QueueEntry[], entry: QueueEntry, maxSize: number): void {\n    if (queue.length >= maxSize) {\n      console.warn(`${maxSize}`);\n      queue.shift();\n    }\n    queue.push(entry);\n  }\n\n  private removeFromQueue(entry: QueueEntry): void {\n    const queueName = entry.queueType;\n    const queue = this.queues[queueName];\n    const index = queue.findIndex((e) => e.word === entry.word);\n    if (index !== -1) {\n      queue.splice(index, 1);\n    }\n  }\n\n  private removeFromAllQueues(word: string): void {\n    for (const queueType of Object.keys(this.queues) as QueueType[]) {\n      this.queues[queueType] = this.queues[queueType].filter((e) => e.word !== word);\n    }\n  }\n\n  private findWordInQueues(word: string): QueueEntry | null {\n    for (const queueType of Object.keys(this.queues) as QueueType[]) {\n      const entry = this.queues[queueType].find((e) => e.word === word);\n      if (entry) return entry;\n    }\n    return null;\n  }\n\n  private cleanupExpiredEntries(): void {\n    const now = Date.now();\n\n    for (const queueType of Object.keys(this.queues) as QueueType[]) {\n      this.queues[queueType] = this.queues[queueType].filter((entry) => {\n        const age = now - entry.enqueuedAt;\n        if (age > QUEUE_EXPIRY_TIME) {\n          console.warn(`: ${entry.word}`);\n          return false;\n        }\n        return true;\n      });\n    }\n  }\n\n  private trackWordAttempts(word: string): boolean {\n    if (!this.wordAttempts.has(word)) {\n      this.wordAttempts.set(word, 0);\n    }\n\n    const attempts = this.wordAttempts.get(word)! + 1;\n    this.wordAttempts.set(word, attempts);\n\n    if (attempts >= MAX_SAME_WORD_ATTEMPTS) {\n      console.error(`: ${word}`);\n      this.removeFromAllQueues(word);\n      return false;\n    }\n\n    return true;\n  }\n\n  private calculateAverageWaitTime(queue: QueueEntry[]): number {\n    if (queue.length === 0) return 0;\n\n    const now = Date.now();\n    const totalWaitTime = queue.reduce((sum, entry) => {\n      return sum + (now - entry.enqueuedAt);\n    }, 0);\n\n    return totalWaitTime / queue.length;\n  }\n}\n\n/**\n * \n */\nexport function calculateAcquisitionEfficiency(manager: AcquisitionQueueManager): number {\n  const report = manager.generateAcquisitionReport();\n\n  if (report.completed === 0) {\n    return 0;\n  }\n\n  // \n  let totalReviewCount = 0;\n  for (const word of [...Array(report.totalWords)].map((_, i) => `word${i}`)) {\n    const progress = manager.getAcquisitionProgress(word);\n    totalReviewCount += progress.todayReviews.length;\n  }\n\n  //  =  / \n  const avgReviewsPerWord = totalReviewCount / report.completed;\n\n  //  = (3) / \n  const efficiency = 3.0 / avgReviewsPerWord;\n\n  return Math.min(efficiency, 1.0); // 1.0\n}\n","/**\n *  (SuperMemo SM-2 )\n *\n * \n * \n */\n\nexport interface SM2Parameters {\n  interval: number; // \n  repetition: number; // \n  easeFactor: number; //  (1.3-2.5)\n}\n\nexport interface RetentionStatus {\n  lastReviewDate: number; // \n  nextReviewDate: number; // \n  sm2: SM2Parameters; // SM-2\n  retentionRate: number; //  (0-1)\n  forgettingIndex: number; //  ()\n  totalReviews: number; // \n  totalCorrect: number; // \n  consecutiveCorrect: number; // \n  consecutiveWrong: number; // \n  averageResponseTime: number; // \n  lastResponseTime: number; // \n}\n\nexport interface ReviewResult {\n  isCorrect: boolean;\n  responseTime: number;\n  confidence: number; //  (1-5)\n  timestamp: number;\n}\n\nexport interface RetentionConfig {\n  minEaseFactor: number; // \n  maxEaseFactor: number; // \n  easeFactorIncrement: number; // \n  easeFactorDecrement: number; // \n  initialInterval: number; // \n  forgettingCurveDecay: number; // \n  confidenceWeight: number; // \n}\n\nexport const DEFAULT_RETENTION_CONFIG: RetentionConfig = {\n  minEaseFactor: 1.3,\n  maxEaseFactor: 2.5,\n  easeFactorIncrement: 0.1,\n  easeFactorDecrement: 0.2,\n  initialInterval: 1,\n  forgettingCurveDecay: 0.5,\n  confidenceWeight: 0.15,\n};\n\n/**\n * \n */\nexport class MemoryRetentionManager {\n  private retentionData: Map<string, RetentionStatus> = new Map();\n  private config: RetentionConfig;\n\n  constructor(customConfig?: Partial<RetentionConfig>) {\n    this.config = { ...DEFAULT_RETENTION_CONFIG, ...customConfig };\n  }\n\n  /**\n   * \n   */\n  getRetentionStatus(word: string): RetentionStatus {\n    if (!this.retentionData.has(word)) {\n      this.retentionData.set(word, this.createInitialStatus());\n    }\n    return this.retentionData.get(word)!;\n  }\n\n  /**\n   * \n   */\n  recordReview(word: string, result: ReviewResult): RetentionStatus {\n    const status = this.getRetentionStatus(word);\n\n    // \n    status.totalReviews++;\n    status.lastReviewDate = result.timestamp;\n    status.lastResponseTime = result.responseTime;\n\n    // \n    const alpha = 0.3; // \n    status.averageResponseTime =\n      status.averageResponseTime * (1 - alpha) + result.responseTime * alpha;\n\n    if (result.isCorrect) {\n      status.totalCorrect++;\n      status.consecutiveCorrect++;\n      status.consecutiveWrong = 0;\n\n      // SM-2\n      this.updateSM2OnCorrect(status, result.confidence);\n    } else {\n      status.consecutiveCorrect = 0;\n      status.consecutiveWrong++;\n\n      // SM-2\n      this.updateSM2OnWrong(status);\n    }\n\n    // \n    status.retentionRate = this.estimateRetentionRate(status);\n\n    // \n    status.forgettingIndex = this.calculateForgettingIndex(status);\n\n    return status;\n  }\n\n  /**\n   * \n   */\n  getDueWords(wordList: string[], currentTime: number = Date.now()): string[] {\n    const dueWords: Array<{ word: string; priority: number }> = [];\n\n    for (const word of wordList) {\n      const status = this.getRetentionStatus(word);\n\n      if (currentTime >= status.nextReviewDate) {\n        //  =   \n        const daysPastDue = (currentTime - status.nextReviewDate) / 86400000;\n        const priority = daysPastDue * status.forgettingIndex;\n\n        dueWords.push({ word, priority });\n      }\n    }\n\n    // \n    dueWords.sort((a, b) => b.priority - a.priority);\n\n    return dueWords.map((item) => item.word);\n  }\n\n  /**\n   * \n   */\n  getReviewSchedule(wordList: string[], days: number = 7): Map<string, Date[]> {\n    const schedule = new Map<string, Date[]>();\n    const now = Date.now();\n\n    for (const word of wordList) {\n      const status = this.getRetentionStatus(word);\n      const reviewDates: Date[] = [];\n\n      let nextDate = status.nextReviewDate;\n      const endDate = now + days * 86400000;\n\n      while (nextDate <= endDate) {\n        reviewDates.push(new Date(nextDate));\n\n        // \n        nextDate += status.sm2.interval * 86400000;\n      }\n\n      if (reviewDates.length > 0) {\n        schedule.set(word, reviewDates);\n      }\n    }\n\n    return schedule;\n  }\n\n  /**\n   * \n   */\n  getRetentionStatistics(wordList: string[]): {\n    averageRetentionRate: number;\n    averageEaseFactor: number;\n    averageInterval: number;\n    dueCount: number;\n    overdueCount: number;\n    wellLearnedCount: number;\n  } {\n    const now = Date.now();\n    let totalRetention = 0;\n    let totalEaseFactor = 0;\n    let totalInterval = 0;\n    let dueCount = 0;\n    let overdueCount = 0;\n    let wellLearnedCount = 0;\n\n    for (const word of wordList) {\n      const status = this.getRetentionStatus(word);\n\n      totalRetention += status.retentionRate;\n      totalEaseFactor += status.sm2.easeFactor;\n      totalInterval += status.sm2.interval;\n\n      if (now >= status.nextReviewDate) {\n        dueCount++;\n\n        const daysPastDue = (now - status.nextReviewDate) / 86400000;\n        if (daysPastDue > 1) {\n          overdueCount++;\n        }\n      }\n\n      // 5interval >= 30\n      if (status.consecutiveCorrect >= 5 && status.sm2.interval >= 30) {\n        wellLearnedCount++;\n      }\n    }\n\n    const count = wordList.length || 1;\n\n    return {\n      averageRetentionRate: totalRetention / count,\n      averageEaseFactor: totalEaseFactor / count,\n      averageInterval: totalInterval / count,\n      dueCount,\n      overdueCount,\n      wellLearnedCount,\n    };\n  }\n\n  /**\n   * \n   */\n  estimateRetentionRate(status: RetentionStatus): number {\n    const now = Date.now();\n    const daysSinceReview = (now - status.lastReviewDate) / 86400000;\n    const daysUntilReview = (status.nextReviewDate - now) / 86400000;\n\n    if (daysUntilReview >= 0) {\n      // \n      const decay = Math.exp(\n        (-this.config.forgettingCurveDecay * daysSinceReview) / status.sm2.interval\n      );\n      return Math.max(0.1, Math.min(1.0, decay));\n    } else {\n      // \n      const overdueDays = -daysUntilReview;\n      const decay = Math.exp(\n        (-this.config.forgettingCurveDecay * (daysSinceReview + overdueDays)) / status.sm2.interval\n      );\n      return Math.max(0.05, Math.min(0.9, decay));\n    }\n  }\n\n  /**\n   * \n   */\n  reset(): void {\n    this.retentionData.clear();\n  }\n\n  /**\n   * \n   */\n  importRetentionData(data: Map<string, RetentionStatus>): void {\n    this.retentionData = new Map(data);\n  }\n\n  /**\n   * \n   */\n  exportRetentionData(): Map<string, RetentionStatus> {\n    return new Map(this.retentionData);\n  }\n\n  // ========================================\n  // \n  // ========================================\n\n  private createInitialStatus(): RetentionStatus {\n    return {\n      lastReviewDate: Date.now(),\n      nextReviewDate: Date.now() + this.config.initialInterval * 86400000,\n      sm2: {\n        interval: this.config.initialInterval,\n        repetition: 0,\n        easeFactor: 2.5,\n      },\n      retentionRate: 1.0,\n      forgettingIndex: 1.0,\n      totalReviews: 0,\n      totalCorrect: 0,\n      consecutiveCorrect: 0,\n      consecutiveWrong: 0,\n      averageResponseTime: 0,\n      lastResponseTime: 0,\n    };\n  }\n\n  private updateSM2OnCorrect(status: RetentionStatus, confidence: number): void {\n    const sm2 = status.sm2;\n    sm2.repetition++;\n\n    // \n    const quality = this.mapConfidenceToQuality(confidence);\n    const newEF = sm2.easeFactor + (0.1 - (5 - quality) * (0.08 + (5 - quality) * 0.02));\n    sm2.easeFactor = Math.max(\n      this.config.minEaseFactor,\n      Math.min(this.config.maxEaseFactor, newEF)\n    );\n\n    // \n    if (sm2.repetition === 1) {\n      sm2.interval = 1;\n    } else if (sm2.repetition === 2) {\n      sm2.interval = 6;\n    } else {\n      sm2.interval = Math.round(sm2.interval * sm2.easeFactor);\n    }\n\n    // \n    if (\n      status.lastResponseTime > 3000 &&\n      status.lastResponseTime > status.averageResponseTime * 1.5\n    ) {\n      // \n      sm2.interval = Math.max(1, Math.round(sm2.interval * 0.8));\n    }\n\n    // \n    status.nextReviewDate = status.lastReviewDate + sm2.interval * 86400000;\n  }\n\n  private updateSM2OnWrong(status: RetentionStatus): void {\n    const sm2 = status.sm2;\n\n    // \n    sm2.repetition = 0;\n\n    // \n    sm2.easeFactor = Math.max(\n      this.config.minEaseFactor,\n      sm2.easeFactor - this.config.easeFactorDecrement\n    );\n\n    // \n    sm2.interval = 1;\n\n    // \n    status.nextReviewDate = status.lastReviewDate + sm2.interval * 86400000;\n  }\n\n  private mapConfidenceToQuality(confidence: number): number {\n    // confidence (1-5)  SM-2  quality (0-5) \n    // confidence 5 ()  quality 5\n    // confidence 4 ()  quality 4\n    // confidence 3 ()  quality 3\n    // confidence 2 ()  quality 2\n    // confidence 1 ()  quality 1\n    return Math.max(0, Math.min(5, confidence));\n  }\n\n  private calculateForgettingIndex(status: RetentionStatus): number {\n    //  =  +  + \n\n    const baseIndex = 1.0;\n\n    // \n    const wrongRate = status.totalReviews > 0 ? 1 - status.totalCorrect / status.totalReviews : 0;\n    const wrongImpact = wrongRate * 2.0;\n\n    // \n    const responseImpact =\n      status.averageResponseTime > 2000 ? (status.averageResponseTime - 2000) / 5000 : 0;\n\n    // \n    const consecutiveWrongImpact = Math.min(status.consecutiveWrong * 0.3, 1.5);\n\n    const index = baseIndex + wrongImpact + responseImpact + consecutiveWrongImpact;\n\n    return Math.max(0.5, Math.min(5.0, index));\n  }\n}\n\n/**\n * \n */\nexport function isOptimalReviewTime(\n  status: RetentionStatus,\n  currentTime: number = Date.now()\n): { isOptimal: boolean; reason: string; hoursUntilDue: number } {\n  const hoursUntilDue = (status.nextReviewDate - currentTime) / 3600000;\n\n  if (hoursUntilDue <= 0) {\n    return {\n      isOptimal: true,\n      reason: '',\n      hoursUntilDue,\n    };\n  }\n\n  if (hoursUntilDue <= 2) {\n    return {\n      isOptimal: true,\n      reason: '',\n      hoursUntilDue,\n    };\n  }\n\n  if (status.retentionRate < 0.6) {\n    return {\n      isOptimal: true,\n      reason: '',\n      hoursUntilDue,\n    };\n  }\n\n  return {\n    isOptimal: false,\n    reason: '',\n    hoursUntilDue,\n  };\n}\n\n/**\n * \n */\nexport function calculateReviewEfficiency(\n  manager: MemoryRetentionManager,\n  wordList: string[]\n): number {\n  const stats = manager.getRetentionStatistics(wordList);\n\n  if (wordList.length === 0) {\n    return 0;\n  }\n\n  //  = (  0.4) + (/60  0.3) + (  0.3)\n  const retentionScore = stats.averageRetentionRate * 0.4;\n  const intervalScore = Math.min(stats.averageInterval / 60, 1.0) * 0.3;\n  const masteryScore = (stats.wellLearnedCount / wordList.length) * 0.3;\n\n  return retentionScore + intervalScore + masteryScore;\n}\n","/**\n * \n *\n * \n * \n */\n\nexport interface PersonalParameters {\n  learningSpeed: number; //  (0.5-2.0, 1.0)\n  forgettingSpeed: number; //  (0.5-2.0, 1.0)\n  consolidationThreshold: number; //  (2-53)\n  responseTimeProfile: ResponseTimeProfile;\n  confidenceLevel: number; //  (0-1)\n  sampleSize: number; // \n  lastUpdated: number; // \n}\n\nexport interface ResponseTimeProfile {\n  averageResponseTime: number; //  (ms)\n  fastThreshold: number; //  (ms)\n  slowThreshold: number; //  (ms)\n  consistencyScore: number; //  (0-1)\n}\n\nexport interface LearningHistory {\n  word: string;\n  timestamp: number;\n  isCorrect: boolean;\n  responseTime: number;\n  reviewNumber: number; // \n  daysSinceFirstSeen: number; // \n}\n\nexport interface EstimationConfig {\n  minSampleSize: number; // \n  confidenceThreshold: number; // \n  learningSpeedWindow: number; // \n  forgettingSpeedWindow: number; // \n}\n\nexport const DEFAULT_ESTIMATION_CONFIG: EstimationConfig = {\n  minSampleSize: 20,\n  confidenceThreshold: 0.7,\n  learningSpeedWindow: 7,\n  forgettingSpeedWindow: 30,\n};\n\nexport const DEFAULT_PERSONAL_PARAMETERS: PersonalParameters = {\n  learningSpeed: 1.0,\n  forgettingSpeed: 1.0,\n  consolidationThreshold: 3,\n  responseTimeProfile: {\n    averageResponseTime: 2000,\n    fastThreshold: 1000,\n    slowThreshold: 3000,\n    consistencyScore: 0.5,\n  },\n  confidenceLevel: 0,\n  sampleSize: 0,\n  lastUpdated: Date.now(),\n};\n\n/**\n * \n */\nexport class PersonalParameterEstimator {\n  private config: EstimationConfig;\n  private parameters: PersonalParameters;\n  private historyCache: LearningHistory[] = [];\n\n  constructor(config?: Partial<EstimationConfig>) {\n    this.config = { ...DEFAULT_ESTIMATION_CONFIG, ...config };\n    this.parameters = { ...DEFAULT_PERSONAL_PARAMETERS };\n  }\n\n  /**\n   * \n   */\n  addHistory(history: LearningHistory): void {\n    this.historyCache.push(history);\n\n    // 100\n    if (this.historyCache.length > 100) {\n      this.historyCache.shift();\n    }\n  }\n\n  /**\n   * \n   */\n  estimateParameters(fullHistory?: LearningHistory[]): PersonalParameters {\n    const history = fullHistory || this.historyCache;\n\n    if (history.length < this.config.minSampleSize) {\n      // \n      this.parameters.sampleSize = history.length;\n      this.parameters.confidenceLevel = 0;\n      return { ...this.parameters };\n    }\n\n    // \n    this.parameters.learningSpeed = this.estimateLearningSpeed(history);\n\n    // \n    this.parameters.forgettingSpeed = this.estimateForgettingSpeed(history);\n\n    // \n    this.parameters.consolidationThreshold = this.estimateConsolidationThreshold(history);\n\n    // \n    this.parameters.responseTimeProfile = this.estimateResponseTimeProfile(history);\n\n    // \n    this.parameters.confidenceLevel = this.calculateConfidenceLevel(history.length);\n\n    // \n    this.parameters.sampleSize = history.length;\n    this.parameters.lastUpdated = Date.now();\n\n    return { ...this.parameters };\n  }\n\n  /**\n   * \n   */\n  getParameters(): PersonalParameters {\n    return { ...this.parameters };\n  }\n\n  /**\n   * \n   */\n  importParameters(params: PersonalParameters): void {\n    this.parameters = { ...params };\n  }\n\n  /**\n   * \n   */\n  clearHistory(): void {\n    this.historyCache = [];\n  }\n\n  // ========================================\n  // \n  // ========================================\n\n  /**\n   * \n   *\n   * \n   * - 1-2   (1.5-2.0)\n   * - 3-4   (0.9-1.1)\n   * - 5   (0.5-0.8)\n   */\n  private estimateLearningSpeed(history: LearningHistory[]): number {\n    // \n    const wordTrials = new Map<string, number>();\n    const wordFirstCorrect = new Map<string, number>();\n\n    for (const record of history) {\n      const word = record.word;\n\n      if (!wordTrials.has(word)) {\n        wordTrials.set(word, 0);\n      }\n\n      wordTrials.set(word, wordTrials.get(word)! + 1);\n\n      if (record.isCorrect && !wordFirstCorrect.has(word)) {\n        wordFirstCorrect.set(word, wordTrials.get(word)!);\n      }\n    }\n\n    // \n    const trials = Array.from(wordFirstCorrect.values());\n    if (trials.length === 0) {\n      return 1.0;\n    }\n\n    const averageTrials = trials.reduce((sum, t) => sum + t, 0) / trials.length;\n\n    // \n    if (averageTrials <= 2) {\n      return 1.8;\n    } else if (averageTrials <= 2.5) {\n      return 1.5;\n    } else if (averageTrials <= 3.5) {\n      return 1.0;\n    } else if (averageTrials <= 5) {\n      return 0.7;\n    } else {\n      return 0.5;\n    }\n  }\n\n  /**\n   * \n   *\n   * \n   * - 7   (0.5-0.7)\n   * - 3-7   (0.9-1.1)\n   * - 3   (1.5-2.0)\n   */\n  private estimateForgettingSpeed(history: LearningHistory[]): number {\n    const wordLastCorrect = new Map<string, number>();\n    const retentionPeriods: number[] = [];\n\n    for (const record of history) {\n      const word = record.word;\n\n      if (record.isCorrect) {\n        wordLastCorrect.set(word, record.timestamp);\n      } else if (wordLastCorrect.has(word)) {\n        // \n        const lastCorrectTime = wordLastCorrect.get(word)!;\n        const periodDays = (record.timestamp - lastCorrectTime) / 86400000;\n        retentionPeriods.push(periodDays);\n\n        // \n        wordLastCorrect.delete(word);\n      }\n    }\n\n    if (retentionPeriods.length === 0) {\n      return 1.0;\n    }\n\n    const averagePeriod = retentionPeriods.reduce((sum, p) => sum + p, 0) / retentionPeriods.length;\n\n    // \n    if (averagePeriod >= 7) {\n      return 0.6;\n    } else if (averagePeriod >= 5) {\n      return 0.8;\n    } else if (averagePeriod >= 3) {\n      return 1.0;\n    } else if (averagePeriod >= 1) {\n      return 1.5;\n    } else {\n      return 2.0;\n    }\n  }\n\n  /**\n   * \n   *\n   * \n   */\n  private estimateConsolidationThreshold(history: LearningHistory[]): number {\n    const wordConsecutiveCorrect = new Map<string, number>();\n    const wordMaxConsecutive = new Map<string, number>();\n    const consolidationCounts: number[] = [];\n\n    for (const record of history) {\n      const word = record.word;\n\n      if (!wordConsecutiveCorrect.has(word)) {\n        wordConsecutiveCorrect.set(word, 0);\n        wordMaxConsecutive.set(word, 0);\n      }\n\n      if (record.isCorrect) {\n        const current = wordConsecutiveCorrect.get(word)! + 1;\n        wordConsecutiveCorrect.set(word, current);\n\n        const max = Math.max(wordMaxConsecutive.get(word)!, current);\n        wordMaxConsecutive.set(word, max);\n\n        // 5\n        if (current === 5) {\n          consolidationCounts.push(this.getWordTotalReviews(word, history));\n        }\n      } else {\n        wordConsecutiveCorrect.set(word, 0);\n      }\n    }\n\n    if (consolidationCounts.length === 0) {\n      return 3;\n    }\n\n    const averageCount =\n      consolidationCounts.reduce((sum, c) => sum + c, 0) / consolidationCounts.length;\n\n    // \n    return Math.max(2, Math.min(5, Math.round(averageCount * 0.6)));\n  }\n\n  /**\n   * \n   */\n  private estimateResponseTimeProfile(history: LearningHistory[]): ResponseTimeProfile {\n    const responseTimes = history.map((h) => h.responseTime);\n\n    if (responseTimes.length === 0) {\n      return DEFAULT_PERSONAL_PARAMETERS.responseTimeProfile;\n    }\n\n    // \n    const averageResponseTime = responseTimes.reduce((sum, t) => sum + t, 0) / responseTimes.length;\n\n    // \n    const variance =\n      responseTimes.reduce((sum, t) => sum + Math.pow(t - averageResponseTime, 2), 0) /\n      responseTimes.length;\n    const stdDev = Math.sqrt(variance);\n\n    // \n    const fastThreshold = Math.max(500, averageResponseTime - stdDev);\n    const slowThreshold = Math.min(5000, averageResponseTime + stdDev);\n\n    // \n    const coefficientOfVariation = stdDev / averageResponseTime;\n    const consistencyScore = Math.max(0, Math.min(1, 1 - coefficientOfVariation));\n\n    return {\n      averageResponseTime: Math.round(averageResponseTime),\n      fastThreshold: Math.round(fastThreshold),\n      slowThreshold: Math.round(slowThreshold),\n      consistencyScore: Math.round(consistencyScore * 100) / 100,\n    };\n  }\n\n  /**\n   * \n   */\n  private calculateConfidenceLevel(sampleSize: number): number {\n    // \n    // 20: \n    // 20-50: \n    // 50: \n\n    if (sampleSize < this.config.minSampleSize) {\n      return 0;\n    } else if (sampleSize < 50) {\n      return ((sampleSize - this.config.minSampleSize) / (50 - this.config.minSampleSize)) * 0.7;\n    } else if (sampleSize < 100) {\n      return 0.7 + ((sampleSize - 50) / 50) * 0.2;\n    } else {\n      return 0.9 + Math.min(((sampleSize - 100) / 200) * 0.1, 0.1);\n    }\n  }\n\n  /**\n   * \n   */\n  private getWordTotalReviews(word: string, history: LearningHistory[]): number {\n    return history.filter((h) => h.word === word).length;\n  }\n}\n\n/**\n * \n */\nexport function isParameterReliable(params: PersonalParameters): boolean {\n  return params.confidenceLevel >= DEFAULT_ESTIMATION_CONFIG.confidenceThreshold;\n}\n\n/**\n * \n */\nexport function calculateParameterApplicability(params: PersonalParameters): {\n  shouldApply: boolean;\n  applicabilityScore: number;\n  reason: string;\n} {\n  if (params.sampleSize < DEFAULT_ESTIMATION_CONFIG.minSampleSize) {\n    return {\n      shouldApply: false,\n      applicabilityScore: 0,\n      reason: `${params.sampleSize}/${DEFAULT_ESTIMATION_CONFIG.minSampleSize}`,\n    };\n  }\n\n  if (params.confidenceLevel < DEFAULT_ESTIMATION_CONFIG.confidenceThreshold) {\n    return {\n      shouldApply: false,\n      applicabilityScore: params.confidenceLevel,\n      reason: `${Math.round(params.confidenceLevel * 100)}%`,\n    };\n  }\n\n  // \n  const learningDeviation = Math.abs(params.learningSpeed - 1.0);\n  const forgettingDeviation = Math.abs(params.forgettingSpeed - 1.0);\n  const thresholdDeviation = Math.abs(params.consolidationThreshold - 3);\n\n  const totalDeviation = learningDeviation + forgettingDeviation + thresholdDeviation / 2;\n  const applicabilityScore = Math.min(1.0, params.confidenceLevel * (1 + totalDeviation));\n\n  if (totalDeviation > 0.5) {\n    return {\n      shouldApply: true,\n      applicabilityScore,\n      reason: '',\n    };\n  }\n\n  return {\n    shouldApply: true,\n    applicabilityScore,\n    reason: '',\n  };\n}\n","/**\n * hybridQuestionSelector.ts\n *\n * \n * \n *\n * @author AI Assistant\n * @version 1.0\n * @since 2025-12-16\n */\n\nimport { LearningPhase } from './learningPhaseDetector';\nimport type { PersonalParameters } from './personalParameterEstimator';\nimport { QueueType, QuestionCategory } from './memoryAcquisitionAlgorithm';\n\n/**\n * \n */\nexport interface QuestionCandidate {\n  /** ID */\n  id: string;\n\n  /**  */\n  word: string;\n\n  /**  */\n  category: QuestionCategory;\n\n  /**  */\n  phase: LearningPhase;\n\n  /**  */\n  reviewCount: number;\n\n  /**  */\n  correctCount: number;\n\n  /**  */\n  lastReviewTime: number;\n\n  /**  */\n  nextReviewTime?: number;\n\n  /**  */\n  queueType?: QueueType;\n\n  /**  */\n  questionNumber?: number;\n\n  /** 1-5 */\n  difficulty?: number;\n}\n\n/**\n * \n */\nexport interface HybridStrategy {\n  /** 0-1 */\n  acquisitionRatio: number;\n\n  /** 0-1 */\n  retentionRatio: number;\n\n  /**  */\n  adaptiveAdjustment: boolean;\n\n  /**  */\n  sessionQuestionNumber?: number;\n}\n\n/**\n * \n */\nexport const DEFAULT_HYBRID_STRATEGY: HybridStrategy = {\n  acquisitionRatio: 0.6,\n  retentionRatio: 0.4,\n  adaptiveAdjustment: true,\n  sessionQuestionNumber: 0,\n};\n\n/**\n * \n */\nexport interface PriorityResult {\n  /**  */\n  candidate: QuestionCandidate;\n\n  /** 0-100 */\n  priority: number;\n\n  /**  */\n  breakdown: {\n    queuePriority: number; // 0-40\n    phasePriority: number; // 0-30\n    timingPriority: number; // 0-20\n    personalPriority: number; // 0-10\n  };\n\n  /**  */\n  reason: string;\n}\n\n/**\n * \n *\n * \n */\nexport class HybridQuestionSelector {\n  private strategy: HybridStrategy;\n  private personalParams: PersonalParameters | null = null;\n\n  constructor(strategy: HybridStrategy = DEFAULT_HYBRID_STRATEGY) {\n    this.strategy = { ...strategy };\n  }\n\n  /**\n   * \n   */\n  setPersonalParameters(params: PersonalParameters): void {\n    this.personalParams = params;\n  }\n\n  /**\n   * \n   */\n  updateStrategy(strategy: Partial<HybridStrategy>): void {\n    this.strategy = { ...this.strategy, ...strategy };\n  }\n\n  /**\n   * \n   *\n   * :\n   * 1. \n   * 2. /\n   * 3. \n   */\n  selectNextQuestion(candidates: QuestionCandidate[]): QuestionCandidate | null {\n    if (candidates.length === 0) {\n      return null;\n    }\n\n    // \n    const priorities = candidates.map((c) => this.calculatePriority(c));\n\n    // \n    priorities.sort((a, b) => b.priority - a.priority);\n\n    // \n    const queuedQuestion = priorities.find((p) => p.candidate.queueType !== undefined);\n    if (queuedQuestion) {\n      return queuedQuestion.candidate;\n    }\n\n    // \n    return this.selectByStrategy(priorities);\n  }\n\n  /**\n   * \n   */\n  calculatePriority(candidate: QuestionCandidate): PriorityResult {\n    const breakdown = {\n      queuePriority: this.calculateQueuePriority(candidate),\n      phasePriority: this.calculatePhasePriority(candidate),\n      timingPriority: this.calculateTimingPriority(candidate),\n      personalPriority: this.calculatePersonalPriority(candidate),\n    };\n\n    const priority = Object.values(breakdown).reduce((sum, val) => sum + val, 0);\n    const reason = this.generatePriorityReason(candidate, breakdown);\n\n    return {\n      candidate,\n      priority,\n      breakdown,\n      reason,\n    };\n  }\n\n  /**\n   * 0-40\n   */\n  private calculateQueuePriority(candidate: QuestionCandidate): number {\n    if (!candidate.queueType) {\n      return 0;\n    }\n\n    // \n    const baseQueuePriority: Record<QueueType, number> = {\n      [QueueType.IMMEDIATE]: 40, // : \n      [QueueType.EARLY]: 30, // : \n      [QueueType.MID]: 20, // : \n      [QueueType.END]: 10, // : \n    };\n\n    let priority = baseQueuePriority[candidate.queueType] || 0;\n\n    // \n    if (candidate.questionNumber !== undefined) {\n      const positionBonus = Math.max(0, 5 - candidate.questionNumber * 0.5);\n      priority += positionBonus;\n    }\n\n    return Math.min(40, priority);\n  }\n\n  /**\n   * 0-30\n   */\n  private calculatePhasePriority(candidate: QuestionCandidate): number {\n    // \n    const phasePriorityMap: Record<LearningPhase, number> = {\n      [LearningPhase.ENCODING]: 25, // : \n      [LearningPhase.INITIAL_CONSOLIDATION]: 30, // : \n      [LearningPhase.INTRADAY_REVIEW]: 20, // : \n      [LearningPhase.SHORT_TERM]: 15, // : \n      [LearningPhase.LONG_TERM]: 10, // : \n    };\n\n    return phasePriorityMap[candidate.phase] || 0;\n  }\n\n  /**\n   * 0-20\n   */\n  private calculateTimingPriority(candidate: QuestionCandidate): number {\n    const now = Date.now();\n\n    // \n    if (!candidate.nextReviewTime) {\n      return 15; // \n    }\n\n    // ms\n    const timeDiff = now - candidate.nextReviewTime;\n\n    // \n    if (timeDiff >= 0) {\n      // 20\n      const hoursOverdue = timeDiff / (1000 * 60 * 60);\n      return Math.min(20, 10 + hoursOverdue * 2);\n    }\n\n    // \n    const hoursEarly = Math.abs(timeDiff) / (1000 * 60 * 60);\n\n    // 1\n    if (hoursEarly <= 1) {\n      return 10 - hoursEarly * 5;\n    }\n\n    // \n    return 0;\n  }\n\n  /**\n   * 0-10\n   */\n  private calculatePersonalPriority(candidate: QuestionCandidate): number {\n    if (!this.personalParams) {\n      return 5; // \n    }\n\n    let priority = 5;\n\n    // \n    if (candidate.reviewCount === 0 && this.personalParams.learningSpeed < 0.8) {\n      priority -= 2;\n    }\n\n    // \n    if (candidate.reviewCount === 0 && this.personalParams.learningSpeed > 1.2) {\n      priority += 2;\n    }\n\n    // \n    if (candidate.reviewCount > 0 && this.personalParams.forgettingSpeed > 1.2) {\n      priority += 3;\n    }\n\n    // \n    if (candidate.reviewCount > 0 && this.personalParams.forgettingSpeed < 0.8) {\n      priority -= 2;\n    }\n\n    return Math.max(0, Math.min(10, priority));\n  }\n\n  /**\n   * \n   */\n  private selectByStrategy(priorities: PriorityResult[]): QuestionCandidate | null {\n    if (priorities.length === 0) {\n      return null;\n    }\n\n    // \n    const newWords = priorities.filter((p) => p.candidate.reviewCount === 0);\n    const reviewWords = priorities.filter((p) => p.candidate.reviewCount > 0);\n\n    // \n    if (newWords.length === 0) {\n      return reviewWords[0]?.candidate || null;\n    }\n    if (reviewWords.length === 0) {\n      return newWords[0]?.candidate || null;\n    }\n\n    // \n    let acquisitionRatio = this.strategy.acquisitionRatio;\n    if (this.strategy.adaptiveAdjustment && this.strategy.sessionQuestionNumber !== undefined) {\n      acquisitionRatio = this.calculateAdaptiveRatio(this.strategy.sessionQuestionNumber);\n    }\n\n    // \n    const random = Math.random();\n\n    if (random < acquisitionRatio) {\n      // \n      return newWords[0].candidate;\n    } else {\n      // \n      return reviewWords[0].candidate;\n    }\n  }\n\n  /**\n   * \n   */\n  private calculateAdaptiveRatio(questionNumber: number): number {\n    // 1-10: 70%, 30%\n    if (questionNumber <= 10) {\n      return 0.7;\n    }\n\n    // 11-20: 60%, 40%\n    if (questionNumber <= 20) {\n      return 0.6;\n    }\n\n    // 21-30: 50%, 50%\n    if (questionNumber <= 30) {\n      return 0.5;\n    }\n\n    // : 40%, 60%\n    return 0.4;\n  }\n\n  /**\n   * \n   */\n  private generatePriorityReason(\n    candidate: QuestionCandidate,\n    _breakdown: PriorityResult['breakdown']\n  ): string {\n    const reasons: string[] = [];\n\n    if (candidate.queueType) {\n      reasons.push(`: ${candidate.queueType}`);\n    }\n\n    reasons.push(`: ${candidate.phase}`);\n\n    if (candidate.nextReviewTime) {\n      const now = Date.now();\n      const diff = now - candidate.nextReviewTime;\n      const hours = Math.abs(diff / (1000 * 60 * 60));\n\n      if (diff >= 0) {\n        reasons.push(`: ${hours.toFixed(1)}`);\n      } else {\n        reasons.push(`: ${hours.toFixed(1)}`);\n      }\n    }\n\n    if (candidate.reviewCount === 0) {\n      reasons.push('');\n    } else {\n      reasons.push(`${candidate.reviewCount}`);\n    }\n\n    return reasons.join(', ');\n  }\n\n  /**\n   * \n   */\n  getAllPriorities(candidates: QuestionCandidate[]): PriorityResult[] {\n    return candidates.map((c) => this.calculatePriority(c)).sort((a, b) => b.priority - a.priority);\n  }\n}\n\n/**\n * \n */\nlet defaultSelector: HybridQuestionSelector | null = null;\n\n/**\n * \n */\nexport function getDefaultSelector(): HybridQuestionSelector {\n  if (!defaultSelector) {\n    defaultSelector = new HybridQuestionSelector();\n  }\n  return defaultSelector;\n}\n\n/**\n * \n */\nexport function resetDefaultSelector(): void {\n  defaultSelector = null;\n}\n","/**\n * useAdaptiveLearning.ts\n *\n * AI\n * 3-7UI\n *\n * @author AI Assistant\n * @version 1.0\n * @since 2025-12-16\n */\n\nimport { useState, useEffect, useRef, useCallback } from 'react';\nimport { Question } from '../types';\nimport {\n  LearningPhaseDetector,\n  LearningPhase,\n  type QuestionStatus,\n} from '../strategies/learningPhaseDetector';\nimport {\n  AcquisitionQueueManager,\n  QuestionCategory,\n} from '../strategies/memoryAcquisitionAlgorithm';\nimport { MemoryRetentionManager } from '../strategies/memoryRetentionAlgorithm';\nimport {\n  PersonalParameterEstimator,\n  type PersonalParameters,\n} from '../strategies/personalParameterEstimator';\nimport {\n  HybridQuestionSelector,\n  type QuestionCandidate,\n  DEFAULT_HYBRID_STRATEGY,\n} from '../strategies/hybridQuestionSelector';\nimport { logger } from '@/utils/logger';\nimport { getWordProgress } from '../progressStorage';\n\n/**\n * WordProgressQuestionStatus\n */\nfunction convertToQuestionStatus(\n  word: string,\n  wordProgress: ReturnType<typeof getWordProgress>\n): QuestionStatus {\n  if (!wordProgress) {\n    return {\n      word,\n      reviewCount: 0,\n      correctCount: 0,\n      wrongCount: 0,\n      lastReviewTime: 0,\n      lastCorrectTime: 0,\n      averageResponseTime: 0,\n      consecutiveCorrect: 0,\n      consecutiveWrong: 0,\n    };\n  }\n\n  return {\n    word,\n    reviewCount: wordProgress.correctCount + wordProgress.incorrectCount,\n    correctCount: wordProgress.correctCount,\n    wrongCount: wordProgress.incorrectCount,\n    lastReviewTime: wordProgress.lastStudied || 0,\n    lastCorrectTime: wordProgress.consecutiveCorrect > 0 ? wordProgress.lastStudied : 0,\n    averageResponseTime: wordProgress.averageResponseTime || 0,\n    consecutiveCorrect: wordProgress.consecutiveCorrect,\n    consecutiveWrong: wordProgress.consecutiveIncorrect,\n  };\n}\n\n/**\n * \n */\nexport interface AdaptiveLearningState {\n  /**  */\n  currentPhase: LearningPhase | null;\n\n  /**  */\n  personalParams: PersonalParameters | null;\n\n  /**  */\n  queueSizes: {\n    immediate: number;\n    early: number;\n    mid: number;\n    end: number;\n  };\n\n  /**  */\n  sessionProgress: {\n    totalQuestions: number;\n    newWords: number;\n    reviews: number;\n  };\n}\n\n/**\n * \n */\nexport interface UseAdaptiveLearningResult {\n  /**  */\n  selectNextQuestion: (candidates: Question[]) => Question | null;\n\n  /**  */\n  recordAnswer: (word: string, isCorrect: boolean, responseTime: number) => void;\n\n  /**  */\n  state: AdaptiveLearningState;\n\n  /**  */\n  reset: () => void;\n\n  /**  */\n  getDebugInfo: () => any;\n}\n\n/**\n * \n *\n * @param category MEMORIZATION, TRANSLATION, SPELLING, GRAMMAR\n * @param sessionId ID\n * @returns \n *\n * @example\n * const { selectNextQuestion, recordAnswer, state } = useAdaptiveLearning('MEMORIZATION');\n *\n * // \n * const nextQuestion = selectNextQuestion(availableQuestions);\n *\n * // \n * recordAnswer(question.word, isCorrect, responseTime);\n */\nexport function useAdaptiveLearning(\n  category: QuestionCategory = QuestionCategory.MEMORIZATION,\n  sessionId?: string\n): UseAdaptiveLearningResult {\n  // Ref \n  const phaseDetectorRef = useRef<LearningPhaseDetector | null>(null);\n  const acquisitionAlgoRef = useRef<AcquisitionQueueManager | null>(null);\n  const retentionAlgoRef = useRef<MemoryRetentionManager | null>(null);\n  const paramEstimatorRef = useRef<PersonalParameterEstimator | null>(null);\n  const questionSelectorRef = useRef<HybridQuestionSelector | null>(null);\n\n  // \n  const [sessionQuestionCount, setSessionQuestionCount] = useState(0);\n  const [state, setState] = useState<AdaptiveLearningState>({\n    currentPhase: null,\n    personalParams: null,\n    queueSizes: {\n      immediate: 0,\n      early: 0,\n      mid: 0,\n      end: 0,\n    },\n    sessionProgress: {\n      totalQuestions: 0,\n      newWords: 0,\n      reviews: 0,\n    },\n  });\n\n  // \n  useEffect(() => {\n    logger.info('[useAdaptiveLearning] Initializing adaptive learning algorithms', {\n      category,\n      sessionId,\n    });\n\n    // \n    phaseDetectorRef.current = new LearningPhaseDetector();\n    acquisitionAlgoRef.current = new AcquisitionQueueManager();\n    retentionAlgoRef.current = new MemoryRetentionManager();\n    paramEstimatorRef.current = new PersonalParameterEstimator();\n    questionSelectorRef.current = new HybridQuestionSelector({\n      ...DEFAULT_HYBRID_STRATEGY,\n      sessionQuestionNumber: 0,\n    });\n\n    // LocalStorage\n    try {\n      const savedQueues = localStorage.getItem(`adaptive-learning-queues-${category}`);\n      if (savedQueues && acquisitionAlgoRef.current) {\n        // \n        logger.debug('[useAdaptiveLearning] Restored queues from localStorage');\n      }\n    } catch (error) {\n      logger.error('[useAdaptiveLearning] Failed to restore queues:', error);\n    }\n\n    // \n    try {\n      if (paramEstimatorRef.current) {\n        const params = paramEstimatorRef.current.estimateParameters();\n        setState((prev) => ({ ...prev, personalParams: params }));\n\n        // HybridQuestionSelector\n        if (questionSelectorRef.current) {\n          questionSelectorRef.current.setPersonalParameters(params);\n        }\n\n        logger.info('[useAdaptiveLearning] Personal parameters estimated:', params);\n      }\n    } catch (error) {\n      logger.error('[useAdaptiveLearning] Failed to estimate personal parameters:', error);\n    }\n\n    return () => {\n      // : \n      try {\n        if (acquisitionAlgoRef.current) {\n          const queues = acquisitionAlgoRef.current.exportQueues();\n          localStorage.setItem(`adaptive-learning-queues-${category}`, JSON.stringify(queues));\n          logger.debug('[useAdaptiveLearning] Saved queues to localStorage');\n        }\n      } catch (error) {\n        logger.error('[useAdaptiveLearning] Failed to save queues:', error);\n      }\n    };\n  }, [category, sessionId]);\n\n  /**\n   * \n   */\n  const selectNextQuestion = useCallback(\n    (candidates: Question[]): Question | null => {\n      if (\n        !questionSelectorRef.current ||\n        !phaseDetectorRef.current ||\n        !acquisitionAlgoRef.current\n      ) {\n        logger.warn('[useAdaptiveLearning] Algorithms not initialized');\n        return candidates.length > 0 ? candidates[0] : null;\n      }\n\n      try {\n        // QuestionCandidate\n        const questionCandidates: QuestionCandidate[] = candidates.map((q) => {\n          const wordProgress = getWordProgress(q.word);\n          const status = convertToQuestionStatus(q.word, wordProgress);\n          const phase = phaseDetectorRef.current!.detectPhase(q.word, status);\n          const queueInfo = acquisitionAlgoRef.current!.getQueueInfo(q.word);\n\n          return {\n            id: q.word,\n            word: q.word,\n            category,\n            phase,\n            reviewCount: status.reviewCount,\n            correctCount: status.correctCount,\n            lastReviewTime: status.lastReviewTime || Date.now(),\n            queueType: queueInfo?.queueType,\n            questionNumber: queueInfo?.questionNumber,\n            difficulty: parseInt(q.difficulty) || 3,\n          };\n        });\n\n        // HybridQuestionSelector\n        questionSelectorRef.current.updateStrategy({\n          sessionQuestionNumber: sessionQuestionCount,\n        });\n\n        const selected = questionSelectorRef.current.selectNextQuestion(questionCandidates);\n\n        if (selected) {\n          const selectedQuestion = candidates.find((q) => q.word === selected.word);\n\n          // \n          setSessionQuestionCount((prev) => prev + 1);\n          setState((prev) => ({\n            ...prev,\n            currentPhase: selected.phase,\n            sessionProgress: {\n              totalQuestions: prev.sessionProgress.totalQuestions + 1,\n              newWords: prev.sessionProgress.newWords + (selected.reviewCount === 0 ? 1 : 0),\n              reviews: prev.sessionProgress.reviews + (selected.reviewCount > 0 ? 1 : 0),\n            },\n          }));\n\n          logger.debug('[useAdaptiveLearning] Selected question:', {\n            word: selected.word,\n            phase: selected.phase,\n            queueType: selected.queueType,\n          });\n\n          return selectedQuestion || null;\n        }\n\n        return null;\n      } catch (error) {\n        logger.error('[useAdaptiveLearning] Error selecting question:', error);\n        return candidates.length > 0 ? candidates[0] : null;\n      }\n    },\n    [category, sessionQuestionCount]\n  );\n\n  /**\n   * \n   */\n  const recordAnswer = useCallback(\n    (word: string, isCorrect: boolean, responseTime: number) => {\n      try {\n        // \n        if (phaseDetectorRef.current) {\n          const wordProgress = getWordProgress(word);\n          const status = convertToQuestionStatus(word, wordProgress);\n          const phase = phaseDetectorRef.current.detectPhase(word, status);\n          setState((prev) => ({ ...prev, currentPhase: phase }));\n        }\n\n        // \n        if (acquisitionAlgoRef.current) {\n          acquisitionAlgoRef.current.recordAnswer(word, isCorrect, responseTime);\n\n          // \n          const queueSizes = acquisitionAlgoRef.current.getQueueSizes();\n          setState((prev) => ({ ...prev, queueSizes }));\n        }\n\n        // \n        if (retentionAlgoRef.current) {\n          retentionAlgoRef.current.recordReview(word, {\n            isCorrect,\n            confidence: isCorrect ? 3 : 0, // 0\n            responseTime,\n            timestamp: Date.now(),\n          });\n        }\n\n        // \n        if (paramEstimatorRef.current) {\n          paramEstimatorRef.current.addHistory({\n            word,\n            timestamp: Date.now(),\n            isCorrect,\n            responseTime,\n            reviewNumber: 1, // TODO: \n            daysSinceFirstSeen: 0, // TODO: \n          });\n\n          // 20\n          if (sessionQuestionCount > 0 && sessionQuestionCount % 20 === 0) {\n            const params = paramEstimatorRef.current.estimateParameters();\n            setState((prev) => ({ ...prev, personalParams: params }));\n\n            if (questionSelectorRef.current) {\n              questionSelectorRef.current.setPersonalParameters(params);\n            }\n\n            logger.info('[useAdaptiveLearning] Personal parameters updated:', params);\n          }\n        }\n\n        logger.debug('[useAdaptiveLearning] Recorded answer:', { word, isCorrect, responseTime });\n      } catch (error) {\n        logger.error('[useAdaptiveLearning] Error recording answer:', error);\n      }\n    },\n    [sessionQuestionCount]\n  );\n\n  /**\n   * \n   */\n  const reset = useCallback(() => {\n    logger.info('[useAdaptiveLearning] Resetting adaptive learning algorithms');\n\n    setSessionQuestionCount(0);\n    setState({\n      currentPhase: null,\n      personalParams: null,\n      queueSizes: {\n        immediate: 0,\n        early: 0,\n        mid: 0,\n        end: 0,\n      },\n      sessionProgress: {\n        totalQuestions: 0,\n        newWords: 0,\n        reviews: 0,\n      },\n    });\n\n    // \n    if (acquisitionAlgoRef.current) {\n      acquisitionAlgoRef.current.clearQueues();\n    }\n\n    // \n    if (paramEstimatorRef.current) {\n      paramEstimatorRef.current.clearHistory();\n    }\n  }, []);\n\n  /**\n   * \n   */\n  const getDebugInfo = useCallback(() => {\n    return {\n      sessionQuestionCount,\n      state,\n      queues: acquisitionAlgoRef.current?.exportQueues() || null,\n      personalParams: state.personalParams,\n    };\n  }, [sessionQuestionCount, state]);\n\n  return {\n    selectNextQuestion,\n    recordAnswer,\n    state,\n    reset,\n    getDebugInfo,\n  };\n}\n","import { useState, useEffect } from 'react';\nimport { QuizState, QuestionSet } from '../types';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\nimport {\n  DifficultyLevel,\n  WordPhraseFilter,\n  PhraseTypeFilter,\n  OFFICIAL_CATEGORIES,\n  DataSource,\n} from '../App';\nimport { ErrorPrediction } from '@/ai/prediction/errorPredictionAI';\nimport ScoreBoard from './ScoreBoard';\nimport QuestionCard from './QuestionCard';\nimport LearningLimitsInput from './LearningLimitsInput';\nimport { useLearningLimits } from '../hooks/useLearningLimits';\nimport { logger } from '@/utils/logger';\nimport { TranslationStrategy } from '../strategies/TranslationStrategy';\nimport { useAdaptiveLearning } from '../hooks/useAdaptiveLearning';\nimport { QuestionCategory } from '../strategies/memoryAcquisitionAlgorithm';\n\ninterface QuizViewProps {\n  quizState: QuizState;\n  _categoryList: string[];\n  selectedCategory: string;\n  onCategoryChange: (category: string) => void;\n  selectedDifficulty: DifficultyLevel;\n  onDifficultyChange: (level: DifficultyLevel) => void;\n  selectedWordPhraseFilter?: WordPhraseFilter;\n  onWordPhraseFilterChange?: (filter: WordPhraseFilter) => void;\n  selectedPhraseTypeFilter?: PhraseTypeFilter;\n  onPhraseTypeFilterChange?: (filter: PhraseTypeFilter) => void;\n  selectedDataSource?: DataSource;\n  onDataSourceChange?: (source: DataSource) => void;\n  questionSets?: QuestionSet[];\n  onStartQuiz: () => void;\n  onAnswer: (answer: string, correct: string) => void | Promise<void>;\n  onNext: () => void;\n  onPrevious: () => void;\n  onSkip?: () => void | Promise<void>;\n  onDifficultyRate?: (rating: number) => void;\n  onReviewFocus?: () => void;\n  sessionStats?: {\n    correct: number;\n    incorrect: number;\n    review: number;\n    mastered: number;\n  };\n  isReviewFocusMode?: boolean;\n  errorPrediction?: ErrorPrediction;\n  customQuestionSets?: CustomQuestionSet[];\n  onAddWordToCustomSet?: (setId: string, word: CustomWord) => void;\n  onRemoveWordFromCustomSet?: (setId: string, word: CustomWord) => void;\n  onOpenCustomSetManagement?: () => void;\n}\n\nfunction QuizView({\n  quizState,\n  _categoryList,\n  selectedCategory,\n  onCategoryChange,\n  selectedDifficulty,\n  onDifficultyChange,\n  selectedWordPhraseFilter = 'all',\n  onWordPhraseFilterChange,\n  selectedPhraseTypeFilter = 'all',\n  onPhraseTypeFilterChange,\n  selectedDataSource = 'all',\n  onDataSourceChange,\n  questionSets = [],\n  onStartQuiz: _onStartQuiz,\n  onAnswer,\n  onNext,\n  onPrevious,\n  onSkip,\n  onDifficultyRate,\n  onReviewFocus,\n  sessionStats,\n  isReviewFocusMode = false,\n  errorPrediction,\n  customQuestionSets = [],\n  onAddWordToCustomSet,\n  onRemoveWordFromCustomSet,\n  onOpenCustomSetManagement,\n}: QuizViewProps) {\n  const { questions, currentIndex, answered, selectedAnswer } = quizState;\n\n  const hasQuestions = questions.length > 0;\n  const currentQuestion = hasQuestions ? questions[currentIndex] : null;\n\n  const [showSettings, setShowSettings] = useState<boolean>(false);\n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  // ScoreBoard\n  const [lastAnswerTime, setLastAnswerTime] = useState<number>(Date.now());\n\n  // AI\n  const [lastAnswerCorrect, setLastAnswerCorrect] = useState<boolean | undefined>(undefined);\n  const [lastAnswerWord, setLastAnswerWord] = useState<string | undefined>(undefined);\n  const [correctStreak, setCorrectStreak] = useState<number>(0);\n  const [incorrectStreak, setIncorrectStreak] = useState<number>(0);\n\n  // \n  const adaptiveLearning = useAdaptiveLearning(QuestionCategory.TRANSLATION);\n\n  // \n  const { learningLimit, reviewLimit, setLearningLimit, setReviewLimit } =\n    useLearningLimits('translation');\n\n  // \n  const [autoNext, setAutoNext] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoNext');\n    return saved === 'true';\n  });\n\n  const [autoNextDelay, setAutoNextDelay] = useState<number>(() => {\n    const saved = localStorage.getItem('autoNextDelay');\n    return saved ? parseInt(saved, 10) : 1500;\n  });\n\n  // \n  const [autoShowDetails, setAutoShowDetails] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoShowDetails');\n    return saved !== 'false'; // true\n  });\n\n  // \n  const handleAnswer = async (answer: string, correct: string) => {\n    const isCorrect = answer === correct;\n\n    // \n    setLastAnswerCorrect(isCorrect);\n    setLastAnswerWord(currentQuestion?.word);\n    if (isCorrect) {\n      setCorrectStreak((prev) => prev + 1);\n      setIncorrectStreak(0);\n    } else {\n      setIncorrectStreak((prev) => prev + 1);\n      setCorrectStreak(0);\n    }\n\n    await onAnswer(answer, correct);\n    // \n    setLastAnswerTime(Date.now());\n\n    // \n    if (currentQuestion?.word) {\n      adaptiveLearning.recordAnswer(currentQuestion.word, isCorrect, 3000); // 3\n    }\n\n    // \n    if (autoNext && isCorrect) {\n      setTimeout(() => {\n        // lastAnswerWord\n        setLastAnswerWord(undefined);\n        onNext();\n      }, autoNextDelay);\n    }\n  };\n\n  // onNextlastAnswerWord\n  const handleNextWrapper = () => {\n    setLastAnswerWord(undefined);\n    onNext();\n  };\n\n  // \n  const handleSkipWrapper = async () => {\n    if (onSkip) {\n      await onSkip();\n      setLastAnswerTime(Date.now());\n    }\n  };\n\n  // \n  const learningPlan = localStorage.getItem('learning-schedule-90days');\n  const hasPlan = !!learningPlan;\n  let planStatus = null;\n  if (hasPlan) {\n    try {\n      const schedule = JSON.parse(learningPlan);\n      const daysPassed = Math.floor((Date.now() - schedule.startDate) / (1000 * 60 * 60 * 24));\n      const currentDay = Math.min(daysPassed + 1, schedule.totalDays);\n      const progressPercent = Math.round((currentDay / schedule.totalDays) * 100);\n      planStatus = {\n        currentDay,\n        totalDays: schedule.totalDays,\n        progressPercent,\n        phase: schedule.phase,\n      };\n    } catch (e) {\n      logger.error('Failed to parse learning plan:', e);\n    }\n  }\n\n  // \n  const toggleFullscreen = () => {\n    setIsFullscreen(!isFullscreen);\n  };\n\n  // \n  if (isFullscreen && hasQuestions && currentQuestion) {\n    return (\n      <div className=\"fixed inset-0 z-50 bg-gray-50 overflow-y-auto\">\n        <div className=\"min-h-screen flex items-center justify-center py-8\">\n          {/*  */}\n          <button\n            onClick={toggleFullscreen}\n            className=\"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition\"\n            aria-label=\"\"\n          >\n            <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n              <path\n                strokeLinecap=\"round\"\n                strokeLinejoin=\"round\"\n                strokeWidth={2}\n                d=\"M6 18L18 6M6 6l12 12\"\n              />\n            </svg>\n          </button>\n\n          <div className=\"w-full max-w-4xl px-4\">\n            <QuestionCard\n              question={currentQuestion}\n              questionNumber={currentIndex + 1}\n              allQuestions={questions}\n              currentIndex={currentIndex}\n              answered={answered}\n              selectedAnswer={selectedAnswer}\n              onAnswer={handleAnswer}\n              onNext={\n                onSkip ? (answered ? handleNextWrapper : handleSkipWrapper) : handleNextWrapper\n              }\n              onPrevious={onPrevious}\n              onDifficultyRate={onDifficultyRate}\n              errorPrediction={errorPrediction}\n              customQuestionSets={customQuestionSets}\n              onAddWordToCustomSet={onAddWordToCustomSet}\n              onRemoveWordFromCustomSet={onRemoveWordFromCustomSet}\n              onOpenCustomSetManagement={onOpenCustomSetManagement}\n              onFullscreen={toggleFullscreen}\n            />\n          </div>\n        </div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"quiz-view\">\n      {/*  */}\n      {hasPlan && planStatus && (\n        <div className=\"plan-progress-banner\">\n          <div className=\"plan-progress-content\">\n            <span className=\"plan-progress-icon\"></span>\n            <div className=\"plan-progress-info\">\n              <div className=\"plan-progress-title\"></div>\n              <div className=\"plan-progress-detail\">\n                {planStatus.currentDay} / {planStatus.totalDays} (Phase {planStatus.phase}) -{' '}\n                {planStatus.progressPercent}%\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {hasQuestions && (\n        <>\n          {/*  */}\n          <div className=\"mb-4 flex justify-center\">\n            <div className=\"w-full max-w-4xl\">\n              <ScoreBoard\n                mode=\"translation\"\n                currentScore={quizState.score}\n                totalAnswered={quizState.totalAnswered}\n                sessionCorrect={sessionStats?.correct}\n                sessionIncorrect={sessionStats?.incorrect}\n                sessionReview={sessionStats?.review}\n                sessionMastered={sessionStats?.mastered}\n                sessionStats={sessionStats}\n                onReviewFocus={onReviewFocus}\n                isReviewFocusMode={isReviewFocusMode}\n                onShowSettings={() => setShowSettings(true)}\n                currentWord={currentQuestion?.word}\n                onAnswerTime={lastAnswerTime}\n                lastAnswerCorrect={lastAnswerCorrect}\n                lastAnswerWord={lastAnswerWord}\n                lastAnswerDifficulty={currentQuestion?.difficulty}\n                correctStreak={correctStreak}\n                incorrectStreak={incorrectStreak}\n                learningPhase={\n                  (adaptiveLearning.state.currentPhase as unknown as\n                    | 'ENCODING'\n                    | 'INITIAL_CONSOLIDATION'\n                    | 'LONG_TERM_RETENTION'\n                    | 'MASTERED'\n                    | undefined) ?? undefined\n                }\n                estimatedSpeed={adaptiveLearning.state.personalParams?.learningSpeed}\n                dataSource={\n                  questionSets?.find((qs) => qs.id === selectedDataSource)?.name || ''\n                }\n                category={selectedCategory === '' ? '' : selectedCategory}\n                difficulty={selectedDifficulty}\n                wordPhraseFilter={selectedWordPhraseFilter}\n              />\n            </div>\n          </div>\n\n          {/*  */}\n          {showSettings && (\n            <div className=\"study-settings-panel\">\n              <div className=\"settings-header\">\n                <h3> </h3>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600\"\n                >\n                   \n                </button>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"category-select-quiz\"> :</label>\n                <select\n                  id=\"category-select-quiz\"\n                  value={selectedCategory}\n                  onChange={(e) => onCategoryChange(e.target.value)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  {OFFICIAL_CATEGORIES.map((category) => (\n                    <option key={category} value={category}>\n                      {category}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"difficulty-select-quiz\"> :</label>\n                <select\n                  id=\"difficulty-select-quiz\"\n                  value={selectedDifficulty}\n                  onChange={(e) => onDifficultyChange(e.target.value as DifficultyLevel)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  <option value=\"beginner\"></option>\n                  <option value=\"intermediate\"></option>\n                  <option value=\"advanced\"></option>\n                </select>\n              </div>\n\n              {onDataSourceChange && questionSets && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"data-source-select-quiz\"> :</label>\n                  <select\n                    id=\"data-source-select-quiz\"\n                    value={selectedDataSource}\n                    onChange={(e) => onDataSourceChange(e.target.value as DataSource)}\n                    className=\"select-input\"\n                  >\n                    {questionSets.map((set) => (\n                      <option key={set.id} value={set.id}>\n                        {set.name}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n              )}\n\n              {onWordPhraseFilterChange && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"word-phrase-filter-quiz\"> /:</label>\n                  <select\n                    id=\"word-phrase-filter-quiz\"\n                    value={selectedWordPhraseFilter}\n                    onChange={(e) => onWordPhraseFilterChange(e.target.value as WordPhraseFilter)}\n                    className=\"select-input\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"words-only\"></option>\n                    <option value=\"phrases-only\"></option>\n                  </select>\n                </div>\n              )}\n\n              {onPhraseTypeFilterChange && selectedWordPhraseFilter === 'phrases-only' && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"phrase-type-filter-quiz\"> :</label>\n                  <select\n                    id=\"phrase-type-filter-quiz\"\n                    value={selectedPhraseTypeFilter}\n                    onChange={(e) => onPhraseTypeFilterChange(e.target.value as PhraseTypeFilter)}\n                    className=\"select-input\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"phrasal-verb\"></option>\n                    <option value=\"idiom\"></option>\n                    <option value=\"collocation\"></option>\n                    <option value=\"other\"></option>\n                  </select>\n                </div>\n              )}\n\n              <LearningLimitsInput\n                learningLimit={learningLimit}\n                reviewLimit={reviewLimit}\n                onLearningLimitChange={setLearningLimit}\n                onReviewLimitChange={setReviewLimit}\n                idPrefix=\"quiz-\"\n              />\n\n              {/*  */}\n              <div className=\"filter-group\">\n                <div className=\"checkbox-row\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"auto-next-toggle\"\n                    checked={autoNext}\n                    onChange={(e) => {\n                      setAutoNext(e.target.checked);\n                      localStorage.setItem('autoNext', e.target.checked.toString());\n                    }}\n                  />\n                  <label htmlFor=\"auto-next-toggle\" className=\"checkbox-label\">\n                    {autoNext ? '' : ''}\n                  </label>\n                </div>\n              </div>\n\n              {autoNext && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"auto-next-delay\"> </label>\n                  <div className=\"slider-row\">\n                    <input\n                      type=\"range\"\n                      id=\"auto-next-delay\"\n                      min=\"500\"\n                      max=\"3000\"\n                      step=\"100\"\n                      value={autoNextDelay}\n                      onChange={(e) => {\n                        const delay = parseInt(e.target.value, 10);\n                        setAutoNextDelay(delay);\n                        localStorage.setItem('autoNextDelay', delay.toString());\n                      }}\n                      className=\"slider-input\"\n                    />\n                    <span className=\"slider-value\">{(autoNextDelay / 1000).toFixed(1)}</span>\n                  </div>\n                </div>\n              )}\n\n              {/*  */}\n              <div className=\"filter-group\">\n                <div className=\"checkbox-row\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"auto-show-details-toggle\"\n                    checked={autoShowDetails}\n                    onChange={(e) => {\n                      setAutoShowDetails(e.target.checked);\n                      localStorage.setItem('autoShowDetails', e.target.checked.toString());\n                    }}\n                  />\n                  <label htmlFor=\"auto-show-details-toggle\" className=\"checkbox-label\">\n                    {autoShowDetails ? '' : ''}\n                  </label>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"question-container\">\n            {currentQuestion && (\n              <>\n                <QuestionCard\n                  question={currentQuestion}\n                  questionNumber={currentIndex + 1}\n                  allQuestions={questions}\n                  currentIndex={currentIndex}\n                  answered={answered}\n                  selectedAnswer={selectedAnswer}\n                  onAnswer={handleAnswer}\n                  onNext={\n                    onSkip ? (answered ? handleNextWrapper : handleSkipWrapper) : handleNextWrapper\n                  }\n                  onPrevious={onPrevious}\n                  onDifficultyRate={onDifficultyRate}\n                  errorPrediction={errorPrediction}\n                  customQuestionSets={customQuestionSets}\n                  onAddWordToCustomSet={onAddWordToCustomSet}\n                  onRemoveWordFromCustomSet={onRemoveWordFromCustomSet}\n                  onOpenCustomSetManagement={onOpenCustomSetManagement}\n                  onFullscreen={toggleFullscreen}\n                />\n              </>\n            )}\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default QuizView;\n","import { useState, useEffect, useRef } from 'react';\nimport type { Question, SpellingState } from '@/types';\n\n/**\n * \n *\n * :\n * - \n * - \n * - \n * - \n */\nexport function useSpellingGame(questions: Question[]) {\n  // \n  const [spellingState, setSpellingState] = useState<SpellingState>({\n    questions: [],\n    currentIndex: 0,\n    score: 0,\n    totalAnswered: 0,\n    answered: false,\n    selectedLetters: [],\n    correctWord: '',\n  });\n\n  // \n  const [shuffledLetters, setShuffledLetters] = useState<string[]>([]);\n\n  // \n  const [selectedSequence, setSelectedSequence] = useState<string[]>([]);\n\n  // \n  const [phraseWords, setPhraseWords] = useState<string[]>([]);\n\n  // \n  const [currentWordIndex, setCurrentWordIndex] = useState<number>(0);\n\n  // \n  const [completedWords, setCompletedWords] = useState<string[]>([]);\n\n  // \n  const questionStartTimeRef = useRef<number>(0);\n\n  // questions\n  useEffect(() => {\n    if (questions.length > 0) {\n      setSpellingState({\n        questions,\n        currentIndex: 0,\n        score: 0,\n        totalAnswered: 0,\n        answered: false,\n        selectedLetters: [],\n        correctWord: '',\n      });\n    }\n  }, [questions]);\n\n  // \n  useEffect(() => {\n    if (spellingState.questions.length > 0) {\n      const currentQuestion = spellingState.questions[spellingState.currentIndex];\n      const word = currentQuestion.word.toLowerCase();\n\n      // \n      if (word.includes(' ')) {\n        // \n        const words = word.split(/\\s+/);\n        setPhraseWords(words);\n        setCurrentWordIndex(0);\n        setCompletedWords([]);\n\n        // \n        const firstWordLetters = words[0].split('');\n        const shuffled = [...firstWordLetters].sort(() => Math.random() - 0.5);\n        setShuffledLetters(shuffled);\n\n        setSpellingState((prev) => ({\n          ...prev,\n          correctWord: word.replace(/\\s+/g, ''),\n          answered: false,\n        }));\n      } else {\n        // \n        setPhraseWords([]);\n        setCurrentWordIndex(0);\n        setCompletedWords([]);\n\n        const letters = word.split('');\n        const shuffled = [...letters].sort(() => Math.random() - 0.5);\n        setShuffledLetters(shuffled);\n\n        setSpellingState((prev) => ({\n          ...prev,\n          correctWord: word,\n          answered: false,\n        }));\n      }\n\n      setSelectedSequence([]);\n\n      // \n      questionStartTimeRef.current = Date.now();\n    }\n  }, [spellingState.currentIndex, spellingState.questions]);\n\n  /**\n   * \n   */\n  const handleLetterClick = (index: number) => {\n    // \n    if (spellingState.answered) {\n      // /\n      if (selectedSequence.includes(`${index}`)) {\n        setSelectedSequence(selectedSequence.filter((idx) => idx !== `${index}`));\n      } else {\n        const newSequence = [...selectedSequence, `${index}`];\n        setSelectedSequence(newSequence);\n      }\n      return;\n    }\n\n    // \n    if (selectedSequence.includes(`${index}`)) return;\n\n    const newSequence = [...selectedSequence, `${index}`];\n    setSelectedSequence(newSequence);\n\n    // \n    if (newSequence.length === shuffledLetters.length) {\n      return newSequence; // \n    }\n\n    return null;\n  };\n\n  /**\n   * \n   * @returns { isCorrect, userWord, responseTime }\n   */\n  const checkAnswer = (sequence: string[]) => {\n    const userWord = sequence.map((idx) => shuffledLetters[parseInt(idx)]).join('');\n    const responseTime = Date.now() - questionStartTimeRef.current;\n\n    // \n    if (phraseWords.length > 0) {\n      const currentTargetWord = phraseWords[currentWordIndex];\n      const isWordCorrect = userWord === currentTargetWord;\n\n      if (isWordCorrect) {\n        // \n        const newCompletedWords = [...completedWords, userWord];\n        setCompletedWords(newCompletedWords);\n\n        if (currentWordIndex < phraseWords.length - 1) {\n          // \n          const nextWordIndex = currentWordIndex + 1;\n          setCurrentWordIndex(nextWordIndex);\n\n          const nextWordLetters = phraseWords[nextWordIndex].split('');\n          const shuffled = [...nextWordLetters].sort(() => Math.random() - 0.5);\n          setShuffledLetters(shuffled);\n          setSelectedSequence([]);\n\n          return { isPartialCorrect: true, isComplete: false, userWord, responseTime };\n        } else {\n          // \n          const fullUserWord = newCompletedWords.join('');\n          const isFullCorrect = fullUserWord === spellingState.correctWord;\n\n          return {\n            isPartialCorrect: true,\n            isComplete: true,\n            isCorrect: isFullCorrect,\n            userWord: fullUserWord,\n            responseTime,\n          };\n        }\n      } else {\n        // \n        const fullUserWord = [...completedWords, userWord].join('');\n        return {\n          isPartialCorrect: false,\n          isComplete: true,\n          isCorrect: false,\n          userWord: fullUserWord,\n          responseTime,\n        };\n      }\n    } else {\n      // \n      const isCorrect = userWord === spellingState.correctWord;\n      return { isComplete: true, isCorrect, userWord, responseTime };\n    }\n  };\n\n  /**\n   * \n   */\n  const moveToNextQuestion = () => {\n    setSpellingState((prev) => ({\n      ...prev,\n      currentIndex: prev.currentIndex + 1,\n      answered: false,\n    }));\n  };\n\n  /**\n   * \n   */\n  const updateScore = (isCorrect: boolean) => {\n    setSpellingState((prev) => ({\n      ...prev,\n      score: isCorrect ? prev.score + 1 : prev.score,\n      totalAnswered: prev.totalAnswered + 1,\n      answered: true,\n    }));\n  };\n\n  /**\n   * \n   */\n  const resetAnswer = () => {\n    setSelectedSequence([]);\n    setSpellingState((prev) => ({\n      ...prev,\n      answered: false,\n    }));\n\n    // \n    if (phraseWords.length > 0) {\n      const currentWordLetters = phraseWords[currentWordIndex].split('');\n      const shuffled = [...currentWordLetters].sort(() => Math.random() - 0.5);\n      setShuffledLetters(shuffled);\n    } else {\n      const currentQuestion = spellingState.questions[spellingState.currentIndex];\n      const letters = currentQuestion.word.toLowerCase().split('');\n      const shuffled = [...letters].sort(() => Math.random() - 0.5);\n      setShuffledLetters(shuffled);\n    }\n\n    questionStartTimeRef.current = Date.now();\n  };\n\n  return {\n    spellingState,\n    setSpellingState,\n    shuffledLetters,\n    selectedSequence,\n    setSelectedSequence,\n    phraseWords,\n    currentWordIndex,\n    completedWords,\n    handleLetterClick,\n    checkAnswer,\n    moveToNextQuestion,\n    updateScore,\n    resetAnswer,\n  };\n}\n","import { useState } from 'react';\n\n/**\n * \n */\nexport interface SessionStats {\n  correct: number;\n  incorrect: number;\n  review: number;\n  mastered: number;\n  newQuestions: number;      // \n  reviewQuestions: number;   // \n  consecutiveNew: number;    // \n  consecutiveReview: number; // \n}\n\n/**\n * \n *\n * \n */\nexport function useSessionStats() {\n  const [sessionStats, setSessionStats] = useState<SessionStats>({\n    correct: 0,\n    incorrect: 0,\n    review: 0,\n    mastered: 0,\n    newQuestions: 0,\n    reviewQuestions: 0,\n    consecutiveNew: 0,\n    consecutiveReview: 0,\n  });\n\n  /**\n   * \n   */\n  const resetStats = () => {\n    setSessionStats({\n      correct: 0,\n      incorrect: 0,\n      review: 0,\n      mastered: 0,\n      newQuestions: 0,\n      reviewQuestions: 0,\n      consecutiveNew: 0,\n      consecutiveReview: 0,\n    });\n  };\n\n  /**\n   * \n   */\n  const updateStats = (status: 'correct' | 'incorrect' | 'review' | 'mastered') => {\n    setSessionStats((prev) => ({\n      ...prev,\n      correct: prev.correct + (status === 'correct' ? 1 : 0),\n      incorrect: prev.incorrect + (status === 'incorrect' ? 1 : 0),\n      review: prev.review + (status === 'review' ? 1 : 0),\n      mastered: prev.mastered + (status === 'mastered' ? 1 : 0),\n    }));\n  };\n\n  return {\n    sessionStats,\n    setSessionStats,\n    resetStats,\n    updateStats,\n  };\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { Question } from '../types';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\nimport {\n  DifficultyLevel,\n  WordPhraseFilter,\n  PhraseTypeFilter,\n  OFFICIAL_CATEGORIES,\n  DataSource,\n} from '../App';\nimport ScoreBoard from './ScoreBoard';\nimport LearningLimitsInput from './LearningLimitsInput';\nimport AddToCustomButton from './AddToCustomButton';\nimport {\n  addQuizResult,\n  updateWordProgress,\n  recordWordSkip,\n  loadProgress,\n  addSessionHistory,\n} from '../progressStorage';\nimport {\n  addToSkipGroup,\n  handleSkippedWordIncorrect,\n  handleSkippedWordCorrect,\n} from '../learningAssistant';\nimport { generateId } from '../utils';\nimport { speakEnglish, isSpeechSynthesisSupported } from '@/features/speech/speechSynthesis';\nimport { logger } from '@/utils/logger';\nimport { useLearningLimits } from '../hooks/useLearningLimits';\nimport { useSpellingGame } from '../hooks/useSpellingGame';\nimport { useSessionStats } from '../hooks/useSessionStats';\nimport { useAdaptiveLearning } from '../hooks/useAdaptiveLearning';\nimport { QuestionCategory } from '../strategies/memoryAcquisitionAlgorithm';\nimport { sortQuestionsByPriority } from '../utils/questionPrioritySorter';\nimport { sessionKpi } from '../metrics/sessionKpi';\nimport { useQuestionRequeue } from '../hooks/useQuestionRequeue';\n\ninterface SpellingViewProps {\n  questions: Question[];\n  _categoryList: string[];\n  selectedCategory: string;\n  onCategoryChange: (category: string) => void;\n  selectedDifficulty: DifficultyLevel;\n  onDifficultyChange: (level: DifficultyLevel) => void;\n  selectedWordPhraseFilter?: WordPhraseFilter;\n  onWordPhraseFilterChange?: (filter: WordPhraseFilter) => void;\n  selectedPhraseTypeFilter?: PhraseTypeFilter;\n  onPhraseTypeFilterChange?: (filter: PhraseTypeFilter) => void;\n  selectedDataSource?: DataSource;\n  onDataSourceChange?: (source: DataSource) => void;\n  onStartQuiz: () => void;\n  onReviewFocus?: () => void;\n  isReviewFocusMode?: boolean;\n  customQuestionSets?: CustomQuestionSet[];\n  onAddWordToCustomSet?: (setId: string, word: CustomWord) => void;\n  onRemoveWordFromCustomSet?: (setId: string, word: CustomWord) => void;\n  onOpenCustomSetManagement?: () => void;\n}\n\nfunction SpellingView({\n  questions,\n  _categoryList,\n  selectedCategory,\n  onCategoryChange,\n  selectedDifficulty,\n  onDifficultyChange,\n  selectedWordPhraseFilter = 'all',\n  onWordPhraseFilterChange,\n  selectedPhraseTypeFilter = 'all',\n  onPhraseTypeFilterChange,\n  selectedDataSource = 'all',\n  onDataSourceChange,\n  onStartQuiz,\n  onReviewFocus,\n  isReviewFocusMode = false,\n  customQuestionSets = [],\n  onAddWordToCustomSet,\n  onRemoveWordFromCustomSet,\n  onOpenCustomSetManagement,\n}: SpellingViewProps) {\n  // \n  const {\n    spellingState,\n    setSpellingState,\n    shuffledLetters,\n    selectedSequence,\n    setSelectedSequence,\n    phraseWords,\n    completedWords,\n    handleLetterClick: handleLetterClickCore,\n    checkAnswer,\n    moveToNextQuestion,\n    updateScore,\n  } = useSpellingGame(questions);\n\n  // \n  const { sessionStats, setSessionStats, resetStats, updateStats } = useSessionStats();\n\n  // \n  const adaptiveLearning = useAdaptiveLearning(QuestionCategory.SPELLING);\n\n  // \n  const { reAddQuestion, clearExpiredFlags, updateRequeueStats } = useQuestionRequeue<Question>();\n\n  const [showSettings, setShowSettings] = useState<boolean>(false);\n  const [_isFullscreen, _setIsFullscreen] = useState(false);\n\n  // ScoreBoard\n  const [lastAnswerTime, setLastAnswerTime] = useState<number>(Date.now());\n\n  // AI\n  const [lastAnswerCorrect, setLastAnswerCorrect] = useState<boolean | undefined>(undefined);\n  const [lastAnswerWord, setLastAnswerWord] = useState<string | undefined>(undefined);\n  const [correctStreak, setCorrectStreak] = useState<number>(0);\n  const [incorrectStreak, setIncorrectStreak] = useState<number>(0);\n\n  // \n  const { learningLimit, reviewLimit, setLearningLimit, setReviewLimit } =\n    useLearningLimits('spelling');\n\n  // \n  const [_autoNext, _setAutoNext] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoNext');\n    return saved === 'true';\n  });\n\n  const [_autoNextDelay, _setAutoNextDelay] = useState<number>(() => {\n    const saved = localStorage.getItem('autoNextDelay');\n    return saved ? parseInt(saved, 10) : 1500;\n  });\n\n  // letter-cardsref\n  const letterCardsRef = useRef<HTMLDivElement>(null);\n\n  // \n  const quizStartTimeRef = useRef<number>(0);\n  const questionStartTimeRef = useRef<number>(0); // \n  const incorrectWordsRef = useRef<string[]>([]);\n\n  // questions\n  useEffect(() => {\n    if (questions.length > 0) {\n      // \n      quizStartTimeRef.current = Date.now();\n      incorrectWordsRef.current = [];\n\n      // \n      resetStats();\n    }\n  }, [questions, resetStats]);\n\n  // letter-cards\n  useEffect(() => {\n    if (!spellingState.answered && letterCardsRef.current) {\n      const timer = setTimeout(() => {\n        letterCardsRef.current?.focus();\n      }, 100);\n      return () => clearTimeout(timer);\n    }\n  }, [spellingState.answered, spellingState.currentIndex, spellingState.questions.length]);\n\n  // \n  const handleLetterClick = (_letter: string, index: number) => {\n    const result = handleLetterClickCore(index);\n\n    // \n    if (result && result.length === shuffledLetters.length) {\n      setTimeout(() => handleCheckAnswer(result), 300);\n    }\n  };\n\n  // checkAnswer\n  const handleCheckAnswer = async (sequence: string[]) => {\n    const result = checkAnswer(sequence);\n\n    if (!result) return;\n\n    // \n    if (result.isPartialCorrect && !result.isComplete) {\n      return; // useSpellingGame\n    }\n\n    // \n    if (result.isComplete) {\n      await processAnswer(result.userWord, result.isCorrect || false, result.responseTime);\n    }\n  };\n\n  // \n  const processAnswer = async (_userWord: string, isCorrect: boolean, responseTime: number) => {\n    const currentQuestion = spellingState.questions[spellingState.currentIndex];\n\n    // AI\n    setLastAnswerCorrect(isCorrect);\n    setLastAnswerWord(currentQuestion.word);\n    if (isCorrect) {\n      setCorrectStreak((prev) => prev + 1);\n      setIncorrectStreak(0);\n    } else {\n      setIncorrectStreak((prev) => prev + 1);\n      setCorrectStreak(0);\n    }\n\n    // \n    if (currentQuestion) {\n      await updateWordProgress(\n        currentQuestion.word,\n        isCorrect,\n        responseTime,\n        undefined,\n        'spelling'\n      );\n\n      // ScoreBoard- updateWordProgress\n      setLastAnswerTime(Date.now());\n\n      // \n      adaptiveLearning.recordAnswer(currentQuestion.word, isCorrect, responseTime);\n\n      // AI: \n      const progress = await loadProgress();\n      const wordProgress = progress.wordProgress?.[currentQuestion.word];\n\n      // \n      let status: 'correct' | 'incorrect' | 'review' | 'mastered' = isCorrect\n        ? 'correct'\n        : 'incorrect';\n\n      // \n      if (wordProgress && wordProgress.masteryLevel === 'mastered') {\n        status = 'mastered';\n      } else if (!isCorrect && wordProgress && wordProgress.incorrectCount >= 2) {\n        // 2\n        status = 'review';\n      }\n\n      // \n      updateStats(status);\n\n      addSessionHistory(\n        {\n          status,\n          word: currentQuestion.word,\n          timestamp: Date.now(),\n        },\n        'spelling'\n      );\n\n      if (wordProgress && wordProgress.skippedCount && wordProgress.skippedCount > 0) {\n        if (isCorrect) {\n          handleSkippedWordCorrect(currentQuestion.word);\n        } else {\n          handleSkippedWordIncorrect(currentQuestion.word);\n        }\n      }\n    }\n\n    // \n    if (!isCorrect && currentQuestion) {\n      incorrectWordsRef.current.push(currentQuestion.word);\n\n      // : 3\n      const shouldResortImmediately = true;\n      const totalAnswered = sessionStats.correct + sessionStats.incorrect;\n      const shouldResortPeriodically = totalAnswered % 3 === 0;\n\n      if (shouldResortImmediately || shouldResortPeriodically) {\n        const remainingQuestions = spellingState.questions.slice(spellingState.currentIndex + 1);\n\n        if (remainingQuestions.length > 1) {\n          // localStorage \n          const savedLearningLimit = localStorage.getItem('learning-limit-spelling');\n          const savedReviewLimit = localStorage.getItem('review-limit-spelling');\n          const learningLimit = savedLearningLimit ? parseInt(savedLearningLimit) : null;\n          const reviewLimit = savedReviewLimit ? parseInt(savedReviewLimit) : null;\n\n          // \n          const resorted = sortQuestionsByPriority(remainingQuestions, {\n            isReviewFocusMode: isReviewFocusMode || false,\n            learningLimit,\n            reviewLimit,\n            mode: 'spelling',\n          });\n\n          // \n          setSpellingState((prev) => ({\n            ...prev,\n            questions: [...prev.questions.slice(0, prev.currentIndex + 1), ...resorted],\n          }));\n        }\n      }\n    }\n\n    // 3-5\n    if (!isCorrect && currentQuestion) {\n      setSpellingState((prev) => ({\n        ...prev,\n        questions: reAddQuestion(currentQuestion, prev.questions, prev.currentIndex),\n      }));\n    }\n\n    // /\n    if (currentQuestion) {\n      const qid = String((currentQuestion as any).word);\n      sessionKpi.onShown(qid);\n      sessionKpi.onAnswer(qid, isCorrect);\n      updateRequeueStats(currentQuestion, sessionStats, setSessionStats);\n    }\n\n    // \n    updateScore(isCorrect);\n\n    // QuizResult\n    if (currentQuestion) {\n      addQuizResult({\n        id: generateId(),\n        questionSetId: 'spelling-quiz-single',\n        questionSetName: '',\n        score: isCorrect ? 1 : 0,\n        total: 1,\n        percentage: isCorrect ? 100 : 0,\n        date: Date.now(),\n        timeSpent: Math.floor(responseTime / 1000),\n        incorrectWords: isCorrect ? [] : [currentQuestion.word],\n        mode: 'spelling',\n      });\n    }\n  };\n\n  const handleNext = () => {\n    // 5\n    const nextIndex = spellingState.currentIndex + 1;\n    if (nextIndex < spellingState.questions.length) {\n      const cleanedQuestions = clearExpiredFlags(spellingState.questions, nextIndex - 1);\n      if (cleanedQuestions !== spellingState.questions) {\n        setSpellingState((prev) => ({\n          ...prev,\n          questions: cleanedQuestions,\n        }));\n      }\n    }\n    // lastAnswerWord\n    setLastAnswerWord(undefined);\n    // \n    moveToNextQuestion();\n  };\n\n  const handleSkip = async () => {\n    const currentQuestion = spellingState.questions[spellingState.currentIndex];\n    if (!currentQuestion) return;\n\n    // \n    if (spellingState.answered) {\n      handleNext();\n      return;\n    }\n\n    // \n    const responseTime = Date.now() - questionStartTimeRef.current;\n\n    console.log('[SpellingView] Skip:', {\n      word: currentQuestion.word,\n      responseTime,\n      currentScore: spellingState.score,\n      totalAnswered: spellingState.totalAnswered,\n    });\n\n    // AI\n    // \n    setLastAnswerCorrect(true);\n    setLastAnswerWord(currentQuestion.word);\n    setCorrectStreak((prev) => prev + 1);\n    setIncorrectStreak(0);\n\n    // 30AI\n    recordWordSkip(currentQuestion.word, 30);\n\n    // AI: \n    addToSkipGroup(currentQuestion.word);\n\n    // \n    await updateWordProgress(currentQuestion.word, true, responseTime, undefined, 'spelling');\n\n    // ScoreBoard- updateWordProgress\n    setLastAnswerTime(Date.now());\n\n    // \n    setSelectedSequence([]);\n    setSpellingState((prev) => ({\n      ...prev,\n      totalAnswered: prev.totalAnswered + 1,\n      score: prev.score + 1,\n      answered: false,\n    }));\n\n    // +\n    updateStats('correct');\n    updateStats('mastered');\n\n    // =\n    addSessionHistory(\n      {\n        status: 'correct',\n        word: currentQuestion.word,\n        timestamp: Date.now(),\n      },\n      'spelling'\n    );\n\n    console.log('[SpellingView] Skip:', {\n      word: currentQuestion.word,\n      newScore: spellingState.score + 1,\n      newTotalAnswered: spellingState.totalAnswered + 1,\n    });\n\n    // \n    addQuizResult({\n      id: generateId(),\n      questionSetId: 'spelling-quiz-single',\n      questionSetName: '',\n      score: 1,\n      total: 1,\n      percentage: 100,\n      date: Date.now(),\n      timeSpent: Math.floor(responseTime / 1000),\n      incorrectWords: [],\n      mode: 'spelling',\n      difficulty: currentQuestion.difficulty,\n    });\n\n    // \n    handleNext();\n  };\n\n  const handlePrevious = () => {\n    setSelectedSequence([]); // \n    setSpellingState((prev) => ({\n      ...prev,\n      currentIndex: prev.currentIndex > 0 ? prev.currentIndex - 1 : 0,\n      answered: false, // \n    }));\n    // \n    questionStartTimeRef.current = Date.now();\n  };\n\n  // 1\n  const handleBackspace = () => {\n    if (selectedSequence.length > 0) {\n      const newSequence = selectedSequence.slice(0, -1);\n      setSelectedSequence(newSequence);\n    }\n  };\n\n  const hasQuestions = spellingState.questions.length > 0;\n  const currentQuestion = hasQuestions ? spellingState.questions[spellingState.currentIndex] : null;\n\n  // \n  const userWord = selectedSequence.map((idx) => shuffledLetters[parseInt(idx)]).join('');\n\n  // CustomWord\n  const customWord: CustomWord | null = currentQuestion\n    ? {\n        word: currentQuestion.word,\n        meaning: currentQuestion.meaning,\n        katakana: currentQuestion.reading,\n        source: 'spelling' as const,\n      }\n    : null;\n\n  // \n  const learningPlan = localStorage.getItem('learning-schedule-90days');\n  const hasPlan = !!learningPlan;\n  let planStatus = null;\n  if (hasPlan) {\n    try {\n      const schedule = JSON.parse(learningPlan);\n      const daysPassed = Math.floor((Date.now() - schedule.startDate) / (1000 * 60 * 60 * 24));\n      const currentDay = Math.min(daysPassed + 1, schedule.totalDays);\n      const progressPercent = Math.round((currentDay / schedule.totalDays) * 100);\n      planStatus = {\n        currentDay,\n        totalDays: schedule.totalDays,\n        progressPercent,\n        phase: schedule.phase,\n      };\n    } catch (e) {\n      logger.error('Failed to parse learning plan:', e);\n    }\n  }\n\n  return (\n    <div className=\"spelling-view\">\n      {/*  */}\n      {hasPlan && planStatus && (\n        <div className=\"plan-progress-banner\">\n          <div className=\"plan-progress-content\">\n            <span className=\"plan-progress-icon\"></span>\n            <div className=\"plan-progress-info\">\n              <div className=\"plan-progress-title\"></div>\n              <div className=\"plan-progress-detail\">\n                {planStatus.currentDay} / {planStatus.totalDays} (Phase {planStatus.phase}) -{' '}\n                {planStatus.progressPercent}%\n              </div>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {!hasQuestions && (\n        <div className=\"quiz-controls\">\n          <button\n            onClick={onStartQuiz}\n            className=\"w-64 px-8 py-4 text-lg font-bold bg-blue-600 text-white rounded-xl hover:bg-blue-700 transition-all duration-300 shadow-xl:bg-primary-hover\"\n          >\n             \n          </button>\n        </div>\n      )}\n\n      {!hasQuestions ? (\n        <div className=\"empty-state\">\n          <p> </p>\n        </div>\n      ) : (\n        <>\n          {/*  */}\n          <div className=\"mb-4 flex justify-center\">\n            <div className=\"w-full max-w-4xl\">\n              <ScoreBoard\n                mode=\"spelling\"\n                currentScore={spellingState.score}\n                totalAnswered={spellingState.totalAnswered}\n                sessionCorrect={sessionStats.correct}\n                sessionIncorrect={sessionStats.incorrect}\n                sessionReview={sessionStats.review}\n                sessionMastered={sessionStats.mastered}\n                sessionStats={sessionStats}\n                onReviewFocus={onReviewFocus}\n                isReviewFocusMode={isReviewFocusMode}\n                onShowSettings={() => setShowSettings(true)}\n                currentWord={spellingState.questions[spellingState.currentIndex]?.word}\n                onAnswerTime={lastAnswerTime}\n                lastAnswerCorrect={lastAnswerCorrect}\n                lastAnswerWord={lastAnswerWord}\n                lastAnswerDifficulty={\n                  spellingState.questions[spellingState.currentIndex]?.difficulty\n                }\n                correctStreak={correctStreak}\n                incorrectStreak={incorrectStreak}\n                learningPhase={\n                  (adaptiveLearning.state.currentPhase as unknown as\n                    | 'ENCODING'\n                    | 'INITIAL_CONSOLIDATION'\n                    | 'LONG_TERM_RETENTION'\n                    | 'MASTERED'\n                    | undefined) ?? undefined\n                }\n                estimatedSpeed={adaptiveLearning.state.personalParams?.learningSpeed}\n                dataSource={\n                  selectedDataSource === 'all'\n                    ? ''\n                    : selectedDataSource === 'junior'\n                      ? ''\n                      : ''\n                }\n                category={selectedCategory === '' ? '' : selectedCategory}\n                difficulty={selectedDifficulty}\n                wordPhraseFilter={selectedWordPhraseFilter}\n              />\n            </div>\n          </div>\n\n          {/*  */}\n          {showSettings && (\n            <div className=\"study-settings-panel\">\n              <div className=\"settings-header\">\n                <h3> </h3>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className=\"px-4 py-2 bg-gray-100 text-gray-700 border border-gray-300 rounded-lg hover:bg-gray-200 hover:border-gray-400 transition-all duration-200 text-sm shadow-sm:bg-gray-600:border-gray-500\"\n                >\n                   \n                </button>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"category-select-spelling\"> :</label>\n                <select\n                  id=\"category-select-spelling\"\n                  value={selectedCategory}\n                  onChange={(e) => onCategoryChange(e.target.value)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  {OFFICIAL_CATEGORIES.map((category) => (\n                    <option key={category} value={category}>\n                      {category}\n                    </option>\n                  ))}\n                </select>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"difficulty-select-spelling\"> :</label>\n                <select\n                  id=\"difficulty-select-spelling\"\n                  value={selectedDifficulty}\n                  onChange={(e) => onDifficultyChange(e.target.value as DifficultyLevel)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  <option value=\"beginner\"></option>\n                  <option value=\"intermediate\"></option>\n                  <option value=\"advanced\"></option>\n                </select>\n              </div>\n\n              {onDataSourceChange && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"data-source-select-spelling\"> :</label>\n                  <select\n                    id=\"data-source-select-spelling\"\n                    value={selectedDataSource}\n                    onChange={(e) => onDataSourceChange(e.target.value as DataSource)}\n                    className=\"select-input\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"junior\"></option>\n                    <option value=\"intermediate\"></option>\n                  </select>\n                </div>\n              )}\n\n              {onWordPhraseFilterChange && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"word-phrase-filter-spelling\"> /:</label>\n                  <select\n                    id=\"word-phrase-filter-spelling\"\n                    value={selectedWordPhraseFilter}\n                    onChange={(e) => onWordPhraseFilterChange(e.target.value as WordPhraseFilter)}\n                    className=\"select-input\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"words-only\"></option>\n                    <option value=\"phrases-only\"></option>\n                  </select>\n                </div>\n              )}\n\n              {onPhraseTypeFilterChange && selectedWordPhraseFilter === 'phrases-only' && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"phrase-type-filter-spelling\"> :</label>\n                  <select\n                    id=\"phrase-type-filter-spelling\"\n                    value={selectedPhraseTypeFilter}\n                    onChange={(e) => {\n                      if (onPhraseTypeFilterChange) {\n                        onPhraseTypeFilterChange(e.target.value as PhraseTypeFilter);\n                      }\n                    }}\n                    className=\"select-input\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"phrasal-verb\"></option>\n                    <option value=\"idiom\"></option>\n                    <option value=\"collocation\"></option>\n                    <option value=\"other\"></option>\n                  </select>\n                </div>\n              )}\n\n              <LearningLimitsInput\n                learningLimit={learningLimit}\n                reviewLimit={reviewLimit}\n                onLearningLimitChange={setLearningLimit}\n                onReviewLimitChange={setReviewLimit}\n                idPrefix=\"spelling-quiz-\"\n              />\n            </div>\n          )}\n\n          {currentQuestion && (\n            <div className=\"question-card relative\">\n              {/*  */}\n              <button\n                onClick={() => _setIsFullscreen(true)}\n                className=\"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md\"\n                aria-label=\"\"\n                title=\"\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n                  />\n                </svg>\n              </button>\n              {/*  */}\n              <div className=\"question-nav-row meaning-row\">\n                <button\n                  className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n                  onClick={handlePrevious}\n                  disabled={spellingState.currentIndex === 0}\n                  title=\"\"\n                >\n                  \n                </button>\n                <div className=\"meaning-display\">\n                  <div className=\"meaning-line\">\n                    <span className=\"text-xl text-gray-600\">:</span>\n                    <span className=\"text-4xl font-bold text-gray-900 ml-2\">\n                      {currentQuestion.meaning}\n                    </span>\n                  </div>\n\n                  {/*  */}\n                  {customWord &&\n                    onAddWordToCustomSet &&\n                    onRemoveWordFromCustomSet &&\n                    onOpenCustomSetManagement &&\n                    customQuestionSets && (\n                      <div className=\"mt-3 flex justify-center\">\n                        <AddToCustomButton\n                          word={customWord}\n                          sets={customQuestionSets}\n                          onAddWord={onAddWordToCustomSet}\n                          onRemoveWord={onRemoveWordFromCustomSet}\n                          onOpenManagement={onOpenCustomSetManagement}\n                          size=\"medium\"\n                          variant=\"both\"\n                        />\n                      </div>\n                    )}\n\n                  <div className=\"meaning-meta\">\n                    {currentQuestion.difficulty && (\n                      <div className={`difficulty-badge ${currentQuestion.difficulty}`}>\n                        {currentQuestion.difficulty === 'beginner'\n                          ? ''\n                          : currentQuestion.difficulty === 'intermediate'\n                            ? ''\n                            : ''}\n                      </div>\n                    )}\n                    {currentQuestion.word.includes(' ') && (\n                      <div className=\"phrase-hint\">\n                         ({phraseWords.length}): \n                        {completedWords.length > 0 && (\n                          <span className=\"phrase-progress\">\n                            {' '}\n                            (: {completedWords.join(' ')})\n                          </span>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n                <button\n                  className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n                  onClick={spellingState.answered ? handleNext : handleSkip}\n                  disabled={spellingState.currentIndex >= spellingState.questions.length - 1}\n                  title={spellingState.answered ? '' : ''}\n                >\n                  \n                </button>\n              </div>\n\n              {/*  */}\n              <div className=\"question-content-inline\">\n                <div className=\"user-word-display\">\n                  <div className=\"user-word-label\">:</div>\n                  <div className=\"user-word-text\">\n                    {phraseWords.length > 0 ? (\n                      <>\n                        {completedWords.join(' ')}\n                        {completedWords.length > 0 && ' '}\n                        {userWord || ''}\n                      </>\n                    ) : (\n                      userWord || ''\n                    )}\n                  </div>\n                </div>\n              </div>\n\n              {/*  */}\n              <div\n                className=\"letter-cards\"\n                ref={letterCardsRef}\n                tabIndex={0}\n                onKeyDown={(e) => {\n                  if (!spellingState.answered) {\n                    // \n                    const key = e.key.toLowerCase();\n                    if (key.length === 1 && key >= 'a' && key <= 'z') {\n                      e.preventDefault();\n                      // \n                      const availableIndex = shuffledLetters.findIndex(\n                        (letter, idx) => letter === key && !selectedSequence.includes(`${idx}`)\n                      );\n                      if (availableIndex !== -1) {\n                        handleLetterClick(key, availableIndex);\n                      }\n                    } else if (e.key === 'Backspace') {\n                      e.preventDefault();\n                      handleBackspace();\n                    } else if (e.key === ' ') {\n                      // : \n                      e.preventDefault();\n                      handleSkip();\n                    } else if (e.key === 'Enter') {\n                      // Enter: \n                      e.preventDefault();\n                      handleSkip();\n                    }\n                  } else if (e.key === 'Enter') {\n                    // Enter\n                    e.preventDefault();\n                    handleNext();\n                  }\n                }}\n              >\n                {shuffledLetters.map((letter, index) => {\n                  const isSelected = selectedSequence.includes(`${index}`);\n                  const selectionOrder = selectedSequence.indexOf(`${index}`) + 1;\n\n                  // \n                  let answerClass = '';\n                  if (spellingState.answered && isSelected) {\n                    const userWord = selectedSequence\n                      .map((i) => shuffledLetters[parseInt(i)])\n                      .join('');\n                    const isCorrect = userWord === spellingState.correctWord;\n                    answerClass = isCorrect ? 'correct' : 'incorrect';\n                  }\n\n                  return (\n                    <button\n                      key={index}\n                      className={`letter-card ${isSelected ? 'selected' : ''} ${\n                        spellingState.answered ? 'practice-mode' : ''\n                      } ${answerClass}`}\n                      onClick={() => handleLetterClick(letter, index)}\n                    >\n                      {letter}\n                      {isSelected && <span className=\"selection-number\">{selectionOrder}</span>}\n                    </button>\n                  );\n                })}\n              </div>\n\n              {/* 1 */}\n              {!spellingState.answered && (\n                <div className=\"spelling-reset-button-container\">\n                  {selectedSequence.length > 0 && (\n                    <button className=\"btn-reset-selection\" onClick={handleBackspace}>\n                       1\n                    </button>\n                  )}\n                  <button className=\"btn-skip-word\" onClick={handleSkip}>\n                      ()\n                  </button>\n                </div>\n              )}\n\n              {spellingState.answered && (\n                <div className=\"result-display\">\n                  <div className=\"correct-answer\">\n                    {userWord === spellingState.correctWord\n                      ? ' : '\n                      : userWord === ''\n                        ? '  - : '\n                        : '  - : '}\n                    <strong\n                      className={isSpeechSynthesisSupported() ? 'clickable-word' : ''}\n                      onClick={(e) => {\n                        e.stopPropagation();\n                        if (isSpeechSynthesisSupported() && currentQuestion) {\n                          speakEnglish(currentQuestion.word, { rate: 0.85 });\n                        }\n                      }}\n                      title={isSpeechSynthesisSupported() ? ' ' : undefined}\n                    >\n                      {currentQuestion?.word || spellingState.correctWord}\n                      {isSpeechSynthesisSupported() && <span className=\"speaker-icon\"></span>}\n                      {currentQuestion?.reading && (\n                        <span className=\"pronunciation-hint\">({currentQuestion.reading})</span>\n                      )}\n                    </strong>\n                  </div>\n\n                  {/*  */}\n                  <div className=\"question-details-spelling\">\n                    {currentQuestion.reading && (\n                      <div\n                        className=\"detail-row clickable-row\"\n                        onClick={() =>\n                          isSpeechSynthesisSupported() &&\n                          speakEnglish(currentQuestion.word, { rate: 0.85 })\n                        }\n                        title=\" \"\n                      >\n                        <span className=\"detail-label\">:</span>\n                        <span className=\"detail-content\">{currentQuestion.reading}</span>\n                      </div>\n                    )}\n                    <div className=\"detail-row\">\n                      <span className=\"detail-label\">:</span>\n                      <span className=\"detail-content\">{currentQuestion.meaning}</span>\n                    </div>\n                    {currentQuestion.etymology && (\n                      <div className=\"detail-row\">\n                        <span className=\"detail-label\"> :</span>\n                        <span className=\"detail-content\">{currentQuestion.etymology}</span>\n                      </div>\n                    )}\n                    {currentQuestion.relatedWords && (\n                      <div className=\"detail-row\">\n                        <span className=\"detail-label\"> :</span>\n                        <span className=\"detail-content\">{currentQuestion.relatedWords}</span>\n                      </div>\n                    )}\n                    {currentQuestion.relatedFields && (\n                      <div className=\"detail-row\">\n                        <span className=\"detail-label\"> :</span>\n                        <span className=\"detail-content\">{currentQuestion.relatedFields}</span>\n                      </div>\n                    )}\n                    {currentQuestion.difficulty && (\n                      <div\n                        className=\"detail-row clickable-row\"\n                        onClick={() =>\n                          isSpeechSynthesisSupported() &&\n                          speakEnglish(currentQuestion.word, { rate: 0.85 })\n                        }\n                        title=\" \"\n                      >\n                        <span className=\"detail-label\">:</span>\n                        <div className={`difficulty-badge ${currentQuestion.difficulty}`}>\n                          {currentQuestion.difficulty === 'beginner'\n                            ? ''\n                            : currentQuestion.difficulty === 'intermediate'\n                              ? ''\n                              : ''}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n              )}\n            </div>\n          )}\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default SpellingView;\n","/**\n *  - public/data/passages/*.txt \n * PASSAGE_CREATION_GUIDELINES.md \n */\n\nimport { logger } from '@/utils/logger';\n\nexport interface PassageMetadata {\n  id: string;\n  title: string;\n  level: 'beginner' | 'intermediate' | 'advanced';\n  topic: string;\n  wordCount: number;\n  filePath: string;\n}\n\nexport interface LoadedPassage extends PassageMetadata {\n  content: string;\n  sections: PassageSection[];\n}\n\nexport interface PassageSection {\n  title: string;\n  paragraphs: string[];\n}\n\n/**\n * \n * : /data/passages-for-phrase-work/beginner_1200_Shopping-at-the-Supermarket.txt\n *      \"Shopping-at-the-Supermarket\"\n */\nfunction extractTitleFromPath(filePath: string): string {\n  const fileName = filePath.split('/').pop() || '';\n  const withoutExt = fileName.replace(/\\.txt$/, '');\n  const parts = withoutExt.split('_');\n\n  if (parts.length >= 3) {\n    // __ \n    const titlePart = parts.slice(2).join('_');\n    // \n    return titlePart;\n  }\n\n  return fileName;\n}\n\n// public/data/passages-for-phrase-work/ \n// : __.txt\n// title\nconst PASSAGE_FILES_RAW = [\n  // Beginner (6 passages)\n  {\n    id: 'beginner-morning-routine',\n    level: 'beginner',\n    topic: 'daily-life',\n    wordCount: 50,\n    filePath: '/data/passages-for-phrase-work/beginner_50_Morning-Routine.txt',\n  },\n  {\n    id: 'beginner-supermarket-shopping',\n    level: 'beginner',\n    topic: 'daily-life',\n    wordCount: 1910,\n    filePath: '/data/passages-for-phrase-work/beginner_1910_Shopping-at-the-Supermarket.txt',\n  },\n  {\n    id: 'beginner-cafe-day',\n    level: 'beginner',\n    topic: 'food-culture',\n    wordCount: 1380,\n    filePath: '/data/passages-for-phrase-work/beginner_1380_A-Day-at-the-Cafe.txt',\n  },\n  {\n    id: 'beginner-conversation-daily',\n    level: 'beginner',\n    topic: 'communication',\n    wordCount: 3018,\n    filePath: '/data/passages-for-phrase-work/beginner_3018_Daily-Conversations.txt',\n  },\n  {\n    id: 'beginner-weather-seasons',\n    level: 'beginner',\n    topic: 'nature',\n    wordCount: 2111,\n    filePath: '/data/passages-for-phrase-work/beginner_2111_Weather-and-Seasons.txt',\n  },\n  {\n    id: 'beginner-wildlife-park-guide',\n    level: 'beginner',\n    topic: 'animals',\n    wordCount: 2097,\n    filePath: '/data/passages-for-phrase-work/beginner_2097_Wildlife-Park-Guide.txt',\n  },\n\n  // Intermediate (8 passages)\n  {\n    id: 'intermediate-exchange-student-australia',\n    level: 'intermediate',\n    topic: 'culture-exchange',\n    wordCount: 3199,\n    filePath: '/data/passages-for-phrase-work/intermediate_3199_Exchange-Student-in-Australia.txt',\n  },\n  {\n    id: 'intermediate-homestay-america',\n    level: 'intermediate',\n    topic: 'culture-exchange',\n    wordCount: 3148,\n    filePath: '/data/passages-for-phrase-work/intermediate_3148_Homestay-in-America.txt',\n  },\n  {\n    id: 'intermediate-career-day',\n    level: 'intermediate',\n    topic: 'education-career',\n    wordCount: 2895,\n    filePath: '/data/passages-for-phrase-work/intermediate_2895_Career-Day-at-School.txt',\n  },\n  {\n    id: 'intermediate-hospital-visit',\n    level: 'intermediate',\n    topic: 'health',\n    wordCount: 2721,\n    filePath: '/data/passages-for-phrase-work/intermediate_2721_A-Visit-to-the-Hospital.txt',\n  },\n  {\n    id: 'intermediate-science-museum',\n    level: 'intermediate',\n    topic: 'science-education',\n    wordCount: 3265,\n    filePath: '/data/passages-for-phrase-work/intermediate_3265_Science-Museum-Experience.txt',\n  },\n  {\n    id: 'intermediate-community-events',\n    level: 'intermediate',\n    topic: 'community',\n    wordCount: 2216,\n    filePath: '/data/passages-for-phrase-work/intermediate_2216_Community-Events.txt',\n  },\n  {\n    id: 'intermediate-school-events-year',\n    level: 'intermediate',\n    topic: 'school-life',\n    wordCount: 2558,\n    filePath: '/data/passages-for-phrase-work/intermediate_2558_A-Year-of-School-Events.txt',\n  },\n  {\n    id: 'intermediate-school-news',\n    level: 'intermediate',\n    topic: 'school-life',\n    wordCount: 1937,\n    filePath: '/data/passages-for-phrase-work/intermediate_1937_School-News.txt',\n  },\n\n  // Advanced (8 passages)\n  {\n    id: 'advanced-environmental-issues',\n    level: 'advanced',\n    topic: 'environment',\n    wordCount: 4263,\n    filePath: '/data/passages-for-phrase-work/advanced_4263_Environmental-Issues-and-Solutions.txt',\n  },\n  {\n    id: 'advanced-family-gathering',\n    level: 'advanced',\n    topic: 'culture-family',\n    wordCount: 4493,\n    filePath: '/data/passages-for-phrase-work/advanced_4493_Family-Gathering-Traditions.txt',\n  },\n  {\n    id: 'advanced-health-statistics',\n    level: 'advanced',\n    topic: 'health-data',\n    wordCount: 3422,\n    filePath: '/data/passages-for-phrase-work/advanced_3422_Health-Statistics-Analysis.txt',\n  },\n  {\n    id: 'advanced-historical-figures',\n    level: 'advanced',\n    topic: 'history',\n    wordCount: 3115,\n    filePath: '/data/passages-for-phrase-work/advanced_3115_Historical-Figures-Study.txt',\n  },\n  {\n    id: 'advanced-international-exchange',\n    level: 'advanced',\n    topic: 'culture-global',\n    wordCount: 3813,\n    filePath: '/data/passages-for-phrase-work/advanced_3813_Cultural-Exchange-Insights.txt',\n  },\n  {\n    id: 'advanced-school-festival',\n    level: 'advanced',\n    topic: 'school-events',\n    wordCount: 4419,\n    filePath: '/data/passages-for-phrase-work/advanced_4419_School-Festival-Planning.txt',\n  },\n  {\n    id: 'advanced-summer-vacation-stories',\n    level: 'advanced',\n    topic: 'personal-growth',\n    wordCount: 3255,\n    filePath: '/data/passages-for-phrase-work/advanced_3255_Summer-Vacation-Stories.txt',\n  },\n  {\n    id: 'advanced-technology-future',\n    level: 'advanced',\n    topic: 'technology-innovation',\n    wordCount: 3161,\n    filePath: '/data/passages-for-phrase-work/advanced_3161_Technology-and-Future.txt',\n  },\n] as const;\n\n// title\nconst PASSAGE_FILES: PassageMetadata[] = PASSAGE_FILES_RAW.map((passage) => ({\n  ...passage,\n  title: extractTitleFromPath(passage.filePath),\n  level: passage.level as 'beginner' | 'intermediate' | 'advanced',\n}));\n\n/**\n * \n */\nexport function getPassageList(): PassageMetadata[] {\n  return PASSAGE_FILES;\n}\n\n/**\n * \n */\nexport function getPassagesByLevel(\n  level: 'beginner' | 'intermediate' | 'advanced'\n): PassageMetadata[] {\n  return PASSAGE_FILES.filter((p) => p.level === level);\n}\n\n/**\n * passages-original \n */\nexport async function loadOriginalPassage(passageId: string): Promise<string> {\n  try {\n    // \n    // : beginner-morning-routine -> /data/passages-original/beginner_50_Morning-Routine.txt\n    const metadata = PASSAGE_FILES.find((p) => p.id === passageId);\n    if (!metadata) {\n      logger.error(`Passage not found: ${passageId}`);\n      return '';\n    }\n\n    // filePath\n    const fileName = metadata.filePath.split('/').pop() || '';\n    const originalPath = `/data/passages-original/${fileName}`;\n\n    const response = await fetch(originalPath);\n    if (!response.ok) {\n      logger.log(`Original file not found: ${originalPath}`);\n      return '';\n    }\n\n    const content = await response.text();\n    return content;\n  } catch (error) {\n    logger.error(`Error loading original passage ${passageId}:`, error);\n    return '';\n  }\n}\n\n/**\n * \n */\nexport async function loadPassage(passageId: string): Promise<LoadedPassage | null> {\n  const metadata = PASSAGE_FILES.find((p) => p.id === passageId);\n  if (!metadata) {\n    logger.error(`Passage not found: ${passageId}`);\n    return null;\n  }\n\n  try {\n    const response = await fetch(metadata.filePath);\n    if (!response.ok) {\n      throw new Error(`Failed to fetch: ${response.statusText}`);\n    }\n\n    const content = await response.text();\n    const sections = parsePassageContent(content);\n\n    return {\n      ...metadata,\n      content,\n      sections,\n    };\n  } catch (error) {\n    logger.error(`Error loading passage ${passageId}:`, error);\n    return null;\n  }\n}\n\n/**\n * \n * PASSAGE_CREATION_GUIDELINES.md \n */\nfunction parsePassageContent(content: string): PassageSection[] {\n  const lines = content.split('\\n');\n  const sections: PassageSection[] = [];\n  let currentSection: PassageSection | null = null;\n\n  for (const line of lines) {\n    const trimmed = line.trim();\n\n    // \n    if (!trimmed) {\n      continue;\n    }\n\n    // \n    // \n    if (!line.startsWith('    ') && trimmed.length > 0 && trimmed.length < 80) {\n      // \n      if (currentSection) {\n        sections.push(currentSection);\n      }\n      currentSection = {\n        title: trimmed,\n        paragraphs: [],\n      };\n    } else if (line.startsWith('    ') && currentSection) {\n      // 4\n      currentSection.paragraphs.push(trimmed);\n    }\n  }\n\n  // \n  if (currentSection) {\n    sections.push(currentSection);\n  }\n\n  return sections;\n}\n\n/**\n * \n */\nexport function getPassageStats() {\n  const stats = {\n    total: PASSAGE_FILES.length,\n    byLevel: {\n      beginner: PASSAGE_FILES.filter((p) => p.level === 'beginner').length,\n      intermediate: PASSAGE_FILES.filter((p) => p.level === 'intermediate').length,\n      advanced: PASSAGE_FILES.filter((p) => p.level === 'advanced').length,\n    },\n    totalWords: PASSAGE_FILES.reduce((sum, p) => sum + p.wordCount, 0),\n  };\n\n  return stats;\n}\n","/**\n * \n *  .txt  ReadingPassage \n */\n\nimport { ReadingPassage, ReadingSegment } from '../types';\nimport { getPassageList, loadPassage, loadOriginalPassage } from './passageLoader';\nimport { logger } from '@/utils/logger';\n\n// : \nfunction getLemma(word: string): string {\n  const cleaned = word.toLowerCase().trim();\n\n  // -ing\n  if (cleaned.endsWith('ing') && cleaned.length > 4) {\n    const base = cleaned.slice(0, -3);\n    if (base.endsWith('n') || base.endsWith('m') || base.endsWith('t')) {\n      return base.slice(0, -1); // running  run\n    }\n    return base + 'e'; // making  make ()\n  }\n\n  // -ed\n  if (cleaned.endsWith('ed') && cleaned.length > 3) {\n    const base = cleaned.slice(0, -2);\n    if (base.endsWith('i')) {\n      return base.slice(0, -1) + 'y'; // studied  study\n    }\n    return base;\n  }\n\n  // -s/-es\n  if (cleaned.endsWith('es') && cleaned.length > 3) {\n    return cleaned.slice(0, -2);\n  }\n  if (cleaned.endsWith('s') && cleaned.length > 2 && !cleaned.endsWith('ss')) {\n    return cleaned.slice(0, -1);\n  }\n\n  return cleaned;\n}\n\n/**\n * 20\n */\nfunction _splitLongSentence(sentence: string): string[] {\n  const words = sentence.trim().split(/\\s+/);\n\n  // 20\n  if (words.length <= 20) {\n    return [sentence];\n  }\n\n  // \n  const conjunctionPattern =\n    /\\b(when|if|because|although|while|since|after|before|unless|until|as|though|whereas)\\b/gi;\n\n  // \n  const parts: string[] = [];\n  let currentPart = '';\n  let wordCount = 0;\n\n  const sentenceWords = sentence.match(/\\S+|\\s+/g) || [];\n\n  for (let i = 0; i < sentenceWords.length; i++) {\n    const token = sentenceWords[i];\n\n    // \n    if (/^\\s+$/.test(token)) {\n      currentPart += token;\n      continue;\n    }\n\n    // 20\n    if (wordCount >= 15 && conjunctionPattern.test(token)) {\n      // \n      if (currentPart.trim()) {\n        parts.push(currentPart.trim());\n      }\n      // \n      currentPart = token;\n      wordCount = 1;\n    } else {\n      currentPart += token;\n      wordCount++;\n    }\n  }\n\n  // \n  if (currentPart.trim()) {\n    parts.push(currentPart.trim());\n  }\n\n  // \n  return parts.length > 0 ? parts : [sentence];\n}\n\n/**\n * \n */\nasync function loadFullTranslation(passageId: string): Promise<string> {\n  try {\n    // passageId\n    // : beginner-morning-routine -> /data/passages/passages-translations/beginner_50_Morning-Routine-ja.txt\n    // : advanced-environmental-issues -> /data/passages-translations/advanced-environmental-issues-ja.txt\n\n    //  (passages/passages-translations/)\n    let translationFilePath = `/data/passages/passages-translations/${passageId}-ja.txt`;\n\n    console.log(`[] Attempting to load: ${translationFilePath} for passageId: ${passageId}`);\n\n    let response = await fetch(translationFilePath);\n\n    // \n    if (!response.ok) {\n      translationFilePath = `/data/passages-translations/${passageId}-ja.txt`;\n      console.log(`[] Trying old path: ${translationFilePath}`);\n      response = await fetch(translationFilePath);\n    }\n\n    if (!response.ok) {\n      console.log(`[] File not found (${response.status}): ${translationFilePath}`);\n      return '';\n    }\n\n    const content = await response.text();\n    console.log(\n      `[] Successfully loaded ${content.length} characters from ${translationFilePath}`\n    );\n    return content;\n  } catch (_error) {\n    console.error(`[] Error loading full translation for ${passageId}:`, _error);\n    return '';\n  }\n}\n\n/**\n * passages-for-phrase-work-ja\n * : \n * passages-for-phrase-work\n */\nasync function loadJapanesePhrases(passageId: string): Promise<string[]> {\n  try {\n    // passageId\n    const metadata = getPassageList().find((p) => p.id === passageId);\n    if (!metadata) return [];\n\n    // \n    const fileName = metadata.filePath.split('/').pop() || '';\n\n    // passages-for-phrase-work-ja\n    // : beginner_50_Morning-Routine.txt -> /data/passages-for-phrase-work-ja/beginner_50_Morning-Routine-ja.txt\n    const jaFilePath = `/data/passages-for-phrase-work-ja/${fileName.replace(/\\.txt$/, '-ja.txt')}`;\n\n    const response = await fetch(jaFilePath);\n    if (!response.ok) {\n      logger.log(`No Japanese phrase file found: ${jaFilePath}`);\n      return [];\n    }\n\n    const content = await response.text();\n    const lines = content\n      .split('\\n')\n      .map((line) => line.trim())\n      .filter((line) => line.length > 0); // \n\n    logger.log(`Loaded ${lines.length} Japanese phrases from ${jaFilePath}`);\n    return lines;\n  } catch (_error) {\n    logger.error(`Error loading Japanese phrases for ${passageId}:`, _error);\n    return [];\n  }\n}\n\n/**\n * .txt  ReadingPassage \n */\nexport async function convertPassageToReadingFormat(\n  passageId: string,\n  wordDictionary: Map<string, any>\n): Promise<ReadingPassage | null> {\n  const loaded = await loadPassage(passageId);\n  if (!loaded) return null;\n\n  // \n  const [japanesePhrases, fullTranslation, originalText] = await Promise.all([\n    loadJapanesePhrases(passageId),\n    loadFullTranslation(passageId),\n    loadOriginalPassage(passageId),\n  ]);\n  let japaneseIndex = 0;\n\n  // \n  const phrases: any[] = [];\n\n  loaded.sections.forEach((section) => {\n    section.paragraphs.forEach((paragraph) => {\n      // Speaker: \"...\"\n      const conversationMatch = paragraph.match(/^([^:]+):\\s*\"([^\"]+)\"$/);\n\n      if (conversationMatch) {\n        // : 1\n        const fullText = paragraph.trim();\n        const words = fullText.split(/\\s+/);\n\n        // \n        const segments: ReadingSegment[] = words\n          .map((word) => {\n            // \n            let processWord = word;\n            let leadingQuote = '';\n            if (processWord.startsWith('\"')) {\n              leadingQuote = '\"';\n              processWord = processWord.substring(1);\n            }\n\n            // Ms., Mr., Dr.\n            const abbreviationPattern =\n              /^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\\.$|^[A-Z]\\.$|^vs\\.$|^e\\.g\\.$|^i\\.e\\.$/;\n            if (abbreviationPattern.test(processWord)) {\n              // 1\n              const lemma = getLemma(processWord.replace(/\\.$/, '')); // \n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n\n              const result: ReadingSegment[] = [];\n              if (leadingQuote) {\n                result.push({\n                  word: leadingQuote,\n                  meaning: '',\n                  isUnknown: false,\n                });\n              }\n              result.push({\n                word: processWord,\n                meaning: meaning === '-' ? '' : meaning,\n                isUnknown: false,\n              });\n              return result;\n            }\n\n            // \n            const punctuationMatch = processWord.match(/([.,!?;:\"])$/);\n\n            if (punctuationMatch) {\n              const cleanWord = processWord.replace(/[.,!?;:\"]$/, '');\n              const punctuation = punctuationMatch[1];\n\n              if (!cleanWord) {\n                // \n                const result: ReadingSegment[] = [];\n                if (leadingQuote) {\n                  result.push({\n                    word: leadingQuote,\n                    meaning: '',\n                    isUnknown: false,\n                  });\n                }\n                result.push({\n                  word: punctuation,\n                  meaning: '',\n                  isUnknown: false,\n                });\n                return result;\n              }\n\n              const lemma = getLemma(cleanWord);\n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n\n              const result: ReadingSegment[] = [];\n              if (leadingQuote) {\n                result.push({\n                  word: leadingQuote,\n                  meaning: '',\n                  isUnknown: false,\n                });\n              }\n              result.push({\n                word: cleanWord,\n                meaning: meaning === '-' ? '' : meaning,\n                isUnknown: false,\n              });\n              result.push({\n                word: punctuation,\n                meaning: '',\n                isUnknown: false,\n              });\n              return result;\n            } else {\n              // \n              const lemma = getLemma(processWord);\n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n\n              const result: ReadingSegment[] = [];\n              if (leadingQuote) {\n                result.push({\n                  word: leadingQuote,\n                  meaning: '',\n                  isUnknown: false,\n                });\n              }\n              result.push({\n                word: processWord,\n                meaning: meaning === '-' ? '' : meaning,\n                isUnknown: false,\n              });\n              return result;\n            }\n          })\n          .flat();\n\n        // \n        const japanese = japanesePhrases[japaneseIndex] || '';\n        japaneseIndex++;\n\n        phrases.push({\n          english: fullText,\n          japanese: japanese,\n          phraseMeaning: japanese, // phraseMeaning\n          words: words,\n          segments: segments,\n        });\n      } else {\n        // passages-for-phrase-work\n        // 1\n        const phraseText = paragraph.trim();\n\n        // \n        const words = phraseText.split(/\\s+/);\n\n        // \n        const segments: ReadingSegment[] = words\n          .map((word) => {\n            // Ms., Mr., Dr.\n            const abbreviationPattern =\n              /^(Ms|Mr|Mrs|Dr|Prof|St|Ave|Inc|Ltd|etc)\\.$|^[A-Z]\\.$|^vs\\.$|^e\\.g\\.$|^i\\.e\\.$/;\n            if (abbreviationPattern.test(word)) {\n              // 1\n              const lemma = getLemma(word.replace(/\\.$/, '')); // \n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n              return {\n                word: word,\n                meaning: meaning === '-' ? '' : meaning,\n                isUnknown: false,\n              };\n            }\n\n            // \n            const punctuationMatch = word.match(/([.,!?;:])$/);\n\n            if (punctuationMatch) {\n              const cleanWord = word.replace(/[.,!?;:]$/, '');\n              const punctuation = punctuationMatch[1];\n\n              // \n              if (!cleanWord) {\n                return {\n                  word: punctuation,\n                  meaning: '',\n                  isUnknown: false,\n                };\n              }\n\n              const lemma = getLemma(cleanWord);\n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n\n              return [\n                {\n                  word: cleanWord,\n                  meaning: meaning === '-' ? '' : meaning,\n                  isUnknown: false,\n                },\n                {\n                  word: punctuation,\n                  meaning: '',\n                  isUnknown: false,\n                },\n              ];\n            } else {\n              // \n              const lemma = getLemma(word);\n              const wordData = wordDictionary.get(lemma);\n              const meaning = wordData?.meaning || '';\n\n              return {\n                word: word,\n                meaning: meaning === '-' ? '' : meaning,\n                isUnknown: false,\n              };\n            }\n          })\n          .flat();\n\n        // \n        const japanese = japanesePhrases[japaneseIndex] || '';\n        japaneseIndex++;\n\n        phrases.push({\n          english: phraseText,\n          japanese: japanese,\n          phraseMeaning: japanese, // phraseMeaning\n          words: words,\n          segments: segments,\n        });\n      }\n    });\n  });\n\n  // ReadingPassage\n  const readingPassage: ReadingPassage = {\n    id: loaded.id,\n    title: loaded.title,\n    level: loaded.level,\n    actualWordCount: loaded.wordCount,\n    phrases: phrases,\n    translation: fullTranslation, // \n    originalText: originalText, // \n  };\n\n  return readingPassage;\n}\n\n/**\n * JSON\n * public/data/passages-phrase-learning/*.json\n */\nexport async function loadPhraseLearningJSON(passageId: string): Promise<ReadingPassage | null> {\n  try {\n    const response = await fetch(`/data/passages-phrase-learning/${passageId}.json`);\n    if (!response.ok) {\n      logger.log(`No phrase learning JSON found for ${passageId}, will use .txt conversion`);\n      return null; // null\n    }\n\n    const data = await response.json();\n    logger.log(\n      `Loaded phrase learning JSON for ${passageId}, phrases: ${data.phrases?.length || 0}`\n    );\n\n    // \n    const [fullTranslation, originalText] = await Promise.all([\n      loadFullTranslation(passageId),\n      loadOriginalPassage(passageId),\n    ]);\n\n    // JSON(ReadingPassage)\n    const readingPassage: ReadingPassage = {\n      ...data,\n      phrases: data.phrases || [], // phrases\n      translation: fullTranslation, // \n      originalText: originalText, // \n    };\n\n    return readingPassage;\n  } catch {\n    // old\n    // SyntaxErrorJSON404\n    logger.log(\n      `Skipping phrase learning JSON for ${passageId} (file may be old or moved), will use .txt conversion`\n    );\n    return null;\n  }\n}\n\n/**\n *  ReadingPassage[] \n * : 1) JSON, 2) .txt\n */\nexport async function loadAllPassagesAsReadingFormat(\n  wordDictionary: Map<string, any>\n): Promise<ReadingPassage[]> {\n  const metadata = getPassageList();\n  const passages: ReadingPassage[] = [];\n\n  logger.log(`Loading ${metadata.length} passages...`);\n\n  for (const meta of metadata) {\n    // JSON\n    let passage = await loadPhraseLearningJSON(meta.id);\n\n    // JSON.txt\n    if (!passage) {\n      passage = await convertPassageToReadingFormat(meta.id, wordDictionary);\n    }\n\n    if (passage) {\n      logger.log(` Loaded passage: ${meta.id} (${passage.phrases?.length || 0} phrases)`);\n      passages.push(passage);\n    } else {\n      logger.error(` Failed to load passage: ${meta.id}`);\n    }\n  }\n\n  logger.log(`Total passages loaded: ${passages.length}`);\n  return passages;\n}\n\n/**\n * 'beginner'  ''\n */\nexport function getLevelLabel(level: string): string {\n  const levelMap: Record<string, string> = {\n    beginner: '',\n    intermediate: '',\n    advanced: '',\n  };\n  return levelMap[level] || level;\n}\n","/**\n * \n * S, V, O, C, M\n */\n\nexport type GrammarTag =\n  | 'S'\n  | 'V'\n  | 'O'\n  | 'C'\n  | 'M'\n  | 'Prep'\n  | 'Conj'\n  | 'Det'\n  | 'Adj'\n  | 'Adv'\n  | 'Unknown';\n\nexport interface GrammarAnalysisResult {\n  word: string;\n  tag: GrammarTag;\n  color: string;\n  description: string;\n}\n\n// \nconst VERBS = new Set([\n  'be',\n  'am',\n  'is',\n  'are',\n  'was',\n  'were',\n  'been',\n  'being',\n  'have',\n  'has',\n  'had',\n  'having',\n  'do',\n  'does',\n  'did',\n  'done',\n  'doing',\n  'can',\n  'could',\n  'will',\n  'would',\n  'shall',\n  'should',\n  'may',\n  'might',\n  'must',\n  'go',\n  'goes',\n  'went',\n  'gone',\n  'going',\n  'get',\n  'gets',\n  'got',\n  'gotten',\n  'getting',\n  'make',\n  'makes',\n  'made',\n  'making',\n  'take',\n  'takes',\n  'took',\n  'taken',\n  'taking',\n  'see',\n  'sees',\n  'saw',\n  'seen',\n  'seeing',\n  'come',\n  'comes',\n  'came',\n  'coming',\n  'want',\n  'wants',\n  'wanted',\n  'wanting',\n  'use',\n  'uses',\n  'used',\n  'using',\n  'find',\n  'finds',\n  'found',\n  'finding',\n  'give',\n  'gives',\n  'gave',\n  'given',\n  'giving',\n  'tell',\n  'tells',\n  'told',\n  'telling',\n  'work',\n  'works',\n  'worked',\n  'working',\n  'call',\n  'calls',\n  'called',\n  'calling',\n  'try',\n  'tries',\n  'tried',\n  'trying',\n  'ask',\n  'asks',\n  'asked',\n  'asking',\n  'need',\n  'needs',\n  'needed',\n  'needing',\n  'feel',\n  'feels',\n  'felt',\n  'feeling',\n  'become',\n  'becomes',\n  'became',\n  'becoming',\n  'leave',\n  'leaves',\n  'left',\n  'leaving',\n  'put',\n  'puts',\n  'putting',\n  'mean',\n  'means',\n  'meant',\n  'meaning',\n  'keep',\n  'keeps',\n  'kept',\n  'keeping',\n  'let',\n  'lets',\n  'letting',\n  'begin',\n  'begins',\n  'began',\n  'begun',\n  'beginning',\n  'seem',\n  'seems',\n  'seemed',\n  'seeming',\n  'help',\n  'helps',\n  'helped',\n  'helping',\n  'talk',\n  'talks',\n  'talked',\n  'talking',\n  'turn',\n  'turns',\n  'turned',\n  'turning',\n  'start',\n  'starts',\n  'started',\n  'starting',\n  'show',\n  'shows',\n  'showed',\n  'shown',\n  'showing',\n  'hear',\n  'hears',\n  'heard',\n  'hearing',\n  'play',\n  'plays',\n  'played',\n  'playing',\n  'run',\n  'runs',\n  'ran',\n  'running',\n  'move',\n  'moves',\n  'moved',\n  'moving',\n  'like',\n  'likes',\n  'liked',\n  'liking',\n  'live',\n  'lives',\n  'lived',\n  'living',\n  'believe',\n  'believes',\n  'believed',\n  'believing',\n  'bring',\n  'brings',\n  'brought',\n  'bringing',\n  'happen',\n  'happens',\n  'happened',\n  'happening',\n  'write',\n  'writes',\n  'wrote',\n  'written',\n  'writing',\n  'sit',\n  'sits',\n  'sat',\n  'sitting',\n  'stand',\n  'stands',\n  'stood',\n  'standing',\n  'lose',\n  'loses',\n  'lost',\n  'losing',\n  'pay',\n  'pays',\n  'paid',\n  'paying',\n  'meet',\n  'meets',\n  'met',\n  'meeting',\n  'include',\n  'includes',\n  'included',\n  'including',\n  'continue',\n  'continues',\n  'continued',\n  'continuing',\n  'set',\n  'sets',\n  'setting',\n  'learn',\n  'learns',\n  'learned',\n  'learning',\n  'change',\n  'changes',\n  'changed',\n  'changing',\n  'lead',\n  'leads',\n  'led',\n  'leading',\n  'understand',\n  'understands',\n  'understood',\n  'understanding',\n  'watch',\n  'watches',\n  'watched',\n  'watching',\n  'follow',\n  'follows',\n  'followed',\n  'following',\n  'stop',\n  'stops',\n  'stopped',\n  'stopping',\n  'create',\n  'creates',\n  'created',\n  'creating',\n  'speak',\n  'speaks',\n  'spoke',\n  'spoken',\n  'speaking',\n  'read',\n  'reads',\n  'reading',\n  'spend',\n  'spends',\n  'spent',\n  'spending',\n  'grow',\n  'grows',\n  'grew',\n  'grown',\n  'growing',\n  'open',\n  'opens',\n  'opened',\n  'opening',\n  'walk',\n  'walks',\n  'walked',\n  'walking',\n  'win',\n  'wins',\n  'won',\n  'winning',\n  'teach',\n  'teaches',\n  'taught',\n  'teaching',\n  'offer',\n  'offers',\n  'offered',\n  'offering',\n  'remember',\n  'remembers',\n  'remembered',\n  'remembering',\n  'consider',\n  'considers',\n  'considered',\n  'considering',\n  'appear',\n  'appears',\n  'appeared',\n  'appearing',\n  'buy',\n  'buys',\n  'bought',\n  'buying',\n  'serve',\n  'serves',\n  'served',\n  'serving',\n  'die',\n  'dies',\n  'died',\n  'dying',\n  'send',\n  'sends',\n  'sent',\n  'sending',\n  'build',\n  'builds',\n  'built',\n  'building',\n  'stay',\n  'stays',\n  'stayed',\n  'staying',\n  'fall',\n  'falls',\n  'fell',\n  'fallen',\n  'falling',\n  'cut',\n  'cuts',\n  'cutting',\n  'reach',\n  'reaches',\n  'reached',\n  'reaching',\n  'kill',\n  'kills',\n  'killed',\n  'killing',\n  'raise',\n  'raises',\n  'raised',\n  'raising',\n  'pass',\n  'passes',\n  'passed',\n  'passing',\n  'sell',\n  'sells',\n  'sold',\n  'selling',\n  'decide',\n  'decides',\n  'decided',\n  'deciding',\n  'return',\n  'returns',\n  'returned',\n  'returning',\n  'explain',\n  'explains',\n  'explained',\n  'explaining',\n  'hope',\n  'hopes',\n  'hoped',\n  'hoping',\n  'develop',\n  'develops',\n  'developed',\n  'developing',\n  'carry',\n  'carries',\n  'carried',\n  'carrying',\n  'break',\n  'breaks',\n  'broke',\n  'broken',\n  'breaking',\n  'receive',\n  'receives',\n  'received',\n  'receiving',\n  'agree',\n  'agrees',\n  'agreed',\n  'agreeing',\n  'support',\n  'supports',\n  'supported',\n  'supporting',\n  'hit',\n  'hits',\n  'hitting',\n  'produce',\n  'produces',\n  'produced',\n  'producing',\n  'eat',\n  'eats',\n  'ate',\n  'eaten',\n  'eating',\n  'cover',\n  'covers',\n  'covered',\n  'covering',\n  'catch',\n  'catches',\n  'caught',\n  'catching',\n  'draw',\n  'draws',\n  'drew',\n  'drawn',\n  'drawing',\n  'wake',\n  'wakes',\n  'woke',\n  'woken',\n  'waking',\n  'brush',\n  'brushes',\n  'brushed',\n  'brushing',\n  'wash',\n  'washes',\n  'washed',\n  'washing',\n  'prepare',\n  'prepares',\n  'prepared',\n  'preparing',\n  'check',\n  'checks',\n  'checked',\n  'checking',\n]);\n\nconst PREPOSITIONS = new Set([\n  'in',\n  'on',\n  'at',\n  'to',\n  'for',\n  'with',\n  'from',\n  'by',\n  'about',\n  'as',\n  'into',\n  'like',\n  'through',\n  'after',\n  'over',\n  'between',\n  'out',\n  'against',\n  'during',\n  'without',\n  'before',\n  'under',\n  'around',\n  'among',\n  'of',\n  'up',\n]);\n\nconst CONJUNCTIONS = new Set([\n  'and',\n  'but',\n  'or',\n  'so',\n  'yet',\n  'for',\n  'nor',\n  'because',\n  'although',\n  'if',\n  'when',\n  'while',\n  'since',\n  'unless',\n  'that',\n  'which',\n  'who',\n  'whom',\n  'whose',\n  'where',\n]);\n\nconst DETERMINERS = new Set([\n  'the',\n  'a',\n  'an',\n  'this',\n  'that',\n  'these',\n  'those',\n  'my',\n  'your',\n  'his',\n  'her',\n  'its',\n  'our',\n  'their',\n  'some',\n  'any',\n  'no',\n  'every',\n  'each',\n  'either',\n  'neither',\n  'much',\n  'many',\n  'more',\n  'most',\n  'few',\n  'little',\n  'several',\n]);\n\nconst PRONOUNS = new Set([\n  'i',\n  'you',\n  'he',\n  'she',\n  'it',\n  'we',\n  'they',\n  'me',\n  'him',\n  'her',\n  'us',\n  'them',\n  'myself',\n  'yourself',\n  'himself',\n  'herself',\n  'itself',\n  'ourselves',\n  'themselves',\n]);\n\nconst ADJECTIVES = new Set([\n  'good',\n  'new',\n  'first',\n  'last',\n  'long',\n  'great',\n  'little',\n  'own',\n  'other',\n  'old',\n  'right',\n  'big',\n  'high',\n  'different',\n  'small',\n  'large',\n  'next',\n  'early',\n  'young',\n  'important',\n  'few',\n  'public',\n  'bad',\n  'same',\n  'able',\n  'ready',\n  'usual',\n  'toast',\n  'juice',\n]);\n\nconst ADVERBS = new Set([\n  'not',\n  'so',\n  'up',\n  'out',\n  'just',\n  'now',\n  'how',\n  'then',\n  'more',\n  'also',\n  'here',\n  'well',\n  'only',\n  'very',\n  'even',\n  'back',\n  'there',\n  'down',\n  'still',\n  'in',\n  'as',\n  'too',\n  'when',\n  'never',\n  'really',\n  'usually',\n  'finally',\n  'first',\n  'after',\n  'before',\n]);\n\n/**\n * \n */\nfunction getTagColor(tag: GrammarTag): string {\n  const colorMap: Record<GrammarTag, string> = {\n    S: '#3b82f6', //  - \n    V: '#ef4444', //  - \n    O: '#10b981', //  - \n    C: '#f59e0b', //  - \n    M: '#8b5cf6', //  - \n    Prep: '#6366f1', //  - \n    Conj: '#ec4899', //  - \n    Det: '#14b8a6', //  - \n    Adj: '#f97316', //  - \n    Adv: '#a855f7', //  - \n    Unknown: '#6b7280', //  - \n  };\n  return colorMap[tag];\n}\n\n/**\n * \n */\nfunction getTagDescription(tag: GrammarTag): string {\n  const descMap: Record<GrammarTag, string> = {\n    S: '',\n    V: '',\n    O: '',\n    C: '',\n    M: '',\n    Prep: '',\n    Conj: '',\n    Det: '',\n    Adj: '',\n    Adv: '',\n    Unknown: '',\n  };\n  return descMap[tag];\n}\n\n/**\n * \n */\nfunction classifyWord(word: string, index: number, words: string[]): GrammarTag {\n  const lower = word.toLowerCase();\n\n  // \n  if (/^[.,!?;:]$/.test(word)) {\n    return 'Unknown';\n  }\n\n  // \n  if (VERBS.has(lower)) {\n    return 'V';\n  }\n\n  // \n  if (PREPOSITIONS.has(lower)) {\n    return 'Prep';\n  }\n\n  // \n  if (CONJUNCTIONS.has(lower)) {\n    return 'Conj';\n  }\n\n  // \n  if (DETERMINERS.has(lower)) {\n    return 'Det';\n  }\n\n  // \n  if (ADJECTIVES.has(lower)) {\n    return 'Adj';\n  }\n\n  // \n  if (ADVERBS.has(lower)) {\n    return 'Adv';\n  }\n\n  // \n  if (PRONOUNS.has(lower)) {\n    // \n    if (index === 0 || (index > 0 && VERBS.has(words[index + 1]?.toLowerCase()))) {\n      return 'S';\n    }\n    // \n    return 'O';\n  }\n\n  return 'Unknown';\n}\n\n/**\n * \n */\nfunction getPunctuationMeaning(punctuation: string): string {\n  const meanings: Record<string, string> = {\n    '.': '',\n    ',': '',\n    '!': '',\n    '?': '',\n    ';': '',\n    ':': '',\n    '-': '',\n    '': '',\n    '': '',\n    '\"': '',\n    \"'\": '',\n    '(': '',\n    ')': '',\n  };\n  return meanings[punctuation] || '';\n}\n\n/**\n * \n */\nexport function analyzeSentence(sentence: string): GrammarAnalysisResult[] {\n  // \n  const words = sentence.match(/\\b[\\w']+\\b|[.,!?;:\\-\"'()]/g) || [];\n\n  const results: GrammarAnalysisResult[] = [];\n  let foundVerb = false;\n  let foundSubject = false;\n\n  for (let i = 0; i < words.length; i++) {\n    const word = words[i];\n\n    // \n    if (/^[.,!?;:\\-\"'()]$/.test(word)) {\n      results.push({\n        word,\n        tag: 'Unknown',\n        color: '#6b7280',\n        description: getPunctuationMeaning(word),\n      });\n      continue;\n    }\n\n    let tag = classifyWord(word, i, words);\n\n    // \n    if (tag === 'Unknown') {\n      // \n      if (i === 0 && /^[A-Z]/.test(word) && !foundSubject) {\n        tag = 'S';\n        foundSubject = true;\n      }\n      // \n      else if (foundVerb && !foundSubject) {\n        tag = 'O';\n      }\n      // \n      else if (i > 0 && PREPOSITIONS.has(words[i - 1].toLowerCase())) {\n        tag = 'M';\n      }\n      // \n      else {\n        tag = 'M';\n      }\n    }\n\n    if (tag === 'V') {\n      foundVerb = true;\n    }\n    if (tag === 'S') {\n      foundSubject = true;\n    }\n\n    results.push({\n      word,\n      tag,\n      color: getTagColor(tag),\n      description: getTagDescription(tag),\n    });\n  }\n\n  return results;\n}\n\n/**\n * \n */\nexport function getGrammarStats(results: GrammarAnalysisResult[]): Record<GrammarTag, number> {\n  const stats: Record<string, number> = {};\n\n  results.forEach((result) => {\n    stats[result.tag] = (stats[result.tag] || 0) + 1;\n  });\n\n  return stats as Record<GrammarTag, number>;\n}\n\n/**\n * \n * \n */\nexport interface PhrasalExpression {\n  words: string[];\n  meaning: string;\n  type: 'phrasal-verb' | 'idiom' | 'time-expression' | 'determiner-noun';\n}\n\nconst PHRASAL_EXPRESSIONS: PhrasalExpression[] = [\n  //  (Phrasal Verbs) - \n  { words: ['wake', 'up'], meaning: '', type: 'phrasal-verb' },\n  { words: ['get', 'up'], meaning: '', type: 'phrasal-verb' },\n  { words: ['wake', 'up'], meaning: '', type: 'phrasal-verb' },\n  { words: ['brush', 'my', 'teeth'], meaning: '', type: 'phrasal-verb' },\n  { words: ['wash', 'my', 'face'], meaning: '', type: 'phrasal-verb' },\n  { words: ['have', 'breakfast'], meaning: '', type: 'phrasal-verb' },\n  { words: ['go', 'to', 'school'], meaning: '', type: 'phrasal-verb' },\n  { words: ['come', 'back'], meaning: '', type: 'phrasal-verb' },\n  { words: ['come', 'home'], meaning: '', type: 'phrasal-verb' },\n  { words: ['do', 'homework'], meaning: '', type: 'phrasal-verb' },\n  { words: ['go', 'to', 'bed'], meaning: '', type: 'phrasal-verb' },\n\n  // \n  { words: ['at', 'seven'], meaning: '7', type: 'time-expression' },\n  { words: ['in', 'the', 'morning'], meaning: '', type: 'time-expression' },\n  { words: ['in', 'the', 'afternoon'], meaning: '', type: 'time-expression' },\n  { words: ['in', 'the', 'evening'], meaning: '', type: 'time-expression' },\n  { words: ['at', 'night'], meaning: '', type: 'time-expression' },\n\n  // +\n  { words: ['every', 'morning'], meaning: '', type: 'determiner-noun' },\n  { words: ['every', 'day'], meaning: '', type: 'determiner-noun' },\n  { words: ['every', 'night'], meaning: '', type: 'determiner-noun' },\n  { words: ['every', 'week'], meaning: '', type: 'determiner-noun' },\n];\n\n/**\n * \n */\nexport function detectPhrasalExpressions(words: string[]): PhrasalExpression[] {\n  const detected: PhrasalExpression[] = [];\n  const lowerWords = words.map((w) => w.toLowerCase());\n\n  for (const expression of PHRASAL_EXPRESSIONS) {\n    const exprLower = expression.words.map((w) => w.toLowerCase());\n\n    // \n    for (let i = 0; i <= lowerWords.length - exprLower.length; i++) {\n      let match = true;\n      for (let j = 0; j < exprLower.length; j++) {\n        if (lowerWords[i + j] !== exprLower[j]) {\n          match = false;\n          break;\n        }\n      }\n\n      if (match) {\n        detected.push({\n          ...expression,\n          words: words.slice(i, i + exprLower.length), // \n        });\n      }\n    }\n  }\n\n  return detected;\n}\n\n/**\n * \n */\nexport interface GrammarPattern {\n  name: string;\n  meaning: string;\n  pattern: RegExp;\n  explanation: string;\n}\n\nconst GRAMMAR_PATTERNS: GrammarPattern[] = [\n  {\n    name: 'too ~ to ...',\n    meaning: '...',\n    pattern: /\\btoo\\s+\\w+\\s+to\\s+\\w+/i,\n    explanation: 'too + / + to + ...',\n  },\n  {\n    name: 'so ~ that ...',\n    meaning: '...',\n    pattern: /\\bso\\s+\\w+\\s+that\\b/i,\n    explanation: 'so + / + that ~...',\n  },\n  {\n    name: 'so that ...',\n    meaning: '',\n    pattern: /\\bso\\s+that\\b/i,\n    explanation: 'so that ~',\n  },\n  {\n    name: 'It is ~ for ... to',\n    meaning: '...',\n    pattern: /\\bit\\s+is\\s+\\w+\\s+for\\s+\\w+\\s+to\\b/i,\n    explanation:\n      'It is +  + for +  + to + ()...',\n  },\n  {\n    name: 'It is ~ to ...',\n    meaning: '...',\n    pattern: /\\bit\\s+is\\s+\\w+\\s+to\\s+\\w+/i,\n    explanation: 'It is +  + to + ...',\n  },\n  {\n    name: 'It is ~ that ...',\n    meaning: '... ()',\n    pattern: /\\bit\\s+is\\s+\\w+\\s+that\\b/i,\n    explanation: 'It is ~ that ...',\n  },\n  {\n    name: 'not only ~ but also ...',\n    meaning: '...',\n    pattern: /\\bnot\\s+only\\s+.+\\s+but\\s+also\\b/i,\n    explanation: 'not only A but also BAB',\n  },\n  {\n    name: 'either ~ or ...',\n    meaning: '...',\n    pattern: /\\beither\\s+.+\\s+or\\b/i,\n    explanation: 'either A or BAB',\n  },\n  {\n    name: 'neither ~ nor ...',\n    meaning: '...',\n    pattern: /\\bneither\\s+.+\\s+nor\\b/i,\n    explanation: 'neither A nor BAB',\n  },\n  {\n    name: 'both ~ and ...',\n    meaning: '...',\n    pattern: /\\bboth\\s+.+\\s+and\\b/i,\n    explanation: 'both A and BAB',\n  },\n  {\n    name: 'as ~ as ...',\n    meaning: '...',\n    pattern: /\\bas\\s+\\w+\\s+as\\b/i,\n    explanation: 'as + / + as ......',\n  },\n  {\n    name: 'not as ~ as ...',\n    meaning: '...',\n    pattern: /\\bnot\\s+as\\s+\\w+\\s+as\\b/i,\n    explanation: 'not as + / + as ......',\n  },\n  {\n    name: 'one of the ~est',\n    meaning: '1',\n    pattern: /\\bone\\s+of\\s+the\\s+\\w+est\\b/i,\n    explanation: 'one of the +  + 1',\n  },\n  {\n    name: 'make/let/have +  + ',\n    meaning: '',\n    pattern: /\\b(make|let|have|help)\\s+\\w+\\s+\\w+/i,\n    explanation: 'make/let/have +  + ',\n  },\n  {\n    name: 'be used to ~ing',\n    meaning: '',\n    pattern: /\\b(am|is|are|was|were)\\s+used\\s+to\\s+\\w+ing\\b/i,\n    explanation: 'be used to + ',\n  },\n  {\n    name: 'used to + ',\n    meaning: '',\n    pattern: /\\bused\\s+to\\s+\\w+/i,\n    explanation: 'used to + ',\n  },\n];\n\n/**\n * \n */\nexport function detectGrammarPatterns(sentence: string): GrammarPattern[] {\n  const detected: GrammarPattern[] = [];\n\n  for (const pattern of GRAMMAR_PATTERNS) {\n    if (pattern.pattern.test(sentence)) {\n      detected.push(pattern);\n    }\n  }\n\n  return detected;\n}\n","import { useState, useEffect, useMemo, useCallback } from 'react';\nimport { ReadingPassage, Question, ReadingSegment } from '../types';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\nimport { twoWordPhrases, commonPhrases } from '../utils/phrases';\nimport {\n  speakEnglish,\n  isSpeechSynthesisSupported,\n  stopSpeaking,\n  pauseSpeaking,\n  resumeSpeaking,\n  isSpeaking,\n  isPaused,\n} from '@/features/speech/speechSynthesis';\nimport { loadAllPassagesAsReadingFormat } from '../utils/passageAdapter';\nimport { logger } from '@/utils/logger';\nimport {\n  analyzeSentence,\n  GrammarAnalysisResult,\n  detectPhrasalExpressions,\n  PhrasalExpression,\n  detectGrammarPatterns,\n  GrammarPattern,\n} from '../utils/grammarAnalyzer';\nimport AddToCustomButton from './AddToCustomButton';\n\ntype DifficultyFilter = 'all' | '' | '' | '';\n\ninterface ComprehensiveReadingViewProps {\n  onSaveUnknownWords?: (words: Question[]) => void | Promise<void>;\n  customQuestionSets?: CustomQuestionSet[];\n  onAddWordToCustomSet?: (setId: string, word: CustomWord) => void;\n  onRemoveWordFromCustomSet?: (setId: string, word: CustomWord) => void;\n  onOpenCustomSetManagement?: () => void;\n}\n\ninterface WordPopup {\n  word: string;\n  meaning: string;\n  reading: string;\n  etymology: string;\n  relatedWords: string;\n  x: number;\n  y: number;\n}\n\n// \nfunction _getLevelLabel(level: string): string {\n  const levelMap: Record<string, string> = {\n    beginner: '',\n    intermediate: '',\n    advanced: '',\n    Advanced: '',\n    : '',\n    : '',\n    : '',\n  };\n  return levelMap[level] || level;\n}\n\nfunction ComprehensiveReadingView({\n  onSaveUnknownWords,\n  customQuestionSets = [],\n  onAddWordToCustomSet,\n  onRemoveWordFromCustomSet,\n  onOpenCustomSetManagement,\n}: ComprehensiveReadingViewProps) {\n  const [passages, setPassages] = useState<ReadingPassage[]>([]);\n  const [selectedPassageId, setSelectedPassageId] = useState<string | null>(null);\n  const [phraseTranslations, setPhraseTranslations] = useState<boolean[]>([]);\n  const [wordMeaningsVisible, setWordMeaningsVisible] = useState<boolean[]>([]);\n  const [difficultyFilter, setDifficultyFilter] = useState<DifficultyFilter>('all');\n  const [error, setError] = useState<string | null>(null);\n  const [wordDictionary, setWordDictionary] = useState<Map<string, Question>>(new Map());\n  const [readingDictionary, setReadingDictionary] = useState<Map<string, Record<string, string>>>(\n    new Map()\n  );\n  const [wordPopup, setWordPopup] = useState<WordPopup | null>(null);\n  const [showSettings, setShowSettings] = useState(false);\n  const [readingStarted, _setReadingStarted] = useState(true);\n  const [readingSubTab, setReadingSubTab] = useState<'reading' | 'fullText' | 'fullTranslation'>(\n    'reading'\n  );\n  const [_currentPhraseIndex, _setCurrentPhraseIndex] = useState(0);\n  const [isFullTextSpeaking, setIsFullTextSpeaking] = useState(false);\n  const [isFullTextPaused, setIsFullTextPaused] = useState(false);\n  const [selectedSentenceIndex, setSelectedSentenceIndex] = useState<number | null>(null);\n  const [selectedSentenceDetails, setSelectedSentenceDetails] = useState<{\n    text: string;\n    grammarAnalysis: GrammarAnalysisResult[];\n    showMeanings: boolean;\n  } | null>(null);\n  const [showGrammarLegend, setShowGrammarLegend] = useState(false);\n  const [showDetailedExplanation, setShowDetailedExplanation] = useState(false);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // LocalStorage\n  useEffect(() => {\n    if (passages.length > 0) {\n      const readingProgressKey = 'reading-unknown-words-state';\n      try {\n        // : isUnknown\n        const progressData = passages.map((passage) => ({\n          id: passage.id,\n          unknownWords: passage.phrases.flatMap((phrase, pIdx) =>\n            phrase.segments\n              .map((seg, sIdx) => (seg.isUnknown ? `${pIdx}-${sIdx}` : null))\n              .filter(Boolean)\n          ),\n        }));\n        localStorage.setItem(readingProgressKey, JSON.stringify(progressData));\n      } catch (error) {\n        logger.warn(':', error);\n      }\n    }\n  }, [passages]);\n\n  // \n  type PhraseGroup = {\n    type: 'phrase' | 'word';\n    words: string[];\n    segments: ReadingSegment[];\n    isUnknown: boolean;\n  };\n\n  // \n  const _groupSegmentsByPhrases = (segments: ReadingSegment[]): PhraseGroup[] => {\n    const groups: PhraseGroup[] = [];\n    let i = 0;\n\n    while (i < segments.length) {\n      // A.M., P.M., Ms., Mr., Dr. \n      // :  + . +  + .   +  + .\n      if (i + 3 < segments.length) {\n        // A.M.  P.M.  (4: a, ., m, .)\n        const seg1 = segments[i].word.toLowerCase();\n        const seg2 = segments[i + 1].word;\n        const seg3 = segments[i + 2].word.toLowerCase();\n        const seg4 = segments[i + 3].word;\n\n        if ((seg1 === 'a' || seg1 === 'p') && seg2 === '.' && seg3 === 'm' && seg4 === '.') {\n          const abbreviation = seg1 === 'a' ? 'A.M.' : 'P.M.';\n          groups.push({\n            type: 'word',\n            words: [abbreviation],\n            segments: [{ ...segments[i], word: abbreviation }],\n            isUnknown:\n              segments[i].isUnknown ||\n              segments[i + 1].isUnknown ||\n              segments[i + 2].isUnknown ||\n              segments[i + 3].isUnknown,\n          });\n          i += 4;\n          continue;\n        }\n      }\n\n      // Ms., Mr., Dr.  (3: ms/mr/dr, ., )\n      if (i + 2 < segments.length) {\n        const seg1 = segments[i].word.toLowerCase();\n        const seg2 = segments[i + 1].word;\n        const titles = ['ms', 'mr', 'mrs', 'dr', 'prof', 'st'];\n\n        if (titles.includes(seg1) && seg2 === '.') {\n          const abbreviation = seg1.charAt(0).toUpperCase() + seg1.slice(1) + '.';\n          groups.push({\n            type: 'word',\n            words: [abbreviation],\n            segments: [{ ...segments[i], word: abbreviation }],\n            isUnknown: segments[i].isUnknown || segments[i + 1].isUnknown,\n          });\n          i += 2;\n          continue;\n        }\n      }\n\n      // 3\n      if (i + 2 < segments.length) {\n        const threeWords = [\n          segments[i].word.toLowerCase(),\n          segments[i + 1].word.toLowerCase(),\n          segments[i + 2].word.toLowerCase(),\n        ].join(' ');\n\n        if (commonPhrases.includes(threeWords)) {\n          groups.push({\n            type: 'phrase',\n            words: [segments[i].word, segments[i + 1].word, segments[i + 2].word],\n            segments: [segments[i], segments[i + 1], segments[i + 2]],\n            isUnknown:\n              segments[i].isUnknown || segments[i + 1].isUnknown || segments[i + 2].isUnknown,\n          });\n          i += 3;\n          continue;\n        }\n      }\n\n      // 2\n      if (i + 1 < segments.length) {\n        const twoWords = [segments[i].word.toLowerCase(), segments[i + 1].word.toLowerCase()].join(\n          ' '\n        );\n\n        if (twoWordPhrases.includes(twoWords)) {\n          groups.push({\n            type: 'phrase',\n            words: [segments[i].word, segments[i + 1].word],\n            segments: [segments[i], segments[i + 1]],\n            isUnknown: segments[i].isUnknown || segments[i + 1].isUnknown,\n          });\n          i += 2;\n          continue;\n        }\n      }\n\n      // \n      groups.push({\n        type: 'word',\n        words: [segments[i].word],\n        segments: [segments[i]],\n        isUnknown: segments[i].isUnknown,\n      });\n      i += 1;\n    }\n\n    return groups;\n  };\n\n  // \n  useEffect(() => {\n    logger.log('[] ...');\n    // CSV\n    fetch('/data/vocabulary/high-school-entrance-words.csv')\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`CSV: ${res.status}`);\n        }\n        return res.text();\n      })\n      .then((csvText) => {\n        const lines = csvText.split('\\n');\n        const dictionary = new Map<string, Question>();\n\n        // \n        lines.slice(1).forEach((line) => {\n          if (!line.trim()) return;\n\n          // CSV\n          const row = line.split(',').map((cell) => cell.trim());\n\n          if (row.length >= 7) {\n            const word = row[0].toLowerCase().trim();\n            dictionary.set(word, {\n              word: row[0],\n              reading: row[1],\n              meaning: row[2],\n              etymology: row[3],\n              relatedWords: row[4],\n              relatedFields: row[5],\n              difficulty: row[6],\n            });\n          }\n        });\n\n        logger.log(`[] : ${dictionary.size}`);\n        setWordDictionary(dictionary);\n      })\n      .catch((_err) => {\n        // \n        // \n      });\n\n    // JSON\n    fetch('/data/dictionaries/reading-passages-dictionary.json')\n      .then((res) => {\n        if (!res.ok) {\n          throw new Error(`JSON: ${res.status}`);\n        }\n        return res.json();\n      })\n      .then((dictData: Record<string, Record<string, string>>) => {\n        const readingDict = new Map<string, Record<string, string>>();\n\n        Object.entries(dictData).forEach(([word, info]) => {\n          readingDict.set(word.toLowerCase(), info);\n        });\n\n        setReadingDictionary(readingDict);\n        logger.log(`[] : ${readingDict.size}`);\n      })\n      .catch((err) => {\n        logger.error('[] Error loading reading dictionary:', err);\n        // \n      });\n  }, []);\n\n  // \n  // NOTE: useEffect\n  const getLemma = useCallback(\n    (word: string): string => {\n      const normalized = word\n        .toLowerCase()\n        .replace(/[.,!?;:\"']/g, '')\n        .trim();\n\n      // \n      if (wordDictionary.has(normalized) || readingDictionary.has(normalized)) return normalized;\n\n      // -s, -es \n      if (normalized.endsWith('es')) {\n        const base = normalized.slice(0, -2);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n      }\n      if (normalized.endsWith('s')) {\n        const base = normalized.slice(0, -1);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n      }\n\n      // -ed \n      if (normalized.endsWith('ed')) {\n        const base = normalized.slice(0, -2);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n        if (wordDictionary.has(base + 'e') || readingDictionary.has(base + 'e')) return base + 'e';\n        if (base.length > 2 && base[base.length - 1] === base[base.length - 2]) {\n          const deduped = base.slice(0, -1);\n          if (wordDictionary.has(deduped) || readingDictionary.has(deduped)) return deduped;\n        }\n      }\n\n      // -ing \n      if (normalized.endsWith('ing')) {\n        const base = normalized.slice(0, -3);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n        if (wordDictionary.has(base + 'e') || readingDictionary.has(base + 'e')) return base + 'e';\n        if (base.length > 2 && base[base.length - 1] === base[base.length - 2]) {\n          const deduped = base.slice(0, -1);\n          if (wordDictionary.has(deduped) || readingDictionary.has(deduped)) return deduped;\n        }\n      }\n\n      // -ly \n      if (normalized.endsWith('ly')) {\n        const base = normalized.slice(0, -2);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n      }\n\n      // -er, -est \n      if (normalized.endsWith('er')) {\n        const base = normalized.slice(0, -2);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n      }\n      if (normalized.endsWith('est')) {\n        const base = normalized.slice(0, -3);\n        if (wordDictionary.has(base) || readingDictionary.has(base)) return base;\n      }\n\n      return normalized;\n    },\n    [wordDictionary, readingDictionary]\n  );\n\n  // \n  const getMeaning = useCallback(\n    (word: string, existingMeaning?: string | Record<string, unknown>): string => {\n      // existingMeaning'-'\n      if (\n        existingMeaning &&\n        typeof existingMeaning === 'string' &&\n        existingMeaning.trim() &&\n        existingMeaning !== '-'\n      ) {\n        return existingMeaning;\n      }\n\n      // existingMeaningmeaning\n      if (\n        existingMeaning &&\n        typeof existingMeaning === 'object' &&\n        'meaning' in existingMeaning &&\n        typeof existingMeaning.meaning === 'string'\n      ) {\n        return existingMeaning.meaning;\n      }\n\n      // \n      const lowerWord = word.toLowerCase();\n      if (lowerWord === 'who') {\n        return '()';\n      }\n      if (lowerWord === 'whom') {\n        return '()';\n      }\n      if (lowerWord === 'which') {\n        return '()';\n      }\n      if (lowerWord === 'that') {\n        return '()';\n      }\n\n      // \n      const lemma = getLemma(word);\n      const wordData = wordDictionary.get(lemma);\n      const readingWord = readingDictionary.get(lemma);\n\n      return wordData?.meaning || readingWord?.meaning || '';\n    },\n    [getLemma, wordDictionary, readingDictionary]\n  );\n\n  // \n  useEffect(() => {\n    const checkSpeechStatus = setInterval(() => {\n      if (isFullTextSpeaking && !isSpeaking() && !isPaused()) {\n        // \n        setIsFullTextSpeaking(false);\n        setIsFullTextPaused(false);\n      }\n    }, 500); // 0.5\n\n    return () => clearInterval(checkSpeechStatus);\n  }, [isFullTextSpeaking]);\n\n  // \n  useEffect(() => {\n    // \n    if (wordDictionary.size === 0) {\n      logger.log('[] ...');\n      return;\n    }\n\n    logger.log(`[] ... (: ${wordDictionary.size})`);\n\n    // LocalStorage\n    try {\n      localStorage.removeItem('reading-passages-data');\n    } catch {\n      // \n    }\n\n    // \n    const readingProgressKey = 'reading-unknown-words-state';\n    let savedProgress: Array<{ id: string; unknownWords?: string[] }> = [];\n    try {\n      const stored = localStorage.getItem(readingProgressKey);\n      if (stored) {\n        savedProgress = JSON.parse(stored);\n      }\n    } catch (e) {\n      logger.warn('[] :', e);\n    }\n\n    // JSON\n    setIsLoading(true);\n    loadAllPassagesAsReadingFormat(wordDictionary)\n      .then((loadedPassages) => {\n        if (loadedPassages && loadedPassages.length > 0) {\n          logger.log(`[] ${loadedPassages.length}`);\n\n          // \n          const restoredPassages = loadedPassages.map((passage) => {\n            const saved = savedProgress.find((p) => p.id === passage.id);\n            if (saved?.unknownWords && saved.unknownWords.length > 0) {\n              return {\n                ...passage,\n                phrases: passage.phrases.map((phrase, pIdx) => ({\n                  ...phrase,\n                  segments: phrase.segments.map((seg, sIdx) => ({\n                    ...seg,\n                    isUnknown: saved.unknownWords?.includes(`${pIdx}-${sIdx}`) ?? false,\n                  })),\n                })),\n              };\n            }\n            return passage;\n          });\n\n          // : : \n          const levelOrder: Record<string, number> = {\n            : 1,\n            beginner: 1,\n            : 2,\n            intermediate: 2,\n            : 3,\n            advanced: 3,\n            Advanced: 3,\n          };\n          const sortedData = restoredPassages.sort((a, b) => {\n            const levelA = levelOrder[a.level || ''] || 999;\n            const levelB = levelOrder[b.level || ''] || 999;\n            if (levelA !== levelB) return levelA - levelB;\n\n            const wordCountA = a.actualWordCount || 0;\n            const wordCountB = b.actualWordCount || 0;\n            return wordCountA - wordCountB;\n          });\n\n          setPassages(sortedData);\n          logger.log(`[] : ${sortedData.length}`);\n          if (sortedData.length > 0) {\n            setSelectedPassageId(sortedData[0].id);\n            setPhraseTranslations(new Array(sortedData[0].phrases?.length || 0).fill(false));\n            setWordMeaningsVisible(new Array(sortedData[0].phrases?.length || 0).fill(false));\n            logger.log(`[] : ${sortedData[0].id}`);\n          }\n          setIsLoading(false);\n        } else {\n          logger.error('[] loadAllPassagesAsReadingFormat');\n          setError('');\n          setIsLoading(false);\n        }\n      })\n      .catch((err) => {\n        logger.error('[] Error loading passages:', err);\n        setError(': ' + err.message);\n        setIsLoading(false);\n      });\n  }, [wordDictionary]); // \n\n  // \n  const currentPassage = useMemo(\n    () => passages.find((p) => p.id === selectedPassageId),\n    [passages, selectedPassageId]\n  );\n\n  // \n  const filteredPassages = useMemo(() => {\n    const filtered =\n      difficultyFilter === 'all' ? passages : passages.filter((p) => p.level === difficultyFilter);\n\n    // \n    const levelOrder: Record<string, number> = {\n      : 1,\n      beginner: 1,\n      : 2,\n      intermediate: 2,\n      : 3,\n      advanced: 3,\n      Advanced: 3,\n    };\n    return filtered.sort((a, b) => {\n      // \n      const levelA = levelOrder[a.level || ''] || 999;\n      const levelB = levelOrder[b.level || ''] || 999;\n      if (levelA !== levelB) return levelA - levelB;\n\n      // \n      const wordCountA = a.actualWordCount || 0;\n      const wordCountB = b.actualWordCount || 0;\n      return wordCountA - wordCountB;\n    });\n  }, [passages, difficultyFilter]);\n\n  // \n  const handleSelectPassage = useCallback(\n    (passageId: string) => {\n      setSelectedPassageId(passageId);\n      const passage = passages.find((p) => p.id === passageId);\n      if (passage) {\n        setPhraseTranslations(new Array(passage.phrases?.length || 0).fill(false));\n        setWordMeaningsVisible(new Array(passage.phrases?.length || 0).fill(false));\n        _setCurrentPhraseIndex(0); // \n      }\n    },\n    [passages]\n  );\n\n  // \n  const _handlePreviousPhrase = () => {\n    _setCurrentPhraseIndex((prev: number) => Math.max(0, prev - 1));\n  };\n\n  const _handleNextPhrase = () => {\n    if (currentPassage && currentPassage.phrases) {\n      _setCurrentPhraseIndex((prev: number) =>\n        Math.min(currentPassage.phrases.length - 1, prev + 1)\n      );\n    }\n  };\n\n  // \n  const _handlePhraseSpeak = useCallback(\n    (phraseIdx: number, event: React.MouseEvent) => {\n      event.preventDefault();\n      event.stopPropagation();\n\n      if (!currentPassage || !isSpeechSynthesisSupported()) return;\n\n      const phrase = currentPassage.phrases[phraseIdx];\n      const phraseText = phrase.segments\n        .filter((seg) => seg.word && seg.word.trim() !== '')\n        .map((seg) => seg.word)\n        .join(' ');\n\n      speakEnglish(phraseText, { rate: 0.85 });\n\n      // \n      const element = event.currentTarget as HTMLElement;\n      element.classList.add('speaking');\n      setTimeout(() => {\n        element.classList.remove('speaking');\n      }, 600);\n    },\n    [currentPassage]\n  );\n\n  // \n  const handleWordDoubleClick = (word: string, event: React.MouseEvent<HTMLElement>) => {\n    event.preventDefault();\n    event.stopPropagation();\n\n    // \n\n    // \n    if (wordPopup && wordPopup.word === word) {\n      setWordPopup(null);\n      return;\n    }\n\n    // \n    const normalizedWord = word\n      .toLowerCase()\n      .replace(/[.,!?;:\"']/g, '')\n      .trim();\n\n    // \n    const tryLemmatization = (word: string): string | null => {\n      // \n      if (wordDictionary.has(word)) return word;\n\n      // -s, -es \n      if (word.endsWith('es') && wordDictionary.has(word.slice(0, -2))) {\n        return word.slice(0, -2);\n      }\n      if (word.endsWith('s') && wordDictionary.has(word.slice(0, -1))) {\n        return word.slice(0, -1);\n      }\n\n      // -ed \n      if (word.endsWith('ed')) {\n        const base = word.slice(0, -2);\n        if (wordDictionary.has(base)) return base;\n        if (wordDictionary.has(base + 'e')) return base + 'e'; // loved -> love\n        if (base.length > 2 && base[base.length - 1] === base[base.length - 2]) {\n          const deduped = base.slice(0, -1);\n          if (wordDictionary.has(deduped)) return deduped; // stopped -> stop\n        }\n      }\n\n      // -ing \n      if (word.endsWith('ing')) {\n        const base = word.slice(0, -3);\n        if (wordDictionary.has(base)) return base;\n        if (wordDictionary.has(base + 'e')) return base + 'e'; // making -> make\n        if (base.length > 2 && base[base.length - 1] === base[base.length - 2]) {\n          const deduped = base.slice(0, -1);\n          if (wordDictionary.has(deduped)) return deduped; // running -> run\n        }\n      }\n\n      // -ly \n      if (word.endsWith('ly') && wordDictionary.has(word.slice(0, -2))) {\n        return word.slice(0, -2);\n      }\n\n      // -er, -est \n      if (word.endsWith('er') && wordDictionary.has(word.slice(0, -2))) {\n        return word.slice(0, -2);\n      }\n      if (word.endsWith('est') && wordDictionary.has(word.slice(0, -3))) {\n        return word.slice(0, -3);\n      }\n\n      return null;\n    };\n\n    const baseForm = tryLemmatization(normalizedWord);\n    const wordInfo = baseForm ? wordDictionary.get(baseForm) : null;\n\n    if (wordInfo) {\n      const rect = event.currentTarget.getBoundingClientRect();\n      setWordPopup({\n        word: wordInfo.word,\n        meaning: wordInfo.meaning,\n        reading: wordInfo.reading,\n        etymology: wordInfo.etymology,\n        relatedWords: wordInfo.relatedWords,\n        x: rect.left + window.scrollX,\n        y: rect.bottom + window.scrollY + 5,\n      });\n    } else {\n      // \n      const readingWord = readingDictionary.get(baseForm || normalizedWord);\n      if (readingWord) {\n        const rect = event.currentTarget.getBoundingClientRect();\n        setWordPopup({\n          word: readingWord.word,\n          meaning: readingWord.meaning,\n          reading: readingWord.reading || '',\n          etymology: readingWord.etymology || '',\n          relatedWords: readingWord.relatedWords || '',\n          x: rect.left + window.scrollX,\n          y: rect.bottom + window.scrollY + 5,\n        });\n      } else {\n        // \n        logger.warn(`Word not found in dictionary: ${normalizedWord}`);\n      }\n    }\n  };\n\n  // \n  const _handleMarkUnknown = (\n    phraseIndex: number,\n    segmentIndex: number,\n    event: React.MouseEvent\n  ) => {\n    event.preventDefault();\n    event.stopPropagation(); // \n    if (!currentPassage) return;\n\n    setPassages((prev) =>\n      prev.map((passage) =>\n        passage.id === currentPassage.id\n          ? {\n              ...passage,\n              phrases: passage.phrases.map((phrase, pIdx) =>\n                pIdx === phraseIndex\n                  ? {\n                      ...phrase,\n                      segments: phrase.segments.map((seg, sIdx) =>\n                        sIdx === segmentIndex ? { ...seg, isUnknown: !seg.isUnknown } : seg\n                      ),\n                    }\n                  : phrase\n              ),\n            }\n          : passage\n      )\n    );\n  };\n\n  // 4\n  const _handleShowPhraseTranslation = (\n    phraseIndex: number,\n    direction: 'forward' | 'backward' = 'forward'\n  ) => {\n    // 4\n    // 1: \n    // 2: \n    // 3: \n    // 4: \n\n    const wordVisible = wordMeaningsVisible[phraseIndex];\n    const phraseVisible = phraseTranslations[phraseIndex];\n\n    if (direction === 'forward') {\n      // \n      if (!wordVisible && !phraseVisible) {\n        // 1  2: \n        setWordMeaningsVisible((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = true;\n          return newState;\n        });\n      } else if (wordVisible && !phraseVisible) {\n        // 2  3: \n        setPhraseTranslations((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = true;\n          return newState;\n        });\n      } else if (wordVisible && phraseVisible) {\n        // 3  4: \n        setPhraseTranslations((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = false;\n          return newState;\n        });\n      } else {\n        // 4  1: \n        setWordMeaningsVisible((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = false;\n          return newState;\n        });\n      }\n    } else {\n      // \n      if (!wordVisible && !phraseVisible) {\n        // 1  4: \n        setWordMeaningsVisible((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = true;\n          return newState;\n        });\n      } else if (wordVisible && !phraseVisible) {\n        // 24  1: \n        setWordMeaningsVisible((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = false;\n          return newState;\n        });\n      } else if (wordVisible && phraseVisible) {\n        // 3  2: \n        setPhraseTranslations((prev) => {\n          const newState = [...prev];\n          newState[phraseIndex] = false;\n          return newState;\n        });\n      }\n    }\n  };\n\n  // \n  const handleSaveUnknownWords = () => {\n    if (!currentPassage) return;\n\n    const unknownWords: Question[] = [];\n    currentPassage.phrases.forEach((phrase) => {\n      phrase.segments.forEach((segment) => {\n        if (segment.isUnknown && segment.word.trim() !== '') {\n          // \n          if (!unknownWords.some((w) => w.word.toLowerCase() === segment.word.toLowerCase())) {\n            unknownWords.push({\n              word: segment.word,\n              meaning: segment.meaning,\n              reading: segment.reading || '',\n              etymology: segment.etymology || '',\n              relatedWords: segment.relatedWords || '',\n              relatedFields: segment.relatedFields || '',\n              difficulty: segment.difficulty || 'intermediate',\n            });\n          }\n        }\n      });\n    });\n\n    if (unknownWords.length === 0) {\n      alert('\\n');\n      return;\n    }\n\n    if (onSaveUnknownWords) {\n      onSaveUnknownWords(unknownWords);\n    }\n\n    // \n    setPassages((prev) =>\n      prev.map((passage) =>\n        passage.id === currentPassage.id\n          ? {\n              ...passage,\n              phrases: passage.phrases.map((phrase) => ({\n                ...phrase,\n                segments: phrase.segments.map((seg) => ({ ...seg, isUnknown: false })),\n              })),\n            }\n          : passage\n      )\n    );\n\n    alert(`${unknownWords.length}${currentPassage.title}`);\n  };\n\n  // \n  const handleReset = () => {\n    if (!currentPassage) return;\n\n    setPassages((prev) =>\n      prev.map((passage) =>\n        passage.id === currentPassage.id\n          ? {\n              ...passage,\n              phrases: passage.phrases.map((phrase) => ({\n                ...phrase,\n                segments: phrase.segments.map((seg) => ({ ...seg, isUnknown: false })),\n              })),\n            }\n          : passage\n      )\n    );\n    setPhraseTranslations(new Array(currentPassage.phrases.length).fill(false));\n    setWordMeaningsVisible(new Array(currentPassage.phrases.length).fill(false));\n  };\n\n  if (error) {\n    return <div className=\"error-message\">{error}</div>;\n  }\n\n  if (isLoading) {\n    return <div className=\"empty-container\">...</div>;\n  }\n\n  if (passages.length === 0) {\n    return <div className=\"empty-container\"></div>;\n  }\n\n  // \n  if (filteredPassages.length === 0) {\n    return (\n      <div className=\"comprehensive-reading-view\">\n        <div className=\"reading-header\">\n          <div className=\"filter-controls\">\n            <label htmlFor=\"difficulty-filter\">: </label>\n            <select\n              id=\"difficulty-filter\"\n              value={difficultyFilter}\n              onChange={(e) => setDifficultyFilter(e.target.value as DifficultyFilter)}\n              title=\"\"\n            >\n              <option value=\"all\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n            </select>\n          </div>\n        </div>\n        <div className=\"empty-container\">\n          \n        </div>\n      </div>\n    );\n  }\n\n  const unknownCount =\n    currentPassage?.phrases?.reduce(\n      (count, phrase) => count + phrase.segments.filter((s) => s.isUnknown).length,\n      0\n    ) || 0;\n\n  return (\n    <div className=\"comprehensive-reading-view\">\n      {/*  -  */}\n      {!readingStarted && showSettings && (\n        <div className=\"study-settings-panel\">\n          <div className=\"settings-header\">\n            <h3> </h3>\n            <button\n              onClick={() => setShowSettings(false)}\n              className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600\"\n            >\n               \n            </button>\n          </div>\n\n          <div className=\"filter-group\">\n            <label htmlFor=\"difficulty-filter\"> :</label>\n            <select\n              id=\"difficulty-filter\"\n              value={difficultyFilter}\n              onChange={(e) => setDifficultyFilter(e.target.value as DifficultyFilter)}\n              className=\"select-input\"\n            >\n              <option value=\"all\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n            </select>\n          </div>\n\n          <div className=\"filter-group\">\n            <label htmlFor=\"passage-select\"> :</label>\n            <select\n              id=\"passage-select\"\n              value={selectedPassageId || ''}\n              onChange={(e) => handleSelectPassage(e.target.value)}\n              className=\"select-input\"\n            >\n              {filteredPassages.map((passage) => (\n                <option key={passage.id} value={passage.id}>\n                  {_getLevelLabel(passage.level || 'beginner')}_{passage.actualWordCount}_\n                  {passage.title}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      )}\n\n      {/* 6 */}\n      {readingStarted && (\n        <div className=\"reading-sub-tabs grid grid-cols-6 gap-1 sm:gap-2\">\n          <button\n            className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n              readingSubTab === 'reading'\n                ? 'bg-primary text-white border-primary'\n                : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n            }`}\n            onClick={() => setReadingSubTab('reading')}\n          >\n             \n          </button>\n          <button\n            className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n              readingSubTab === 'fullText'\n                ? 'bg-primary text-white border-primary'\n                : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n            }`}\n            onClick={() => setReadingSubTab('fullText')}\n          >\n             \n          </button>\n          <button\n            className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n              readingSubTab === 'fullTranslation'\n                ? 'bg-primary text-white border-primary'\n                : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n            }`}\n            onClick={() => setReadingSubTab('fullTranslation')}\n          >\n             \n          </button>\n          <button\n            onClick={handleSaveUnknownWords}\n            className=\"px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium bg-success text-white rounded-t-lg border-b-2 border-success transition-all duration-200 hover:bg-success-hover disabled:opacity-50 disabled:cursor-not-allowed:bg-success-hover\"\n            disabled={unknownCount === 0}\n            title=\"\"\n          >\n              ({unknownCount})\n          </button>\n          <button\n            onClick={handleReset}\n            className=\"px-4 py-2 text-sm font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md:bg-warning-hover\"\n            title=\"\"\n          >\n             \n          </button>\n          <button\n            className=\"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600\"\n            onClick={() => setShowSettings(!showSettings)}\n            title=\"\"\n          >\n             \n          </button>\n        </div>\n      )}\n\n      {/*  - 6 */}\n      {readingStarted && showSettings && (\n        <div className=\"study-settings-panel\">\n          <div className=\"settings-header\">\n            <h3> </h3>\n            <button\n              onClick={() => setShowSettings(false)}\n              className=\"px-4 py-2 bg-blue-500 text-white rounded-lg hover:bg-blue-600 transition-colors duration-200 text-sm shadow-sm:bg-gray-600\"\n            >\n               \n            </button>\n          </div>\n\n          <div className=\"filter-group\">\n            <label htmlFor=\"difficulty-filter-reading\"> :</label>\n            <select\n              id=\"difficulty-filter-reading\"\n              value={difficultyFilter}\n              onChange={(e) => setDifficultyFilter(e.target.value as DifficultyFilter)}\n              className=\"select-input\"\n            >\n              <option value=\"all\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n              <option value=\"\"></option>\n            </select>\n          </div>\n\n          <div className=\"filter-group\">\n            <label htmlFor=\"passage-select-reading\"> :</label>\n            <select\n              id=\"passage-select-reading\"\n              value={selectedPassageId || ''}\n              onChange={(e) => handleSelectPassage(e.target.value)}\n              className=\"select-input\"\n            >\n              {filteredPassages.map((passage) => (\n                <option key={passage.id} value={passage.id}>\n                  {_getLevelLabel(passage.level || 'beginner')}_{passage.actualWordCount}_\n                  {passage.title}\n                </option>\n              ))}\n            </select>\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      {wordPopup && (\n        <>\n          <div className=\"word-popup-overlay\" onClick={() => setWordPopup(null)} />\n          <div className=\"word-popup\" data-popup-x={wordPopup.x} data-popup-y={wordPopup.y}>\n            <button className=\"popup-close\" onClick={() => setWordPopup(null)} title=\"\">\n              \n            </button>\n            <div className=\"popup-word\">{wordPopup.word}</div>\n            {wordPopup.reading && <div className=\"popup-reading\">{wordPopup.reading}</div>}\n            <div className=\"popup-meaning\">{wordPopup.meaning}</div>\n            {wordPopup.etymology && (\n              <div className=\"popup-etymology\">\n                <strong>:</strong> {wordPopup.etymology}\n              </div>\n            )}\n            {wordPopup.relatedWords && (\n              <div className=\"popup-related\">\n                <strong>:</strong> {wordPopup.relatedWords}\n              </div>\n            )}\n          </div>\n        </>\n      )}\n\n      {/*  */}\n      {readingStarted &&\n        currentPassage &&\n        currentPassage.phrases &&\n        currentPassage.phrases.length > 0 && (\n          <div className=\"passage-content\">\n            <h3 className=\"passage-title\">{currentPassage.title}</h3>\n\n            {/* :  +  */}\n            {readingSubTab === 'reading' && (\n              <>\n                {/*  */}\n                <div className=\"reading-full-text-area\">\n                  <h4 className=\"text-lg font-semibold mb-3\"> </h4>\n                  <div className=\"full-text-content\">\n                    {(() => {\n                      // originalText\n                      if (currentPassage.originalText) {\n                        // \n                        const sentences = currentPassage.originalText\n                          .split(/([.!?])\\s+/)\n                          .filter((s) => s.trim());\n                        const reconstructedSentences: string[] = [];\n                        for (let i = 0; i < sentences.length; i += 2) {\n                          const sentence = sentences[i];\n                          const punctuation = sentences[i + 1] || '';\n                          reconstructedSentences.push((sentence + punctuation).trim());\n                        }\n\n                        return (\n                          <div className=\"sentences-container\">\n                            {reconstructedSentences.map((sentence, idx) => (\n                              <span\n                                key={idx}\n                                className={`sentence-clickable ${selectedSentenceIndex === idx ? 'selected-reading' : ''}`}\n                                onClick={() => {\n                                  setSelectedSentenceIndex(idx);\n                                  const grammarAnalysis = analyzeSentence(sentence);\n                                  setSelectedSentenceDetails({\n                                    text: sentence,\n                                    grammarAnalysis,\n                                    showMeanings: false,\n                                  });\n                                }}\n                              >\n                                {sentence}{' '}\n                              </span>\n                            ))}\n                          </div>\n                        );\n                      }\n\n                      // originalText\n                      const isConversation = currentPassage.title\n                        .toLowerCase()\n                        .includes('conversation');\n\n                      if (isConversation) {\n                        // : \n                        const lines: string[] = [];\n\n                        currentPassage.phrases.forEach((phrase) => {\n                          let lineText = phrase.segments\n                            .map((s) => s.word)\n                            .join(' ')\n                            .trim();\n                          if (!lineText || lineText === '-') return;\n                          lineText = lineText.replace(/\\s+([.,!?;:\"])/g, '$1');\n                          lines.push(lineText);\n                        });\n\n                        return (\n                          <div className=\"sentences-container\">\n                            {lines.map((line, idx) => (\n                              <span\n                                key={idx}\n                                className={`sentence-clickable ${selectedSentenceIndex === idx ? 'selected-reading' : ''}`}\n                                onClick={() => {\n                                  setSelectedSentenceIndex(idx);\n                                  const grammarAnalysis = analyzeSentence(line);\n                                  setSelectedSentenceDetails({\n                                    text: line,\n                                    grammarAnalysis,\n                                    showMeanings: false,\n                                  });\n                                }}\n                              >\n                                {line}{' '}\n                              </span>\n                            ))}\n                          </div>\n                        );\n                      } else {\n                        // \n                        let fullText = '';\n                        let lastWasPeriod = true;\n\n                        currentPassage.phrases.forEach((phrase) => {\n                          phrase.segments.forEach((seg) => {\n                            let word = seg.word.trim();\n                            if (word && word !== '-') {\n                              if (/^[.,!?;:]$/.test(word)) {\n                                fullText += word;\n                                lastWasPeriod = /^[.!?]$/.test(word);\n                              } else if (word === '\"' || word === \"'\") {\n                                fullText += word;\n                              } else {\n                                if (lastWasPeriod && word.length > 0) {\n                                  word = word.charAt(0).toUpperCase() + word.slice(1);\n                                  lastWasPeriod = false;\n                                }\n                                if (\n                                  fullText.length > 0 &&\n                                  !fullText.endsWith(' ') &&\n                                  !fullText.endsWith('\"') &&\n                                  !fullText.endsWith(\"'\")\n                                ) {\n                                  fullText += ' ';\n                                }\n                                fullText += word;\n                              }\n                            }\n                          });\n                        });\n\n                        fullText = fullText.replace(/\\s+\"/g, '\"').replace(/\\s+'/g, \"'\");\n\n                        const sentences = fullText.split(/([.!?])\\s+/).filter((s) => s.trim());\n                        const reconstructedSentences: string[] = [];\n                        for (let i = 0; i < sentences.length; i += 2) {\n                          const sentence = sentences[i];\n                          const punctuation = sentences[i + 1] || '';\n                          reconstructedSentences.push((sentence + punctuation).trim());\n                        }\n\n                        return (\n                          <div className=\"sentences-container\">\n                            {reconstructedSentences.map((sentence, idx) => (\n                              <span\n                                key={idx}\n                                className={`sentence-clickable ${selectedSentenceIndex === idx ? 'selected-reading' : ''}`}\n                                onClick={() => {\n                                  setSelectedSentenceIndex(idx);\n                                  const grammarAnalysis = analyzeSentence(sentence);\n                                  setSelectedSentenceDetails({\n                                    text: sentence,\n                                    grammarAnalysis,\n                                    showMeanings: false,\n                                  });\n                                }}\n                              >\n                                {sentence}{' '}\n                              </span>\n                            ))}\n                          </div>\n                        );\n                      }\n                    })()}\n                  </div>\n                </div>\n\n                {/*  */}\n                {selectedSentenceIndex !== null && selectedSentenceDetails && (\n                  <div className=\"selected-sentence-analysis mt-6\">\n                    <div className=\"flex justify-between items-center mb-4\">\n                      <h4 className=\"m-0 text-lg font-semibold\"> </h4>\n                      <div className=\"flex gap-2\">\n                        <button\n                          className=\"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover\"\n                          onClick={() => speakEnglish(selectedSentenceDetails.text)}\n                          title=\"\"\n                        >\n                           \n                        </button>\n                        <button\n                          className=\"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover\"\n                          onClick={() =>\n                            setSelectedSentenceDetails({\n                              ...selectedSentenceDetails,\n                              showMeanings: !selectedSentenceDetails.showMeanings,\n                            })\n                          }\n                        >\n                          {selectedSentenceDetails.showMeanings ? '' : ''}\n                        </button>\n                      </div>\n                    </div>\n\n                    <div className=\"selected-sentence-text mb-4\">\n                      {selectedSentenceDetails.text}\n                    </div>\n\n                    {/*  */}\n                    <div className=\"grammar-structure mb-4\">\n                      <div className=\"flex justify-between items-center mb-2\">\n                        <h5 className=\"text-sm font-semibold m-0\"> :</h5>\n                        <button\n                          className=\"px-2 py-1 text-xs bg-gray-200 rounded hover:bg-gray-300:bg-gray-600\"\n                          onClick={() => setShowGrammarLegend(!showGrammarLegend)}\n                        >\n                          {showGrammarLegend ? '' : ''}\n                        </button>\n                      </div>\n\n                      {/*  */}\n                      {showGrammarLegend && (\n                        <div className=\"grammar-legend mb-3 p-3 bg-gray-50 rounded\">\n                          <div className=\"flex flex-col gap-2 sm:flex-row sm:justify-between sm:items-center mb-2\">\n                            <h6 className=\"text-xs font-semibold m-0\"> </h6>\n                            <button\n                              className=\"px-2 py-1 text-xs bg-blue-100 text-blue-700 rounded hover:bg-blue-200:bg-blue-800\"\n                              onClick={() => setShowDetailedExplanation(!showDetailedExplanation)}\n                            >\n                              {showDetailedExplanation ? '' : ' '}\n                            </button>\n                          </div>\n\n                          {!showDetailedExplanation ? (\n                            <div className=\"grid grid-cols-1 sm:grid-cols-2 gap-2 text-xs\">\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"S\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"S\">\n                                    [S]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\"> (Subject)</span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"V\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"V\">\n                                    [V]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\"> (Verb)</span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"O\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"O\">\n                                    [O]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\"> (Object)</span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"C\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"C\">\n                                    [C]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Complement)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"M\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"M\">\n                                    [M]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Modifier)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Prep\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Prep\">\n                                    [Prep]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Preposition)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Conj\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Conj\">\n                                    [Conj]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Conjunction)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Det\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Det\">\n                                    [Det]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Determiner)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Adj\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Adj\">\n                                    [Adj]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\">\n                                   (Adjective)\n                                </span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Adv\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Adv\">\n                                    [Adv]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\"> (Adverb)</span>\n                              </div>\n                              <div className=\"flex items-center gap-2 min-w-0\">\n                                <span className=\"grammar-tag\" data-tag=\"Unknown\">\n                                  <span className=\"grammar-tag-label\" data-tag=\"Unknown\">\n                                    [?]\n                                  </span>\n                                </span>\n                                <span className=\"flex-1 min-w-0 break-words\"></span>\n                              </div>\n                            </div>\n                          ) : (\n                            <div className=\"detailed-grammar-explanation text-xs space-y-3 break-words\">\n                              <div className=\"explanation-section\">\n                                <h6 className=\"font-semibold text-sm mb-2\">\n                                    ()\n                                </h6>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"S\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"S\">\n                                        [S]\n                                      </span>\n                                    </span>\n                                    <strong> (Subject)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : <em>I</em> study English. / <em>The cat</em> is cute.\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"V\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"V\">\n                                        [V]\n                                      </span>\n                                    </span>\n                                    <strong> (Verb)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    \n                                    <br />\n                                    : I <em>study</em> English. / The cat <em>is</em> cute.\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"O\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"O\">\n                                        [O]\n                                      </span>\n                                    </span>\n                                    <strong> (Object)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : I study <em>English</em>. / I like <em>cats</em>.\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"C\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"C\">\n                                        [C]\n                                      </span>\n                                    </span>\n                                    <strong> (Complement)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    \n                                    <br />\n                                    : The cat is <em>cute</em>. / I am <em>a student</em>.\n                                  </p>\n                                </div>\n                              </div>\n\n                              <div className=\"explanation-section\">\n                                <h6 className=\"font-semibold text-sm mb-2\">\n                                   \n                                </h6>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"M\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"M\">\n                                        [M]\n                                      </span>\n                                    </span>\n                                    <strong> (Modifier)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    \n                                    <br />\n                                    : I wake up at <em>seven</em>. / I read a <em>good</em> book.\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"Adj\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"Adj\">\n                                        [Adj]\n                                      </span>\n                                    </span>\n                                    <strong> (Adjective)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : a <em>beautiful</em> flower / <em>happy</em> students\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"Adv\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"Adv\">\n                                        [Adv]\n                                      </span>\n                                    </span>\n                                    <strong> (Adverb)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : run <em>quickly</em> / <em>very</em> happy / <em>always</em>{' '}\n                                    study\n                                  </p>\n                                </div>\n                              </div>\n\n                              <div className=\"explanation-section\">\n                                <h6 className=\"font-semibold text-sm mb-2\">\n                                   \n                                </h6>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"Prep\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"Prep\">\n                                        [Prep]\n                                      </span>\n                                    </span>\n                                    <strong> (Preposition)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : <em>at</em> school / <em>in</em> the morning / <em>with</em>{' '}\n                                    friends\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"Conj\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"Conj\">\n                                        [Conj]\n                                      </span>\n                                    </span>\n                                    <strong> (Conjunction)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    <br />\n                                    : I <em>and</em> you / study <em>but</em> tired /{' '}\n                                    <em>because</em> I like it\n                                  </p>\n                                </div>\n\n                                <div className=\"explanation-item mb-2\">\n                                  <div className=\"flex items-center gap-2 mb-1\">\n                                    <span className=\"grammar-tag\" data-tag=\"Det\">\n                                      <span className=\"grammar-tag-label\" data-tag=\"Det\">\n                                        [Det]\n                                      </span>\n                                    </span>\n                                    <strong> (Determiner)</strong>\n                                  </div>\n                                  <p className=\"ml-6 text-gray-600\">\n                                    <strong></strong>\n                                    \n                                    <br />\n                                    : <em>the</em> book / <em>my</em> cat / <em>every</em> day /{' '}\n                                    <em>some</em> water\n                                  </p>\n                                </div>\n                              </div>\n                            </div>\n                          )}\n                        </div>\n                      )}\n\n                      <div className=\"flex flex-wrap gap-2\">\n                        {selectedSentenceDetails.grammarAnalysis\n                          .filter((a) => !/^[.,!?;:\\-\"'()]$/.test(a.word))\n                          .map((analysis, idx) => (\n                            <div\n                              key={idx}\n                              className=\"grammar-tag\"\n                              data-tag={analysis.tag}\n                              title={analysis.description}\n                            >\n                              <span className=\"font-semibold\">{analysis.word}</span>\n                              <span\n                                className=\"ml-1 text-xs grammar-tag-label\"\n                                data-tag={analysis.tag}\n                              >\n                                [{analysis.tag}]\n                              </span>\n                            </div>\n                          ))}\n                      </div>\n\n                      {/*  */}\n                      {selectedSentenceDetails.grammarAnalysis.some((a) =>\n                        /^[.,!?;:\\-\"'()]$/.test(a.word)\n                      ) && (\n                        <div className=\"mt-3\">\n                          <h6 className=\"text-xs font-semibold mb-2 text-gray-600\">\n                             :\n                          </h6>\n                          <div className=\"flex flex-wrap gap-2\">\n                            {selectedSentenceDetails.grammarAnalysis\n                              .filter((a) => /^[.,!?;:\\-\"'()]$/.test(a.word))\n                              .map((analysis, idx) => (\n                                <div\n                                  key={idx}\n                                  className=\"punctuation-card\"\n                                  title={analysis.description}\n                                >\n                                  <span className=\"font-bold text-lg\">{analysis.word}</span>\n                                  <span className=\"ml-2 text-xs text-gray-600\">\n                                    {analysis.description}\n                                  </span>\n                                </div>\n                              ))}\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    {/*  */}\n                    {(() => {\n                      const words = selectedSentenceDetails.grammarAnalysis.map((a) => a.word);\n                      const phrasalExpressions = detectPhrasalExpressions(words);\n\n                      if (phrasalExpressions.length === 0) return null;\n\n                      return (\n                        <div className=\"phrasal-expressions-section mt-4\">\n                          <h5 className=\"text-sm font-semibold mb-2\"> :</h5>\n                          <div className=\"space-y-2\">\n                            {phrasalExpressions.map((expr: PhrasalExpression, idx: number) => (\n                              <div key={idx} className=\"phrasal-expression-card\">\n                                <div className=\"phrasal-expression-words\">\n                                  {expr.words.map((word, widx) => {\n                                    const meaning = getMeaning(word, undefined);\n                                    return (\n                                      <div key={widx} className=\"phrasal-word-item\">\n                                        <div className=\"phrasal-word\">{word}</div>\n                                        <div className=\"phrasal-word-meaning\">{meaning || '-'}</div>\n                                      </div>\n                                    );\n                                  })}\n                                </div>\n                                <div className=\"phrasal-expression-divider\">\n                                  <div className=\"phrasal-divider-line\"></div>\n                                  <div className=\"flex items-center gap-2\">\n                                    <div className=\"phrasal-type-label\"></div>\n                                    {/*  */}\n                                    {onAddWordToCustomSet &&\n                                      onRemoveWordFromCustomSet &&\n                                      onOpenCustomSetManagement && (\n                                        <AddToCustomButton\n                                          word={{\n                                            word: expr.words.join(' '),\n                                            meaning: expr.meaning,\n                                            source: 'reading',\n                                            sourceDetail: currentPassage?.title,\n                                          }}\n                                          sets={customQuestionSets}\n                                          onAddWord={onAddWordToCustomSet}\n                                          onRemoveWord={onRemoveWordFromCustomSet}\n                                          onOpenManagement={onOpenCustomSetManagement}\n                                          size=\"small\"\n                                        />\n                                      )}\n                                  </div>\n                                </div>\n                                <div className=\"phrasal-expression-meaning\">{expr.meaning}</div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    })()}\n\n                    {/*  */}\n                    {(() => {\n                      const patterns = detectGrammarPatterns(selectedSentenceDetails.text);\n\n                      if (patterns.length === 0) return null;\n\n                      return (\n                        <div className=\"grammar-patterns-section mt-4\">\n                          <h5 className=\"text-sm font-semibold mb-2\"> :</h5>\n                          <div className=\"space-y-2\">\n                            {patterns.map((pattern: GrammarPattern, idx: number) => (\n                              <div key={idx} className=\"grammar-pattern-card\">\n                                <div className=\"pattern-header\">\n                                  <div className=\"pattern-name\">{pattern.name}</div>\n                                  <div className=\"pattern-meaning\">{pattern.meaning}</div>\n                                </div>\n                                <div className=\"pattern-sentence\">\n                                  {selectedSentenceDetails.text}\n                                </div>\n                                <div className=\"pattern-explanation\"> {pattern.explanation}</div>\n                              </div>\n                            ))}\n                          </div>\n                        </div>\n                      );\n                    })()}\n\n                    {/*  */}\n                    {selectedSentenceDetails.showMeanings && (\n                      <div className=\"word-cards-container\">\n                        <h5 className=\"text-sm font-semibold mb-2\"> :</h5>\n                        <div className=\"flex flex-wrap gap-2\">\n                          {selectedSentenceDetails.grammarAnalysis\n                            .filter((a) => !/^[.,!?;:\\-\"'()]$/.test(a.word))\n                            .map((analysis, idx) => {\n                              const meaning = getMeaning(analysis.word, undefined);\n                              return (\n                                <div\n                                  key={idx}\n                                  className=\"word-card\"\n                                  onDoubleClick={(e) => handleWordDoubleClick(analysis.word, e)}\n                                  title=\": \"\n                                >\n                                  <div className=\"word-card-word\">{analysis.word}</div>\n                                  {meaning && meaning !== '-' && (\n                                    <div className=\"word-card-meaning text-xs\">{meaning}</div>\n                                  )}\n                                </div>\n                              );\n                            })}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                )}\n              </>\n            )}\n\n            {/* :  */}\n            {readingSubTab === 'fullText' && (\n              <div className=\"full-text-display\">\n                <h3> </h3>\n                <div className=\"full-text-controls\">\n                  <button\n                    className=\"px-6 py-3 text-base font-medium bg-primary text-white border-2 border-primary rounded-lg transition-all duration-200 hover:bg-primary-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-primary-hover\"\n                    onClick={() => {\n                      // Student 1:, Mom:, etc.\n                      const fullText = currentPassage.phrases\n                        .map((phrase) => {\n                          const text = phrase.segments.map((s) => s.word).join(' ');\n                          // Student 1:, Mom:, Teacher:, etc.\n                          return text.replace(/^[A-Z][a-z]*(?:\\s+\\d+)?:\\s*/, '').replace(/\"/g, ''); // \n                        })\n                        .join(' ')\n                        .replace(/\\s+([.,!?;:])/g, '$1');\n\n                      speakEnglish(fullText);\n                      setIsFullTextSpeaking(true);\n                      setIsFullTextPaused(false);\n                    }}\n                    disabled={isFullTextSpeaking && !isFullTextPaused}\n                    title=\"\"\n                  >\n                     \n                  </button>\n                  <button\n                    className=\"px-6 py-3 text-base font-medium bg-warning text-warning-dark border-2 border-warning rounded-lg transition-all duration-200 hover:bg-warning-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-warning-hover\"\n                    onClick={() => {\n                      if (isFullTextPaused) {\n                        resumeSpeaking();\n                        setIsFullTextPaused(false);\n                      } else {\n                        pauseSpeaking();\n                        setIsFullTextPaused(true);\n                      }\n                    }}\n                    disabled={!isFullTextSpeaking}\n                    title={isFullTextPaused ? '' : ''}\n                  >\n                    {isFullTextPaused ? ' ' : ' '}\n                  </button>\n                  <button\n                    className=\"px-6 py-3 text-base font-medium bg-error text-white border-2 border-error rounded-lg transition-all duration-200 hover:bg-error-hover hover:shadow-md disabled:opacity-50 disabled:cursor-not-allowed:bg-error-hover\"\n                    onClick={() => {\n                      stopSpeaking();\n                      setIsFullTextSpeaking(false);\n                      setIsFullTextPaused(false);\n                    }}\n                    disabled={!isFullTextSpeaking}\n                    title=\"\"\n                  >\n                     \n                  </button>\n                </div>\n                <div className=\"full-text-content\">\n                  {(() => {\n                    // originalText\n                    if (currentPassage.originalText) {\n                      return <div className=\"paragraph-en\">{currentPassage.originalText}</div>;\n                    }\n\n                    // : \"Daily Conversation\"\n                    const isConversation = currentPassage.title\n                      .toLowerCase()\n                      .includes('conversation');\n\n                    if (isConversation) {\n                      // : \n                      const lines: string[] = [];\n\n                      currentPassage.phrases.forEach((phrase) => {\n                        let lineText = phrase.segments\n                          .map((s) => s.word)\n                          .join(' ')\n                          .trim();\n                        if (!lineText || lineText === '-') return;\n                        lineText = lineText.replace(/\\s+([.,!?;:\"])/g, '$1');\n                        lines.push(lineText);\n                      });\n\n                      return (\n                        <div>\n                          {lines.map((line, idx) => (\n                            <p key={idx} className=\"paragraph-en conversation-line\">\n                              {line}\n                            </p>\n                          ))}\n                        </div>\n                      );\n                    } else {\n                      // : \n                      // \n                      const firstPhrase = currentPassage.phrases[0];\n                      const firstPhraseText = firstPhrase.segments\n                        .map((s) => s.word)\n                        .join(' ')\n                        .trim();\n                      const isFirstPhraseTitle =\n                        firstPhraseText.length < 100 && !/[.!?]$/.test(firstPhraseText);\n\n                      let fullText = '';\n                      let lastWasPeriod = true;\n\n                      currentPassage.phrases.forEach((phrase, phraseIdx) => {\n                        // \n                        if (phraseIdx === 0 && isFirstPhraseTitle) {\n                          return;\n                        }\n\n                        phrase.segments.forEach((seg) => {\n                          let word = seg.word.trim();\n                          if (word && word !== '-') {\n                            if (/^[.,!?;:]$/.test(word)) {\n                              fullText += word;\n                              lastWasPeriod = /^[.!?]$/.test(word);\n                            } else if (word === '\"' || word === \"'\") {\n                              // \n                              fullText += word;\n                            } else {\n                              if (lastWasPeriod && word.length > 0) {\n                                word = word.charAt(0).toUpperCase() + word.slice(1);\n                                lastWasPeriod = false;\n                              }\n                              // \n                              if (\n                                fullText.length > 0 &&\n                                !fullText.endsWith(' ') &&\n                                !fullText.endsWith('\"') &&\n                                !fullText.endsWith(\"'\")\n                              ) {\n                                fullText += ' ';\n                              }\n                              fullText += word;\n                            }\n                          }\n                        });\n                      });\n\n                      // \n                      fullText = fullText.replace(/\\s+\"/g, '\"').replace(/\\s+'/g, \"'\");\n\n                      // \n                      const sentences = fullText.split(/([.!?])\\s+/).filter((s) => s.trim());\n                      const reconstructedSentences: string[] = [];\n                      for (let i = 0; i < sentences.length; i += 2) {\n                        const sentence = sentences[i];\n                        const punctuation = sentences[i + 1] || '';\n                        reconstructedSentences.push((sentence + punctuation).trim());\n                      }\n\n                      // \n                      const paragraphs: string[] = [];\n                      let currentParagraph: string[] = [];\n                      let wordCount = 0;\n                      const targetWordsPerParagraph = 60;\n\n                      reconstructedSentences.forEach((sentence, idx) => {\n                        const sentenceWordCount = sentence.split(/\\s+/).length;\n                        currentParagraph.push(sentence);\n                        wordCount += sentenceWordCount;\n\n                        if (\n                          wordCount >= targetWordsPerParagraph ||\n                          idx === reconstructedSentences.length - 1\n                        ) {\n                          paragraphs.push(currentParagraph.join(' '));\n                          currentParagraph = [];\n                          wordCount = 0;\n                        }\n                      });\n\n                      if (currentParagraph.length > 0) {\n                        paragraphs.push(currentParagraph.join(' '));\n                      }\n\n                      // \n                      const allSentences = reconstructedSentences;\n\n                      // \n                      const handleSentenceClick = (idx: number) => {\n                        setSelectedSentenceIndex(idx);\n                        const sentence = allSentences[idx];\n                        const grammarAnalysis = analyzeSentence(sentence);\n                        setSelectedSentenceDetails({\n                          text: sentence,\n                          grammarAnalysis,\n                          showMeanings: false,\n                        });\n                      };\n\n                      return (\n                        <div>\n                          <div className=\"sentences-container\">\n                            {allSentences.map((sentence, idx) => (\n                              <span\n                                key={idx}\n                                className={`sentence-clickable ${selectedSentenceIndex === idx ? 'selected' : ''}`}\n                                onClick={() => handleSentenceClick(idx)}\n                              >\n                                {sentence}{' '}\n                              </span>\n                            ))}\n                          </div>\n\n                          {/*  */}\n                          {selectedSentenceIndex !== null && selectedSentenceDetails && (\n                            <div className=\"selected-sentence-analysis\">\n                              <div className=\"flex justify-between items-center mb-4\">\n                                <h4 className=\"m-0\"> </h4>\n                                <div className=\"flex gap-2\">\n                                  <button\n                                    className=\"px-3 py-1 text-sm bg-primary text-white rounded hover:bg-primary-hover\"\n                                    onClick={() => speakEnglish(selectedSentenceDetails.text)}\n                                    title=\"\"\n                                  >\n                                     \n                                  </button>\n                                  <button\n                                    className=\"px-3 py-1 text-sm bg-info text-white rounded hover:bg-info-hover\"\n                                    onClick={() =>\n                                      setSelectedSentenceDetails({\n                                        ...selectedSentenceDetails,\n                                        showMeanings: !selectedSentenceDetails.showMeanings,\n                                      })\n                                    }\n                                  >\n                                    {selectedSentenceDetails.showMeanings\n                                      ? ''\n                                      : ''}\n                                  </button>\n                                </div>\n                              </div>\n\n                              <div className=\"selected-sentence-text\">\n                                {selectedSentenceDetails.text}\n                              </div>\n\n                              {/*  */}\n                              <div className=\"grammar-structure mt-4\">\n                                <h5 className=\"text-sm font-semibold mb-2\"> :</h5>\n                                <div className=\"flex flex-wrap gap-2\">\n                                  {selectedSentenceDetails.grammarAnalysis.map((analysis, idx) => (\n                                    <div\n                                      key={idx}\n                                      className=\"grammar-tag\"\n                                      data-tag={analysis.tag}\n                                      title={analysis.description}\n                                    >\n                                      <span className=\"font-semibold\">{analysis.word}</span>\n                                      <span\n                                        className=\"ml-1 text-xs grammar-tag-label\"\n                                        data-tag={analysis.tag}\n                                      >\n                                        [{analysis.tag}]\n                                      </span>\n                                    </div>\n                                  ))}\n                                </div>\n                              </div>\n\n                              {/*  */}\n                              {selectedSentenceDetails.showMeanings && (\n                                <div className=\"word-cards-container mt-4\">\n                                  <h5 className=\"text-sm font-semibold mb-2\"> :</h5>\n                                  <div className=\"flex flex-wrap gap-2\">\n                                    {selectedSentenceDetails.grammarAnalysis\n                                      .filter((a) => !/^[.,!?;:]$/.test(a.word))\n                                      .map((analysis, idx) => {\n                                        const meaning = getMeaning(analysis.word, undefined);\n                                        return (\n                                          <div\n                                            key={idx}\n                                            className=\"word-card\"\n                                            onDoubleClick={(e) =>\n                                              handleWordDoubleClick(analysis.word, e)\n                                            }\n                                            title=\": \"\n                                          >\n                                            <div className=\"word-card-word\">{analysis.word}</div>\n                                            {meaning && meaning !== '-' && (\n                                              <div className=\"word-card-meaning text-xs\">\n                                                {meaning}\n                                              </div>\n                                            )}\n                                          </div>\n                                        );\n                                      })}\n                                  </div>\n                                </div>\n                              )}\n                            </div>\n                          )}\n                        </div>\n                      );\n                    }\n                  })()}\n                </div>\n              </div>\n            )}\n\n            {/* :  */}\n            {readingSubTab === 'fullTranslation' && (\n              <div className=\"full-translation-display\">\n                <div className=\"full-translation-content\">\n                  {(() => {\n                    // \n                    console.log('[] currentPassage.id:', currentPassage.id);\n                    console.log(\n                      '[] currentPassage.translation exists:',\n                      !!currentPassage.translation\n                    );\n                    console.log(\n                      '[] currentPassage.translation length:',\n                      currentPassage.translation?.length || 0\n                    );\n\n                    if (currentPassage.translation) {\n                      // \n                      const paragraphs = currentPassage.translation\n                        .split(/\\n+/)\n                        .map((p) => p.trim())\n                        .filter((p) => p.length > 0);\n\n                      return (\n                        <div className=\"full-translation-text\">\n                          {paragraphs.map((para, idx) => (\n                            <p key={idx} className=\"paragraph-ja\">\n                              {para}\n                            </p>\n                          ))}\n                        </div>\n                      );\n                    }\n\n                    // \n                    // : \"Conversation\"\n                    const isConversation = currentPassage.title\n                      .toLowerCase()\n                      .includes('conversation');\n\n                    if (isConversation) {\n                      // : \n                      const lines: string[] = [];\n\n                      currentPassage.phrases.forEach((phrase) => {\n                        let meaning = phrase.phraseMeaning || '';\n\n                        // []\n                        meaning = meaning.replace(/\\[\\]/g, '').trim();\n\n                        // \n                        if (!meaning || meaning === '-') return;\n\n                        lines.push(meaning);\n                      });\n\n                      return lines.map((line, idx) => (\n                        <p key={idx} className=\"paragraph-ja conversation-line\">\n                          {line}\n                        </p>\n                      ));\n                    } else {\n                      // : \n                      const translatedSentences: string[] = [];\n                      let currentSentence = '';\n\n                      currentPassage.phrases.forEach((phrase) => {\n                        let meaning = phrase.phraseMeaning || '';\n                        if (meaning) {\n                          meaning = meaning.replace(/\\[\\]/g, '').trim();\n                          if (!meaning) return;\n\n                          const phraseWords = phrase.segments\n                            .map((s) => s.word)\n                            .join(' ')\n                            .trim();\n                          const isEndOfSentence = /[.!?]$/.test(phraseWords);\n\n                          if (!/[]$/.test(meaning)) {\n                            if (isEndOfSentence) {\n                              currentSentence += meaning + '';\n                              translatedSentences.push(currentSentence.trim());\n                              currentSentence = '';\n                            } else {\n                              currentSentence += meaning + '';\n                            }\n                          } else {\n                            currentSentence += meaning;\n                            if (isEndOfSentence) {\n                              translatedSentences.push(currentSentence.trim());\n                              currentSentence = '';\n                            }\n                          }\n                        }\n                      });\n\n                      if (currentSentence.trim()) {\n                        translatedSentences.push(currentSentence.trim() + '');\n                      }\n\n                      // 4\n                      const paragraphs: string[] = [];\n                      const sentencesPerParagraph = 4;\n\n                      for (let i = 0; i < translatedSentences.length; i += sentencesPerParagraph) {\n                        const paragraphSentences = translatedSentences.slice(\n                          i,\n                          i + sentencesPerParagraph\n                        );\n                        paragraphs.push(paragraphSentences.join(''));\n                      }\n\n                      return paragraphs.map((para, idx) => (\n                        <p key={idx} className=\"paragraph-ja\">\n                          {para}\n                        </p>\n                      ));\n                    }\n                  })()}\n                </div>\n              </div>\n            )}\n          </div>\n        )}\n\n      <style>{`\n        .comprehensive-reading-view {\n          max-width: 1200px;\n          margin: 0 auto;\n          padding: 20px;\n          width: 100%;\n        }\n\n        @media (max-width: 768px) {\n          .comprehensive-reading-view {\n            max-width: 100%;\n            margin: 0;\n            padding: 8px;\n          }\n        }\n\n        .reading-header {\n          background: white;\n          padding: 20px;\n          border-radius: 8px;\n          box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          margin-bottom: 20px;\n        }\n\n        .dark-mode .reading-header {\n          background: var(--gray-800);\n        }\n\n        .reading-header h2 {\n          margin: 0 0 20px 0;\n        }\n\n        .filter-controls, .passage-selector {\n          margin-bottom: 15px;\n        }\n\n        .filter-controls label, .passage-selector label {\n          font-weight: bold;\n          margin-right: 10px;\n          color: #333;\n        }\n\n        .dark-mode .filter-controls label,\n        .dark-mode .passage-selector label {\n          color: var(--gray-200);\n        }\n\n        .filter-controls select, .passage-selector select {\n          padding: 8px 12px;\n          border: 1px solid #ddd;\n          border-radius: 4px;\n          font-size: 14px;\n          background: white;\n          color: #333;\n        }\n\n        .dark-mode .filter-controls select,\n        .dark-mode .passage-selector select {\n          background: var(--gray-700);\n          border-color: var(--gray-600);\n          color: var(--gray-200);\n        }\n\n        .passage-stats {\n          display: flex;\n          gap: 10px;\n          margin: 15px 0;\n          flex-wrap: wrap;\n        }\n\n        .stat-badge {\n          display: inline-block;\n          padding: 6px 12px;\n          background: #f0f0f0;\n          border-radius: 4px;\n          font-size: 14px;\n          color: #333;\n        }\n\n        .dark-mode .stat-badge {\n          background: var(--gray-700);\n          color: var(--gray-200);\n        }\n\n        .stat-badge.unknown-count {\n          background: #fff3cd;\n          color: #856404;\n          font-weight: bold;\n        }\n\n        .dark-mode .stat-badge.unknown-count {\n          background: var(--yellow-500);\n          color: var(--black);\n        }\n\n        .action-buttons {\n          display: flex;\n          gap: 10px;\n          margin-top: 15px;\n        }\n\n        .action-buttons button {\n          padding: 10px 20px;\n          border: none;\n          border-radius: 4px;\n          cursor: pointer;\n          font-size: 14px;\n          font-weight: bold;\n          transition: all 0.3s;\n        }\n\n        .btn-primary {\n          background: #007bff;\n          color: white;\n        }\n\n        .btn-primary:hover {\n          background: #0056b3;\n        }\n\n        .btn-info {\n          background: #17a2b8;\n          color: white;\n        }\n\n        .btn-info:hover {\n          background: #138496;\n        }\n\n        .btn-success {\n          background: #28a745;\n          color: white;\n        }\n\n        .btn-success:hover {\n          background: #218838;\n        }\n\n        .btn-success:disabled {\n          background: #ccc;\n          cursor: not-allowed;\n        }\n\n        .btn-secondary {\n          background: #6c757d;\n          color: white;\n        }\n\n        .btn-secondary:hover {\n          background: #545b62;\n        }\n\n        .passage-content {\n          background: white;\n          padding: 30px;\n          border-radius: 8px;\n          box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n        }\n\n        .dark-mode .passage-content {\n          background: var(--gray-800);\n          color: var(--gray-100);\n        }\n\n        .passage-title {\n          text-align: center;\n          color: #333;\n          margin-bottom: 30px;\n          font-size: 24px;\n          font-family: 'Times New Roman', Georgia, serif;\n        }\n\n        .dark-mode .passage-title {\n          color: var(--white);\n        }\n\n        .passage-body {\n          line-height: 1.5;\n          font-family: 'Times New Roman', Georgia, serif;\n          color: #333;\n        }\n\n        .dark-mode .passage-body {\n          color: var(--gray-200);\n        }\n\n        .phrase-block {\n          margin-bottom: 8px;\n          padding: 8px 12px;\n          background: #ffffff;\n          border-left: 3px solid #007bff;\n          border-radius: 2px;\n        }\n\n        .dark-mode .phrase-block {\n          background: var(--gray-700);\n          border-left-color: var(--blue-400);\n        }\n\n        .phrase-english {\n          font-size: 16px;\n          line-height: 1.6;\n          margin-bottom: 6px;\n          font-family: 'Times New Roman', 'Georgia', serif;\n          display: flex;\n          flex-wrap: wrap;\n          gap: 8px;\n          align-items: flex-start;\n        }\n\n        .word-card {\n          display: inline-flex;\n          flex-direction: column;\n          align-items: center;\n          padding: 2px 5px;\n          margin: 1px;\n          background: #f8f9fa;\n          border: 1px solid #dee2e6;\n          border-radius: 4px;\n          cursor: pointer;\n          transition: all 0.2s;\n          min-width: 60px;\n        }\n\n        .dark-mode .word-card {\n          background: var(--gray-700);\n          border-color: var(--gray-600);\n        }\n\n        .word-card:hover {\n          background: #e7f3ff;\n          border-color: #007bff;\n        }\n\n        .dark-mode .word-card:hover {\n          background: var(--gray-600);\n          border-color: var(--blue-400);\n        }\n\n        .word-card.unknown {\n          background: #ffc107;\n          color: #000;\n          border-color: #ff9800;\n          font-weight: bold;\n        }\n\n        .word-card.phrase-card {\n          background: #e8f5e9;\n          border-color: #4caf50;\n        }\n\n        .dark-mode .word-card.phrase-card {\n          background: var(--gray-700);\n          border-color: var(--green-400);\n        }\n\n        .word-card.phrase-card:hover {\n          background: #c8e6c9;\n        }\n\n        .dark-mode .word-card.phrase-card:hover {\n          background: var(--gray-600);\n        }\n\n        .word-card.punctuation-card {\n          min-width: 20px;\n          background: transparent;\n          border: none;\n          cursor: default;\n          padding: 2px 4px;\n        }\n\n        .word-card.punctuation-card:hover {\n          background: transparent;\n          border: none;\n        }\n\n        .word-card-word {\n          font-size: 16px;\n          font-weight: 500;\n          color: #333;\n          text-align: center;\n          font-family: 'Times New Roman', Georgia, serif;\n        }\n\n        .dark-mode .word-card-word {\n          color: var(--gray-200);\n        }\n\n        .phrase-card .word-card-word {\n          font-size: 15px;\n          color: #2e7d32;\n          font-family: 'Times New Roman', Georgia, serif;\n        }\n\n        .dark-mode .phrase-card .word-card-word {\n          color: var(--green-400);\n        }\n\n        .word-card-meaning {\n          font-size: 12px;\n          color: #666;\n          margin-top: 1px;\n          text-align: center;\n          padding: 1px 3px;\n          background: rgba(255, 255, 255, 0.8);\n          border-radius: 2px;\n          min-height: 14px;\n        }\n\n        .dark-mode .word-card-meaning {\n          color: var(--gray-300);\n          background: rgba(48, 48, 48, 0.8);\n        }\n\n        .word-segment {\n          display: inline-block;\n          padding: 2px 4px;\n          margin: 0 2px;\n          cursor: pointer;\n          border-radius: 3px;\n          transition: all 0.2s;\n          font-family: 'Times New Roman', Georgia, serif;\n        }\n\n        .word-segment:hover {\n          background: #e7f3ff;\n        }\n\n        .word-segment.unknown {\n          background: #ffc107;\n          color: #000;\n          font-weight: bold;\n        }\n\n        .show-translation-btn {\n          background: #f8f9fa;\n          border: 1px solid #ddd;\n          padding: 8px 16px;\n          border-radius: 4px;\n          cursor: pointer;\n          color: #666;\n          font-size: 14px;\n        }\n\n        .show-translation-btn:hover {\n          background: #e9ecef;\n        }\n\n        .phrase-translation {\n          margin-top: 10px;\n          padding: 15px;\n          background: white;\n          border-radius: 4px;\n          border: 1px solid #dee2e6;\n        }\n\n        .dark-mode .phrase-translation {\n          background: var(--gray-800);\n          border-color: var(--gray-600);\n        }\n\n        .translation-text {\n          font-size: 16px;\n          color: #333;\n          margin-bottom: 10px;\n          font-weight: 500;\n        }\n\n        .dark-mode .translation-text {\n          color: var(--gray-200);\n        }\n\n        .word-meanings {\n          display: flex;\n          flex-wrap: wrap;\n          gap: 10px;\n          font-size: 14px;\n          color: #666;\n        }\n\n        .dark-mode .word-meanings {\n          color: var(--gray-300);\n        }\n\n        .word-meaning-pair {\n          background: #e7f3ff;\n          padding: 4px 8px;\n          border-radius: 3px;\n        }\n\n        .dark-mode .word-meaning-pair {\n          background: var(--gray-700);\n          color: var(--gray-200);\n        }\n\n        .error-message, .empty-container {\n          text-align: center;\n          padding: 50px;\n          font-size: 18px;\n          color: #666;\n        }\n\n        .dark-mode .error-message,\n        .dark-mode .empty-container {\n          color: var(--gray-300);\n        }\n\n        .error-message {\n          color: #dc3545;\n        }\n\n        .dark-mode .error-message {\n          color: var(--red-400);\n        }\n\n        /*  */\n        .word-popup-overlay {\n          position: fixed;\n          top: 0;\n          left: 0;\n          right: 0;\n          bottom: 0;\n          background: transparent;\n          z-index: 999;\n        }\n\n        .word-popup {\n          position: absolute;\n          left: var(--popup-x, 0);\n          top: var(--popup-y, 0);\n          background: white;\n          border: 2px solid #007bff;\n          border-radius: 8px;\n          padding: 16px;\n          box-shadow: 0 4px 12px rgba(0, 0, 0, 0.2);\n          z-index: 1000;\n          max-width: 400px;\n          min-width: 250px;\n        }\n\n        .dark-mode .word-popup {\n          background: var(--gray-800);\n          border-color: var(--blue-400);\n          color: var(--gray-200);\n        }\n\n        .popup-close {\n          position: absolute;\n          top: 8px;\n          right: 8px;\n          background: #f8f9fa;\n          border: none;\n          border-radius: 4px;\n          width: 24px;\n          height: 24px;\n          cursor: pointer;\n          font-size: 16px;\n          line-height: 1;\n          color: #666;\n          display: flex;\n          align-items: center;\n          justify-content: center;\n        }\n\n        .popup-close:hover {\n          background: #e9ecef;\n          color: #000;\n        }\n\n        .popup-word {\n          font-size: 20px;\n          font-weight: bold;\n          color: #007bff;\n          margin-bottom: 4px;\n          padding-right: 30px;\n        }\n\n        .popup-reading {\n          font-size: 14px;\n          color: #666;\n          margin-bottom: 8px;\n        }\n\n        .popup-meaning {\n          font-size: 16px;\n          color: #333;\n          margin-bottom: 12px;\n          padding: 8px;\n          background: #f0f8ff;\n          border-radius: 4px;\n        }\n\n        .popup-etymology {\n          font-size: 13px;\n          color: #555;\n          margin-bottom: 8px;\n          padding: 6px;\n          background: #f8f9fa;\n          border-radius: 4px;\n        }\n\n        .popup-related {\n          font-size: 13px;\n          color: #555;\n          padding: 6px;\n          background: #f8f9fa;\n          border-radius: 4px;\n        }\n\n        .popup-etymology strong,\n        .popup-related strong {\n          color: #007bff;\n        }\n\n        .full-text-display, .full-translation-display {\n          background: white;\n          padding: 20px;\n          border-radius: 8px;\n          box-shadow: 0 2px 4px rgba(0,0,0,0.1);\n          margin-top: 20px;\n        }\n\n        .dark-mode .full-text-display,\n        .dark-mode .full-translation-display {\n          background: var(--gray-800);\n          color: var(--gray-100);\n        }\n\n        .full-text-display h3, .full-translation-display h3 {\n          margin: 0 0 15px 0;\n          color: #667eea;\n        }\n\n        .dark-mode .full-text-display h3,\n        .dark-mode .full-translation-display h3 {\n          color: var(--blue-400);\n        }\n\n        .full-text-content {\n          font-size: 1.1em;\n          line-height: 1.8;\n          color: #333;\n          font-family: 'Times New Roman', 'Georgia', serif;\n        }\n\n        .full-text-content .paragraph-en {\n          margin-bottom: 1.5em;\n          text-indent: 2em;\n          text-align: left;\n        }\n\n        .full-text-content .paragraph-en:first-child {\n          margin-top: 0;\n        }\n\n        /*  */\n        .full-text-content .conversation-line {\n          text-indent: 0;\n          margin-bottom: 1em;\n          padding-left: 1em;\n          border-left: 3px solid #667eea;\n        }\n\n        .full-translation-content {\n          font-size: 1.05em;\n          line-height: 2;\n          color: #333;\n        }\n\n        .full-translation-text {\n          white-space: pre-wrap;\n          line-height: 2;\n        }\n\n        .full-translation-content .paragraph-ja {\n          margin-bottom: 1.5em;\n          text-indent: 1em;\n          text-align: left;\n        }\n\n        .full-translation-content .paragraph-ja:first-child {\n          margin-top: 0;\n        }\n\n        /*  */\n        .full-translation-content .conversation-line {\n          text-indent: 0;\n          margin-bottom: 1em;\n          padding-left: 1em;\n          border-left: 3px solid #667eea;\n        }\n\n        .translation-line {\n          margin-bottom: 10px;\n          padding: 8px;\n          background: #f8f9fa;\n          border-radius: 4px;\n        }\n      `}</style>\n    </div>\n  );\n}\n\nexport default ComprehensiveReadingView;\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport './GrammarQuizView.css';\nimport ScoreBoard from './ScoreBoard';\nimport LearningLimitsInput from './LearningLimitsInput';\nimport { useLearningLimits } from '../hooks/useLearningLimits';\nimport { logger } from '@/utils/logger';\nimport { useAdaptiveLearning } from '../hooks/useAdaptiveLearning';\nimport { QuestionCategory } from '../strategies/memoryAcquisitionAlgorithm';\nimport { sortQuestionsByPriority } from '../utils/questionPrioritySorter';\nimport { sessionKpi } from '../metrics/sessionKpi';\nimport { useQuestionRequeue } from '../hooks/useQuestionRequeue';\n\ninterface VerbFormQuestion {\n  id: string;\n  japanese: string;\n  sentence: string;\n  verb: string;\n  choices: string[];\n  correctAnswer: string;\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  explanation: string;\n  hint: string;\n  //  (Grade 2/3)\n  passage?: string; // \n  passageJapanese?: string; // \n}\n\ninterface FillInBlankQuestion {\n  id: string;\n  japanese: string;\n  sentence: string;\n  choices: string[];\n  correctAnswer: string;\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  explanation: string;\n  hint: string;\n  //  (Grade 2/3)\n  passage?: string; // \n  passageJapanese?: string; // \n}\n\ninterface SentenceOrderingQuestion {\n  id: string;\n  japanese: string;\n  words: string[];\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  grammarPoint: string;\n  wordCount: number;\n  hint: string;\n  //  (Grade 2/3)\n  passage?: string; // \n  passageJapanese?: string; // \n}\n\ninterface _Category {\n  category: string;\n  grammarPoint: string;\n  questions: VerbFormQuestion[] | FillInBlankQuestion[];\n}\n\ninterface _Unit {\n  unit: string;\n  title: string;\n  sentenceOrdering?: SentenceOrderingQuestion[];\n  verbForm?: VerbFormQuestion[];\n  fillInBlank?: FillInBlankQuestion[];\n  questions?: SentenceOrderingQuestion[]; // \n}\n\ntype QuizType = 'all' | 'random' | 'verb-form' | 'fill-in-blank' | 'sentence-ordering';\ntype Grade = 'all' | '1' | '2' | '3' | '1-all' | '2-all' | '3-all' | string; // 'g1-u0', 'g1-u1' \n\n// \ninterface GrammarQuestion {\n  id: string;\n  japanese: string;\n  difficulty: 'beginner' | 'intermediate' | 'advanced';\n  hint: string;\n  // VerbFormQuestion / FillInBlankQuestion\n  sentence?: string;\n  verb?: string;\n  choices?: string[];\n  correctAnswer?: string;\n  explanation?: string;\n  // SentenceOrderingQuestion\n  words?: string[];\n  grammarPoint?: string;\n  wordCount?: number;\n  //  (Grade 2/3)\n  passage?: string; // \n  passageJapanese?: string; // \n  // \n  type?: string;\n  question?: string;\n  // \n  sessionPriority?: number; // \n  reAddedCount?: number;    // \n}\n\ninterface GrammarQuizViewProps {\n  onSaveProgress?: (data: Record<string, unknown>) => void;\n}\n\nfunction GrammarQuizView(_props: GrammarQuizViewProps) {\n  const [quizType, setQuizType] = useState<QuizType>(() => {\n    const saved = localStorage.getItem('grammar-quiz-type');\n    return (saved as QuizType) || 'verb-form';\n  });\n  const [grade, setGrade] = useState<Grade>(() => {\n    const saved = localStorage.getItem('grammar-grade');\n    return (saved as Grade) || 'all';\n  });\n  const [availableUnits, setAvailableUnits] = useState<{ value: string; label: string }[]>([]);\n  const [showSettings, setShowSettings] = useState<boolean>(false);\n  const [_isFullscreen, _setIsFullscreen] = useState(false);\n\n  // \n  const adaptiveLearning = useAdaptiveLearning(QuestionCategory.GRAMMAR);\n\n  // \n  const { reAddQuestion, clearExpiredFlags, updateRequeueStats } = useQuestionRequeue<GrammarQuestion>();\n\n  // ScoreBoard\n  const [lastAnswerTime, setLastAnswerTime] = useState<number>(Date.now());\n\n  // AI\n  const [lastAnswerCorrect, setLastAnswerCorrect] = useState<boolean | undefined>(undefined);\n  const [lastAnswerWord, setLastAnswerWord] = useState<string | undefined>(undefined);\n  const [correctStreak, setCorrectStreak] = useState<number>(0);\n  const [incorrectStreak, setIncorrectStreak] = useState<number>(0);\n\n  // \n  const { learningLimit, reviewLimit, setLearningLimit, setReviewLimit } =\n    useLearningLimits('grammar');\n\n  // \n  const [isReviewFocusMode, setIsReviewFocusMode] = useState(false);\n\n  // \n  const handleReviewFocus = () => {\n    setIsReviewFocusMode(!isReviewFocusMode);\n  };\n\n  // \n  const [autoNext, setAutoNext] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoNext-grammar');\n    return saved === 'true';\n  });\n\n  const [autoNextDelay, setAutoNextDelay] = useState<number>(() => {\n    const saved = localStorage.getItem('autoNextDelay-grammar');\n    return saved ? parseInt(saved, 10) : 1500;\n  });\n\n  // \n  const [autoReadAloud, setAutoReadAloud] = useState<boolean>(() => {\n    const saved = localStorage.getItem('autoReadAloud-grammar');\n    return saved === 'true';\n  });\n\n  const [quizStarted, setQuizStarted] = useState<boolean>(false);\n  const [_loading, setLoading] = useState<boolean>(false);\n\n  const [currentQuestions, setCurrentQuestions] = useState<GrammarQuestion[]>([]);\n  const [currentQuestionIndex, setCurrentQuestionIndex] = useState(0);\n  const [selectedAnswer, setSelectedAnswer] = useState<string | null>(null);\n  const [selectedWords, setSelectedWords] = useState<string[]>([]);\n  const [remainingWords, setRemainingWords] = useState<string[]>([]);\n  const [textInput, setTextInput] = useState<string>(''); // \n  const [answered, setAnswered] = useState(false);\n  const [showHint, setShowHint] = useState(false);\n  const [score, setScore] = useState(0);\n  const [totalAnswered, setTotalAnswered] = useState(0);\n  const [sessionStats, setSessionStats] = useState({\n    correct: 0,\n    incorrect: 0,\n    review: 0,\n    mastered: 0,\n    newQuestions: 0,\n    reviewQuestions: 0,\n    consecutiveNew: 0,\n    consecutiveReview: 0,\n  });\n  const [error, setError] = useState<string | null>(null);\n\n  const currentQuestion = currentQuestions[currentQuestionIndex];\n  const isSentenceOrdering =\n    currentQuestion?.type === 'sentenceOrdering' || quizType === 'sentence-ordering';\n\n  // \n  const currentGrammarUnit = currentQuestion?.id\n    ? (() => {\n        // ID: g1-u0-fib-001  g1-u1-so-002\n        const match = currentQuestion.id.match(/^g(\\d+)-u(\\d+)/);\n        if (match) {\n          return `g${match[1]}-unit${match[2]}`;\n        }\n        return undefined;\n      })()\n    : undefined;\n\n  // RefsuseEffect\n  const prevSettingsRef = useRef({ quizType, grade });\n  const questionStartTimeRef = useRef<number>(Date.now());\n\n  // useEffect\n  const handleNext = useCallback(() => {\n    if (currentQuestionIndex < currentQuestions.length - 1) {\n      const nextIndex = currentQuestionIndex + 1;\n\n      // 5\n      const cleanedQuestions = clearExpiredFlags(currentQuestions, nextIndex - 1);\n\n      if (cleanedQuestions !== currentQuestions) {\n        setCurrentQuestions(cleanedQuestions);\n      }\n\n      setCurrentQuestionIndex(nextIndex);\n      setSelectedAnswer(null);\n      setSelectedWords([]);\n      setAnswered(false);\n      setShowHint(false);\n      questionStartTimeRef.current = Date.now(); // \n      // lastAnswerWord\n      setLastAnswerWord(undefined);\n    }\n  }, [currentQuestionIndex, currentQuestions]);\n\n  const handleStartQuiz = useCallback(async () => {\n    setLoading(true);\n    setError(null);\n\n    try {\n      // \n      let gradesToLoad: string[] = [];\n      let selectedUnitIndex: number | null = null;\n\n      if (grade === 'all') {\n        gradesToLoad = ['1', '2', '3'];\n      } else if (grade.match(/^[123]$/)) {\n        // '1', '2', '3' \n        gradesToLoad = [grade];\n      } else if (grade.endsWith('-all')) {\n        // '1-all', '2-all', '3-all' \n        gradesToLoad = [grade.charAt(0)];\n      } else if (grade.match(/^g\\d+-unit\\d+$/)) {\n        // 'g1-unit0' Unit\n        const gradeNum = grade.match(/^g(\\d+)-unit(\\d+)$/)?.[1];\n        const unitNum = grade.match(/^g(\\d+)-unit(\\d+)$/)?.[2];\n        if (gradeNum && unitNum !== undefined) {\n          gradesToLoad = [gradeNum];\n          selectedUnitIndex = parseInt(unitNum);\n        }\n      }\n\n      const allGrammarFiles: Array<{\n        enabled?: boolean;\n        disabledReason?: string;\n        questions?: GrammarQuestion[];\n      }> = [];\n\n      // grammar_grade{N}_unit{X}.json\n      for (const g of gradesToLoad) {\n        for (let unitIdx = 0; unitIdx < 10; unitIdx++) {\n          // unit\n          if (selectedUnitIndex !== null && unitIdx !== selectedUnitIndex) {\n            continue;\n          }\n\n          try {\n            const res = await fetch(`/data/grammar/grammar_grade${g}_unit${unitIdx}.json`);\n            if (res.ok) {\n              const data = await res.json();\n\n              // enabled (true)\n              if (data.enabled === false) {\n                logger.log(\n                  `grammar_grade${g}_unit${unitIdx}.json is disabled: ${data.disabledReason || 'No reason provided'}`\n                );\n                continue; // \n              }\n\n              allGrammarFiles.push(data);\n            } else {\n              // (404)\n              logger.log(\n                `grammar_grade${g}_unit${unitIdx}.json returned status ${res.status}, skipping...`\n              );\n            }\n          } catch (err) {\n            // fetch\n            logger.log(`Failed to fetch grammar_grade${g}_unit${unitIdx}.json:`, err);\n          }\n        }\n      }\n\n      if (allGrammarFiles.length === 0) {\n        throw new Error(`: ${grade}, : ${quizType}`);\n      }\n\n      // \n      let questions: GrammarQuestion[] = [];\n\n      // grammar\n      allGrammarFiles.forEach((grammarFile) => {\n        const allQuestions = grammarFile.questions || [];\n\n        // quizTypetype\n        const typeMapping: { [key: string]: string } = {\n          'verb-form': 'verbForm',\n          'fill-in-blank': 'fillInBlank',\n          'sentence-ordering': 'sentenceOrdering',\n        };\n\n        // \n        if (quizType === 'all' || quizType === 'random') {\n          // \n          questions.push(...allQuestions);\n        } else {\n          //  (quizType)\n          const targetType = typeMapping[quizType] || quizType;\n          const filtered = allQuestions.filter((q: GrammarQuestion) => q.type === targetType);\n          questions.push(...filtered);\n        }\n      });\n\n      if (questions.length === 0) {\n        throw new Error('');\n      }\n\n      logger.log(`Total questions: ${questions.length}`);\n\n      if (questions.length === 0) {\n        throw new Error(``);\n      }\n\n      // \n      questions = questions.sort(() => Math.random() - 0.5);\n\n      setCurrentQuestions(questions);\n      setCurrentQuestionIndex(0);\n      setSelectedAnswer(null);\n      setSelectedWords([]);\n      setRemainingWords([]);\n      setAnswered(false);\n      setShowHint(false);\n      setScore(0);\n      setTotalAnswered(0);\n      setSessionStats({\n        correct: 0,\n        incorrect: 0,\n        review: 0,\n        mastered: 0,\n        newQuestions: 0,\n        reviewQuestions: 0,\n        consecutiveNew: 0,\n        consecutiveReview: 0,\n      });\n      setQuizStarted(true);\n      setLoading(false);\n    } catch (err) {\n      logger.error(':', err);\n      setError(err instanceof Error ? err.message : String(err));\n      setLoading(false);\n    }\n  }, [quizType, grade]);\n\n  const handleSkip = useCallback(async () => {\n    if (!answered) {\n      // \n      setScore((prev) => prev + 1);\n      setTotalAnswered((prev) => prev + 1);\n      setSessionStats((prev) => ({\n        ...prev,\n        correct: prev.correct + 1,\n        mastered: prev.mastered + 1,\n      }));\n\n      // \n      const responseTime = Date.now() - questionStartTimeRef.current;\n      const { updateWordProgress, addSessionHistory } = await import('../progressStorage');\n      // ID: idquestionunknown\n      const questionId = currentQuestion.id\n        ? `grammar_${currentQuestion.id}`\n        : currentQuestion.question\n          ? `grammar_${currentQuestion.question.slice(0, 50).replace(/[^a-zA-Z0-9]/g, '_')}`\n          : `grammar_unknown_${Date.now()}`;\n      await updateWordProgress(\n        questionId,\n        true, // \n        responseTime,\n        undefined,\n        'grammar'\n      );\n\n      // \n      const status: 'correct' | 'incorrect' | 'review' | 'mastered' = 'correct';\n\n      addSessionHistory(\n        {\n          status,\n          word: questionId,\n          timestamp: Date.now(),\n        },\n        'grammar'\n      );\n\n      // ScoreBoard\n      setLastAnswerTime(Date.now());\n\n      // answered\n      if (currentQuestionIndex < currentQuestions.length - 1) {\n        setCurrentQuestionIndex((prev) => prev + 1);\n        setSelectedAnswer(null);\n        setSelectedWords([]);\n        setAnswered(false);\n        setShowHint(false);\n        questionStartTimeRef.current = Date.now();\n      } else {\n        // \n        setAnswered(false);\n      }\n    } else {\n      // \n      handleNext();\n    }\n  }, [answered, currentQuestionIndex, currentQuestions.length, currentQuestion, handleNext]);\n\n  // localStorage\n  useEffect(() => {\n    localStorage.setItem('grammar-quiz-type', quizType);\n  }, [quizType]);\n\n  useEffect(() => {\n    localStorage.setItem('grammar-grade', grade);\n  }, [grade]);\n\n  // Unit\n  useEffect(() => {\n    const loadUnits = async () => {\n      const units: { value: string; label: string }[] = [];\n      // grade'1', '2', '3', 'g1-unit0' -> '1', '2-all' -> '2'\n      const gradeMatch = grade.match(/^g?(\\d+)/);\n      const gradeNum = gradeMatch ? gradeMatch[1] : null;\n\n      if (!gradeNum || grade === 'all') {\n        setAvailableUnits([]);\n        return;\n      }\n\n      // grammar_grade{N}_unit{X}.json\n      for (let unitIdx = 0; unitIdx < 10; unitIdx++) {\n        try {\n          const res = await fetch(`/data/grammar/grammar_grade${gradeNum}_unit${unitIdx}.json`);\n          if (res.ok) {\n            const data = await res.json();\n\n            // enabled (true)\n            if (data.enabled === false) {\n              continue; // \n            }\n\n            units.push({\n              value: `g${gradeNum}-unit${unitIdx}`,\n              label: `${gradeNum}_Unit${unitIdx}_${data.title}`,\n            });\n          }\n          // \n        } catch {\n          // ()\n        }\n      }\n\n      setAvailableUnits(units);\n    };\n\n    loadUnits();\n  }, [grade, quizType]);\n\n  // \n  useEffect(() => {\n    const prevSettings = prevSettingsRef.current;\n    const settingsChanged = prevSettings.quizType !== quizType || prevSettings.grade !== grade;\n\n    if (quizStarted && settingsChanged) {\n      // \n      handleStartQuiz();\n    }\n\n    prevSettingsRef.current = { quizType, grade };\n  }, [quizType, grade, handleStartQuiz, quizStarted]);\n\n  // \n  useEffect(() => {\n    if (isSentenceOrdering && currentQuestion && currentQuestion.words) {\n      const shuffled = [...currentQuestion.words].sort(() => Math.random() - 0.5);\n      setRemainingWords(shuffled);\n      setSelectedWords([]);\n      setAnswered(false);\n      setShowHint(false);\n    }\n  }, [currentQuestionIndex, currentQuestions, isSentenceOrdering, currentQuestion]);\n\n  // \n  useEffect(() => {\n    setSelectedAnswer(null);\n    setTextInput('');\n    setAnswered(false);\n    setShowHint(false);\n  }, [currentQuestionIndex]);\n\n  // Enter\n  useEffect(() => {\n    const handleKeyDown = (event: KeyboardEvent) => {\n      // Enter\n      if (quizStarted && !answered && event.key === 'Enter') {\n        event.preventDefault();\n        handleSkip();\n      }\n    };\n\n    window.addEventListener('keydown', handleKeyDown);\n    return () => {\n      window.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [quizStarted, answered, handleSkip]);\n\n  // \n  const handleAnswerSelect = async (answer: string) => {\n    if (answered || isSentenceOrdering) return;\n\n    setSelectedAnswer(answer);\n    setAnswered(true);\n\n    // \n    const isCorrect = answer === currentQuestion.correctAnswer;\n    const isDontKnow = answer === '';\n\n    // AI\n    setLastAnswerCorrect(isCorrect);\n    setLastAnswerWord(currentQuestion.question || currentQuestion.sentence);\n    if (isCorrect) {\n      setCorrectStreak((prev) => prev + 1);\n      setIncorrectStreak(0);\n    } else {\n      setIncorrectStreak((prev) => prev + 1);\n      setCorrectStreak(0);\n    }\n\n    // \n    if (autoReadAloud && currentQuestion.sentence) {\n      setTimeout(() => {\n        const utterance = new SpeechSynthesisUtterance(currentQuestion.sentence);\n        utterance.lang = 'en-US';\n        utterance.rate = 0.9;\n        window.speechSynthesis.speak(utterance);\n      }, 300);\n    }\n\n    setTotalAnswered((prev) => prev + 1);\n\n    // \n    const responseTime = Date.now() - questionStartTimeRef.current;\n\n    if (isCorrect) {\n      setScore((prev) => prev + 1);\n      // 3\n      const isMastered = currentQuestion && score >= 2;\n      setSessionStats((prev) => ({\n        ...prev,\n        correct: prev.correct + 1,\n        mastered: isMastered ? prev.mastered + 1 : prev.mastered,\n      }));\n    } else if (isDontKnow) {\n      // \n      setSessionStats((prev) => ({\n        ...prev,\n        incorrect: prev.incorrect + 1,\n        review: prev.review + 1,\n      }));\n    } else {\n      setSessionStats((prev) => ({ ...prev, incorrect: prev.incorrect + 1 }));\n    }\n\n    // ScoreBoard- updateWordProgress\n    // IDgrammar_\n    const { updateWordProgress, loadProgress, addSessionHistory, addQuizResult } =\n      await import('../progressStorage');\n    // ID: idquestionunknown\n    const questionId = currentQuestion.id\n      ? `grammar_${currentQuestion.id}`\n      : currentQuestion.question\n        ? `grammar_${currentQuestion.question.slice(0, 50).replace(/[^a-zA-Z0-9]/g, '_')}`\n        : `grammar_unknown_${Date.now()}`;\n\n    // \n    const { generateId } = await import('../utils');\n    await addQuizResult({\n      id: generateId(),\n      questionSetId: 'grammar-set',\n      questionSetName: '',\n      score: isCorrect ? 1 : 0,\n      total: 1,\n      percentage: isCorrect ? 100 : 0,\n      date: Date.now(),\n      timeSpent: Math.floor(responseTime / 1000),\n      incorrectWords: isCorrect ? [] : [questionId],\n      mode: 'grammar',\n      category: undefined,\n      difficulty: currentQuestion.difficulty,\n    });\n\n    await updateWordProgress(questionId, isCorrect, responseTime, undefined, 'grammar');\n\n    // \n    adaptiveLearning.recordAnswer(questionId, isCorrect, responseTime);\n\n    // \n    const progress = await loadProgress();\n    const wordProgress = progress.wordProgress?.[questionId];\n    let status: 'correct' | 'incorrect' | 'review' | 'mastered' = isCorrect\n      ? 'correct'\n      : 'incorrect';\n\n    // \n    if (wordProgress && wordProgress.masteryLevel === 'mastered') {\n      status = 'mastered';\n    } else if (!isCorrect && wordProgress && wordProgress.incorrectCount >= 2) {\n      // 2\n      status = 'review';\n    }\n\n    addSessionHistory(\n      {\n        status,\n        word: questionId,\n        timestamp: Date.now(),\n      },\n      'grammar'\n    );\n\n    // ScoreBoard\n    setLastAnswerTime(Date.now());\n\n    // : 3\n    if (!isCorrect && !isReviewFocusMode) {\n      const shouldResortImmediately = true;\n      const shouldResortPeriodically = totalAnswered % 3 === 0;\n\n      if (shouldResortImmediately || shouldResortPeriodically) {\n        const remainingQuestions = currentQuestions.slice(currentQuestionIndex + 1);\n\n        if (remainingQuestions.length > 1) {\n          // localStorage \n          const savedLearningLimit = localStorage.getItem('learning-limit-grammar');\n          const savedReviewLimit = localStorage.getItem('review-limit-grammar');\n          const learningLimit = savedLearningLimit ? parseInt(savedLearningLimit) : null;\n          const reviewLimit = savedReviewLimit ? parseInt(savedReviewLimit) : null;\n\n          // \n          const resorted = sortQuestionsByPriority(remainingQuestions as any[], {\n            isReviewFocusMode: false,\n            learningLimit,\n            reviewLimit,\n            mode: 'grammar',\n          });\n\n          // \n          setCurrentQuestions([\n            ...currentQuestions.slice(0, currentQuestionIndex + 1),\n            ...(resorted as unknown as GrammarQuestion[]),\n          ]);\n        }\n      }\n    }\n\n    // 3-5\n    if (!isCorrect && !isReviewFocusMode) {\n      setCurrentQuestions((prev) =>\n        reAddQuestion(currentQuestion, prev, currentQuestionIndex)\n      );\n    }\n\n    // KPI + /\n    {\n      const qid = String((currentQuestion as any).word);\n      sessionKpi.onShown(qid);\n      sessionKpi.onAnswer(qid, isCorrect);\n    }\n    updateRequeueStats(currentQuestion, sessionStats, setSessionStats);\n  };\n\n  const handleWordClick = (word: string, fromRemaining: boolean) => {\n    if (answered || !isSentenceOrdering) return;\n\n    if (fromRemaining) {\n      setRemainingWords((prev) => prev.filter((w) => w !== word));\n      setSelectedWords((prev) => {\n        const newWords = [...prev, word];\n\n        // \n        if (newWords.length === currentQuestion.words?.length && !answered) {\n          setTimeout(async () => {\n            setAnswered(true);\n\n            const userAnswer = newWords.join(' ');\n            //  correctAnswer, correctOrder, sentence \n            const correctAnswer = (\n              (currentQuestion as any).correctAnswer ||\n              (currentQuestion as any).correctOrder ||\n              currentQuestion.sentence ||\n              ''\n            )\n              .replace(/[.!?]/g, '')\n              .trim(); // \n            const isCorrect = userAnswer.toLowerCase() === correctAnswer.toLowerCase();\n\n            setTotalAnswered((prevTotal) => prevTotal + 1);\n\n            // \n            const responseTime = Date.now() - questionStartTimeRef.current;\n\n            // \n            if (autoReadAloud) {\n              setTimeout(() => {\n                const utterance = new SpeechSynthesisUtterance(correctAnswer);\n                utterance.lang = 'en-US';\n                utterance.rate = 0.9;\n                window.speechSynthesis.speak(utterance);\n              }, 300);\n            }\n\n            if (isCorrect) {\n              setScore((prevScore) => prevScore + 1);\n              // 3\n              const isMastered = score >= 2;\n              setSessionStats((prev) => ({\n                ...prev,\n                correct: prev.correct + 1,\n                mastered: isMastered ? prev.mastered + 1 : prev.mastered,\n              }));\n            } else {\n              setSessionStats((prev) => ({ ...prev, incorrect: prev.incorrect + 1 }));\n            }\n\n            // ScoreBoard- updateWordProgress\n            // IDgrammar_\n            const { updateWordProgress, loadProgress, addSessionHistory } =\n              await import('../progressStorage');\n            // ID: idquestionunknown\n            const questionId = currentQuestion.id\n              ? `grammar_${currentQuestion.id}`\n              : currentQuestion.question\n                ? `grammar_${currentQuestion.question.slice(0, 50).replace(/[^a-zA-Z0-9]/g, '_')}`\n                : `grammar_unknown_${Date.now()}`;\n            await updateWordProgress(questionId, isCorrect, responseTime, undefined, 'grammar');\n\n            // \n            const progress = await loadProgress();\n            const wordProgress = progress.wordProgress?.[questionId];\n            let status: 'correct' | 'incorrect' | 'review' | 'mastered' = isCorrect\n              ? 'correct'\n              : 'incorrect';\n\n            // \n            if (wordProgress && wordProgress.masteryLevel === 'mastered') {\n              status = 'mastered';\n            } else if (!isCorrect && wordProgress && wordProgress.incorrectCount >= 2) {\n              // 2\n              status = 'review';\n            }\n\n            addSessionHistory(\n              {\n                status,\n                word: questionId,\n                timestamp: Date.now(),\n              },\n              'grammar'\n            );\n\n            // ScoreBoard\n            setLastAnswerTime(Date.now());\n          }, 100);\n        }\n\n        return newWords;\n      });\n    } else {\n      setSelectedWords((prev) => prev.filter((w) => w !== word));\n      setRemainingWords((prev) => [...prev, word]);\n    }\n  };\n\n  const toggleHint = () => {\n    setShowHint(!showHint);\n  };\n\n  const handlePrevious = () => {\n    if (currentQuestionIndex > 0) {\n      setCurrentQuestionIndex((prev) => prev - 1);\n      setSelectedAnswer(null);\n      setSelectedWords([]);\n      setAnswered(false);\n      setShowHint(false);\n      questionStartTimeRef.current = Date.now(); // \n    }\n  };\n\n  const isCorrect = () => {\n    if (!currentQuestion || !answered) return false;\n    if (isSentenceOrdering) {\n      return selectedWords.join(' ') === currentQuestion.words?.join(' ');\n    }\n    return selectedAnswer === currentQuestion.correctAnswer;\n  };\n\n  // \n  useEffect(() => {\n    if (!quizStarted) {\n      handleStartQuiz();\n    }\n  }, [quizType, grade, handleStartQuiz, quizStarted]); // \n\n  return (\n    <div className=\"quiz-view\">\n      {error && (\n        <div className=\"error-message\">\n          <p> {error}</p>\n          <button\n            onClick={handleStartQuiz}\n            className=\"mt-4 px-6 py-2 bg-blue-600 text-white rounded-lg hover:bg-blue-700\"\n          >\n            \n          </button>\n        </div>\n      )}\n\n      {!error && quizStarted && currentQuestion && (\n        <>\n          {/*  */}\n          <div className=\"mb-4 flex justify-center\">\n            <div className=\"w-full max-w-4xl\">\n              <ScoreBoard\n                mode=\"grammar\"\n                currentScore={score}\n                totalAnswered={totalAnswered}\n                sessionCorrect={sessionStats.correct}\n                sessionIncorrect={sessionStats.incorrect}\n                sessionReview={sessionStats.review}\n                sessionMastered={sessionStats.mastered}\n                sessionStats={sessionStats}\n                onReviewFocus={handleReviewFocus}\n                isReviewFocusMode={isReviewFocusMode}\n                onShowSettings={() => setShowSettings(true)}\n                onAnswerTime={lastAnswerTime}\n                lastAnswerCorrect={lastAnswerCorrect}\n                lastAnswerWord={lastAnswerWord}\n                lastAnswerDifficulty={currentQuestion?.difficulty}\n                correctStreak={correctStreak}\n                incorrectStreak={incorrectStreak}\n                learningPhase={\n                  (adaptiveLearning.state.currentPhase as unknown as\n                    | 'ENCODING'\n                    | 'INITIAL_CONSOLIDATION'\n                    | 'LONG_TERM_RETENTION'\n                    | 'MASTERED'\n                    | undefined) ?? undefined\n                }\n                estimatedSpeed={adaptiveLearning.state.personalParams?.learningSpeed}\n                dataSource={\n                  grade.startsWith('g') && grade.includes('-unit')\n                    ? ` ${grade.replace('g', '').replace('-unit', '-unit')}`\n                    : ` ${grade === 'all' ? '' : `${grade}`}`\n                }\n                category={`: ${quizType === 'all' ? '' : quizType === 'verb-form' ? '' : quizType === 'fill-in-blank' ? '' : quizType === 'sentence-ordering' ? '' : ''}`}\n                difficulty=\"\"\n                wordPhraseFilter=\"all\"\n                grammarUnit={currentGrammarUnit}\n              />\n            </div>\n          </div>\n\n          {/*  */}\n          {showSettings && (\n            <div className=\"study-settings-panel\">\n              <div className=\"settings-header\">\n                <h3> </h3>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className=\"px-4 py-2 text-sm font-medium bg-gray-200 text-gray-700 border-2 border-transparent rounded-lg transition-all duration-200 hover:bg-gray-300:bg-gray-600\"\n                >\n                   \n                </button>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"grade-select-active\"> :</label>\n                <select\n                  id=\"grade-select-active\"\n                  value={grade}\n                  onChange={(e) => setGrade(e.target.value as Grade)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  <option value=\"1\">1</option>\n                  {availableUnits\n                    .filter((u) => u.value.startsWith('g1-'))\n                    .map((u) => (\n                      <option key={u.value} value={u.value}>\n                        1_{u.label.replace(/^\\d+_/, '')}\n                      </option>\n                    ))}\n                  <option value=\"2\">2</option>\n                  {availableUnits\n                    .filter((u) => u.value.startsWith('g2-'))\n                    .map((u) => (\n                      <option key={u.value} value={u.value}>\n                        2_{u.label.replace(/^\\d+_/, '')}\n                      </option>\n                    ))}\n                  <option value=\"3\">3</option>\n                  {availableUnits\n                    .filter((u) => u.value.startsWith('g3-'))\n                    .map((u) => (\n                      <option key={u.value} value={u.value}>\n                        3_{u.label.replace(/^\\d+_/, '')}\n                      </option>\n                    ))}\n                </select>\n              </div>\n\n              <div className=\"filter-group\">\n                <label htmlFor=\"quiz-type-select-active\"> :</label>\n                <select\n                  id=\"quiz-type-select-active\"\n                  value={quizType}\n                  onChange={(e) => setQuizType(e.target.value as QuizType)}\n                  className=\"select-input\"\n                >\n                  <option value=\"all\"></option>\n                  <option value=\"verb-form\"></option>\n                  <option value=\"fill-in-blank\"></option>\n                  <option value=\"sentence-ordering\"></option>\n                </select>\n              </div>\n\n              <LearningLimitsInput\n                learningLimit={learningLimit}\n                reviewLimit={reviewLimit}\n                onLearningLimitChange={setLearningLimit}\n                onReviewLimitChange={setReviewLimit}\n                idPrefix=\"grammar-quiz-\"\n              />\n\n              {/*  */}\n              <div className=\"filter-group\">\n                <div className=\"checkbox-row\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"auto-next-toggle-grammar-quiz\"\n                    checked={autoNext}\n                    onChange={(e) => {\n                      setAutoNext(e.target.checked);\n                      localStorage.setItem('autoNext-grammar', e.target.checked.toString());\n                    }}\n                  />\n                  <label htmlFor=\"auto-next-toggle-grammar-quiz\" className=\"checkbox-label\">\n                    {autoNext ? '' : ''}\n                  </label>\n                </div>\n              </div>\n\n              {autoNext && (\n                <div className=\"filter-group\">\n                  <label htmlFor=\"auto-next-delay-grammar-quiz\"> </label>\n                  <div className=\"slider-row\">\n                    <input\n                      type=\"range\"\n                      id=\"auto-next-delay-grammar-quiz\"\n                      min=\"500\"\n                      max=\"3000\"\n                      step=\"100\"\n                      value={autoNextDelay}\n                      onChange={(e) => {\n                        const delay = parseInt(e.target.value, 10);\n                        setAutoNextDelay(delay);\n                        localStorage.setItem('autoNextDelay-grammar', delay.toString());\n                      }}\n                      className=\"slider-input\"\n                    />\n                    <span className=\"slider-value\">{(autoNextDelay / 1000).toFixed(1)}</span>\n                  </div>\n                </div>\n              )}\n\n              {/*  */}\n              <div className=\"filter-group\">\n                <div className=\"checkbox-row\">\n                  <input\n                    type=\"checkbox\"\n                    id=\"auto-read-aloud-toggle-grammar-quiz\"\n                    checked={autoReadAloud}\n                    onChange={(e) => {\n                      setAutoReadAloud(e.target.checked);\n                      localStorage.setItem('autoReadAloud-grammar', e.target.checked.toString());\n                    }}\n                  />\n                  <label htmlFor=\"auto-read-aloud-toggle-grammar-quiz\" className=\"checkbox-label\">\n                    {autoReadAloud ? '' : ''}\n                  </label>\n                </div>\n              </div>\n            </div>\n          )}\n\n          <div className=\"question-container\">\n            <div className=\"question-card relative\">\n              {/*  */}\n              <button\n                onClick={() => _setIsFullscreen(true)}\n                className=\"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md\"\n                aria-label=\"\"\n                title=\"\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n                  />\n                </svg>\n              </button>\n              {/*  */}\n              <div className=\"comment-bar-container\">{/* AI */}</div>\n\n              {/*  */}\n              <div className=\"question-nav-row\">\n                <button\n                  className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-orange-500 hover:bg-orange-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n                  onClick={handlePrevious}\n                  disabled={currentQuestionIndex === 0}\n                  title=\"\"\n                >\n                  \n                </button>\n                <div className=\"question-content-inline\">\n                  <div\n                    className={`question-text ${showHint ? 'hint-active' : ''} ${!answered ? 'clickable' : ''}`}\n                    onClick={!answered ? toggleHint : undefined}\n                    title={!answered ? ' ' : ''}\n                  >\n                    {currentQuestion.japanese}\n                    {!answered && <span className=\"hint-icon\"></span>}\n                  </div>\n                  {currentQuestion.difficulty && (\n                    <div className={`difficulty-badge ${currentQuestion.difficulty}`}>\n                      {currentQuestion.difficulty === 'beginner'\n                        ? ''\n                        : currentQuestion.difficulty === 'intermediate'\n                          ? ''\n                          : ''}\n                    </div>\n                  )}\n                </div>\n                <button\n                  className=\"flex-shrink-0 w-12 h-12 sm:w-16 sm:h-16 bg-green-500 hover:bg-green-600 text-white font-bold rounded-lg transition flex items-center justify-center text-2xl disabled:opacity-30 disabled:cursor-not-allowed\"\n                  onClick={handleSkip}\n                  disabled={currentQuestionIndex >= currentQuestions.length - 1}\n                  title={answered ? '' : ' (Enter)'}\n                >\n                  \n                </button>\n              </div>\n\n              {/*  */}\n              {showHint && !answered && <div className=\"hint-box\">{currentQuestion.hint}</div>}\n\n              {/*  (Grade 2/3) */}\n              {currentQuestion.passage && (\n                <div className=\"passage-context\">\n                  <div className=\"passage-label\"> </div>\n                  <div className=\"passage-content\">\n                    <div className=\"passage-english\">{currentQuestion.passage}</div>\n                    {currentQuestion.passageJapanese && (\n                      <div className=\"passage-japanese\">{currentQuestion.passageJapanese}</div>\n                    )}\n                  </div>\n                </div>\n              )}\n\n              {isSentenceOrdering ? (\n                <div className=\"word-area\">\n                  <div className=\"selected-words-area\">\n                    <div className=\"area-label-with-reset\">\n                      <span className=\"area-label\"> ({selectedWords.length})</span>\n                      {!answered && (\n                        <button\n                          className={`reset-ordering-button ${selectedWords.length === 0 ? 'disabled' : ''}`}\n                          onClick={() => {\n                            if (selectedWords.length > 0) {\n                              // 1\n                              const lastWord = selectedWords[selectedWords.length - 1];\n                              setSelectedWords((prev) => prev.slice(0, -1));\n                              setRemainingWords((prev) => [...prev, lastWord]);\n                            }\n                          }}\n                          disabled={selectedWords.length === 0}\n                          title={\n                            selectedWords.length === 0\n                              ? ''\n                              : ''\n                          }\n                        >\n                           1\n                        </button>\n                      )}\n                    </div>\n                    <div className=\"word-container\">\n                      {selectedWords.map((word, index) => (\n                        <button\n                          key={`selected-${index}`}\n                          className=\"word-button selected\"\n                          onClick={() => handleWordClick(word, false)}\n                          disabled={answered}\n                        >\n                          {word}\n                        </button>\n                      ))}\n                      {selectedWords.length === 0 && (\n                        <div className=\"placeholder\"></div>\n                      )}\n                    </div>\n                  </div>\n\n                  <div className=\"remaining-words-area\">\n                    <div className=\"area-label\"> ({remainingWords.length})</div>\n                    <div className=\"word-container\">\n                      {remainingWords.map((word, index) => (\n                        <button\n                          key={`remaining-${index}`}\n                          className=\"word-button remaining\"\n                          onClick={() => handleWordClick(word, true)}\n                          disabled={answered}\n                        >\n                          {word}\n                        </button>\n                      ))}\n                    </div>\n                  </div>\n                </div>\n              ) : (\n                <div className=\"choices-area\">\n                  {/*  */}\n                  {(currentQuestion as any).conversation ? (\n                    <>\n                      {/*  */}\n                      {currentQuestion.japanese &&\n                        currentQuestion.japanese.includes('A:') &&\n                        currentQuestion.japanese.includes('B:') && (\n                          <div className=\"japanese-conversation\">\n                            {currentQuestion.japanese.split(/([AB]:)/).map((part, idx) => {\n                              if (part === 'A:' || part === 'B:') {\n                                return (\n                                  <span key={idx} className=\"conversation-speaker\">\n                                    {part}\n                                  </span>\n                                );\n                              }\n                              if (part.trim()) {\n                                return (\n                                  <span key={idx} className=\"conversation-text\">\n                                    {part.trim()}\n                                  </span>\n                                );\n                              }\n                              return null;\n                            })}\n                          </div>\n                        )}\n                      <div className=\"conversation-display\">\n                        {(\n                          (currentQuestion as any).conversation ||\n                          (currentQuestion as any).dialogue?.map(\n                            (d: { speaker: string; text: string }) => `${d.speaker}: ${d.text}`\n                          ) ||\n                          []\n                        ).map((line: string, idx: number) => (\n                          <div key={idx} className=\"conversation-line\">\n                            {line.split('____').map((part, index, array) => (\n                              <span key={index}>\n                                {part}\n                                {index < array.length - 1 && (\n                                  <span className=\"fill-in-blank-space\">_______</span>\n                                )}\n                              </span>\n                            ))}\n                          </div>\n                        ))}\n                      </div>\n                    </>\n                  ) : (currentQuestion as any).originalSentence ||\n                    (currentQuestion as any).targetSentence ? (\n                    /*  (paraphrase) */\n                    <div className=\"paraphrase-display\">\n                      <div className=\"paraphrase-label\"> :</div>\n                      <div className=\"sentence-display original\">\n                        {(currentQuestion as any).originalSentence || currentQuestion.sentence}\n                      </div>\n                      <div className=\"paraphrase-arrow\"> </div>\n                      <div className=\"paraphrase-label\"> :</div>\n                      <div className=\"sentence-display target\">\n                        {(\n                          (currentQuestion as any).question ||\n                          (currentQuestion as any).targetSentence\n                        )\n                          ?.split('____')\n                          .map((part: string, index: number, array: string[]) => (\n                            <span key={index}>\n                              {part}\n                              {index < array.length - 1 && (\n                                <span className=\"fill-in-blank-space\">_______</span>\n                              )}\n                            </span>\n                          ))}\n                      </div>\n                    </div>\n                  ) : (\n                    /* 1 */\n                    <div className=\"sentence-display\">\n                      {currentQuestion.sentence?.split('____').map((part, index, array) => (\n                        <span key={index}>\n                          {part}\n                          {index < array.length - 1 && (\n                            <span className=\"fill-in-blank-space\">_______</span>\n                          )}\n                        </span>\n                      ))}\n                    </div>\n                  )}\n                  {/*  */}\n                  {currentQuestion.choices && currentQuestion.choices.length > 0 ? (\n                    <div className=\"choices-grid\">\n                      {/* 3 +  */}\n                      {currentQuestion.choices.map((choice: string, index: number) => {\n                        const isSelected = selectedAnswer === choice;\n                        const isCorrectChoice = choice === currentQuestion.correctAnswer;\n                        const showCorrect = answered && isCorrectChoice;\n                        const showIncorrect = answered && isSelected && !isCorrectChoice;\n\n                        return (\n                          <button\n                            key={index}\n                            className={`choice-button ${isSelected ? 'selected' : ''} ${showCorrect ? 'correct' : ''} ${showIncorrect ? 'incorrect' : ''}`}\n                            onClick={() => handleAnswerSelect(choice)}\n                            disabled={answered}\n                          >\n                            {choice}\n                            {showCorrect && ' '}\n                            {showIncorrect && ' '}\n                          </button>\n                        );\n                      })}\n                      {/*  */}\n                      <button\n                        className={`choice-button dont-know ${selectedAnswer === '' ? 'selected' : ''} ${answered && selectedAnswer === '' ? 'incorrect' : ''}`}\n                        onClick={() => handleAnswerSelect('')}\n                        disabled={answered}\n                      >\n                        \n                        {answered && selectedAnswer === '' && ' '}\n                      </button>\n                    </div>\n                  ) : (\n                    /*  */\n                    <div className=\"text-input-container\">\n                      <input\n                        type=\"text\"\n                        className=\"text-answer-input\"\n                        value={textInput}\n                        onChange={(e) => setTextInput(e.target.value)}\n                        onKeyPress={(e) => {\n                          if (e.key === 'Enter' && textInput.trim()) {\n                            handleAnswerSelect(textInput.trim());\n                          }\n                        }}\n                        placeholder=\"...\"\n                        disabled={answered}\n                        autoFocus\n                      />\n                      <button\n                        className=\"submit-answer-button\"\n                        onClick={() => handleAnswerSelect(textInput.trim())}\n                        disabled={answered || !textInput.trim()}\n                      >\n                        \n                      </button>\n                      <button\n                        className={`choice-button dont-know ${selectedAnswer === '' ? 'selected' : ''}`}\n                        onClick={() => handleAnswerSelect('')}\n                        disabled={answered}\n                      >\n                        \n                      </button>\n                    </div>\n                  )}\n                </div>\n              )}\n\n              {/*  */}\n              {answered && (\n                <>\n                  {isSentenceOrdering ? (\n                    <>\n                      <div className={`result-box ${isCorrect() ? 'correct' : 'incorrect'}`}>\n                        <div className=\"result-header\">\n                          {isCorrect() ? ' ' : ' '}\n                        </div>\n                        <div className=\"result-content\">\n                          <div className=\"answer-comparison\">\n                            <div className=\"user-answer\">\n                              <strong>:</strong>\n                              <br />\n                              {selectedWords.join(' ')}\n                            </div>\n                            {!isCorrect() && (\n                              <div className=\"correct-answer\">\n                                <strong>:</strong>\n                                <br />\n                                {(currentQuestion as any).correctAnswer ||\n                                  (currentQuestion as any).correctOrder ||\n                                  currentQuestion.sentence ||\n                                  ''}\n                              </div>\n                            )}\n                          </div>\n                        </div>\n                      </div>\n                      {currentQuestion.explanation && (\n                        <div className=\"explanation-box\">\n                          <div className=\"explanation\">\n                            <strong>:</strong>\n                            <br />\n                            {currentQuestion.explanation}\n                          </div>\n                        </div>\n                      )}\n                    </>\n                  ) : (\n                    <>\n                      {currentQuestion.explanation && (\n                        <div className=\"explanation-box\">\n                          <div className=\"explanation\">\n                            <strong>:</strong>\n                            <br />\n                            {currentQuestion.explanation}\n                          </div>\n                        </div>\n                      )}\n                    </>\n                  )}\n                </>\n              )}\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default GrammarQuizView;\n","import { useState, useEffect, useRef, useCallback } from 'react';\nimport { Question, MemorizationCardState, MemorizationBehavior, QuestionSet } from '../types';\nimport type { CustomWord, CustomQuestionSet } from '../types/customQuestions';\nimport {\n  getMemorizationCardSettings,\n  saveMemorizationCardSettings,\n  recordMemorizationBehavior,\n  getMemorizationSettings,\n  saveMemorizationSettings,\n} from '../progressStorage';\nimport { speakEnglish, isSpeechSynthesisSupported } from '@/features/speech/speechSynthesis';\nimport { logger } from '@/utils/logger';\nimport ScoreBoard from './ScoreBoard';\nimport AddToCustomButton from './AddToCustomButton';\nimport { useAdaptiveLearning } from '../hooks/useAdaptiveLearning';\nimport { QuestionCategory } from '../strategies/memoryAcquisitionAlgorithm';\nimport { sortQuestionsByPriority as sortByPriorityCommon } from '../utils/questionPrioritySorter';\nimport { useQuestionRequeue } from '../hooks/useQuestionRequeue';\n\ninterface MemorizationViewProps {\n  allQuestions: Question[];\n  questionSets: QuestionSet[];\n  customQuestionSets?: CustomQuestionSet[];\n  onAddWordToCustomSet?: (setId: string, word: CustomWord) => void;\n  onRemoveWordFromCustomSet?: (setId: string, word: CustomWord) => void;\n  onOpenCustomSetManagement?: () => void;\n}\n\nfunction MemorizationView({\n  allQuestions,\n  questionSets,\n  customQuestionSets = [],\n  onAddWordToCustomSet,\n  onRemoveWordFromCustomSet,\n  onOpenCustomSetManagement,\n}: MemorizationViewProps) {\n  // \n  const [showSettings, setShowSettings] = useState(false);\n  const [selectedDataSource, setSelectedDataSource] = useState<string>('all');\n  const [selectedCategory, setSelectedCategory] = useState<string>('all');\n  const [selectedDifficulty, setSelectedDifficulty] = useState<string>('all');\n  const [selectedWordPhraseFilter, setSelectedWordPhraseFilter] = useState<string>('all');\n\n  // LocalStorage\n  const [stillLearningLimit, setStillLearningLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem('memorization-still-learning-limit');\n    return saved ? parseInt(saved) : null;\n  });\n\n  const [incorrectLimit, setIncorrectLimit] = useState<number | null>(() => {\n    const saved = localStorage.getItem('memorization-incorrect-limit');\n    return saved ? parseInt(saved) : null;\n  });\n\n  // \n  const [cardState, setCardState] = useState<MemorizationCardState>({\n    showWord: true,\n    showMeaning: true,\n    showPronunciation: false,\n    showExample: false,\n    showEtymology: false,\n    showRelated: false,\n  });\n\n  // \n  const [autoVoice, setAutoVoice] = useState(false);\n  const [voiceWord, setVoiceWord] = useState(true); // \n  const [voiceMeaning, setVoiceMeaning] = useState(false); // \n  const [voiceDelay, setVoiceDelay] = useState(1.5); // \n\n  // \n  const [currentQuestion, setCurrentQuestion] = useState<Question | null>(null);\n  const [currentIndex, setCurrentIndex] = useState(0);\n  const [questions, setQuestions] = useState<Question[]>([]);\n\n  // \n  const [sessionId] = useState(() => `session-${Date.now()}`);\n  const [consecutiveViews, setConsecutiveViews] = useState(0);\n\n  // \n  const [isReviewFocusMode, setIsReviewFocusMode] = useState(false);\n\n  // \n  const [sessionStats, setSessionStats] = useState({\n    correct: 0,\n    still_learning: 0, // \n    incorrect: 0,\n    total: 0,\n    newQuestions: 0, // \n    reviewQuestions: 0, // \n    consecutiveNew: 0, // \n    consecutiveReview: 0, // \n  });\n\n  // ScoreBoard\n  const [lastAnswerTime, setLastAnswerTime] = useState<number>(0);\n\n  // AI\n  const [lastAnswerCorrect, setLastAnswerCorrect] = useState<boolean | undefined>(undefined);\n  const [lastAnswerWord, setLastAnswerWord] = useState<string | undefined>(undefined);\n  const [correctStreak, setCorrectStreak] = useState<number>(0);\n  const [incorrectStreak, setIncorrectStreak] = useState<number>(0);\n\n  // \n  const cardDisplayTimeRef = useRef<number>(0);\n  const [isLoading, setIsLoading] = useState(true);\n\n  // ref\n  const touchStartX = useRef<number>(0);\n  const cardRef = useRef<HTMLDivElement>(null);\n  const previousQuestionId = useRef<string | null>(null); // ID\n\n  // \n  const [isFullscreen, setIsFullscreen] = useState(false);\n\n  // \n  const adaptiveLearning = useAdaptiveLearning(QuestionCategory.MEMORIZATION);\n\n  // \n  const { reAddQuestion, clearExpiredFlags, updateRequeueStats } = useQuestionRequeue<Question>();\n\n  // : \n  useEffect(() => {\n    const loadSettings = async () => {\n      try {\n        const savedCardSettings = await getMemorizationCardSettings();\n        if (savedCardSettings) {\n          setCardState(savedCardSettings);\n        }\n\n        const memSettings = await getMemorizationSettings();\n        if (memSettings) {\n          setAutoVoice(memSettings.autoVoice || false);\n          setVoiceWord(memSettings.voiceWord !== undefined ? memSettings.voiceWord : true);\n          setVoiceMeaning(memSettings.voiceMeaning || false);\n          setVoiceDelay(memSettings.voiceDelay !== undefined ? memSettings.voiceDelay : 1.5);\n        }\n\n        setIsLoading(false);\n      } catch (error) {\n        logger.error(':', error);\n        setIsLoading(false);\n      }\n    };\n\n    loadSettings();\n  }, []);\n\n  // \n  const getAvailableCategories = (): string[] => {\n    const categories = new Set<string>();\n    allQuestions.forEach((q) => {\n      if (q.relatedFields && Array.isArray(q.relatedFields)) {\n        q.relatedFields.forEach((field) => categories.add(field));\n      }\n    });\n    return Array.from(categories).sort();\n  };\n\n  // AI\n  useEffect(() => {\n    if (isLoading) return;\n\n    const selectQuestions = () => {\n      // \n      const baseQuestions = allQuestions;\n\n      // source  'junior' \n      // \n      if (selectedDataSource !== 'all') {\n        //  junior \n        // : standard/advanced/comprehensive\n      }\n\n      if (baseQuestions.length === 0) return;\n\n      // \n      let filtered = baseQuestions;\n\n      // \n      if (selectedDifficulty !== 'all') {\n        filtered = filtered.filter((q) => q.difficulty === selectedDifficulty);\n      }\n\n      // \n      if (selectedCategory !== 'all') {\n        filtered = filtered.filter(\n          (q) =>\n            q.relatedFields &&\n            Array.isArray(q.relatedFields) &&\n            q.relatedFields.includes(selectedCategory)\n        );\n      }\n\n      // \n      if (selectedWordPhraseFilter === 'words') {\n        filtered = filtered.filter((q) => !q.word.includes(' ') || q.word.split(' ').length <= 2);\n      } else if (selectedWordPhraseFilter === 'phrases') {\n        filtered = filtered.filter((q) => q.word.includes(' ') && q.word.split(' ').length > 2);\n      }\n\n      // Leitner + \n      const sortedQuestions = sortQuestionsByPriority(filtered, stillLearningLimit, incorrectLimit);\n\n      setQuestions(sortedQuestions);\n      if (sortedQuestions.length > 0) {\n        setCurrentQuestion(sortedQuestions[0]);\n        setCurrentIndex(0);\n        cardDisplayTimeRef.current = Date.now();\n      }\n    };\n\n    selectQuestions();\n  }, [\n    questionSets,\n    selectedDataSource,\n    selectedDifficulty,\n    selectedCategory,\n    selectedWordPhraseFilter,\n    allQuestions,\n    isLoading,\n    isReviewFocusMode,\n  ]);\n\n  // \n  const handleReviewFocus = () => {\n    setIsReviewFocusMode(!isReviewFocusMode);\n  };\n\n  // \n  useEffect(() => {\n    if (\n      (stillLearningLimit !== null && sessionStats.still_learning >= stillLearningLimit) ||\n      (incorrectLimit !== null && sessionStats.incorrect >= incorrectLimit)\n    ) {\n      if (!isReviewFocusMode) {\n        setIsReviewFocusMode(true);\n      }\n    }\n  }, [sessionStats, stillLearningLimit, incorrectLimit, isReviewFocusMode]);\n\n  // \n  const calculateOptimalInterval = (streak: number, easinessFactor: number = 2.5): number => {\n    // \n    if (streak === 0) return 0; // \n    if (streak === 1) return 1; // 1\n    if (streak === 2) return 3; // 3\n    if (streak === 3) return 7; // 7\n\n    // 4  \n    const baseInterval = 7;\n    return Math.round(baseInterval * Math.pow(easinessFactor, streak - 3));\n  };\n\n  // \n  const calculateForgettingRisk = (\n    lastStudied: number,\n    reviewInterval: number,\n    accuracy: number\n  ): number => {\n    const now = Date.now();\n    const daysSinceStudy = (now - lastStudied) / (1000 * 60 * 60 * 24);\n    const expectedInterval = reviewInterval || 1;\n\n    //  / 100%\n    const timeRisk = (daysSinceStudy / expectedInterval) * 100;\n\n    // \n    const accuracyRisk = (1 - accuracy / 100) * 50;\n\n    return timeRisk + accuracyRisk;\n  };\n\n  // Leitner + \n  const sortQuestionsByPriority = (\n    questions: Question[],\n    stillLearningLimit: number | null,\n    incorrectLimit: number | null\n  ): Question[] => {\n    // progressStorage\n    const getWordStatus = (word: string) => {\n      const key = 'english-progress';\n      const stored = localStorage.getItem(key);\n      if (!stored) return null;\n\n      try {\n        const progress = JSON.parse(stored);\n        const wordProgress = progress.wordProgress?.[word];\n        if (!wordProgress) return null;\n\n        const attempts = wordProgress.memorizationAttempts || 0;\n        const correct = wordProgress.memorizationCorrect || 0;\n        const stillLearning = wordProgress.memorizationStillLearning || 0;\n        const streak = wordProgress.memorizationStreak || 0;\n        const lastStudied = wordProgress.lastStudied || 0;\n\n        // \n        const easinessFactor = wordProgress.easinessFactor || 2.5;\n        const reviewInterval =\n          wordProgress.reviewInterval || calculateOptimalInterval(streak, easinessFactor);\n        const avgResponseSpeed = wordProgress.avgResponseSpeed || 0;\n\n        if (attempts === 0) {\n          return {\n            category: 'new',\n            priority: 3,\n            lastStudied,\n            attempts,\n            correct,\n            streak,\n            forgettingRisk: 0,\n            reviewInterval: 0,\n          };\n        }\n\n        // 0.550%\n        const effectiveCorrect = correct + stillLearning * 0.5;\n        const accuracy = attempts > 0 ? (effectiveCorrect / attempts) * 100 : 0;\n\n        // \n        const forgettingRisk = calculateForgettingRisk(lastStudied, reviewInterval, accuracy);\n\n        //  : 3 or 80%2\n        if (streak >= 3 || (streak >= 2 && accuracy >= 80)) {\n          return {\n            category: 'mastered',\n            priority: 5,\n            lastStudied,\n            attempts,\n            correct,\n            streak,\n            forgettingRisk,\n            reviewInterval,\n          };\n        }\n        //  : 50% or \n        else if (accuracy >= 50 || stillLearning > 0) {\n          return {\n            category: 'still_learning',\n            priority: 2,\n            lastStudied,\n            attempts,\n            correct,\n            streak,\n            forgettingRisk,\n            reviewInterval,\n          };\n        }\n        //  : 50% and \n        else {\n          return {\n            category: 'incorrect',\n            priority: 1,\n            lastStudied,\n            attempts,\n            correct,\n            streak,\n            forgettingRisk,\n            reviewInterval,\n          };\n        }\n      } catch (error) {\n        logger.error(':', error);\n        return null;\n      }\n    };\n\n    // \n    const questionsWithStatus = questions.map((q) => ({\n      question: q,\n      status: getWordStatus(q.word),\n    }));\n\n    // \n    const counts = {\n      mastered: questionsWithStatus.filter((q) => q.status?.category === 'mastered').length,\n      still_learning: questionsWithStatus.filter((q) => q.status?.category === 'still_learning')\n        .length,\n      incorrect: questionsWithStatus.filter((q) => q.status?.category === 'incorrect').length,\n      new: questionsWithStatus.filter((q) => q.status?.category === 'new').length,\n    };\n\n    // \n    const shouldFocusOnStillLearning =\n      stillLearningLimit !== null && counts.still_learning >= stillLearningLimit;\n    const shouldFocusOnIncorrect = incorrectLimit !== null && counts.incorrect >= incorrectLimit;\n\n    // +\n    const totalStudied = counts.mastered + counts.still_learning + counts.incorrect;\n    const needsReview = counts.still_learning + counts.incorrect;\n    const reviewRatio = totalStudied > 0 ? needsReview / totalStudied : 0;\n\n    // 20%\n    const shouldSuppressNew = reviewRatio >= 0.2;\n\n    // \n    // \n    const effectiveLimit = incorrectLimit !== null ? incorrectLimit : 50;\n\n    // 60%\n    // 10  650  30200  120\n    const concentrationThreshold = Math.max(3, Math.floor(effectiveLimit * 0.6));\n\n    // 30%\n    // 10  350  15200  60\n    const newQuestionThreshold = Math.max(2, Math.floor(effectiveLimit * 0.3));\n\n    const hasLargeIncorrectBacklog = counts.incorrect > concentrationThreshold;\n    const canIntroduceNewQuestions = counts.incorrect <= newQuestionThreshold;\n\n    // :  >  > \n    const sorted = questionsWithStatus.sort((a, b) => {\n      const statusA = a.status;\n      const statusB = b.status;\n\n      // \n      let priorityA = statusA?.priority || 3;\n      let priorityB = statusB?.priority || 3;\n\n      //  : \n      if (isReviewFocusMode) {\n        // incorrect70%\n        if (statusA?.category === 'incorrect') priorityA = 0;\n        if (statusB?.category === 'incorrect') priorityB = 0;\n\n        // still_learning25%\n        if (statusA?.category === 'still_learning' && priorityA !== 0) priorityA = 0.5;\n        if (statusB?.category === 'still_learning' && priorityB !== 0) priorityB = 0.5;\n\n        // mastered5%\n        if (statusA?.category === 'mastered' && priorityA > 1) priorityA = 10;\n        if (statusB?.category === 'mastered' && priorityB > 1) priorityB = 10;\n        if (statusA?.category === 'new' && priorityA > 1) priorityA = 8;\n        if (statusB?.category === 'new' && priorityB > 1) priorityB = 8;\n      } else {\n        // :  + \n\n        // \n        const riskA = statusA?.forgettingRisk || 0;\n        const riskB = statusB?.forgettingRisk || 0;\n\n        //  150+:  \n        if (riskA >= 150) priorityA = 0.1;\n        if (riskB >= 150) priorityB = 0.1;\n\n        //  100-149:   \n        if (riskA >= 100 && riskA < 150) priorityA = 0.2;\n        if (riskB >= 100 && riskB < 150) priorityB = 0.2;\n\n        //  \n        // \n        if (statusA?.category === 'incorrect' && priorityA > 0.2) {\n          if (hasLargeIncorrectBacklog) {\n            // 1\n            const isRecentA = statusA.lastStudied && Date.now() - statusA.lastStudied < 86400000;\n            priorityA = isRecentA ? 0.1 : 0.3;\n          } else {\n            priorityA = 0.3;\n          }\n        }\n        if (statusB?.category === 'incorrect' && priorityB > 0.2) {\n          if (hasLargeIncorrectBacklog) {\n            const isRecentB = statusB.lastStudied && Date.now() - statusB.lastStudied < 86400000;\n            priorityB = isRecentB ? 0.1 : 0.3;\n          } else {\n            priorityB = 0.3;\n          }\n        }\n\n        //  \n        if (statusA?.category === 'still_learning' && priorityA > 0.3) priorityA = 0.8;\n        if (statusB?.category === 'still_learning' && priorityB > 0.3) priorityB = 0.8;\n\n        //  : \n        if (statusA?.category === 'mastered') {\n          if (riskA >= 50 && priorityA > 1)\n            priorityA = 2.0; //   \n          else if (priorityA > 2) priorityA = 4.5; //   \n        }\n        if (statusB?.category === 'mastered') {\n          if (riskB >= 50 && priorityB > 1) priorityB = 2.0;\n          else if (priorityB > 2) priorityB = 4.5;\n        }\n\n        //  \n        // \n        if (statusA?.category === 'new' && priorityA > 3) {\n          if (hasLargeIncorrectBacklog) {\n            // 50\n            priorityA = 10;\n          } else if (canIntroduceNewQuestions) {\n            // 3010%\n            priorityA = 3.5;\n          } else {\n            // 31-50\n            priorityA = shouldSuppressNew ? 5 : 3.5;\n          }\n        }\n        if (statusB?.category === 'new' && priorityB > 3) {\n          if (hasLargeIncorrectBacklog) {\n            priorityB = 10;\n          } else if (canIntroduceNewQuestions) {\n            priorityB = 3.5;\n          } else {\n            priorityB = shouldSuppressNew ? 5 : 3.5;\n          }\n        }\n\n        // \n        if (shouldFocusOnIncorrect) {\n          if (statusA?.category === 'incorrect') priorityA = 0;\n          if (statusB?.category === 'incorrect') priorityB = 0;\n        }\n        if (shouldFocusOnStillLearning) {\n          if (statusA?.category === 'still_learning') priorityA = 0.05;\n          if (statusB?.category === 'still_learning') priorityB = 0.05;\n        }\n      }\n\n      // \n      if (priorityA !== priorityB) {\n        return priorityA - priorityB;\n      }\n\n      // \n      const lastStudiedA = statusA?.lastStudied || 0;\n      const lastStudiedB = statusB?.lastStudied || 0;\n      if (lastStudiedA !== lastStudiedB) {\n        return lastStudiedA - lastStudiedB;\n      }\n\n      // \n      return Math.random() - 0.5;\n    });\n\n    return sorted.map((item) => item.question);\n  };\n\n  // \n  useEffect(() => {\n    if (!currentQuestion || !autoVoice) return;\n\n    // \n    if (previousQuestionId.current === currentQuestion.word) {\n      return;\n    }\n    previousQuestionId.current = currentQuestion.word;\n\n    const speakCard = async () => {\n      // ON\n      if (voiceWord) {\n        speakEnglish(currentQuestion.word, { rate: 0.85 });\n      }\n\n      // ON\n      if (voiceMeaning && currentQuestion.meaning) {\n        await new Promise((resolve) => setTimeout(resolve, voiceDelay * 1000)); // \n        // \n        const utterance = new SpeechSynthesisUtterance(currentQuestion.meaning);\n        utterance.lang = 'ja-JP';\n        utterance.rate = 0.85;\n        window.speechSynthesis.speak(utterance);\n      }\n    };\n\n    speakCard();\n    // voiceWord, voiceMeaning, voiceDelay\n    // autoVoiceID\n  }, [currentQuestion, autoVoice, voiceWord, voiceMeaning, voiceDelay]);\n\n  // \n  const toggleFullscreen = () => {\n    setIsFullscreen(!isFullscreen);\n  };\n\n  // \n  const toggleCardField = async (field: keyof MemorizationCardState) => {\n    if (field === 'showWord') return; // \n\n    const newState = {\n      ...cardState,\n      [field]: !cardState[field],\n    };\n\n    setCardState(newState);\n    await saveMemorizationCardSettings(newState);\n  };\n\n  // \n  const updateVoiceSettings = async (\n    autoVoiceVal: boolean,\n    voiceWordVal: boolean,\n    voiceMeaningVal: boolean,\n    voiceDelayVal?: number\n  ) => {\n    setAutoVoice(autoVoiceVal);\n    setVoiceWord(voiceWordVal);\n    setVoiceMeaning(voiceMeaningVal);\n    if (voiceDelayVal !== undefined) {\n      setVoiceDelay(voiceDelayVal);\n    }\n\n    await saveMemorizationSettings({\n      autoVoice: autoVoiceVal,\n      voiceWord: voiceWordVal,\n      voiceMeaning: voiceMeaningVal,\n      voiceDelay: voiceDelayVal !== undefined ? voiceDelayVal : voiceDelay,\n      interleavingMode: 'off',\n      cardDisplaySettings: cardState,\n    });\n  };\n\n  // useCallback- 3\n  const handleSwipe = useCallback(\n    async (direction: 'left' | 'center' | 'right') => {\n      if (!currentQuestion) return;\n\n      // \n      const viewDuration = (Date.now() - cardDisplayTimeRef.current) / 1000; // \n\n      // right: ()center: ()left: ()\n      const isCorrect = direction === 'right';\n      const isStillLearning = direction === 'center';\n\n      // AI\n      setLastAnswerCorrect(isCorrect);\n      setLastAnswerWord(currentQuestion.word);\n      if (isCorrect) {\n        setCorrectStreak((prev) => prev + 1);\n        setIncorrectStreak(0);\n      } else if (!isStillLearning) {\n        // incorrectStreak\n        setIncorrectStreak((prev) => prev + 1);\n        setCorrectStreak(0);\n      } else {\n        // \n        setCorrectStreak(0);\n        setIncorrectStreak(0);\n      }\n\n      // 3\n      setSessionStats((prev) => ({\n        correct: isCorrect ? prev.correct + 1 : prev.correct,\n        still_learning: isStillLearning ? prev.still_learning + 1 : prev.still_learning,\n        incorrect: !isCorrect && !isStillLearning ? prev.incorrect + 1 : prev.incorrect,\n        total: prev.total + 1,\n        newQuestions: prev.newQuestions,\n        reviewQuestions: prev.reviewQuestions,\n        consecutiveNew: prev.consecutiveNew,\n        consecutiveReview: prev.consecutiveReview,\n      }));\n\n      // 16\n      if (viewDuration < 16) {\n        const behavior: MemorizationBehavior = {\n          word: currentQuestion.word,\n          timestamp: Date.now(),\n          viewDuration,\n          swipeDirection: direction === 'center' ? 'left' : direction,\n          sessionId,\n          consecutiveViews: consecutiveViews + 1,\n        };\n\n        await recordMemorizationBehavior(behavior);\n        setConsecutiveViews((prev) => prev + 1);\n\n        // \n        const { updateWordProgress } = await import('../progressStorage');\n        await updateWordProgress(\n          currentQuestion.word,\n          isCorrect,\n          viewDuration * 1000, // \n          undefined,\n          'memorization', // \n          isStillLearning // \n        );\n\n        // \n        adaptiveLearning.recordAnswer(currentQuestion.word, isCorrect, viewDuration * 1000);\n      }\n\n      // ScoreBoard\n      setLastAnswerTime(Date.now());\n\n      // \n      // \n      // 3\n      const shouldResortImmediately = !isCorrect; // or\n      const shouldResortPeriodically =\n        sessionStats.total % 3 === 0 ||\n        (stillLearningLimit !== null && sessionStats.still_learning >= stillLearningLimit) ||\n        (incorrectLimit !== null && sessionStats.incorrect >= incorrectLimit);\n\n      if ((shouldResortImmediately || shouldResortPeriodically) && questions.length > 1) {\n        // \n        const remainingQuestions = questions.slice(currentIndex + 1);\n\n        // \n        const resorted = sortByPriorityCommon(remainingQuestions, {\n          isReviewFocusMode: false,\n          learningLimit: stillLearningLimit,\n          reviewLimit: incorrectLimit,\n          mode: 'memorization',\n        });\n\n        // \n        const updatedQuestions = [\n          ...questions.slice(0, currentIndex + 1), // \n          ...resorted, // \n        ];\n        setQuestions(updatedQuestions);\n      }\n\n      // 3\n      if (!isCorrect || isStillLearning) {\n        setQuestions((prevQuestions) =>\n          reAddQuestion(currentQuestion, prevQuestions, currentIndex)\n        );\n      }\n\n      // KPI + /\n      \n      updateRequeueStats(currentQuestion, sessionStats, setSessionStats);\n\n      // \n      const nextIndex = currentIndex + 1;\n\n      if (nextIndex < questions.length) {\n        // 5\n        const clearedQuestions = clearExpiredFlags(questions, currentIndex);\n        if (clearedQuestions !== questions) {\n          setQuestions(clearedQuestions);\n        }\n\n        setCurrentQuestion(questions[nextIndex]);\n        setCurrentIndex(nextIndex);\n        cardDisplayTimeRef.current = Date.now();\n        // lastAnswerWord\n        setLastAnswerWord(undefined);\n      } else {\n        // \n        setCurrentQuestion(null);\n        setLastAnswerWord(undefined);\n      }\n    },\n    [\n      currentQuestion,\n      currentIndex,\n      questions,\n      sessionId,\n      consecutiveViews,\n      sessionStats,\n      stillLearningLimit,\n      incorrectLimit,\n    ]\n  );\n\n  // handleSwipe\n  useEffect(() => {\n    const card = cardRef.current;\n    if (!card) return;\n\n    const handleTouchStart = (e: TouchEvent) => {\n      touchStartX.current = e.touches[0].clientX;\n    };\n\n    const handleTouchEnd = (e: TouchEvent) => {\n      const touchEndX = e.changedTouches[0].clientX;\n      const diff = touchEndX - touchStartX.current;\n\n      // 100px\n      if (Math.abs(diff) > 100) {\n        if (diff > 0) {\n          // \n          handleSwipe('right');\n        } else {\n          // \n          handleSwipe('left');\n        }\n      }\n    };\n\n    // 3\n    const handleKeyDown = (e: KeyboardEvent) => {\n      if (e.key === 'ArrowLeft' || e.key === '1') {\n        // 1\n        e.preventDefault();\n        handleSwipe('left');\n      } else if (e.key === 'ArrowDown' || e.key === '2') {\n        // 2\n        e.preventDefault();\n        handleSwipe('center');\n      } else if (e.key === 'ArrowRight' || e.key === '3') {\n        // 3\n        e.preventDefault();\n        handleSwipe('right');\n      }\n    };\n\n    card.addEventListener('touchstart', handleTouchStart);\n    card.addEventListener('touchend', handleTouchEnd);\n    document.addEventListener('keydown', handleKeyDown);\n\n    return () => {\n      card.removeEventListener('touchstart', handleTouchStart);\n      card.removeEventListener('touchend', handleTouchEnd);\n      document.removeEventListener('keydown', handleKeyDown);\n    };\n  }, [handleSwipe]);\n\n  if (isLoading) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-xl\">...</div>\n      </div>\n    );\n  }\n\n  // currentQuestion\n  if (!currentQuestion) {\n    return (\n      <div className=\"flex items-center justify-center min-h-screen\">\n        <div className=\"text-xl\">...</div>\n      </div>\n    );\n  }\n\n  return (\n    <div className=\"min-h-screen flex flex-col\">\n      {/*  */}\n      {isFullscreen ? (\n        <div className=\"fixed inset-0 z-50 bg-gray-50 overflow-y-auto\">\n          <div className=\"min-h-screen flex items-center justify-center py-8\">\n            {/*  */}\n            <button\n              onClick={toggleFullscreen}\n              className=\"fixed top-4 right-4 z-50 p-3 bg-gray-800 text-white rounded-full shadow-lg hover:bg-gray-700:bg-gray-600 transition\"\n              aria-label=\"\"\n            >\n              <svg className=\"w-6 h-6\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                <path\n                  strokeLinecap=\"round\"\n                  strokeLinejoin=\"round\"\n                  strokeWidth={2}\n                  d=\"M6 18L18 6M6 6l12 12\"\n                />\n              </svg>\n            </button>\n\n            {/*  */}\n            <div className=\"w-full max-w-4xl px-4\">\n              <div ref={cardRef} className=\"question-card\">\n                {/*  */}\n                <div className=\"mb-8 py-8 flex flex-col items-center justify-center min-h-[200px]\">\n                  <div\n                    className={`flex flex-col items-center ${isSpeechSynthesisSupported() ? 'clickable-pronunciation' : ''}`}\n                    onClick={(e) => {\n                      if (isSpeechSynthesisSupported()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        speakEnglish(currentQuestion.word, { rate: 0.85 });\n                      }\n                    }}\n                    onTouchEnd={(e) => {\n                      if (isSpeechSynthesisSupported()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        speakEnglish(currentQuestion.word, { rate: 0.85 });\n                      }\n                    }}\n                    title={isSpeechSynthesisSupported() ? ' ' : ''}\n                  >\n                    <div\n                      className={`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${currentQuestion.word.includes(' ') ? 'phrase-text' : ''} ${isSpeechSynthesisSupported() ? 'clickable-word' : ''}`}\n                    >\n                      {currentQuestion.word}\n                      {isSpeechSynthesisSupported() && <span className=\"speaker-icon\"></span>}\n                    </div>\n                    {currentQuestion.reading && (\n                      <div className=\"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center\">\n                        {currentQuestion.reading}\n                      </div>\n                    )}\n                    {currentQuestion.difficulty && (\n                      <div className=\"flex justify-center mt-4\">\n                        <div className={`difficulty-badge ${currentQuestion.difficulty}`}>\n                          {currentQuestion.difficulty === 'beginner'\n                            ? ''\n                            : currentQuestion.difficulty === 'intermediate'\n                              ? ''\n                              : ''}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* 3 */}\n                <div className=\"grid grid-cols-3 gap-3 mb-6\">\n                  <button\n                    onClick={() => handleSwipe('left')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n                  <button\n                    onClick={() => handleSwipe('center')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n                  <button\n                    onClick={() => handleSwipe('right')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n                </div>\n\n                {/*  */}\n                {onAddWordToCustomSet && onRemoveWordFromCustomSet && onOpenCustomSetManagement && (\n                  <div className=\"mb-4 flex justify-center\">\n                    <AddToCustomButton\n                      word={{\n                        word: currentQuestion.word,\n                        meaning: currentQuestion.meaning,\n                        ipa: currentQuestion.reading,\n                        source: 'memorization',\n                      }}\n                      sets={customQuestionSets}\n                      onAddWord={onAddWordToCustomSet}\n                      onRemoveWord={onRemoveWordFromCustomSet}\n                      onOpenManagement={onOpenCustomSetManagement}\n                      size=\"medium\"\n                      variant=\"both\"\n                    />\n                  </div>\n                )}\n\n                {/*  */}\n                <div className=\"space-y-3\">\n                  {/*  */}\n                  <button\n                    onClick={() => toggleCardField('showMeaning')}\n                    className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                  >\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                      <div className=\"flex items-center gap-2 sm:gap-4\">\n                        <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                          \n                        </span>\n                        <span className=\"text-gray-500 flex-shrink-0\">\n                          {cardState.showMeaning ? '' : ''}\n                        </span>\n                      </div>\n                      {cardState.showMeaning && (\n                        <div className=\"flex-1 text-base sm:text-lg text-gray-900 break-words\">\n                          {currentQuestion.meaning}\n                        </div>\n                      )}\n                    </div>\n                  </button>\n\n                  {/*  */}\n                  <button\n                    onClick={() => toggleCardField('showPronunciation')}\n                    className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                  >\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                      <div className=\"flex items-center gap-2 sm:gap-4\">\n                        <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                          \n                        </span>\n                        <span className=\"text-gray-500 flex-shrink-0\">\n                          {cardState.showPronunciation ? '' : ''}\n                        </span>\n                      </div>\n                      {cardState.showPronunciation && (\n                        <div className=\"flex-1 text-sm sm:text-base text-gray-700 break-words\">\n                          {currentQuestion.reading}\n                        </div>\n                      )}\n                    </div>\n                  </button>\n\n                  {/*  */}\n                  {currentQuestion.etymology &&\n                    currentQuestion.etymology.trim() !== '' &&\n                    currentQuestion.etymology !== '' && (\n                      <button\n                        onClick={() => toggleCardField('showEtymology')}\n                        className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                      >\n                        <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                          <div className=\"flex items-center gap-2 sm:gap-4\">\n                            <span className=\"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base\">\n                              \n                            </span>\n                            <span className=\"text-gray-500 flex-shrink-0\">\n                              {cardState.showEtymology ? '' : ''}\n                            </span>\n                          </div>\n                          {cardState.showEtymology && (\n                            <div className=\"flex-1 text-xs sm:text-sm text-gray-600 break-words\">\n                              {currentQuestion.etymology}\n                            </div>\n                          )}\n                        </div>\n                      </button>\n                    )}\n\n                  {/*  */}\n                  {currentQuestion.relatedWords && currentQuestion.relatedWords.trim() !== '' && (\n                    <button\n                      onClick={() => toggleCardField('showRelated')}\n                      className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                    >\n                      <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                        <div className=\"flex items-center gap-2 sm:gap-4\">\n                          <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                            \n                          </span>\n                          <span className=\"text-gray-500 flex-shrink-0\">\n                            {cardState.showRelated ? '' : ''}\n                          </span>\n                        </div>\n                        {cardState.showRelated && (\n                          <div className=\"flex-1 text-xs sm:text-sm text-gray-600 break-words\">\n                            {currentQuestion.relatedWords}\n                          </div>\n                        )}\n                      </div>\n                    </button>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      ) : (\n        <>\n          {/*  */}\n          <div className=\"mb-4 flex justify-center\">\n            <div className=\"w-full max-w-4xl\">\n              <ScoreBoard\n                mode=\"memorization\"\n                sessionCorrect={sessionStats.correct}\n                sessionReview={sessionStats.still_learning}\n                sessionIncorrect={sessionStats.incorrect}\n                totalAnswered={sessionStats.total}\n                currentWord={currentQuestion?.word}\n                onAnswerTime={lastAnswerTime}\n                lastAnswerCorrect={lastAnswerCorrect}\n                lastAnswerWord={lastAnswerWord}\n                lastAnswerDifficulty={currentQuestion?.difficulty}\n                correctStreak={correctStreak}\n                incorrectStreak={incorrectStreak}\n                learningPhase={\n                  (adaptiveLearning.state.currentPhase as unknown as\n                    | 'ENCODING'\n                    | 'INITIAL_CONSOLIDATION'\n                    | 'LONG_TERM_RETENTION'\n                    | 'MASTERED'\n                    | undefined) ?? undefined\n                }\n                estimatedSpeed={adaptiveLearning.state.personalParams?.learningSpeed}\n                onShowSettings={() => setShowSettings(true)}\n                dataSource={selectedDataSource}\n                category={selectedCategory === 'all' ? '' : selectedCategory}\n                difficulty={selectedDifficulty}\n                wordPhraseFilter={selectedWordPhraseFilter}\n                onReviewFocus={handleReviewFocus}\n                isReviewFocusMode={isReviewFocusMode}\n              />\n            </div>\n          </div>\n\n          {/*  */}\n          {showSettings && (\n            <div className=\"mb-4 bg-white rounded-lg shadow-lg p-6\">\n              <div className=\"flex justify-between items-center mb-4\">\n                <h3 className=\"text-xl font-bold\"> </h3>\n                <button\n                  onClick={() => setShowSettings(false)}\n                  className=\"px-4 py-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600\"\n                >\n                   \n                </button>\n              </div>\n\n              <div className=\"space-y-4\">\n                <div>\n                  <label\n                    htmlFor=\"memorization-datasource\"\n                    className=\"block text-sm font-medium mb-2 text-gray-700\"\n                  >\n                     :\n                  </label>\n                  <select\n                    id=\"memorization-datasource\"\n                    value={selectedDataSource}\n                    onChange={(e) => setSelectedDataSource(e.target.value)}\n                    className=\"w-full px-3 py-2 border rounded-lg\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"standard\"></option>\n                    <option value=\"advanced\"></option>\n                    <option value=\"comprehensive\"></option>\n                  </select>\n                </div>\n\n                <div>\n                  <label\n                    htmlFor=\"memorization-difficulty\"\n                    className=\"block text-sm font-medium mb-2 text-gray-700\"\n                  >\n                     :\n                  </label>\n                  <select\n                    id=\"memorization-difficulty\"\n                    value={selectedDifficulty}\n                    onChange={(e) => setSelectedDifficulty(e.target.value)}\n                    className=\"w-full px-3 py-2 border rounded-lg\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"beginner\"></option>\n                    <option value=\"intermediate\"></option>\n                    <option value=\"advanced\"></option>\n                  </select>\n                </div>\n\n                <div>\n                  <label\n                    htmlFor=\"memorization-category\"\n                    className=\"block text-sm font-medium mb-2 text-gray-700\"\n                  >\n                     :\n                  </label>\n                  <select\n                    id=\"memorization-category\"\n                    value={selectedCategory}\n                    onChange={(e) => setSelectedCategory(e.target.value)}\n                    className=\"w-full px-3 py-2 border rounded-lg\"\n                  >\n                    <option value=\"all\"></option>\n                    {getAvailableCategories().map((category) => (\n                      <option key={category} value={category}>\n                        {category}\n                      </option>\n                    ))}\n                  </select>\n                </div>\n\n                <div>\n                  <label\n                    htmlFor=\"memorization-filter\"\n                    className=\"block text-sm font-medium mb-2 text-gray-700\"\n                  >\n                     :\n                  </label>\n                  <select\n                    id=\"memorization-filter\"\n                    value={selectedWordPhraseFilter}\n                    onChange={(e) => setSelectedWordPhraseFilter(e.target.value)}\n                    className=\"w-full px-3 py-2 border rounded-lg\"\n                  >\n                    <option value=\"all\"></option>\n                    <option value=\"words\"></option>\n                    <option value=\"phrases\"></option>\n                  </select>\n                </div>\n\n                {/*  */}\n                <div className=\"border-t pt-4\">\n                  <label className=\"block text-sm font-medium mb-3 text-gray-700\">\n                     :\n                  </label>\n                  <p className=\"text-xs text-gray-500 mb-3\">\n                    Leitner\n                  </p>\n                  <div className=\"space-y-3\">\n                    <div>\n                      <label className=\"flex items-center mb-2\">\n                        <input\n                          type=\"checkbox\"\n                          checked={stillLearningLimit !== null}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              setStillLearningLimit(50);\n                              localStorage.setItem('memorization-still-learning-limit', '50');\n                            } else {\n                              setStillLearningLimit(null);\n                              localStorage.removeItem('memorization-still-learning-limit');\n                            }\n                          }}\n                          className=\"mr-2 w-4 h-4\"\n                        />\n                        <span className=\"text-sm\"> </span>\n                      </label>\n                      {stillLearningLimit !== null && (\n                        <div className=\"ml-6\">\n                          <select\n                            value={stillLearningLimit}\n                            title=\"\"\n                            onChange={(e) => {\n                              const value = parseInt(e.target.value);\n                              setStillLearningLimit(value);\n                              localStorage.setItem(\n                                'memorization-still-learning-limit',\n                                value.toString()\n                              );\n                            }}\n                            className=\"w-full px-3 py-2 border rounded-lg bg-white\"\n                          >\n                            {[5, 10, 20, 30, 50, 100, 150, 200].map((num) => (\n                              <option key={num} value={num}>\n                                {num}\n                              </option>\n                            ))}\n                          </select>\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            \n                          </p>\n                        </div>\n                      )}\n                    </div>\n\n                    <div>\n                      <label className=\"flex items-center mb-2\">\n                        <input\n                          type=\"checkbox\"\n                          checked={incorrectLimit !== null}\n                          onChange={(e) => {\n                            if (e.target.checked) {\n                              setIncorrectLimit(30);\n                              localStorage.setItem('memorization-incorrect-limit', '30');\n                            } else {\n                              setIncorrectLimit(null);\n                              localStorage.removeItem('memorization-incorrect-limit');\n                            }\n                          }}\n                          className=\"mr-2 w-4 h-4\"\n                        />\n                        <span className=\"text-sm\"> </span>\n                      </label>\n                      {incorrectLimit !== null && (\n                        <div className=\"ml-6\">\n                          <select\n                            value={incorrectLimit}\n                            title=\"\"\n                            onChange={(e) => {\n                              const value = parseInt(e.target.value);\n                              setIncorrectLimit(value);\n                              localStorage.setItem(\n                                'memorization-incorrect-limit',\n                                value.toString()\n                              );\n                            }}\n                            className=\"w-full px-3 py-2 border rounded-lg bg-white\"\n                          >\n                            {[5, 10, 20, 30, 50, 100, 150, 200].map((num) => (\n                              <option key={num} value={num}>\n                                {num}\n                              </option>\n                            ))}\n                          </select>\n                          <p className=\"text-xs text-gray-500 mt-1\">\n                            \n                          </p>\n                        </div>\n                      )}\n                    </div>\n                  </div>\n                </div>\n\n                <div className=\"border-t pt-4\">\n                  <label className=\"block text-sm font-medium mb-3 text-gray-700\">\n                     :\n                  </label>\n                  <div className=\"space-y-2\">\n                    <label className=\"flex items-center\">\n                      <input\n                        type=\"checkbox\"\n                        checked={autoVoice}\n                        onChange={(e) =>\n                          updateVoiceSettings(e.target.checked, voiceWord, voiceMeaning)\n                        }\n                        className=\"mr-2 w-4 h-4\"\n                      />\n                      <span></span>\n                    </label>\n                    {autoVoice && (\n                      <div className=\"ml-6 space-y-2\">\n                        <label className=\"flex items-center\">\n                          <input\n                            type=\"checkbox\"\n                            checked={voiceWord}\n                            onChange={(e) =>\n                              updateVoiceSettings(autoVoice, e.target.checked, voiceMeaning)\n                            }\n                            className=\"mr-2 w-4 h-4\"\n                          />\n                          <span></span>\n                        </label>\n                        <label className=\"flex items-center\">\n                          <input\n                            type=\"checkbox\"\n                            checked={voiceMeaning}\n                            onChange={(e) =>\n                              updateVoiceSettings(autoVoice, voiceWord, e.target.checked)\n                            }\n                            className=\"mr-2 w-4 h-4\"\n                          />\n                          <span></span>\n                        </label>\n                        {voiceMeaning && (\n                          <div className=\"ml-6 mt-2\">\n                            <label className=\"block text-sm text-gray-600 mb-1\">\n                               : {voiceDelay.toFixed(1)}\n                            </label>\n                            <input\n                              type=\"range\"\n                              min=\"0.5\"\n                              max=\"5.0\"\n                              step=\"0.5\"\n                              value={voiceDelay}\n                              onChange={(e) => {\n                                const newDelay = parseFloat(e.target.value);\n                                setVoiceDelay(newDelay);\n                                updateVoiceSettings(autoVoice, voiceWord, voiceMeaning, newDelay);\n                              }}\n                              className=\"w-full h-2 bg-gray-200 rounded-lg appearance-none cursor-pointer\"\n                              aria-label=\"\"\n                            />\n                            <div className=\"flex justify-between text-xs text-gray-500 mt-1\">\n                              <span>0.5</span>\n                              <span>5.0</span>\n                            </div>\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                </div>\n              </div>\n            </div>\n          )}\n\n          {/*  */}\n          <div className=\"flex-1 flex items-center justify-center\">\n            <div className=\"relative w-full max-w-4xl\">\n              {/*  */}\n              <button\n                onClick={toggleFullscreen}\n                className=\"absolute top-2 right-2 z-10 p-2 bg-gray-200 text-gray-700 rounded-lg hover:bg-gray-300:bg-gray-600 transition shadow-md\"\n                aria-label=\"\"\n                title=\"\"\n              >\n                <svg className=\"w-5 h-5\" fill=\"none\" stroke=\"currentColor\" viewBox=\"0 0 24 24\">\n                  <path\n                    strokeLinecap=\"round\"\n                    strokeLinejoin=\"round\"\n                    strokeWidth={2}\n                    d=\"M4 8V4m0 0h4M4 4l5 5m11-1V4m0 0h-4m4 0l-5 5M4 16v4m0 0h4m-4 0l5-5m11 5l-5-5m5 5v-4m0 4h-4\"\n                  />\n                </svg>\n              </button>\n\n              <div ref={cardRef} className=\"question-card w-full\">\n                {/*  */}\n                <div className=\"mb-8 py-8 flex flex-col items-center justify-center min-h-[200px]\">\n                  <div\n                    className={`flex flex-col items-center ${isSpeechSynthesisSupported() ? 'clickable-pronunciation' : ''}`}\n                    onClick={(e) => {\n                      if (isSpeechSynthesisSupported()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        speakEnglish(currentQuestion.word, { rate: 0.85 });\n                      }\n                    }}\n                    onTouchEnd={(e) => {\n                      if (isSpeechSynthesisSupported()) {\n                        e.preventDefault();\n                        e.stopPropagation();\n                        speakEnglish(currentQuestion.word, { rate: 0.85 });\n                      }\n                    }}\n                    title={isSpeechSynthesisSupported() ? ' ' : ''}\n                  >\n                    <div\n                      className={`text-3xl sm:text-4xl md:text-5xl lg:text-6xl font-bold text-gray-900 break-words text-center px-4 ${currentQuestion.word.includes(' ') ? 'phrase-text' : ''} ${isSpeechSynthesisSupported() ? 'clickable-word' : ''}`}\n                    >\n                      {currentQuestion.word}\n                      {isSpeechSynthesisSupported() && <span className=\"speaker-icon\"></span>}\n                    </div>\n                    {currentQuestion.reading && (\n                      <div className=\"question-reading text-base sm:text-lg md:text-xl text-gray-600 mt-3 text-center\">\n                        {currentQuestion.reading}\n                      </div>\n                    )}\n                    {currentQuestion.difficulty && (\n                      <div className=\"flex justify-center mt-4\">\n                        <div className={`difficulty-badge ${currentQuestion.difficulty}`}>\n                          {currentQuestion.difficulty === 'beginner'\n                            ? ''\n                            : currentQuestion.difficulty === 'intermediate'\n                              ? ''\n                              : ''}\n                        </div>\n                      </div>\n                    )}\n                  </div>\n                </div>\n\n                {/* 3 */}\n                <div className=\"grid grid-cols-3 gap-3 mb-6\">\n                  {/*  */}\n                  <button\n                    onClick={() => handleSwipe('left')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-red-500 hover:bg-red-600 active:bg-red-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n\n                  {/*  */}\n                  <button\n                    onClick={() => handleSwipe('center')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-yellow-500 hover:bg-yellow-600 active:bg-yellow-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n\n                  {/*  */}\n                  <button\n                    onClick={() => handleSwipe('right')}\n                    className=\"flex flex-col items-center justify-center py-6 px-2 bg-green-500 hover:bg-green-600 active:bg-green-700 text-white font-bold rounded-xl transition shadow-lg hover:shadow-xl transform hover:scale-105 active:scale-95\"\n                    aria-label=\"\"\n                  >\n                    <span className=\"text-3xl mb-2\"></span>\n                    <span className=\"text-sm sm:text-base\"></span>\n                  </button>\n                </div>\n\n                {/*  */}\n                {onAddWordToCustomSet && onRemoveWordFromCustomSet && onOpenCustomSetManagement && (\n                  <div className=\"mb-4 flex justify-center\">\n                    <AddToCustomButton\n                      word={{\n                        word: currentQuestion.word,\n                        meaning: currentQuestion.meaning,\n                        ipa: currentQuestion.reading,\n                        source: 'memorization',\n                      }}\n                      sets={customQuestionSets}\n                      onAddWord={onAddWordToCustomSet}\n                      onRemoveWord={onRemoveWordFromCustomSet}\n                      onOpenManagement={onOpenCustomSetManagement}\n                      size=\"medium\"\n                      variant=\"both\"\n                    />\n                  </div>\n                )}\n\n                {/*  */}\n                <div className=\"space-y-3\">\n                  {/*  */}\n                  <button\n                    onClick={() => toggleCardField('showMeaning')}\n                    className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                  >\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                      <div className=\"flex items-center gap-2 sm:gap-4\">\n                        <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                          \n                        </span>\n                        <span className=\"text-gray-500 flex-shrink-0\">\n                          {cardState.showMeaning ? '' : ''}\n                        </span>\n                      </div>\n                      {cardState.showMeaning && (\n                        <div className=\"flex-1 text-base sm:text-lg text-gray-900 break-words\">\n                          {currentQuestion.meaning}\n                        </div>\n                      )}\n                    </div>\n                  </button>\n\n                  {/*  */}\n                  <button\n                    onClick={() => toggleCardField('showPronunciation')}\n                    className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                  >\n                    <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                      <div className=\"flex items-center gap-2 sm:gap-4\">\n                        <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                          \n                        </span>\n                        <span className=\"text-gray-500 flex-shrink-0\">\n                          {cardState.showPronunciation ? '' : ''}\n                        </span>\n                      </div>\n                      {cardState.showPronunciation && (\n                        <div className=\"flex-1 text-sm sm:text-base text-gray-700 break-words\">\n                          {currentQuestion.reading}\n                        </div>\n                      )}\n                    </div>\n                  </button>\n\n                  {/*  */}\n                  {currentQuestion.etymology &&\n                    currentQuestion.etymology.trim() !== '' &&\n                    currentQuestion.etymology !== '' && (\n                      <button\n                        onClick={() => toggleCardField('showEtymology')}\n                        className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                      >\n                        <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                          <div className=\"flex items-center gap-2 sm:gap-4\">\n                            <span className=\"font-semibold text-gray-700 w-20 sm:w-24 flex-shrink-0 text-sm sm:text-base\">\n                              \n                            </span>\n                            <span className=\"text-gray-500 flex-shrink-0\">\n                              {cardState.showEtymology ? '' : ''}\n                            </span>\n                          </div>\n                          {cardState.showEtymology && (\n                            <div className=\"flex-1 text-xs sm:text-sm text-gray-600 break-words\">\n                              {currentQuestion.etymology}\n                            </div>\n                          )}\n                        </div>\n                      </button>\n                    )}\n\n                  {/*  */}\n                  {currentQuestion.relatedWords && currentQuestion.relatedWords.trim() !== '' && (\n                    <button\n                      onClick={() => toggleCardField('showRelated')}\n                      className=\"w-full text-left p-4 bg-gray-50 rounded-lg hover:bg-gray-100:bg-gray-600 transition\"\n                    >\n                      <div className=\"flex flex-col sm:flex-row sm:items-center gap-2 sm:gap-4\">\n                        <div className=\"flex items-center gap-2 sm:gap-4\">\n                          <span className=\"font-semibold text-gray-700 w-16 sm:w-24 flex-shrink-0\">\n                            \n                          </span>\n                          <span className=\"text-gray-500 flex-shrink-0\">\n                            {cardState.showRelated ? '' : ''}\n                          </span>\n                        </div>\n                        {cardState.showRelated && (\n                          <div className=\"flex-1 text-xs sm:text-sm text-gray-600 break-words\">\n                            {currentQuestion.relatedWords}\n                          </div>\n                        )}\n                      </div>\n                    </button>\n                  )}\n                </div>\n              </div>\n            </div>\n          </div>\n        </>\n      )}\n    </div>\n  );\n}\n\nexport default MemorizationView;\n","import React, { useState } from 'react';\n\n/**\n * \n */\nexport const GrammarGuideView: React.FC = () => {\n  const [activeTab, setActiveTab] = useState<'prepositions' | 'punctuation' | 'tips'>(\n    'prepositions'\n  );\n\n  return (\n    <div className=\"grammar-guide-view p-4 max-w-app mx-auto\">\n      {/*  - ScoreBoard */}\n      <div className=\"grammar-guide-tabs grid grid-cols-3 gap-1 sm:gap-2 mb-4\">\n        <button\n          onClick={() => setActiveTab('prepositions')}\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'prepositions'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          onClick={() => setActiveTab('punctuation')}\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'punctuation'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n        <button\n          onClick={() => setActiveTab('tips')}\n          className={`px-2 sm:px-4 py-1.5 sm:py-2 text-xs sm:text-base font-medium transition-all duration-200 rounded-t-lg border-b-2 ${\n            activeTab === 'tips'\n              ? 'bg-primary text-white border-primary'\n              : 'bg-gray-200 text-gray-700 border-transparent hover:bg-gray-300'\n          }`}\n        >\n          <span className=\"hidden sm:inline\"> </span>\n          <span className=\"sm:hidden\"></span>\n        </button>\n      </div>\n\n      {/*  -  */}\n      <div className=\"content-area bg-white rounded-lg p-4 shadow-md border border-gray-200\">\n        {activeTab === 'prepositions' && <PrepositionGuide />}\n        {activeTab === 'punctuation' && <PunctuationGuide />}\n        {activeTab === 'tips' && <ReadingTipsGuide />}\n      </div>\n    </div>\n  );\n};\n\n/**\n * \n */\nconst PrepositionGuide: React.FC = () => {\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold text-text-color mb-4\"></h2>\n\n      <p className=\"text-text-secondary mb-6\">\n        \n      </p>\n\n      {/* 3 */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> 3</h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* IN */}\n          <div className=\"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-blue-600 mt-2\">IN</div>\n              <div className=\"text-sm text-blue-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-blue-600\">\n                     <strong>in 2024</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in May</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in the morning</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-blue-600\">\n                     <strong>in Japan</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in the room</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* ON */}\n          <div className=\"bg-green-50/20 rounded-lg p-5 border-2 border-green-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-green-600 mt-2\">ON</div>\n              <div className=\"text-sm text-green-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-green-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-green-600\">\n                     <strong>on Monday</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on May 1st</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on Christmas</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-green-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-green-600\">\n                     <strong>on the table</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on the wall</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* AT */}\n          <div className=\"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-orange-600 mt-2\">AT</div>\n              <div className=\"text-sm text-orange-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-orange-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-orange-600\">\n                     <strong>at 7:00</strong>  7\n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at noon</strong>  \n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at night</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-orange-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-orange-600\">\n                     <strong>at school</strong>  \n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at the door</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/*  */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* IN */}\n          <div className=\"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-blue-600 mt-2\">IN</div>\n              <div className=\"text-sm text-blue-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-blue-600\">\n                     <strong>in 2024</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in May</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in the morning</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-blue-600\">\n                     <strong>in Japan</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>in the room</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* ON */}\n          <div className=\"bg-green-50/20 rounded-lg p-5 border-2 border-green-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-green-600 mt-2\">ON</div>\n              <div className=\"text-sm text-green-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-green-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-green-600\">\n                     <strong>on Monday</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on May 1st</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on Christmas</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-green-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-green-600\">\n                     <strong>on the table</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>on the wall</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* AT */}\n          <div className=\"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-orange-600 mt-2\">AT</div>\n              <div className=\"text-sm text-orange-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-orange-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-orange-600\">\n                     <strong>at 7:00</strong>  7\n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at noon</strong>  \n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at night</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-orange-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-orange-600\">\n                     <strong>at school</strong>  \n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>at the door</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/*  */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* TO */}\n          <div className=\"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-pink-600 mt-2\">TO</div>\n              <div className=\"text-sm text-pink-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-pink-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-pink-600\">\n                     <strong>to school</strong>  \n                  </div>\n                  <div className=\"text-pink-600\">\n                     <strong>to Tokyo</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-pink-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-pink-600\">\n                     <strong>from A to B</strong>  AB\n                  </div>\n                  <div className=\"text-pink-600\">\n                     <strong>from 9 to 5</strong>  95\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* FOR */}\n          <div className=\"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-purple-600 mt-2\">FOR</div>\n              <div className=\"text-sm text-purple-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-purple-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-purple-600\">\n                     <strong>for you</strong>  \n                  </div>\n                  <div className=\"text-purple-600\">\n                     <strong>for breakfast</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-purple-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-purple-600\">\n                     <strong>for 3 hours</strong>  3\n                  </div>\n                  <div className=\"text-purple-600\">\n                     <strong>for a week</strong>  1\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* FROM */}\n          <div className=\"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-teal-600 mt-2\">FROM</div>\n              <div className=\"text-sm text-teal-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-teal-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-teal-600\">\n                     <strong>from home</strong>  \n                  </div>\n                  <div className=\"text-teal-600\">\n                     <strong>from Japan</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-teal-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-teal-600\">\n                     <strong>from 9 am</strong>  9\n                  </div>\n                  <div className=\"text-teal-600\">\n                     <strong>from Monday</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 3 */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* WITH */}\n          <div className=\"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-indigo-600 mt-2\">WITH</div>\n              <div className=\"text-sm text-indigo-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-indigo-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-indigo-600\">\n                     <strong>with my family</strong>  \n                  </div>\n                  <div className=\"text-indigo-600\">\n                     <strong>with friends</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-indigo-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-indigo-600\">\n                     <strong>with a pen</strong>  \n                  </div>\n                  <div className=\"text-indigo-600\">\n                     <strong>with chopsticks</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* BY */}\n          <div className=\"bg-amber-50/20 rounded-lg p-5 border-2 border-amber-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-amber-600 mt-2\">BY</div>\n              <div className=\"text-sm text-amber-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-amber-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-amber-600\">\n                     <strong>by train</strong>  \n                  </div>\n                  <div className=\"text-amber-600\">\n                     <strong>by email</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-amber-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-amber-600\">\n                     <strong>by the sea</strong>  \n                  </div>\n                  <div className=\"text-amber-600\">\n                     <strong>by the window</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* OF */}\n          <div className=\"bg-rose-50/20 rounded-lg p-5 border-2 border-rose-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-rose-600 mt-2\">OF</div>\n              <div className=\"text-sm text-rose-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-rose-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-rose-600\">\n                     <strong>the book of mine</strong>  \n                  </div>\n                  <div className=\"text-rose-600\">\n                     <strong>the capital of Japan</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-rose-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-rose-600\">\n                     <strong>a piece of cake</strong>  \n                  </div>\n                  <div className=\"text-rose-600\">\n                     <strong>a glass of water</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 4 */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* ABOUT */}\n          <div className=\"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-cyan-600 mt-2\">ABOUT</div>\n              <div className=\"text-sm text-cyan-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-cyan-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-cyan-600\">\n                     <strong>a book about history</strong>  \n                  </div>\n                  <div className=\"text-cyan-600\">\n                     <strong>talk about sports</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-cyan-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-cyan-600\">\n                     <strong>about 10 minutes</strong>  10\n                  </div>\n                  <div className=\"text-cyan-600\">\n                     <strong>about 50 people</strong>  50\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* AFTER */}\n          <div className=\"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-lime-600 mt-2\">AFTER</div>\n              <div className=\"text-sm text-lime-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-lime-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-lime-600\">\n                     <strong>after dinner</strong>  \n                  </div>\n                  <div className=\"text-lime-600\">\n                     <strong>after school</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-lime-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-lime-600\">\n                     <strong>after you</strong>  \n                  </div>\n                  <div className=\"text-lime-600\">\n                     <strong>one after another</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* BEFORE */}\n          <div className=\"bg-sky-50/20 rounded-lg p-5 border-2 border-sky-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-sky-600 mt-2\">BEFORE</div>\n              <div className=\"text-sm text-sky-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-sky-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-sky-600\">\n                     <strong>before breakfast</strong>  \n                  </div>\n                  <div className=\"text-sky-600\">\n                     <strong>before Christmas</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-sky-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-sky-600\">\n                     <strong>before the door</strong>  \n                  </div>\n                  <div className=\"text-sky-600\">\n                     <strong>before everyone</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 5 */}\n      <div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* OVER */}\n          <div className=\"bg-violet-50/20 rounded-lg p-5 border-2 border-violet-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-violet-600 mt-2\">OVER</div>\n              <div className=\"text-sm text-violet-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-violet-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-violet-600\">\n                     <strong>over the bridge</strong>  \n                  </div>\n                  <div className=\"text-violet-600\">\n                     <strong>over the mountain</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-violet-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-violet-600\">\n                     <strong>over 100 people</strong>  100\n                  </div>\n                  <div className=\"text-violet-600\">\n                     <strong>over $50</strong>  50\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* UNDER */}\n          <div className=\"bg-slate-50/20 rounded-lg p-5 border-2 border-slate-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-slate-600 mt-2\">UNDER</div>\n              <div className=\"text-sm text-slate-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-slate-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-slate-600\">\n                     <strong>under the tree</strong>  \n                  </div>\n                  <div className=\"text-slate-600\">\n                     <strong>under the bridge</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-slate-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-slate-600\">\n                     <strong>under 18</strong>  18\n                  </div>\n                  <div className=\"text-slate-600\">\n                     <strong>under $10</strong>  10\n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* THROUGH */}\n          <div className=\"bg-fuchsia-50/20 rounded-lg p-5 border-2 border-fuchsia-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-fuchsia-600 mt-2\">THROUGH</div>\n              <div className=\"text-sm text-fuchsia-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-fuchsia-600\">\n                     <strong>through the window</strong>  \n                  </div>\n                  <div className=\"text-fuchsia-600\">\n                     <strong>through the forest</strong>  \n                  </div>\n                </div>\n              </div>\n              <div>\n                <div className=\"font-semibold text-fuchsia-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-fuchsia-600\">\n                     <strong>through the night</strong>  \n                  </div>\n                  <div className=\"text-fuchsia-600\">\n                     <strong>through the winter</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 6 */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* BETWEEN */}\n          <div className=\"bg-emerald-50/20 rounded-lg p-5 border-2 border-emerald-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-emerald-600 mt-2\">BETWEEN</div>\n              <div className=\"text-sm text-emerald-700 mt-1\">2</div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-emerald-800 mb-2 flex items-center gap-2\">\n                  <span></span> 2\n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-emerald-600\">\n                     <strong>between the school and hospital</strong>  \n                  </div>\n                  <div className=\"text-emerald-600\">\n                     <strong>between you and me</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* AMONG */}\n          <div className=\"bg-orange-50/20 rounded-lg p-5 border-2 border-orange-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-orange-600 mt-2\">AMONG</div>\n              <div className=\"text-sm text-orange-700 mt-1\">3</div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-orange-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-orange-600\">\n                     <strong>among the flowers</strong>  \n                  </div>\n                  <div className=\"text-orange-600\">\n                     <strong>among friends</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* WITHOUT */}\n          <div className=\"bg-red-50/20 rounded-lg p-5 border-2 border-red-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-red-600 mt-2\">WITHOUT</div>\n              <div className=\"text-sm text-red-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-red-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-red-600\">\n                     <strong>without water</strong>  \n                  </div>\n                  <div className=\"text-red-600\">\n                     <strong>without you</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 7 */}\n      <div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* DURING */}\n          <div className=\"bg-yellow-50/20 rounded-lg p-5 border-2 border-yellow-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-yellow-600 mt-2\">DURING</div>\n              <div className=\"text-sm text-yellow-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-yellow-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-yellow-600\">\n                     <strong>during summer vacation</strong>  \n                  </div>\n                  <div className=\"text-yellow-600\">\n                     <strong>during the movie</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* UNTIL / TILL */}\n          <div className=\"bg-teal-50/20 rounded-lg p-5 border-2 border-teal-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-teal-600 mt-2\">UNTIL/TILL</div>\n              <div className=\"text-sm text-teal-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-teal-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-teal-600\">\n                     <strong>until midnight</strong>  \n                  </div>\n                  <div className=\"text-teal-600\">\n                     <strong>until next week</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* SINCE */}\n          <div className=\"bg-blue-50/20 rounded-lg p-5 border-2 border-blue-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-blue-600 mt-2\">SINCE</div>\n              <div className=\"text-sm text-blue-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-blue-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-blue-600\">\n                     <strong>since last year</strong>  \n                  </div>\n                  <div className=\"text-blue-600\">\n                     <strong>since childhood</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 8 */}\n      <div>\n        <h3 className=\"text-lg font-semibold mb-4 text-primary\"> </h3>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* INSIDE */}\n          <div className=\"bg-purple-50/20 rounded-lg p-5 border-2 border-purple-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-purple-600 mt-2\">INSIDE</div>\n              <div className=\"text-sm text-purple-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-purple-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-purple-600\">\n                     <strong>inside the house</strong>  \n                  </div>\n                  <div className=\"text-purple-600\">\n                     <strong>inside the box</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* OUTSIDE */}\n          <div className=\"bg-green-50/20 rounded-lg p-5 border-2 border-green-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-green-600 mt-2\">OUTSIDE</div>\n              <div className=\"text-sm text-green-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-green-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-green-600\">\n                     <strong>outside the house</strong>  \n                  </div>\n                  <div className=\"text-green-600\">\n                     <strong>outside the school</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* NEAR */}\n          <div className=\"bg-cyan-50/20 rounded-lg p-5 border-2 border-cyan-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-cyan-600 mt-2\">NEAR</div>\n              <div className=\"text-sm text-cyan-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-cyan-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-cyan-600\">\n                     <strong>near the station</strong>  \n                  </div>\n                  <div className=\"text-cyan-600\">\n                     <strong>near the sea</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/* 9 */}\n      <div>\n        <div className=\"grid grid-cols-1 md:grid-cols-3 gap-6\">\n          {/* BEHIND */}\n          <div className=\"bg-indigo-50/20 rounded-lg p-5 border-2 border-indigo-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-indigo-600 mt-2\">BEHIND</div>\n              <div className=\"text-sm text-indigo-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-indigo-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-indigo-600\">\n                     <strong>behind the door</strong>  \n                  </div>\n                  <div className=\"text-indigo-600\">\n                     <strong>behind the house</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* ACROSS */}\n          <div className=\"bg-pink-50/20 rounded-lg p-5 border-2 border-pink-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-pink-600 mt-2\">ACROSS</div>\n              <div className=\"text-sm text-pink-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-pink-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-pink-600\">\n                     <strong>across the street</strong>  \n                  </div>\n                  <div className=\"text-pink-600\">\n                     <strong>across the river</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n\n          {/* ALONG */}\n          <div className=\"bg-lime-50/20 rounded-lg p-5 border-2 border-lime-500\">\n            <div className=\"text-center mb-4\">\n              <span className=\"text-5xl\"></span>\n              <div className=\"text-2xl font-bold text-lime-600 mt-2\">ALONG</div>\n              <div className=\"text-sm text-lime-700 mt-1\"></div>\n            </div>\n            <div className=\"space-y-3\">\n              <div>\n                <div className=\"font-semibold text-lime-800 mb-2 flex items-center gap-2\">\n                  <span></span> \n                </div>\n                <div className=\"bg-white rounded p-2 text-sm space-y-1\">\n                  <div className=\"text-lime-600\">\n                     <strong>along the street</strong>  \n                  </div>\n                  <div className=\"text-lime-600\">\n                     <strong>along the river</strong>  \n                  </div>\n                </div>\n              </div>\n            </div>\n          </div>\n        </div>\n      </div>\n    </div>\n  );\n};\n\n/**\n * \n */\nconst PunctuationGuide: React.FC = () => {\n  const punctuations = [\n    {\n      symbol: '.',\n      name: 'Period ()',\n      usage: '',\n      example: 'I like cats.',\n      explanation: '',\n    },\n    {\n      symbol: ',',\n      name: 'Comma ()',\n      usage: '',\n      example: 'I bought apples, oranges, and bananas.',\n      explanation: '',\n    },\n    {\n      symbol: '!',\n      name: 'Exclamation Mark ()',\n      usage: '',\n      example: 'What a beautiful day!',\n      explanation: '',\n    },\n    {\n      symbol: '?',\n      name: 'Question Mark ()',\n      usage: '',\n      example: 'Do you like music?',\n      explanation: '',\n    },\n    {\n      symbol: ':',\n      name: 'Colon ()',\n      usage: '',\n      example: 'I have three pets: a dog, a cat, and a bird.',\n      explanation: '',\n    },\n    {\n      symbol: ';',\n      name: 'Semicolon ()',\n      usage: '',\n      example: 'I love reading; my sister prefers sports.',\n      explanation: '',\n    },\n    {\n      symbol: '-',\n      name: 'Hyphen ()',\n      usage: '',\n      example: 'a well-known writer',\n      explanation: '2',\n    },\n    {\n      symbol: '',\n      name: 'Em Dash ()',\n      usage: '',\n      example: 'My friendsJohn and Maryare coming.',\n      explanation: '',\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold text-text-color mb-4\"></h2>\n\n      <div className=\"grid grid-cols-1 md:grid-cols-2 gap-4\">\n        {punctuations.map((punc, idx) => (\n          <div\n            key={idx}\n            className=\"bg-bg-secondary rounded-lg p-5 hover:shadow-lg transition-shadow border border-border-color\"\n          >\n            <div className=\"flex items-start gap-4 mb-3\">\n              <div className=\"text-5xl font-bold text-primary flex-shrink-0\">{punc.symbol}</div>\n              <div className=\"flex-1\">\n                <h3 className=\"text-lg font-bold text-text-color\">{punc.name}</h3>\n                <p className=\"text-sm text-primary font-semibold\">{punc.usage}</p>\n              </div>\n            </div>\n\n            <div className=\"bg-blue-50/20 rounded p-3 mb-3\">\n              <div className=\"font-mono text-sm text-blue-600\">{punc.example}</div>\n            </div>\n\n            <p className=\"text-sm text-text-secondary\">{punc.explanation}</p>\n          </div>\n        ))}\n      </div>\n    </div>\n  );\n};\n\n/**\n * \n */\nconst ReadingTipsGuide: React.FC = () => {\n  const tips = [\n    {\n      icon: '',\n      title: '',\n      description: '',\n      details: [\n        '',\n        '',\n        '',\n        '',\n      ],\n    },\n    {\n      icon: '',\n      title: '1',\n      description: '',\n      example: {\n        title: 'The Importance of Reading Books',\n        para1:\n          'Reading books is one of the best ways to improve your knowledge and imagination. Many people think that reading is boring, but it actually helps you learn new things and understand the world better.',\n        explanation:\n          ':  \\n1: 1 \\n ',\n      },\n      details: [\n        '  ',\n        '1  ',\n        '',\n        ' ',\n      ],\n    },\n    {\n      icon: '',\n      title: '',\n      description: '1 = 1',\n      example: {\n        structure:\n          '\\n\\n1\\n \\n\\n\\n1: \\n2: \\n: 30\\n\\n\\n \\n',\n        tips: '1',\n      },\n      details: [\n        '1: ',\n        ': OK',\n        ': ',\n        '1',\n      ],\n    },\n    {\n      icon: '',\n      title: '',\n      description: '',\n      details: [\n        ': However, But, Yet, On the other hand',\n        ': Therefore, So, Thus, As a result',\n        ': For example, For instance, Such as',\n        ': In addition, Moreover, Furthermore',\n        ': In other words, That is, Namely',\n      ],\n    },\n    {\n      icon: '',\n      title: '',\n      description: '',\n      details: [\n        ': 1',\n        ': ',\n        ': ',\n        ': ',\n        'NOT: ',\n      ],\n    },\n    {\n      icon: '',\n      title: '',\n      description: '',\n      details: [\n        '1: 3/',\n        '',\n        '',\n        '5',\n      ],\n    },\n    {\n      icon: '',\n      title: '',\n      description: '',\n      details: [\n        '',\n        '',\n        '',\n        '',\n      ],\n    },\n  ];\n\n  return (\n    <div className=\"space-y-6\">\n      <h2 className=\"text-2xl font-bold text-text-color mb-4\"></h2>\n\n      <div className=\"bg-yellow-50/20 rounded-lg p-6 border-l-4 border-yellow-500 mb-6\">\n        <div className=\"flex items-start gap-3\">\n          <span className=\"text-2xl\"></span>\n          <div>\n            <h3 className=\"font-bold text-lg text-yellow-800 mb-2\"></h3>\n            <p className=\"text-yellow-700 mb-3\">\n              \n              \n            </p>\n            <div className=\"bg-yellow-100/30 rounded p-3 text-sm\">\n              <p className=\"font-semibold text-yellow-900 mb-1\"> </p>\n              <p className=\"text-yellow-800\">\n                :        1   1  \n                \n              </p>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      <div className=\"space-y-4\">\n        {tips.map((tip, idx) => (\n          <div\n            key={idx}\n            className=\"bg-bg-secondary rounded-lg p-6 hover:shadow-lg transition-shadow border-l-4 border-primary/30\"\n          >\n            <div className=\"flex items-start gap-4 mb-4\">\n              <span className=\"text-4xl\">{tip.icon}</span>\n              <div className=\"flex-1\">\n                <h3 className=\"text-xl font-bold text-text-color mb-2\">{tip.title}</h3>\n                <p className=\"text-text-secondary\">{tip.description}</p>\n              </div>\n            </div>\n\n            {/*  */}\n            {tip.example && (\n              <div className=\"ml-14 mb-4 bg-blue-50/20 rounded-lg p-4 border border-blue-200\">\n                <div className=\"space-y-3\">\n                  {tip.example.title && (\n                    <div>\n                      <div className=\"text-xs font-semibold text-blue-600 mb-1\"> </div>\n                      <div className=\"bg-white rounded p-2 font-mono text-sm text-blue-700\">\n                        {tip.example.title}\n                      </div>\n                    </div>\n                  )}\n                  {tip.example.para1 && (\n                    <div>\n                      <div className=\"text-xs font-semibold text-blue-600 mb-1\"> 1</div>\n                      <div className=\"bg-white rounded p-2 text-sm text-gray-700 leading-relaxed\">\n                        {tip.example.para1}\n                      </div>\n                    </div>\n                  )}\n                  {tip.example.structure && (\n                    <div>\n                      <div className=\"text-xs font-semibold text-blue-600 mb-1\"> </div>\n                      <div className=\"bg-white rounded p-3 text-sm font-mono whitespace-pre-line text-gray-700\">\n                        {tip.example.structure}\n                      </div>\n                    </div>\n                  )}\n                  {tip.example.explanation && (\n                    <div className=\"bg-yellow-50/30 rounded p-3 border-l-2 border-yellow-500\">\n                      <div className=\"text-xs font-semibold text-yellow-800 mb-1\">\n                         \n                      </div>\n                      <div className=\"text-sm text-yellow-700 whitespace-pre-line\">\n                        {tip.example.explanation}\n                      </div>\n                    </div>\n                  )}\n                  {tip.example.tips && (\n                    <div className=\"bg-green-50/30 rounded p-3 border-l-2 border-green-500\">\n                      <div className=\"text-sm font-semibold text-green-700\">\n                         {tip.example.tips}\n                      </div>\n                    </div>\n                  )}\n                </div>\n              </div>\n            )}\n\n            <ul className=\"space-y-2 ml-14\">\n              {tip.details.map((detail, detailIdx) => (\n                <li key={detailIdx} className=\"flex items-start gap-2 text-sm\">\n                  <span className=\"text-primary mt-1\"></span>\n                  <span className=\"text-text-color\">{detail}</span>\n                </li>\n              ))}\n            </ul>\n          </div>\n        ))}\n      </div>\n\n      {/*  */}\n      <div className=\"bg-gradient-to-r from-blue-50 to-purple-50/20/20 rounded-lg p-6 mt-8 border-2 border-blue-300\">\n        <h3 className=\"text-xl font-bold text-text-color mb-4 flex items-center gap-2\">\n          <span></span>\n          <span></span>\n        </h3>\n        <ol className=\"space-y-3\">\n          {[\n            { step: '', detail: ' ' },\n            {\n              step: '',\n              detail: ' ',\n            },\n            { step: '1', detail: ' ' },\n            { step: '1', detail: ' ' },\n            { step: '', detail: ' ' },\n            { step: '', detail: ' ' },\n            { step: '', detail: ' ' },\n          ].map((item, idx) => (\n            <li key={idx} className=\"flex items-start gap-3\">\n              <span className=\"bg-primary text-white rounded-full w-6 h-6 flex items-center justify-center text-sm font-bold flex-shrink-0 mt-0.5\">\n                {idx + 1}\n              </span>\n              <div>\n                <span className=\"text-text-color font-semibold\">{item.step}</span>\n                <span className=\"text-text-secondary text-sm ml-2\">{item.detail}</span>\n              </div>\n            </li>\n          ))}\n        </ol>\n      </div>\n\n      {/*  */}\n      <div className=\"bg-green-50/20 rounded-lg p-6 border-l-4 border-green-500\">\n        <h3 className=\"text-lg font-bold text-green-800 mb-3 flex items-center gap-2\">\n          <span></span>\n          <span></span>\n        </h3>\n        <div className=\"space-y-2 text-sm text-green-700\">\n          <p>\n             <strong> = </strong>\n          </p>\n          <p> </p>\n          <p> :  </p>\n          <p className=\"pt-2 italic\">\n             \n          </p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default GrammarGuideView;\n","import React from 'react';\nimport './DictionaryView.css';\n\nconst DictionaryView: React.FC = () => {\n  return (\n    <div className=\"dictionary-view\">\n      <div className=\"dictionary-container\">\n        <h2> </h2>\n        <p className=\"coming-soon\"></p>\n      </div>\n    </div>\n  );\n};\n\nexport default DictionaryView;\n","import React, { useState } from 'react';\nimport type { CustomQuestionSet, CustomWord } from '../types/customQuestions';\n\ninterface FloatingPanelProps {\n  /** / */\n  isOpen: boolean;\n  /**  */\n  onClose: () => void;\n  /**  */\n  sets: CustomQuestionSet[];\n  /**  */\n  onCreateSet: (name: string, description?: string) => void;\n  /**  */\n  onDeleteSet: (setId: string) => void;\n  /**  */\n  onEditSet: (setId: string, name: string, description?: string) => void;\n  /**  */\n  onRemoveWord: (setId: string, word: CustomWord) => void;\n}\n\n/**\n * \n */\nconst FloatingPanel: React.FC<FloatingPanelProps> = ({\n  isOpen,\n  onClose,\n  sets,\n  onCreateSet,\n  onDeleteSet,\n  onEditSet,\n  onRemoveWord,\n}) => {\n  const [activeTab, setActiveTab] = useState<'manage' | 'create'>('manage');\n  const [newSetName, setNewSetName] = useState('');\n  const [newSetDescription, setNewSetDescription] = useState('');\n  const [expandedSetId, setExpandedSetId] = useState<string | null>(null);\n  const [editingSetId, setEditingSetId] = useState<string | null>(null);\n  const [editName, setEditName] = useState('');\n  const [editDescription, setEditDescription] = useState('');\n\n  if (!isOpen) return null;\n\n  const handleCreateSet = () => {\n    if (newSetName.trim()) {\n      onCreateSet(newSetName.trim(), newSetDescription.trim() || undefined);\n      setNewSetName('');\n      setNewSetDescription('');\n      setActiveTab('manage');\n    }\n  };\n\n  const handleStartEdit = (set: CustomQuestionSet) => {\n    setEditingSetId(set.id);\n    setEditName(set.name);\n    setEditDescription(set.description || '');\n  };\n\n  const handleSaveEdit = () => {\n    if (editingSetId && editName.trim()) {\n      onEditSet(editingSetId, editName.trim(), editDescription.trim() || undefined);\n      setEditingSetId(null);\n    }\n  };\n\n  const handleCancelEdit = () => {\n    setEditingSetId(null);\n    setEditName('');\n    setEditDescription('');\n  };\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 p-2 sm:p-4\">\n      <div className=\"bg-white rounded-lg shadow-2xl max-w-2xl sm:max-w-4xl w-full mx-auto max-h-[90vh] flex flex-col\">\n        {/*  */}\n        <div className=\"flex items-center justify-between p-6 border-b border-gray-200\">\n          <h2 className=\"text-2xl font-bold text-gray-900\"> </h2>\n          <button\n            onClick={onClose}\n            className=\"text-gray-500 hover:text-gray-700:text-gray-200 text-2xl\"\n            aria-label=\"\"\n          >\n            \n          </button>\n        </div>\n\n        {/*  */}\n        <div className=\"flex border-b border-gray-200\">\n          <button\n            onClick={() => setActiveTab('manage')}\n            className={`flex-1 px-6 py-3 font-medium ${\n              activeTab === 'manage'\n                ? 'text-blue-600 border-b-2 border-blue-600'\n                : 'text-gray-600 hover:text-gray-900:text-gray-200'\n            }`}\n          >\n              ({sets.length})\n          </button>\n          <button\n            onClick={() => setActiveTab('create')}\n            className={`flex-1 px-6 py-3 font-medium ${\n              activeTab === 'create'\n                ? 'text-blue-600 border-b-2 border-blue-600'\n                : 'text-gray-600 hover:text-gray-900:text-gray-200'\n            }`}\n          >\n             \n          </button>\n        </div>\n\n        {/*  */}\n        <div className=\"flex-1 overflow-y-auto p-6\">\n          {activeTab === 'manage' ? (\n            <div className=\"space-y-4\">\n              {sets.length === 0 ? (\n                <div className=\"text-center py-12 text-gray-500\">\n                  <p className=\"text-lg mb-2\"> </p>\n                  <p className=\"text-sm\"></p>\n                </div>\n              ) : (\n                sets.map((set) => (\n                  <div key={set.id} className=\"border border-gray-200 rounded-lg overflow-hidden\">\n                    {/*  */}\n                    <div className=\"bg-gray-50 p-4\">\n                      {editingSetId === set.id ? (\n                        <div className=\"space-y-2\">\n                          <input\n                            type=\"text\"\n                            value={editName}\n                            onChange={(e) => setEditName(e.target.value)}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900\"\n                            placeholder=\"\"\n                          />\n                          <textarea\n                            value={editDescription}\n                            onChange={(e) => setEditDescription(e.target.value)}\n                            className=\"w-full px-3 py-2 border border-gray-300 rounded-md bg-white text-gray-900\"\n                            placeholder=\"\"\n                            rows={2}\n                          />\n                          <div className=\"flex gap-2\">\n                            <button\n                              onClick={handleSaveEdit}\n                              className=\"px-4 py-2 bg-blue-500 text-white rounded-md hover:bg-blue-600\"\n                            >\n                              \n                            </button>\n                            <button\n                              onClick={handleCancelEdit}\n                              className=\"px-4 py-2 bg-gray-300 text-gray-900 rounded-md hover:bg-gray-400:bg-gray-500\"\n                            >\n                              \n                            </button>\n                          </div>\n                        </div>\n                      ) : (\n                        <div className=\"flex items-start justify-between\">\n                          <div className=\"flex-1\">\n                            <div className=\"flex items-center gap-2\">\n                              <span className=\"text-2xl\">{set.icon || ''}</span>\n                              <h3 className=\"text-lg font-bold text-gray-900\">{set.name}</h3>\n                              <span className=\"text-sm text-gray-500\">({set.words.length})</span>\n                            </div>\n                            {set.description && (\n                              <p className=\"text-sm text-gray-600 mt-1\">{set.description}</p>\n                            )}\n                            <p className=\"text-xs text-gray-500 mt-1\">\n                              : {new Date(set.createdAt).toLocaleDateString('ja-JP')}\n                            </p>\n                          </div>\n                          <div className=\"flex gap-2\">\n                            <button\n                              onClick={() => handleStartEdit(set)}\n                              className=\"text-blue-600 hover:text-blue-700:text-blue-300 text-sm\"\n                              aria-label=\"\"\n                            >\n                              \n                            </button>\n                            <button\n                              onClick={() =>\n                                setExpandedSetId(expandedSetId === set.id ? null : set.id)\n                              }\n                              className=\"text-gray-600 hover:text-gray-700:text-gray-300 text-sm\"\n                              aria-label={expandedSetId === set.id ? '' : ''}\n                            >\n                              {expandedSetId === set.id ? '' : ''}\n                            </button>\n                            <button\n                              onClick={() => {\n                                if (confirm(`${set.name}`)) {\n                                  onDeleteSet(set.id);\n                                }\n                              }}\n                              className=\"text-red-600 hover:text-red-700:text-red-300 text-sm\"\n                              aria-label=\"\"\n                            >\n                              \n                            </button>\n                          </div>\n                        </div>\n                      )}\n                    </div>\n\n                    {/*  */}\n                    {expandedSetId === set.id && (\n                      <div className=\"p-4 bg-white\">\n                        {set.words.length === 0 ? (\n                          <p className=\"text-sm text-gray-500 text-center py-4\">\n                            \n                          </p>\n                        ) : (\n                          <div className=\"space-y-2\">\n                            {set.words.map((word, index) => (\n                              <div\n                                key={`${word.word}-${index}`}\n                                className=\"flex items-center justify-between p-3 bg-gray-50 rounded-md\"\n                              >\n                                <div className=\"flex-1\">\n                                  <div className=\"flex items-center gap-2\">\n                                    <span className=\"font-semibold text-gray-900\">{word.word}</span>\n                                    {word.ipa && (\n                                      <span className=\"text-sm text-blue-600\">/{word.ipa}/</span>\n                                    )}\n                                  </div>\n                                  <p className=\"text-sm text-gray-700 mt-1\">{word.meaning}</p>\n                                  {word.source && (\n                                    <p className=\"text-xs text-gray-500 mt-1\">\n                                      : {word.source}\n                                      {word.sourceDetail && ` (${word.sourceDetail})`}\n                                    </p>\n                                  )}\n                                </div>\n                                <button\n                                  onClick={() => onRemoveWord(set.id, word)}\n                                  className=\"ml-4 text-red-600 hover:text-red-700:text-red-300\"\n                                  aria-label=\"\"\n                                >\n                                  \n                                </button>\n                              </div>\n                            ))}\n                          </div>\n                        )}\n                      </div>\n                    )}\n                  </div>\n                ))\n              )}\n            </div>\n          ) : (\n            <div className=\"max-w-2xl mx-auto\">\n              <div className=\"space-y-4\">\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                     <span className=\"text-red-500\">*</span>\n                  </label>\n                  <input\n                    type=\"text\"\n                    value={newSetName}\n                    onChange={(e) => setNewSetName(e.target.value)}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900\"\n                    placeholder=\": \"\n                  />\n                </div>\n                <div>\n                  <label className=\"block text-sm font-medium text-gray-700 mb-2\">\n                    \n                  </label>\n                  <textarea\n                    value={newSetDescription}\n                    onChange={(e) => setNewSetDescription(e.target.value)}\n                    className=\"w-full px-4 py-2 border border-gray-300 rounded-md bg-white text-gray-900\"\n                    placeholder=\": \"\n                    rows={3}\n                  />\n                </div>\n                <button\n                  onClick={handleCreateSet}\n                  disabled={!newSetName.trim()}\n                  className=\"w-full px-6 py-3 bg-blue-500 text-white rounded-md hover:bg-blue-600 disabled:bg-gray-300:bg-gray-600 disabled:cursor-not-allowed font-medium\"\n                >\n                   \n                </button>\n              </div>\n\n              <div className=\"mt-8 p-4 bg-blue-50 rounded-lg\">\n                <h4 className=\"font-medium text-blue-900 mb-2\"> </h4>\n                <ul className=\"text-sm text-blue-800 space-y-1\">\n                  <li> +</li>\n                  <li> </li>\n                  <li> </li>\n                </ul>\n              </div>\n            </div>\n          )}\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default FloatingPanel;\n","import { useState, useEffect, useCallback } from 'react';\nimport {\n  getStatsByModeDifficulty as _getStatsByModeDifficulty,\n  resetStatsByModeDifficulty,\n  resetAllProgress,\n  loadProgressSync,\n  getStudyCalendarData,\n  getWeeklyStats,\n  getMonthlyStats,\n  getCumulativeProgressData,\n  getRetentionTrend,\n  getWeakWords as _getWeakWords,\n  getCurrentWeakWords,\n  getOvercomeWeakWords,\n  getRecentlyMasteredWords,\n  createWeakWordsQuestionSet,\n  saveCustomQuestionSet,\n  getCustomQuestionSets,\n} from '../progressStorage';\nimport { QuestionSet, Question } from '../types';\nimport { logger } from '@/utils/logger';\nimport { formatLocalYYYYMMDD, QUIZ_RESULT_EVENT } from '../utils';\n\ninterface StatsViewProps {\n  questionSets: QuestionSet[];\n  allQuestions: Question[];\n  categoryList: string[];\n  onResetComplete?: () => void;\n  onQuestionSetsUpdated?: () => Promise<void>;\n}\n\ninterface WeakWord {\n  word: string;\n  meaning?: string;\n  reading?: string;\n  etymology?: string;\n  relatedWords?: string;\n  difficulty?: string;\n  mistakes: number;\n  recentAccuracy: number;\n}\n\nfunction StatsView({ onResetComplete, allQuestions, onQuestionSetsUpdated }: StatsViewProps) {\n  const [autoRefresh, _setAutoRefresh] = useState<boolean>(false);\n  const [storageInfo, setStorageInfo] = useState<{\n    totalMB: number;\n    details: { key: string; sizeMB: number }[];\n  } | null>(null);\n  const [hasWeakWordsSet, setHasWeakWordsSet] = useState<boolean>(false);\n\n  // \n  const [calendarData, setCalendarData] = useState<\n    Array<{ date: string; count: number; accuracy: number }>\n  >([]);\n  const [_weeklyStats, setWeeklyStats] = useState<Record<string, unknown> | null>(null);\n  const [_monthlyStats, setMonthlyStats] = useState<Record<string, unknown> | null>(null);\n  const [_cumulativeData, setCumulativeData] = useState<Record<string, unknown>[]>([]);\n  const [_retentionTrend, setRetentionTrend] = useState<Record<string, unknown> | null>(null);\n  const [weakWords, setWeakWords] = useState<WeakWord[]>([]);\n  const [_overcomeWords, setOvercomeWords] = useState<Record<string, unknown>[]>([]);\n  const [_recentlyMastered, setRecentlyMastered] = useState<Record<string, unknown>[]>([]);\n  const [_streakDays, setStreakDays] = useState<number>(0);\n\n  // LocalStorage\n  const getStorageSize = () => {\n    try {\n      let totalSize = 0;\n      const details: { key: string; sizeMB: number }[] = [];\n\n      for (let i = 0; i < localStorage.length; i++) {\n        const key = localStorage.key(i);\n        if (key) {\n          const value = localStorage.getItem(key);\n          if (value) {\n            const size = new Blob([value]).size;\n            totalSize += size;\n            details.push({ key, sizeMB: size / (1024 * 1024) });\n          }\n        }\n      }\n\n      details.sort((a, b) => b.sizeMB - a.sizeMB);\n      setStorageInfo({ totalMB: totalSize / (1024 * 1024), details: details.slice(0, 5) });\n    } catch (error) {\n      logger.error(':', error);\n    }\n  };\n\n  // \n  const loadData = useCallback(() => {\n    // 2\n    const calData = getStudyCalendarData(14);\n    setCalendarData(calData);\n    setWeeklyStats(getWeeklyStats());\n    setMonthlyStats(getMonthlyStats());\n    setCumulativeData(getCumulativeProgressData(12));\n    setRetentionTrend(getRetentionTrend());\n\n    // \n    const weakWordsBase = getCurrentWeakWords(10);\n    const weakWordsWithDetails = weakWordsBase.map((w) => {\n      const questionData = allQuestions.find(\n        (q) => q.word && w.word && q.word.toLowerCase() === w.word.toLowerCase()\n      );\n      return {\n        ...w,\n        etymology: questionData?.etymology,\n        relatedWords: questionData?.relatedWords,\n        difficulty: questionData?.difficulty,\n      };\n    });\n    setWeakWords(weakWordsWithDetails);\n\n    setOvercomeWords(getOvercomeWeakWords(10));\n    setRecentlyMastered(getRecentlyMasteredWords(7, 5));\n\n    const progress = loadProgressSync();\n    setStreakDays(progress.statistics.streakDays);\n\n    getStorageSize();\n  }, [allQuestions]);\n\n  // \n  useEffect(() => {\n    loadData();\n\n    // \n    const checkWeakWordsSet = async () => {\n      const sets = await getCustomQuestionSets();\n      const hasSet = sets.some((s) => s.source === 'weak-words');\n      setHasWeakWordsSet(hasSet);\n    };\n    checkWeakWordsSet();\n\n    // \n    const onQuizResultAdded = () => {\n      loadData();\n      checkWeakWordsSet();\n    };\n    if (typeof window !== 'undefined') {\n      window.addEventListener(QUIZ_RESULT_EVENT, onQuizResultAdded as EventListener);\n    }\n\n    if (autoRefresh) {\n      const interval = setInterval(() => {\n        loadData();\n        checkWeakWordsSet();\n      }, 1000); // 1\n      return () => {\n        clearInterval(interval);\n        if (typeof window !== 'undefined') {\n          window.removeEventListener(QUIZ_RESULT_EVENT, onQuizResultAdded as EventListener);\n        }\n      };\n    }\n\n    // autoRefresh\n    return () => {\n      if (typeof window !== 'undefined') {\n        window.removeEventListener(QUIZ_RESULT_EVENT, onQuizResultAdded as EventListener);\n      }\n    };\n  }, [autoRefresh, loadData]);\n\n  // \n  const _handleResetByDifficulty = (mode: 'translation' | 'spelling', difficulty: string) => {\n    const modeName = mode === 'translation' ? '' : '';\n    const difficultyName =\n      difficulty === 'beginner' ? '' : difficulty === 'intermediate' ? '' : '';\n\n    if (\n      confirm(`${modeName}${difficultyName}`)\n    ) {\n      resetStatsByModeDifficulty(mode, difficulty);\n      alert('');\n      loadData();\n    }\n  };\n\n  // \n  const handleResetAll = () => {\n    if (confirm('')) {\n      // resetAllProgress\n      resetAllProgress();\n\n      // UI\n      setCalendarData([]);\n      setWeeklyStats(null);\n      setMonthlyStats(null);\n      setCumulativeData([]);\n      setRetentionTrend(null);\n      setWeakWords([]);\n      setOvercomeWords([]);\n      setRecentlyMastered([]);\n      setStreakDays(0);\n\n      alert('');\n      loadData(); // \n\n      // \n      if (onResetComplete) {\n        onResetComplete();\n      }\n    }\n  };\n\n  return (\n    <div className=\"stats-view\">\n      {/*  */}\n      <div className=\"w-full mb-4 px-2\">\n        <h3 className=\"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2\">\n           \n          <span className=\"text-sm font-normal text-gray-500\">12</span>\n        </h3>\n        <CalendarHeatmap data={calendarData} />\n      </div>\n\n      {/* 10 */}\n      <div className=\"w-full mb-4 px-2\">\n        <h3 className=\"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2\">\n           10\n          <span className=\"text-sm font-normal text-gray-500\"></span>\n        </h3>\n        {weakWords.length > 0 ? (\n          <div className=\"bg-white rounded-xl shadow-lg border-2 border-orange-200 p-6\">\n            <ul className=\"space-y-3\">\n              {weakWords.map((w, idx) => (\n                <li\n                  key={idx}\n                  className=\"p-4 bg-gradient-to-r from-orange-50 to-red-50/30/30 rounded-lg border border-orange-200 hover:shadow-md hover:scale-[1.02] transition-all duration-200\"\n                >\n                  <div className=\"flex items-center justify-between mb-2\">\n                    <div className=\"flex items-center gap-4 flex-1\">\n                      <span className=\"flex items-center justify-center w-8 h-8 bg-orange-500 text-white font-bold rounded-full text-sm\">\n                        {idx + 1}\n                      </span>\n                      <div className=\"flex flex-col\">\n                        <span className=\"text-lg font-semibold text-gray-800\">{w.word}</span>\n                        {w.meaning && (\n                          <span className=\"text-sm text-gray-600 mt-1\">{w.meaning}</span>\n                        )}\n                        {w.reading && (\n                          <span className=\"text-xs text-gray-500 mt-0.5\">{w.reading}</span>\n                        )}\n                        {w.etymology && (\n                          <span className=\"text-xs text-blue-600 mt-1\"> {w.etymology}</span>\n                        )}\n                        {w.relatedWords && (\n                          <span className=\"text-xs text-purple-600 mt-0.5\">\n                             {w.relatedWords}\n                          </span>\n                        )}\n                      </div>\n                    </div>\n                    <div className=\"flex items-center gap-3 text-sm\">\n                      <span className=\"px-3 py-1 bg-red-100/50 text-red-700 rounded-full font-medium\">\n                         {w.mistakes}\n                      </span>\n                      {w.recentAccuracy > 0 && (\n                        <span className=\"px-3 py-1 bg-blue-100/50 text-blue-700 rounded-full font-medium\">\n                           {w.recentAccuracy}%\n                        </span>\n                      )}\n                    </div>\n                  </div>\n                </li>\n              ))}\n            </ul>\n            {/*  */}\n            <div className=\"mt-6 flex gap-3\">\n              <button\n                onClick={async () => {\n                  try {\n                    const questionSet = await createWeakWordsQuestionSet(\n                      ` ${new Date().toLocaleDateString('ja-JP')}`,\n                      20,\n                      3,\n                      60,\n                      allQuestions\n                    );\n                    await saveCustomQuestionSet(questionSet);\n                    setHasWeakWordsSet(true);\n\n                    // \n                    if (onQuestionSetsUpdated) {\n                      await onQuestionSetsUpdated();\n                    }\n\n                    alert(\n                      ` ${questionSet.name}${hasWeakWordsSet ? '' : ''}\\n`\n                    );\n                  } catch (error) {\n                    logger.error(':', error);\n                    alert(' ');\n                  }\n                }}\n                className=\"flex-1 px-6 py-3 bg-gradient-to-r from-orange-500 to-red-500 hover:from-orange-600 hover:to-red-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200 flex items-center justify-center gap-2\"\n              >\n                 {hasWeakWordsSet ? '' : ''}\n                <span className=\"text-xs opacity-90\">(20)</span>\n              </button>\n              <button\n                onClick={async () => {\n                  const limit = prompt('1-100', '30');\n                  if (!limit) return;\n\n                  const numLimit = parseInt(limit);\n                  if (isNaN(numLimit) || numLimit < 1 || numLimit > 100) {\n                    alert('1100');\n                    return;\n                  }\n\n                  try {\n                    const questionSet = await createWeakWordsQuestionSet(\n                      ` ${new Date().toLocaleDateString('ja-JP')} (${numLimit})`,\n                      numLimit,\n                      3,\n                      60,\n                      allQuestions\n                    );\n                    await saveCustomQuestionSet(questionSet);\n                    setHasWeakWordsSet(true);\n\n                    // \n                    if (onQuestionSetsUpdated) {\n                      await onQuestionSetsUpdated();\n                    }\n\n                    alert(\n                      ` ${questionSet.name}${hasWeakWordsSet ? '' : ''}\\n`\n                    );\n                  } catch (error) {\n                    logger.error(':', error);\n                    alert(' ');\n                  }\n                }}\n                className=\"px-6 py-3 bg-gradient-to-r from-blue-500 to-purple-500 hover:from-blue-600 hover:to-purple-600 text-white font-semibold rounded-lg shadow-lg hover:shadow-xl transition-all duration-200\"\n              >\n                 \n              </button>\n            </div>\n          </div>\n        ) : (\n          <div className=\"bg-gradient-to-br from-green-50 to-emerald-50/20/20 rounded-xl border-2 border-dashed border-green-300 p-8 text-center\">\n            <p className=\"text-xl font-semibold text-green-700\"></p>\n            <p className=\"text-sm text-green-600 mt-2\"></p>\n          </div>\n        )}\n      </div>\n\n      {/*  */}\n      <div className=\"w-full mb-4 px-2\">\n        <div className=\"bg-white rounded-xl shadow-lg border-2 border-red-200 p-6\">\n          <div className=\"flex items-center justify-between\">\n            <div>\n              <h3 className=\"text-xl font-bold text-gray-800 mb-2 flex items-center gap-2\">\n                 \n              </h3>\n              <p className=\"text-sm text-gray-600\">\n                \n              </p>\n            </div>\n            <button\n              onClick={handleResetAll}\n              className=\"px-8 py-3 bg-red-600 hover:bg-red-700:bg-red-800 text-white font-bold rounded-lg shadow-md hover:shadow-lg transform hover:scale-105 transition-all duration-200 flex items-center gap-2\"\n            >\n               \n            </button>\n          </div>\n        </div>\n      </div>\n\n      {/*  */}\n      {storageInfo && (\n        <div className=\"w-full mb-4 px-2\">\n          <h3 className=\"text-2xl font-bold text-gray-800 mb-2 flex items-center gap-2\">\n             \n          </h3>\n          <div className=\"bg-white rounded-xl shadow-lg border-2 border-purple-200 p-6\">\n            <div className=\"mb-4\">\n              <div className=\"flex items-center justify-between mb-2\">\n                <span className=\"text-lg font-semibold text-gray-800\"></span>\n                <span\n                  className={`text-xl font-bold ${storageInfo.totalMB > 4 ? 'text-red-600' : 'text-green-600'}`}\n                >\n                  {storageInfo.totalMB.toFixed(2)} MB{' '}\n                  <span className=\"text-sm font-normal text-gray-500\">/  5-10 MB</span>\n                </span>\n              </div>\n              <div className=\"w-full bg-gray-200 rounded-full h-4 overflow-hidden relative\">\n                <div\n                  className={`h-full rounded-full transition-all duration-500 absolute left-0 top-0 ${\n                    storageInfo.totalMB > 8\n                      ? 'bg-red-600 w-full'\n                      : storageInfo.totalMB > 4\n                        ? 'bg-yellow-500'\n                        : 'bg-green-500'\n                  }`}\n                  data-progress={Math.min((storageInfo.totalMB / 10) * 100, 100)}\n                />\n              </div>\n              {storageInfo.totalMB > 4 && (\n                <p className=\"mt-2 text-sm font-medium text-red-600 flex items-center gap-1\">\n                   \n                </p>\n              )}\n            </div>\n            <details className=\"mt-4\">\n              <summary className=\"cursor-pointer text-blue-600 hover:text-blue-700:text-blue-300 font-medium flex items-center gap-2\">\n                 \n              </summary>\n              <ul className=\"mt-4 space-y-2\">\n                {storageInfo.details.map((item, idx) => (\n                  <li\n                    key={idx}\n                    className=\"flex items-center justify-between p-3 bg-gray-50 rounded-lg\"\n                  >\n                    <code className=\"text-sm text-gray-700 font-mono\">{item.key}</code>\n                    <span className=\"text-sm font-semibold text-gray-800\">\n                      {item.sizeMB.toFixed(2)} MB\n                    </span>\n                  </li>\n                ))}\n              </ul>\n              <div className=\"mt-4 p-4 bg-blue-50/20 rounded-lg border border-blue-200\">\n                <p className=\"text-sm text-blue-700 flex items-start gap-2\">\n                  <span className=\"text-lg\"></span>\n                  <span>\n                    : \n                  </span>\n                </p>\n              </div>\n            </details>\n          </div>\n        </div>\n      )}\n    </div>\n  );\n}\n\n// 2\nfunction CalendarHeatmap({\n  data,\n}: {\n  data: Array<{ date: string; count: number; accuracy: number }>;\n}) {\n  // (YYYY-MM-DD)\n  const today = new Date();\n  today.setHours(0, 0, 0, 0);\n  const todayStr = formatLocalYYYYMMDD(today);\n\n  // \n  const todayData = data.find((d) => d.date === todayStr);\n\n  if (data.length === 0) {\n    return (\n      <div className=\"w-full p-8 bg-gray-50 rounded-xl border-2 border-dashed border-gray-300 text-center\">\n        <p className=\"text-gray-500 text-lg\"> </p>\n        <p className=\"text-gray-400 text-sm mt-2\"></p>\n        <p className=\"text-xs text-red-500 mt-4\">\n          DEBUG: ={todayStr}, ={data.length}, =\n          {todayData ? `${todayData.count}` : ''}\n        </p>\n      </div>\n    );\n  }\n\n  // 2(14)\n  const twoWeeksAgo = new Date(today);\n  twoWeeksAgo.setDate(twoWeeksAgo.getDate() - 13); // 14\n\n  // \n  const dataMap = new Map(data.map((d) => [d.date, d]));\n\n  // 27  2\n  const weeks: Array<\n    Array<{ date: string; count: number; accuracy: number; correct: number } | null>\n  > = [[], []];\n\n  //  \n  const mondayThisWeek = new Date(today);\n  const dow = mondayThisWeek.getDay();\n  const diffToMonday2 = dow === 0 ? 6 : dow - 1; // (0)6\n  mondayThisWeek.setDate(mondayThisWeek.getDate() - diffToMonday2);\n  // 2\n  const firstDate = new Date(mondayThisWeek);\n  firstDate.setDate(firstDate.getDate() - 7);\n\n  const currentDate = new Date(firstDate);\n\n  // 2\n  for (let week = 0; week < 2; week++) {\n    for (let day = 0; day < 7; day++) {\n      const dateStr = formatLocalYYYYMMDD(currentDate);\n      const dayData = dataMap.get(dateStr);\n\n      // currentDate\n      const normalizedCurrentDate = new Date(currentDate);\n      normalizedCurrentDate.setHours(0, 0, 0, 0);\n\n      // null\n      if (normalizedCurrentDate.getTime() > today.getTime()) {\n        weeks[week].push(null);\n      } else {\n        // (count * accuracy / 100)\n        const correct = dayData ? Math.round((dayData.count * dayData.accuracy) / 100) : 0;\n        const cellData = dayData\n          ? { ...dayData, correct }\n          : { date: dateStr, count: 0, accuracy: 0, correct: 0 };\n        weeks[week].push(cellData);\n      }\n      currentDate.setDate(currentDate.getDate() + 1);\n    }\n  }\n\n  // \n  const getColorClass = (count: number) => {\n    if (count === 0) return 'calendar-color-0';\n    if (count < 10) return 'calendar-color-1';\n    if (count < 20) return 'calendar-color-2';\n    if (count < 30) return 'calendar-color-3';\n    return 'calendar-color-4';\n  };\n\n  const dayLabels = ['', '', '', '', '', '', ''];\n\n  return (\n    <div className=\"w-full p-6 bg-white rounded-xl shadow-lg border-2 border-blue-200\">\n      {/*  */}\n      <div className=\"overflow-x-auto\">\n        <div className=\"min-w-max mx-auto w-fit\">\n          {/*  */}\n          <div className=\"flex gap-2 mb-2\">\n            {dayLabels.map((label, idx) => (\n              <div\n                key={idx}\n                className=\"w-20 h-8 flex items-center justify-center text-sm font-bold text-gray-700\"\n              >\n                {label}\n              </div>\n            ))}\n          </div>\n\n          {/*  - 2 */}\n          <div className=\"flex flex-col gap-2\">\n            {weeks.map((week, weekIdx) => (\n              <div key={weekIdx} className=\"flex gap-2\">\n                {week.map((day, dayIdx) => {\n                  if (!day) {\n                    return (\n                      <div\n                        key={dayIdx}\n                        className=\"w-20 h-20 rounded bg-gray-100 border border-dashed border-gray-300\"\n                      ></div>\n                    );\n                  }\n\n                  const date = new Date(day.date);\n                  const dayName = ['', '', '', '', '', '', ''][date.getDay()];\n                  const isToday = day.date === todayStr;\n                  const colorClasses = {\n                    'calendar-color-0': 'bg-gray-200 text-gray-500',\n                    'calendar-color-1': 'bg-blue-300 text-blue-900',\n                    'calendar-color-2': 'bg-blue-400 text-white',\n                    'calendar-color-3': 'bg-blue-500 text-white',\n                    'calendar-color-4': 'bg-blue-600 text-white',\n                  };\n\n                  return (\n                    <div\n                      key={dayIdx}\n                      className={`w-20 h-20 rounded-lg flex items-center justify-center text-xs font-bold transition-all duration-200 hover:scale-105 hover:shadow-xl cursor-pointer border-2 ${\n                        colorClasses[getColorClass(day.count) as keyof typeof colorClasses]\n                      } ${\n                        isToday\n                          ? 'ring-4 ring-yellow-400 ring-offset-2 ring-offset-white shadow-2xl border-yellow-400'\n                          : 'border-transparent'\n                      }`}\n                      title={`${day.date} (${dayName})${isToday ? ' []' : ''}: ${day.count} (${day.accuracy.toFixed(0)}%, ${day.correct})`}\n                    >\n                      <div className=\"flex items-center gap-1\">\n                        <span className=\"text-base\">{day.correct}</span>\n                        <span className=\"text-[10px] opacity-80\">/</span>\n                        <span className=\"text-sm\">{day.count}</span>\n                      </div>\n                    </div>\n                  );\n                })}\n              </div>\n            ))}\n          </div>\n        </div>\n      </div>\n\n      {/*  */}\n      <div className=\"flex flex-col gap-2 mt-6 text-sm\">\n        <div className=\"flex items-center justify-center gap-3 text-gray-600\">\n          <span className=\"font-medium\">:</span>\n          <span className=\"text-xs\"></span>\n          <div className=\"w-8 h-8 rounded bg-blue-300 border border-gray-300\"></div>\n          <div className=\"w-8 h-8 rounded bg-blue-400 border border-gray-300\"></div>\n          <div className=\"w-8 h-8 rounded bg-blue-500 border border-gray-300\"></div>\n          <div className=\"w-8 h-8 rounded bg-blue-600 border border-gray-300\"></div>\n          <span className=\"text-xs\"></span>\n        </div>\n        <div className=\"text-center text-xs text-gray-500\">\n          <span className=\"font-semibold\">:</span> / |\n          <span className=\"ml-2 inline-block w-6 h-6 rounded bg-gray-200 border-2 border-yellow-400 align-middle\"></span>\n          <span className=\"ml-1\">= </span>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default StatsView;\n","import { useState, useEffect } from 'react';\nimport { logger } from '@/utils/logger';\nimport type { LearningSchedule, DailyStudyPlan, Question } from '../types';\nimport { generateDailyPlan, calculateProgress, calculateWeeklyAchievement } from '../utils';\n\ninterface LearningPlanViewProps {\n  allQuestions: Question[];\n  onStartSession: (mode: 'morning' | 'afternoon' | 'evening', questions: Question[]) => void;\n}\n\nfunction LearningPlanView({ allQuestions, onStartSession }: LearningPlanViewProps) {\n  const [schedule, setSchedule] = useState<LearningSchedule | null>(null);\n  const [dailyPlan, setDailyPlan] = useState<DailyStudyPlan | null>(null);\n  const [_selectedMonths] = useState<number>(3);\n  const [progress, setProgress] = useState({\n    totalLearned: 0,\n    totalReviewed: 0,\n    averageAccuracy: 0,\n    estimatedCompletion: 90,\n  });\n\n  useEffect(() => {\n    // \n    const saved = localStorage.getItem('learning-schedule-90days');\n    if (saved) {\n      try {\n        const parsed = JSON.parse(saved) as LearningSchedule;\n\n        // \n        const daysPassed = Math.floor((Date.now() - parsed.startDate) / (1000 * 60 * 60 * 24));\n        const totalDays = parsed.totalDays;\n        parsed.currentDay = Math.min(daysPassed + 1, totalDays);\n\n        // \n        const phase1End = Math.floor(totalDays / 3);\n        const phase2End = Math.floor((totalDays * 2) / 3);\n        parsed.phase = parsed.currentDay <= phase1End ? 1 : parsed.currentDay <= phase2End ? 2 : 3;\n\n        setSchedule(parsed);\n        setDailyPlan(generateDailyPlan(parsed, allQuestions));\n      } catch (error) {\n        logger.error('Failed to load schedule:', error);\n      }\n    }\n  }, [allQuestions]);\n\n  useEffect(() => {\n    if (schedule) {\n      setProgress(calculateProgress(schedule));\n\n      // width\n      const progressBar = document.querySelector('.progress-bar') as HTMLElement;\n      if (progressBar) {\n        const dayNumber = schedule.currentDay;\n        const totalDays = schedule.totalDays;\n        const progressPercent = (dayNumber / totalDays) * 100;\n        progressBar.style.width = `${progressPercent}%`;\n      }\n    }\n  }, [schedule]);\n\n  const _handleResetPlan = () => {\n    const monthsLabel =\n      schedule?.planDurationMonths === 1\n        ? '1'\n        : schedule?.planDurationMonths === 2\n          ? '2'\n          : schedule?.planDurationMonths === 6\n            ? '6'\n            : '3';\n    if (\n      confirm(\n        `${monthsLabel}`\n      )\n    ) {\n      localStorage.removeItem('learning-schedule-90days');\n      setSchedule(null);\n      setDailyPlan(null);\n    }\n  };\n\n  if (!schedule) {\n    return null; // UI\n  }\n\n  const phaseNames = ['', '', ''];\n  const phase = schedule.phase;\n  const dayNumber = schedule.currentDay;\n  const totalDays = schedule.totalDays;\n  const progressPercent = (dayNumber / totalDays) * 100;\n  const weeklyAchievement = calculateWeeklyAchievement(schedule);\n\n  return (\n    <div className=\"learning-plan-dashboard\">\n      {/*  */}\n      <div className=\"dashboard-header\">\n        <div className=\"day-counter\">\n          <span className=\"day-number\">{dayNumber}</span>\n          <span className=\"day-label\">/ {totalDays}</span>\n        </div>\n\n        <div className=\"phase-indicator\">\n          <span className={`phase-badge phase-${phase}`}>Phase {phase}</span>\n          <span className=\"phase-name\">{phaseNames[phase - 1]}</span>\n        </div>\n\n        <div className=\"progress-bar-container\">\n          <div className={`progress-bar phase-${phase}`} />\n          <span className=\"progress-label\">{progressPercent.toFixed(1)}%</span>\n        </div>\n      </div>\n\n      {/*  */}\n      <div className=\"stats-summary\">\n        <div className=\"stat-card\">\n          <div className=\"stat-icon\"></div>\n          <div className=\"stat-value\">{progress.totalLearned}</div>\n          <div className=\"stat-label\"></div>\n        </div>\n\n        <div className=\"stat-card\">\n          <div className=\"stat-icon\"></div>\n          <div className=\"stat-value\">{progress.averageAccuracy.toFixed(1)}%</div>\n          <div className=\"stat-label\"></div>\n        </div>\n\n        <div className=\"stat-card\">\n          <div className=\"stat-icon\"></div>\n          <div className=\"stat-value\">\n            {weeklyAchievement > 0 ? weeklyAchievement.toFixed(0) : 0}%\n          </div>\n          <div className=\"stat-label\"></div>\n        </div>\n\n        <div className=\"stat-card\">\n          <div className=\"stat-icon\"></div>\n          <div className=\"stat-value\">{progress.estimatedCompletion}</div>\n          <div className=\"stat-label\"></div>\n        </div>\n      </div>\n\n      {/*  */}\n      {dailyPlan && (\n        <div className=\"today-plan\">\n          <h2> Day {dayNumber}</h2>\n\n          <div className=\"session-cards\">\n            {/*  */}\n            <div className=\"session-card morning\">\n              <div className=\"session-header\">\n                <span className=\"session-icon\"></span>\n                <div className=\"session-info\">\n                  <h3></h3>\n                  <p>{dailyPlan.morning.newWords.length}  20</p>\n                </div>\n              </div>\n              <button\n                onClick={() => onStartSession('morning', dailyPlan.morning.newWords)}\n                className=\"btn-start-session\"\n                disabled={dailyPlan.morning.newWords.length === 0}\n              >\n                {dailyPlan.morning.newWords.length === 0 ? '' : ''}\n              </button>\n            </div>\n\n            {/*  */}\n            <div className=\"session-card afternoon\">\n              <div className=\"session-header\">\n                <span className=\"session-icon\"></span>\n                <div className=\"session-info\">\n                  <h3></h3>\n                  <p>{dailyPlan.afternoon.reviewWords.length}  15</p>\n                </div>\n              </div>\n              <button\n                onClick={() => onStartSession('afternoon', dailyPlan.afternoon.reviewWords)}\n                className=\"btn-start-session\"\n                disabled={dailyPlan.afternoon.reviewWords.length === 0}\n              >\n                {dailyPlan.afternoon.reviewWords.length === 0 ? '' : ''}\n              </button>\n            </div>\n\n            {/*  */}\n            <div className=\"session-card evening\">\n              <div className=\"session-header\">\n                <span className=\"session-icon\"></span>\n                <div className=\"session-info\">\n                  <h3></h3>\n                  <p>{dailyPlan.evening.mixedWords.length}  20</p>\n                </div>\n              </div>\n              <button\n                onClick={() => onStartSession('evening', dailyPlan.evening.mixedWords)}\n                className=\"btn-start-session\"\n                disabled={dailyPlan.evening.mixedWords.length === 0}\n              >\n                {dailyPlan.evening.mixedWords.length === 0 ? '' : ''}\n              </button>\n            </div>\n          </div>\n        </div>\n      )}\n\n      {/*  */}\n      <div className=\"milestones\">\n        <h2> </h2>\n        <div className=\"milestone-list\">\n          {schedule.milestones.map((milestone, index) => {\n            const isPassed = dayNumber > milestone.day;\n            const isCurrent = dayNumber === milestone.day;\n            const isAchieved = progress.totalLearned >= milestone.wordsTarget;\n\n            return (\n              <div\n                key={index}\n                className={`milestone-item ${isAchieved ? 'achieved' : ''} ${isCurrent ? 'current' : ''} ${isPassed ? 'passed' : ''}`}\n              >\n                <div className=\"milestone-day\">Day {milestone.day}</div>\n                <div className=\"milestone-title\">{milestone.title}</div>\n                <div className=\"milestone-target\">{milestone.wordsTarget}</div>\n                {isAchieved && <span className=\"check-mark\"></span>}\n              </div>\n            );\n          })}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default LearningPlanView;\n","import { useState, useEffect } from 'react';\nimport type { Question, AIPersonality } from '../types';\nimport type { DataSource } from '../App';\nimport type { CustomQuestionSet } from '../types/customQuestions';\nimport LearningPlanView from './LearningPlanView';\nimport { PERSONALITY_INFO } from '../aiCommentGenerator';\n\ninterface SettingsViewProps {\n  allQuestions: Question[];\n  onStartSession: (mode: 'morning' | 'afternoon' | 'evening', questions: Question[]) => void;\n  _selectedDataSource?: DataSource;\n  _onDataSourceChange?: (source: DataSource) => void;\n  customQuestionSets: CustomQuestionSet[];\n  onOpenCustomSetManagement: () => void;\n}\n\nfunction SettingsView({\n  allQuestions,\n  onStartSession,\n  _selectedDataSource = 'all',\n  _onDataSourceChange,\n  customQuestionSets,\n  onOpenCustomSetManagement,\n}: SettingsViewProps) {\n  // localStorage\n  const [batchSize, setBatchSize] = useState<number>(() => {\n    const saved = localStorage.getItem('batchSize');\n    return saved ? parseInt(saved, 10) : 20;\n  });\n\n  // AI\n  const [aiPersonality, setAIPersonality] = useState<AIPersonality>(() => {\n    const saved = localStorage.getItem('aiPersonality');\n    return (saved as AIPersonality) || 'kind-teacher';\n  });\n\n  // localStorage\n  const handleBatchSizeChange = (newSize: number) => {\n    setBatchSize(newSize);\n    localStorage.setItem('batchSize', newSize.toString());\n  };\n\n  // \n  void handleBatchSizeChange; // ESLint\n\n  // AIlocalStorage\n  const handlePersonalityChange = (personality: AIPersonality) => {\n    setAIPersonality(personality);\n    localStorage.setItem('aiPersonality', personality);\n  };\n\n  // \n  const [voiceGender, setVoiceGender] = useState<'female' | 'male'>(() => {\n    const saved = localStorage.getItem('voiceGender');\n    return saved === 'female' || saved === 'male' ? saved : 'female'; // \n  });\n\n  const [speechRate, setSpeechRate] = useState<number>(() => {\n    const saved = localStorage.getItem('speechRate');\n    return saved ? parseFloat(saved) : 0.9; // \n  });\n\n  // localStorage\n  const handleVoiceGenderChange = (gender: 'female' | 'male') => {\n    setVoiceGender(gender);\n    localStorage.setItem('voiceGender', gender);\n  };\n\n  // localStorage\n  const handleSpeechRateChange = (rate: number) => {\n    setSpeechRate(rate);\n    localStorage.setItem('speechRate', rate.toString());\n  };\n\n  // \n  const [darkMode, setDarkMode] = useState<'light' | 'dark' | 'system'>(() => {\n    const saved = localStorage.getItem('darkMode');\n    if (saved === 'system' || saved === 'light' || saved === 'dark') {\n      return saved;\n    }\n    // boolean\n    if (saved === 'true') return 'dark';\n    if (saved === 'false') return 'light';\n    return 'system';\n  });\n\n  // Tailwinddark\n  const applyDarkMode = (mode: 'light' | 'dark' | 'system') => {\n    let isDark = false;\n    if (mode === 'system') {\n      isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n    } else {\n      isDark = mode === 'dark';\n    }\n    // Tailwinddark\n    document.documentElement.classList.toggle('dark', isDark);\n  };\n\n  // localStorage\n  const _handleDarkModeChange = (mode: 'light' | 'dark' | 'system') => {\n    setDarkMode(mode);\n    localStorage.setItem('darkMode', mode);\n    applyDarkMode(mode);\n  };\n\n  // \n  useEffect(() => {\n    // main.tsx\n    applyDarkMode(darkMode);\n\n    // system\n    if (darkMode === 'system') {\n      const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n      const handleChange = () => {\n        applyDarkMode('system');\n      };\n      mediaQuery.addEventListener('change', handleChange);\n      return () => mediaQuery.removeEventListener('change', handleChange);\n    }\n  }, [darkMode]);\n\n  const _totalWords = allQuestions.length;\n  const estimatedDays = Math.ceil(_totalWords / batchSize);\n  const _estimatedDaysText = `${estimatedDays}`;\n\n  return (\n    <div className=\"w-full px-4 py-6 space-y-6\">\n      {/*  */}\n      <div className=\"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border\">\n        <h3 className=\"text-xl font-bold text-text-color mb-4 flex items-center gap-2\">\n          <span></span>\n          <span></span>\n          <span className=\"text-sm font-normal text-text-secondary\">\n            ({customQuestionSets.length})\n          </span>\n        </h3>\n        <div className=\"space-y-3\">\n          <button\n            onClick={onOpenCustomSetManagement}\n            className=\"w-full px-6 py-4 bg-gradient-to-r from-purple-500 to-pink-500 text-white text-center rounded-lg font-semibold hover:from-purple-600 hover:to-pink-600 transition-all shadow-md flex items-center justify-center gap-2\"\n          >\n            <span></span>\n            <span></span>\n          </button>\n          <p className=\"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg\">\n            \n            \n          </p>\n        </div>\n      </div>\n\n      {/*  */}\n      <LearningPlanView allQuestions={allQuestions} onStartSession={onStartSession} />\n\n      {/* AI */}\n      <div className=\"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border\">\n        <h3 className=\"text-xl font-bold text-text-color mb-4 flex items-center gap-2\">\n          <span></span>\n          <span>AI</span>\n        </h3>\n        <div className=\"grid grid-cols-2 md:grid-cols-3 gap-3\">\n          {(\n            Object.entries(PERSONALITY_INFO) as [\n              AIPersonality,\n              (typeof PERSONALITY_INFO)[AIPersonality],\n            ][]\n          ).map(([key, info]) => (\n            <button\n              key={key}\n              className={`flex flex-col items-center gap-2 p-4 rounded-lg border-2 transition-all duration-200 ${\n                aiPersonality === key\n                  ? 'bg-primary border-primary text-white shadow-lg scale-105'\n                  : 'bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md hover:scale-102'\n              }`}\n              onClick={() => handlePersonalityChange(key)}\n            >\n              <div className=\"text-3xl\">{info.avatar}</div>\n              <div className=\"font-semibold text-sm\">{info.name}</div>\n              <div className=\"text-xs opacity-80 text-center\">{info.description}</div>\n            </button>\n          ))}\n        </div>\n      </div>\n\n      {/*\n         - \n        ---\n        \n        darkMode state, applyDarkMode, handleDarkModeChange\n        src/components/SettingsView.tsx \n        \n\n        :\n        - SettingsView.tsx (L71-115): darkMode state & logic\n        - App.tsx (L273-287): applyDarkMode logic\n        - main.tsx (L8-36): initialization logic\n        - src/styles/themes/dark.css: CSS variables (will be used)\n      */}\n\n      {/*  */}\n      <div className=\"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border\">\n        <h3 className=\"text-xl font-bold text-text-color mb-4 flex items-center gap-2\">\n          <span></span>\n          <span></span>\n        </h3>\n\n        {/*  */}\n        <div className=\"mb-6\">\n          <h4 className=\"text-base font-semibold text-text-color mb-3 flex items-center gap-2\">\n            <span></span>\n            <span></span>\n          </h4>\n          <div className=\"grid grid-cols-2 gap-3\">\n            <button\n              className={`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${\n                voiceGender === 'female'\n                  ? 'bg-primary border-primary text-white shadow-lg scale-105'\n                  : 'bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md'\n              }`}\n              onClick={() => handleVoiceGenderChange('female')}\n            >\n              <div className=\"text-3xl\"></div>\n              <div className=\"text-sm font-semibold\"></div>\n            </button>\n            <button\n              className={`flex flex-col items-center gap-2 px-4 py-4 rounded-lg border-2 transition-all duration-200 ${\n                voiceGender === 'male'\n                  ? 'bg-primary border-primary text-white shadow-lg scale-105'\n                  : 'bg-bg-secondary border-border-color text-text-color hover:border-primary hover:shadow-md'\n              }`}\n              onClick={() => handleVoiceGenderChange('male')}\n            >\n              <div className=\"text-3xl\"></div>\n              <div className=\"text-sm font-semibold\"></div>\n            </button>\n          </div>\n        </div>\n\n        {/*  */}\n        <div>\n          <h4 className=\"text-base font-semibold text-text-color mb-3 flex items-center gap-2\">\n            <span></span>\n            <span></span>\n            <span className=\"text-xs font-normal text-text-secondary\">(WPM: Words Per Minute)</span>\n          </h4>\n          <div className=\"bg-bg-secondary rounded-lg p-6\">\n            {/*  */}\n            <div className=\"text-center mb-6\">\n              <div className=\"font-bold text-primary text-4xl mb-1\">\n                {Math.round(speechRate * 150)}\n              </div>\n              <div className=\"text-sm text-text-secondary\">WPM</div>\n              <div className=\"text-xs text-text-secondary mt-2\">\n                {speechRate < 0.75\n                  ? ' '\n                  : speechRate >= 0.95\n                    ? ' '\n                    : ' '}\n              </div>\n            </div>\n\n            {/*  */}\n            <div className=\"relative mb-8\">\n              <input\n                type=\"range\"\n                min=\"0.6\"\n                max=\"1.0\"\n                step=\"0.05\"\n                value={speechRate}\n                onChange={(e) => handleSpeechRateChange(parseFloat(e.target.value))}\n                className=\"w-full h-3 bg-border-color rounded-lg appearance-none cursor-pointer accent-primary\"\n                aria-label=\"\"\n              />\n              {/*  */}\n              <div className=\"absolute top-0 left-0 w-full h-3 pointer-events-none\">\n                {/* 0.6 (90 WPM) -  (0%) */}\n                <div className=\"absolute top-1/2 left-0 -translate-y-1/2 w-0.5 h-5 bg-gray-400\"></div>\n                {/* 0.75 (113 WPM) -  (37.5%: (0.75-0.6)/(1.0-0.6) = 0.15/0.4 = 0.375) */}\n                <div className=\"absolute top-1/2 left-[37.5%] -translate-y-1/2 w-0.5 h-5 bg-blue-500\"></div>\n                {/* 0.9 (135 WPM) -  (75%: (0.9-0.6)/(1.0-0.6) = 0.3/0.4 = 0.75) */}\n                <div className=\"absolute top-1/2 left-[75%] -translate-y-1/2 w-0.5 h-5 bg-green-500\"></div>\n                {/* 1.0 (150 WPM) -  (100%) */}\n                <div className=\"absolute top-1/2 left-full -translate-y-1/2 -translate-x-0.5 w-0.5 h-5 bg-orange-500\"></div>\n              </div>\n            </div>\n\n            {/*  */}\n            <div className=\"grid grid-cols-4 gap-2 text-center text-xs\">\n              <button\n                onClick={() => handleSpeechRateChange(0.6)}\n                className=\"bg-gray-50/50 rounded-lg p-3 border border-gray-200 hover:bg-gray-100:bg-gray-700/50 transition-colors cursor-pointer\"\n              >\n                <div className=\"font-bold text-gray-600\">90 WPM</div>\n                <div className=\"text-gray-500 mt-1\"></div>\n              </button>\n              <button\n                onClick={() => handleSpeechRateChange(0.75)}\n                className=\"bg-blue-50/20 rounded-lg p-3 border border-blue-200 hover:bg-blue-100:bg-blue-800/30 transition-colors cursor-pointer\"\n              >\n                <div className=\"font-bold text-blue-600\">113 WPM</div>\n                <div className=\"text-blue-500 mt-1\"></div>\n              </button>\n              <button\n                onClick={() => handleSpeechRateChange(0.9)}\n                className=\"bg-green-50/20 rounded-lg p-3 border border-green-200 hover:bg-green-100:bg-green-800/30 transition-colors cursor-pointer\"\n              >\n                <div className=\"font-bold text-green-600\">135 WPM</div>\n                <div className=\"text-green-500 mt-1\"></div>\n              </button>\n              <button\n                onClick={() => handleSpeechRateChange(1.0)}\n                className=\"bg-orange-50/20 rounded-lg p-3 border border-orange-200 hover:bg-orange-100:bg-orange-800/30 transition-colors cursor-pointer\"\n              >\n                <div className=\"font-bold text-orange-600\">150 WPM</div>\n                <div className=\"text-orange-500 mt-1\"></div>\n              </button>\n            </div>\n          </div>\n        </div>\n      </div>\n\n      {/*  */}\n      <div className=\"bg-card-bg rounded-xl p-6 shadow-md border-2 border-card-border\">\n        <h3 className=\"text-xl font-bold text-text-color mb-4 flex items-center gap-2\">\n          <span></span>\n          <span></span>\n        </h3>\n        <div className=\"space-y-3\">\n          <a\n            href=\"/privacy.html\"\n            target=\"_blank\"\n            rel=\"noopener noreferrer\"\n            className=\"block w-full px-4 py-3 bg-primary text-white text-center rounded-lg font-semibold hover:bg-btn-primary-hover transition-colors shadow-md\"\n          >\n             \n          </a>\n          <p className=\"text-sm text-text-secondary bg-bg-secondary px-4 py-3 rounded-lg text-center\">\n            \n          </p>\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default SettingsView;\n","/**\n * \n * \n */\n\ninterface LoadingIndicatorProps {\n  isVisible: boolean;\n  message?: string;\n}\n\nexport const LoadingIndicator: React.FC<LoadingIndicatorProps> = ({\n  isVisible,\n  message = '...',\n}) => {\n  if (!isVisible) return null;\n\n  return (\n    <div className=\"fixed inset-0 bg-black bg-opacity-50 flex items-center justify-center z-50 pointer-events-auto\">\n      <div className=\"bg-white rounded-2xl shadow-2xl p-8 flex flex-col items-center gap-6 animate-in fade-in duration-300\">\n        {/*  */}\n        <div className=\"relative w-16 h-16\">\n          <div className=\"absolute inset-0 rounded-full border-4 border-gray-200\"></div>\n          <div className=\"absolute inset-0 rounded-full border-4 border-transparent border-t-blue-600 animate-spin\"></div>\n        </div>\n\n        {/*  */}\n        <div className=\"text-center\">\n          <p className=\"text-gray-800 font-semibold text-lg\">{message}</p>\n          <p className=\"text-gray-500 text-sm mt-2\">...</p>\n        </div>\n      </div>\n    </div>\n  );\n};\n\nexport default LoadingIndicator;\n","/**\n * \n */\nimport type React from 'react';\n\n// GrammarQuizView  ComprehensiveReadingView \n// \n\nlet grammarQuizViewCache: React.ComponentType<object> | null = null;\nlet comprehensiveReadingViewCache: React.ComponentType<object> | null = null;\n\n/**\n * GrammarQuizView \n */\nexport async function loadGrammarQuizView() {\n  if (grammarQuizViewCache) {\n    return grammarQuizViewCache;\n  }\n  const module = await import('../components/GrammarQuizView');\n  grammarQuizViewCache = module.default;\n  return grammarQuizViewCache;\n}\n\n/**\n * ComprehensiveReadingView \n */\nexport async function loadComprehensiveReadingView() {\n  if (comprehensiveReadingViewCache) {\n    return comprehensiveReadingViewCache;\n  }\n  const module = await import('../components/ComprehensiveReadingView');\n  comprehensiveReadingViewCache = module.default;\n  return comprehensiveReadingViewCache;\n}\n\n/**\n * \n */\nexport function preloadHeavyComponents() {\n  if (typeof requestIdleCallback !== 'undefined') {\n    requestIdleCallback(() => {\n      loadGrammarQuizView();\n      loadComprehensiveReadingView();\n    });\n  } else {\n    // \n    setTimeout(() => {\n      loadGrammarQuizView();\n      loadComprehensiveReadingView();\n    }, 2000);\n  }\n}\n","import { useState, useEffect, useRef } from 'react';\nimport { QuestionSet, Question } from './types';\nimport { parseCSV, saveQuestionSets, generateId, classifyPhraseType } from './utils';\nimport { useQuizSettings } from './hooks/useQuizSettings';\nimport { useQuizFilters } from './hooks/useQuizFilters';\nimport { useQuizState } from './hooks/useQuizState';\n\n// \nimport {\n  addQuizResult,\n  updateWordProgress,\n  filterSkippedWords,\n  getTodayIncorrectWords,\n  loadProgress,\n  addSessionHistory,\n  getStudySettings,\n  recordWordSkip,\n  updateProgressCache,\n  recordConfusion,\n  getConfusedWords,\n} from './storage/progress/progressStorage';\nimport type { CustomQuestionState, CustomWord } from './types/customQuestions';\nimport {\n  loadCustomQuestionState,\n  saveCustomQuestionState,\n  createCustomQuestionSet,\n  addWordToSet,\n  removeWordFromSet,\n  deleteCustomQuestionSet,\n  updateCustomQuestionSet,\n} from './utils/customQuestionStorage';\nimport { logger } from '@/utils/logger';\nimport { sortQuestionsByPriority } from './utils/questionPrioritySorter';\nimport { useQuestionRequeue } from './hooks/useQuestionRequeue';\nimport { sessionKpi } from './metrics/sessionKpi';\nimport {\n  addToSkipGroup,\n  handleSkippedWordIncorrect,\n  handleSkippedWordCorrect,\n} from './features/learning/learningAssistant';\nimport {\n  analyzeRadarChart,\n  prioritizeWeakCategoryQuestions,\n  saveImprovementProgress,\n  updateImprovementProgress,\n  getImprovementProgress,\n} from './ai/analysis/radarChartAI';\nimport {\n  analyzeLearningHistory,\n  calculateQuestionPriorities,\n  planConsolidationSequence,\n  WordLearningHistory,\n  LearningAttempt,\n} from './ai/analysis/learningCurveAI';\nimport {\n  calculateCognitiveLoad,\n  adjustDifficultyByCognitiveLoad,\n  generateFatigueMessage,\n  CognitiveLoadMonitor,\n  SessionResponse,\n} from './ai/cognitive/cognitiveLoadAI';\nimport {\n  analyzeErrorPatterns,\n  batchPredictErrors,\n  ErrorPrediction,\n  ErrorAnalysis,\n} from './ai/prediction/errorPredictionAI';\nimport { generateContextualSequence } from './ai/optimization/contextualLearningAI';\nimport {\n  recordSessionStats,\n  saveSessionToHistory,\n  loadSessionHistory,\n  generateLearningStyleProfile,\n  generateRecommendationMessage,\n  getTimeOfDay as getTimeOfDayStyle,\n} from './ai/adaptation/learningStyleAI';\nimport { processSessionEnd, getMotivationalMessage } from './ai/engagement/gamificationAI';\nimport QuizView from './components/QuizView';\nimport SpellingView from './components/SpellingView';\nimport ComprehensiveReadingView from './components/ComprehensiveReadingView';\nimport GrammarQuizView from './components/GrammarQuizView';\nimport MemorizationView from './components/MemorizationView';\nimport GrammarGuideView from './components/GrammarGuideView';\nimport DictionaryView from './components/DictionaryView';\nimport FloatingPanel from './components/FloatingPanel';\nimport StatsView from './components/StatsView';\nimport SettingsView from './components/SettingsView';\nimport LoadingIndicator from './components/LoadingIndicator';\nimport './App.css';\n\n// IndexedDB\nimport { migrateToIndexedDB } from './storage/migration/dataMigration';\nimport { initStorageStrategy } from './storage/manager/storageManager';\n\n// \nimport { preloadHeavyComponents as _preloadHeavyComponents } from './utils/lazyLoader';\n\ntype Tab =\n  | 'memorization'\n  | 'translation'\n  | 'spelling'\n  | 'grammar'\n  | 'reading'\n  | 'grammar-guide'\n  | 'dictionary'\n  | 'stats'\n  | 'settings';\nexport type DifficultyLevel = 'all' | 'beginner' | 'intermediate' | 'advanced';\nexport type WordPhraseFilter = 'all' | 'words-only' | 'phrases-only';\nexport type PhraseTypeFilter = 'all' | 'phrasal-verb' | 'idiom' | 'collocation' | 'other';\nexport type DataSource = 'all' | 'junior' | 'intermediate' | 'advanced' | 'standard' | string; // stringID\n\n// 10docs/19-junior-high-vocabulary.md\nexport const OFFICIAL_CATEGORIES = [\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n  '',\n] as const;\n\n// LocalStorage\nfunction checkLocalStorageSize() {\n  try {\n    let totalSize = 0;\n    const details: { key: string; size: number }[] = [];\n\n    for (let i = 0; i < localStorage.length; i++) {\n      const key = localStorage.key(i);\n      if (key) {\n        const value = localStorage.getItem(key);\n        if (value) {\n          const size = new Blob([value]).size;\n          totalSize += size;\n          details.push({ key, size });\n        }\n      }\n    }\n\n    const totalMB = totalSize / (1024 * 1024);\n    logger.log(` LocalStorage: ${totalMB.toFixed(2)}MB`);\n\n    // \n    details.sort((a, b) => b.size - a.size);\n    details.slice(0, 5).forEach((d) => {\n      const sizeMB = d.size / (1024 * 1024);\n      logger.log(`  - ${d.key}: ${sizeMB.toFixed(2)}MB`);\n    });\n\n    // 4MB\n    if (totalMB > 4) {\n      logger.warn(' LocalStorage');\n      // \n      loadProgress();\n      logger.log('');\n    }\n  } catch (error) {\n    logger.error('LocalStorage:', error);\n  }\n}\n\nfunction App() {\n  const [activeTab, setActiveTab] = useState<Tab>('translation');\n  const [isLoadingTab, setIsLoadingTab] = useState(false);\n\n  // high-school-entrance-words.csv\n  const [allQuestions, setAllQuestions] = useState<Question[]>([]);\n\n  // \n  const [customQuestionState, setCustomQuestionState] = useState<CustomQuestionState>(() => {\n    return loadCustomQuestionState();\n  });\n  const [isFloatingPanelOpen, setIsFloatingPanelOpen] = useState(false);\n\n  // LocalStorage\n  useEffect(() => {\n    saveCustomQuestionState(customQuestionState);\n  }, [customQuestionState]);\n\n  // \n  useEffect(() => {\n    // \n    const isDevelopment = !window.location.hostname.includes('github.io');\n    if (isDevelopment) {\n      import('./tests/scoreBoardTests')\n        .then(() => {\n          logger.log(' ');\n          logger.log('   : window.runScoreBoardTests()');\n          logger.log('   : window.checkCurrentScoreBoardDisplay(\"translation\")');\n        })\n        .catch((err) => {\n          logger.error(':', err);\n        });\n    }\n  }, []);\n\n  // \n  const {\n    categoryList,\n    setCategoryList,\n    selectedCategory,\n    setSelectedCategory,\n    selectedDifficulty,\n    setSelectedDifficulty,\n    selectedWordPhraseFilter,\n    setSelectedWordPhraseFilter,\n    selectedPhraseTypeFilter,\n    setSelectedPhraseTypeFilter,\n    selectedDataSource,\n    setSelectedDataSource,\n  } = useQuizFilters();\n\n  // \n  const _getSelectedQuestionSetName = () => {\n    if (selectedDataSource === 'all') return '';\n    const set = questionSets.find((qs) => qs.id === selectedDataSource);\n    return set ? set.name : '';\n  };\n\n  // \n  const [questionSets, setQuestionSets] = useState<QuestionSet[]>([]);\n\n  // \n  const [isDataLoaded, setIsDataLoaded] = useState(false);\n\n  // \n  const hasAutoStarted = useRef(false);\n  useEffect(() => {\n    // \n    hasAutoStarted.current = false;\n  }, [activeTab]);\n\n  useEffect(() => {\n    if (\n      isDataLoaded &&\n      (activeTab === 'translation' || activeTab === 'spelling') &&\n      !hasAutoStarted.current &&\n      quizState.questions.length === 0\n    ) {\n      hasAutoStarted.current = true;\n      handleStartQuiz();\n    }\n  }, [isDataLoaded, activeTab]);\n\n  // \n  const [adaptiveMode] = useState<boolean>(() => {\n    const saved = localStorage.getItem('quiz-adaptive-mode');\n    return saved ? JSON.parse(saved) : false;\n  });\n\n  // \n  const {\n    sessionStats,\n    setSessionStats,\n    quizState,\n    setQuizState,\n    reviewFocusMode,\n    setReviewFocusMode,\n    reviewQuestionPool,\n    setReviewQuestionPool,\n    reviewCorrectStreak,\n    setReviewCorrectStreak,\n  } = useQuizState();\n\n  // \n  const { reAddQuestion, clearExpiredFlags, updateRequeueStats } = useQuestionRequeue<Question>();\n\n  // \n  const quizStartTimeRef = useRef<number>(0);\n  const questionStartTimeRef = useRef<number>(0); // \n  const incorrectWordsRef = useRef<string[]>([]);\n\n  //  AI: \n  const sessionQuestionIndexRef = useRef<number>(0);\n\n  //  AI: \n  const sessionResponsesRef = useRef<SessionResponse[]>([]);\n  const cognitiveLoadRef = useRef<CognitiveLoadMonitor | null>(null);\n\n  //  AI: \n  const errorAnalysisRef = useRef<ErrorAnalysis | null>(null);\n  const errorPredictionsRef = useRef<Map<string, ErrorPrediction>>(new Map());\n  const recentAnswersRef = useRef<\n    Array<{ word: string; wasCorrect: boolean; userAnswer?: string }>\n  >([]);\n\n  // ()\n  const recentlyStudiedWordsRef = useRef<string[]>([]);\n\n  // \n  const { autoAdvance: _autoAdvance, autoAdvanceDelay: _autoAdvanceDelay } = useQuizSettings();\n\n  // \n  useEffect(() => {\n    const applyDarkMode = (mode: 'light' | 'dark' | 'system') => {\n      const isDark =\n        mode === 'dark' ||\n        (mode === 'system' && window.matchMedia('(prefers-color-scheme: dark)').matches);\n      document.documentElement.classList.toggle('dark-mode', isDark);\n    };\n\n    const savedDarkMode = localStorage.getItem('darkMode') as 'light' | 'dark' | 'system' | null;\n    const darkMode = savedDarkMode || 'system';\n    applyDarkMode(darkMode);\n\n    // \n    const mediaQuery = window.matchMedia('(prefers-color-scheme: dark)');\n    const handleChange = () => {\n      const currentMode = localStorage.getItem('darkMode') as 'light' | 'dark' | 'system' | null;\n      if (!currentMode || currentMode === 'system') {\n        applyDarkMode('system');\n      }\n    };\n    mediaQuery.addEventListener('change', handleChange);\n    return () => mediaQuery.removeEventListener('change', handleChange);\n  }, []);\n\n  // : high-school-entrance-words.csv\n  useEffect(() => {\n    const loadInitialData = async () => {\n      try {\n        // IndexedDB\n        logger.log(' ...');\n        try {\n          await migrateToIndexedDB();\n        } catch (migrationError) {\n          logger.error('Migration error (continuing):', migrationError);\n        }\n\n        // \n        initStorageStrategy();\n\n        // \n        let progressLoaded = false;\n        try {\n          const progress = await loadProgress();\n          // \n          if (\n            progress &&\n            progress.wordProgress &&\n            progress.statistics &&\n            progress.questionSetStats\n          ) {\n            updateProgressCache(progress);\n            logger.log(' Progress data loaded successfully');\n            progressLoaded = true;\n          } else {\n            logger.warn(' Progress data incomplete, reinitializing');\n          }\n        } catch (progressError) {\n          logger.error('Progress load error:', progressError);\n        }\n\n        // \n        if (!progressLoaded) {\n          logger.log(' Initializing fresh progress data');\n          const initialProgress = {\n            results: [],\n            statistics: {\n              totalQuizzes: 0,\n              totalQuestions: 0,\n              totalCorrect: 0,\n              averageScore: 0,\n              bestScore: 0,\n              streakDays: 0,\n              lastStudyDate: 0,\n              studyDates: [],\n            },\n            questionSetStats: {},\n            wordProgress: {},\n            categoryStats: {},\n            difficultyStats: {},\n          };\n          updateProgressCache(initialProgress);\n          // LocalStorage\n          try {\n            localStorage.setItem('progress-data', JSON.stringify(initialProgress));\n          } catch (e) {\n            logger.warn('Failed to save initial progress:', e);\n          }\n        }\n\n        // LocalStorage\n        checkLocalStorageSize();\n\n        // \n        const juniorWordsResponse = await fetch('/data/vocabulary/high-school-entrance-words.csv');\n        const juniorWordsText = await juniorWordsResponse.text();\n        const juniorWordsQuestions = parseCSV(juniorWordsText).map((q) => ({\n          ...q,\n          source: 'junior' as const,\n        }));\n\n        // \n        let juniorPhrasesQuestions: Question[] = [];\n        try {\n          const juniorPhrasesResponse = await fetch(\n            '/data/vocabulary/high-school-entrance-phrases.csv'\n          );\n          const juniorPhrasesText = await juniorPhrasesResponse.text();\n          juniorPhrasesQuestions = parseCSV(juniorPhrasesText).map((q) => ({\n            ...q,\n            source: 'junior' as const,\n          }));\n          logger.log(` : ${juniorPhrasesQuestions.length}`);\n        } catch (error) {\n          logger.warn(':', error);\n        }\n\n        // 1800\n        let intermediateWordsQuestions: Question[] = [];\n        try {\n          const intermediateWordsResponse = await fetch(\n            '/data/vocabulary/high-school-intermediate-words.csv'\n          );\n          const intermediateWordsText = await intermediateWordsResponse.text();\n          intermediateWordsQuestions = parseCSV(intermediateWordsText).map((q) => ({\n            ...q,\n            source: 'intermediate' as const,\n          }));\n          logger.log(` 1800: ${intermediateWordsQuestions.length}`);\n        } catch (error) {\n          logger.warn('1800:', error);\n        }\n\n        // 1800\n        let intermediatePhrasesQuestions: Question[] = [];\n        try {\n          const intermediatePhrasesResponse = await fetch(\n            '/data/vocabulary/high-school-intermediate-phrases.csv'\n          );\n          const intermediatePhrasesText = await intermediatePhrasesResponse.text();\n          intermediatePhrasesQuestions = parseCSV(intermediatePhrasesText).map((q) => ({\n            ...q,\n            source: 'intermediate' as const,\n          }));\n          logger.log(` 1800: ${intermediatePhrasesQuestions.length}`);\n        } catch (error) {\n          logger.warn('1800:', error);\n        }\n\n        // JSONUnit\n        const unitTitleMap = new Map<string, string>();\n        try {\n          // \n          for (const grade of [1, 2, 3]) {\n            try {\n              const response = await fetch(`/data/sentence-ordering-grade${grade}.json`);\n              const data = await response.json();\n              if (data.units) {\n                data.units.forEach((unit: { unit: string; title: string }) => {\n                  //  `\"1 Unit 0\"` \n                  // key->\n                  const key = `${grade} ${unit.unit}`;\n                  unitTitleMap.set(unit.unit, `${unit.unit}: ${unit.title}`);\n                  unitTitleMap.set(key, `${grade} ${unit.unit}: ${unit.title}`);\n                });\n              }\n            } catch (err) {\n              logger.warn(`Grade ${grade} sentence ordering data not found:`, err);\n            }\n          }\n        } catch (error) {\n          logger.warn('Unit title mapping failed:', error);\n        }\n\n        // \n        const allQuestions = [\n          ...juniorWordsQuestions,\n          ...juniorPhrasesQuestions,\n          ...intermediateWordsQuestions,\n          ...intermediatePhrasesQuestions,\n        ];\n\n        if (allQuestions.length > 0) {\n          setAllQuestions(allQuestions);\n\n          // \n          try {\n            const questionsCache = allQuestions.map((q) => ({\n              word: q.word,\n              difficulty: q.difficulty || 'beginner',\n            }));\n            localStorage.setItem('all-questions-cache', JSON.stringify(questionsCache));\n          } catch (e) {\n            logger.warn('Questions cache save failed:', e);\n          }\n\n          // \n          const categories = Array.from(\n            new Set(allQuestions.map((q) => q.category || '').filter((c) => c))\n          );\n\n          // \n          const categoriesWithTitles = categories.map((cat) => {\n            // unitTitleMap\n            if (unitTitleMap.has(cat)) {\n              return unitTitleMap.get(cat)!;\n            }\n            // \n            return cat;\n          });\n\n          // \n          const sortedCategories = categoriesWithTitles.sort((a, b) => {\n            //  (: \"1 Unit 0: ...\")\n            const gradeRegex = /(\\d+)\\s+Unit\\s+(\\d+)/i;\n            const matchA = a.match(gradeRegex);\n            const matchB = b.match(gradeRegex);\n\n            // +Unit\n            if (matchA && matchB) {\n              const gradeA = parseInt(matchA[1], 10);\n              const gradeB = parseInt(matchB[1], 10);\n              if (gradeA !== gradeB) {\n                return gradeA - gradeB; // \n              }\n              const unitA = parseInt(matchA[2], 10);\n              const unitB = parseInt(matchB[2], 10);\n              return unitA - unitB; // \n            }\n\n            // Unit (: \"Unit 0: ...\")\n            const unitRegex = /Unit\\s+(\\d+)/i;\n            const unitMatchA = a.match(unitRegex);\n            const unitMatchB = b.match(unitRegex);\n\n            if (unitMatchA && unitMatchB) {\n              const numA = parseInt(unitMatchA[1], 10);\n              const numB = parseInt(unitMatchB[1], 10);\n              return numA - numB;\n            }\n\n            // \n            return a.localeCompare(b, 'ja');\n          });\n\n          setCategoryList(sortedCategories);\n\n          // \n          const allSet: QuestionSet = {\n            id: 'all-set',\n            name: '',\n            questions: allQuestions,\n            createdAt: Date.now(),\n            isBuiltIn: true,\n            source: '2758 + 1791',\n          };\n\n          const advancedSet: QuestionSet = {\n            id: 'advanced-set',\n            name: '',\n            questions: allQuestions.filter((q) => q.difficulty === 'advanced'),\n            createdAt: Date.now(),\n            isBuiltIn: true,\n            source: 'high-school-entrance (2662 + 96)',\n          };\n\n          const standardSet: QuestionSet = {\n            id: 'standard-set',\n            name: '',\n            questions: allQuestions.filter(\n              (q) => q.difficulty === 'intermediate' || q.difficulty === 'beginner'\n            ),\n            createdAt: Date.now(),\n            isBuiltIn: true,\n            source: 'high-school-intermediate (1579 + 212)',\n          };\n\n          // \n          const { getCustomQuestionSets } = await import('./storage/progress/progressStorage');\n          const customSets = await getCustomQuestionSets();\n\n          // QuestionSet\n          const customQuestionSets: QuestionSet[] = customSets.map((cs) => {\n            const date = new Date(cs.createdAt);\n            const dateStr = `${date.getMonth() + 1}/${date.getDate()}`;\n            const sourcePrefix =\n              cs.source === 'reading' ? '' : cs.source === 'weak-words' ? '' : '';\n\n            return {\n              id: cs.id,\n              name: `${sourcePrefix}_${dateStr}`,\n              questions: cs.questions,\n              createdAt: cs.createdAt,\n              isBuiltIn: false,\n              source:\n                cs.source === 'reading'\n                  ? ''\n                  : cs.source === 'weak-words'\n                    ? ''\n                    : '',\n            };\n          });\n\n          setQuestionSets([allSet, advancedSet, standardSet, ...customQuestionSets]);\n\n          // \n          setIsDataLoaded(true);\n        }\n      } catch (error) {\n        logger.error(':', error);\n        alert('');\n      }\n    };\n\n    loadInitialData();\n  }, []);\n\n  // \n  const reloadQuestionSets = async () => {\n    try {\n      const { getCustomQuestionSets } = await import('./storage/progress/progressStorage');\n      const customSets = await getCustomQuestionSets();\n\n      const mainSet = questionSets.find((qs) => qs.isBuiltIn);\n      const customQuestionSets: QuestionSet[] = customSets.map((cs) => ({\n        id: cs.id,\n        name: cs.name,\n        questions: cs.questions,\n        createdAt: cs.createdAt,\n        isBuiltIn: false,\n        source:\n          cs.source === 'reading'\n            ? ''\n            : cs.source === 'weak-words'\n              ? ''\n              : '',\n      }));\n\n      if (mainSet) {\n        setQuestionSets([mainSet, ...customQuestionSets]);\n      }\n    } catch (error) {\n      logger.error(':', error);\n    }\n  };\n\n  //  localStorage \n  // useEffect(() => {\n  //   if (questionSets.length > 0) {\n  //     saveQuestionSets(questionSets);\n  //   }\n  // }, [questionSets]);\n\n  // \n  useEffect(() => {\n    localStorage.setItem('quiz-adaptive-mode', JSON.stringify(adaptiveMode));\n  }, [adaptiveMode]);\n\n  // \n  useEffect(() => {\n    localStorage.setItem('selectedDataSource', selectedDataSource);\n  }, [selectedDataSource]);\n\n  // \n  useEffect(() => {\n    if (quizState.questions.length > 0) {\n      // \n      handleStartQuiz();\n    }\n  }, [\n    selectedDataSource,\n    selectedCategory,\n    selectedDifficulty,\n    selectedWordPhraseFilter,\n    selectedPhraseTypeFilter,\n  ]);\n\n  // \n  const getFilteredQuestions = (): Question[] => {\n    let filtered = allQuestions;\n\n    // \n    if (selectedDataSource !== 'all') {\n      filtered = filtered.filter((q) => (q as any).source === selectedDataSource);\n    }\n\n    // \n    if (selectedCategory !== 'all') {\n      filtered = filtered.filter((q) => q.category === selectedCategory);\n    }\n\n    // \n    if (selectedDifficulty !== 'all') {\n      const difficultyMap: Record<DifficultyLevel, string> = {\n        all: '',\n        beginner: '',\n        intermediate: '',\n        advanced: '',\n      };\n      filtered = filtered.filter((q) => q.difficulty === difficultyMap[selectedDifficulty]);\n    }\n\n    // /\n    if (selectedWordPhraseFilter === 'words-only') {\n      filtered = filtered.filter((q) => !q.word.includes(' '));\n    } else if (selectedWordPhraseFilter === 'phrases-only') {\n      filtered = filtered.filter((q) => q.word.includes(' '));\n\n      // \n      if (selectedPhraseTypeFilter !== 'all') {\n        filtered = filtered.filter((q) => {\n          return classifyPhraseType(q.word) === selectedPhraseTypeFilter;\n        });\n      }\n    }\n\n    // \n    filtered = filterSkippedWords(filtered);\n\n    return filtered;\n  };\n\n  // \n  const handleCreateCustomSet = (name: string, description?: string) => {\n    const newSet = createCustomQuestionSet(name, description);\n    setCustomQuestionState((prev) => ({\n      ...prev,\n      sets: [...prev.sets, newSet],\n    }));\n    logger.log(` ${name}`);\n  };\n\n  const handleDeleteCustomSet = (setId: string) => {\n    setCustomQuestionState((prev) => deleteCustomQuestionSet(prev, setId));\n    logger.log(` `);\n  };\n\n  const handleEditCustomSet = (setId: string, name: string, description?: string) => {\n    setCustomQuestionState((prev) => updateCustomQuestionSet(prev, setId, { name, description }));\n    logger.log(` ${name}`);\n  };\n\n  const handleAddWordToCustomSet = (setId: string, word: CustomWord) => {\n    setCustomQuestionState((prev) => addWordToSet(prev, setId, word));\n    logger.log(` ${word.word}`);\n  };\n\n  const handleRemoveWordFromCustomSet = (setId: string, word: CustomWord) => {\n    setCustomQuestionState((prev) => removeWordFromSet(prev, setId, word));\n    logger.log(` ${word.word}`);\n  };\n\n  // \n  const handleStartQuiz = async () => {\n    // AI: \n    const motivationMsg = getMotivationalMessage();\n    logger.log(' :', motivationMsg);\n\n    // \n    const studySettings = getStudySettings();\n\n    let filteredQuestions = getFilteredQuestions();\n\n    if (filteredQuestions.length === 0) {\n      alert('');\n      return;\n    }\n\n    // \n    if (reviewFocusMode) {\n      const todayIncorrect = getTodayIncorrectWords();\n      filteredQuestions = filteredQuestions.filter((q) =>\n        todayIncorrect.some((word) => word && q.word && word.toLowerCase() === q.word.toLowerCase())\n      );\n\n      if (filteredQuestions.length === 0) {\n        alert('');\n        setReviewFocusMode(false); // \n        setReviewQuestionPool([]);\n        return;\n      }\n\n      // \n      setReviewQuestionPool([...filteredQuestions]);\n      logger.log(` : ${filteredQuestions.length}`);\n    }\n\n    // AI: \n    const radarAnalysis = analyzeRadarChart(allQuestions, categoryList);\n\n    // \n    const improvementProgress = getImprovementProgress();\n    if (improvementProgress) {\n      updateImprovementProgress(radarAnalysis);\n      logger.log(\n        ` : ${improvementProgress.currentDay} - ${improvementProgress.overallProgress.toFixed(1)}%`\n      );\n    } else if (radarAnalysis.weakCategories.length > 0) {\n      // \n      saveImprovementProgress(radarAnalysis);\n      logger.log(' ');\n    }\n\n    // AI\n    if (radarAnalysis.aiRecommendations.length > 0) {\n      logger.log(' AI :');\n      radarAnalysis.aiRecommendations.forEach((rec) => logger.log(`  ${rec}`));\n    }\n\n    // (AI)\n    if (radarAnalysis.weakCategories.length > 0 && selectedCategory === 'all') {\n      filteredQuestions = prioritizeWeakCategoryQuestions(\n        filteredQuestions,\n        radarAnalysis.weakCategories,\n        Math.min(30, filteredQuestions.length)\n      );\n      logger.log(\n        ` : ${radarAnalysis.weakCategories\n          .slice(0, 3)\n          .map((w) => w.category)\n          .join(', ')}`\n      );\n    }\n\n    // ()\n    // TODO: selectRelatedQuestions\n    /*\n    if (recentlyStudiedWordsRef.current.length > 0 && selectedCategory === 'all') {\n      const relatedQuestions = selectRelatedQuestions(\n        recentlyStudiedWordsRef.current,\n        filteredQuestions,\n        Math.min(5, Math.floor(filteredQuestions.length * 0.3)) // 30%\n      );\n\n      if (relatedQuestions.length > 0) {\n        // ()\n        const nonRelatedQuestions = filteredQuestions.filter(q =>\n          !relatedQuestions.some(rq => rq.word === q.word)\n        );\n        filteredQuestions = [...relatedQuestions, ...nonRelatedQuestions];\n        logger.log(` : ${relatedQuestions.length}`);\n      }\n    }\n    */\n\n    // \n    const todayIncorrect = getTodayIncorrectWords();\n\n    // \n    const confusedWordsProgress = getConfusedWords(10);\n    const confusedWords = confusedWordsProgress.map((wp) => wp.word);\n\n    // \n    let reviewQuestions: Question[] = [];\n    if (todayIncorrect.length > 0) {\n      const incorrectQuestions = filteredQuestions.filter((q) =>\n        todayIncorrect.some((word) => word && q.word && word.toLowerCase() === q.word.toLowerCase())\n      );\n\n      // 0\n      reviewQuestions =\n        studySettings.maxReviewCount > 0\n          ? incorrectQuestions.slice(0, studySettings.maxReviewCount)\n          : [];\n\n      const correctQuestions = filteredQuestions.filter(\n        (q) =>\n          !todayIncorrect.some(\n            (word) => word && q.word && word.toLowerCase() === q.word.toLowerCase()\n          )\n      );\n\n      // \n      filteredQuestions = [...reviewQuestions, ...correctQuestions];\n\n      if (reviewQuestions.length > 0) {\n        logger.log(\n          ` : ${reviewQuestions.length}: ${studySettings.maxReviewCount}`\n        );\n      }\n    }\n\n    // \n    if (confusedWords.length > 0) {\n      const confusedQuestions = filteredQuestions.filter((q) =>\n        confusedWords.some((word) => word && q.word && word.toLowerCase() === q.word.toLowerCase())\n      );\n\n      if (confusedQuestions.length > 0) {\n        const nonConfusedQuestions = filteredQuestions.filter(\n          (q) =>\n            !confusedWords.some(\n              (word) => word && q.word && word.toLowerCase() === q.word.toLowerCase()\n            )\n        );\n\n        // \n        filteredQuestions = [...confusedQuestions, ...nonConfusedQuestions];\n        logger.log(` : ${confusedQuestions.length}`);\n      }\n    }\n\n    // AI: \n    // NOTE: \n    if (!reviewFocusMode && filteredQuestions.length > 0) {\n      const progress = await loadProgress();\n\n      // \n      const learningHistories = new Map<string, WordLearningHistory>();\n      filteredQuestions.forEach((q) => {\n        const wp = progress.wordProgress[q.word];\n        if (wp && wp.learningHistory && wp.learningHistory.length > 0) {\n          // LearningAttempt\n          const attempts: LearningAttempt[] = wp.learningHistory.map((h) => ({\n            timestamp: h.timestamp,\n            wasCorrect: h.wasCorrect,\n            responseTime: h.responseTime,\n            userAnswer: h.userAnswer,\n            confidenceLevel:\n              h.responseTime < 2000 ? 'instant' : h.responseTime < 5000 ? 'hesitant' : 'guessed',\n            sessionContext: {\n              questionIndex: h.sessionIndex || 0,\n              previousQuestions: [],\n              sessionFatigue: 0,\n            },\n          }));\n\n          const history = analyzeLearningHistory(q.word, wp, attempts);\n          learningHistories.set(q.word, history);\n        }\n      });\n\n      // AI\n      const priorities = calculateQuestionPriorities(\n        filteredQuestions,\n        progress.wordProgress,\n        learningHistories\n      );\n\n      // \n      const optimizedSequence = planConsolidationSequence(priorities, filteredQuestions.length);\n\n      // AI\n      const currentLoad = calculateCognitiveLoad(\n        sessionResponsesRef.current,\n        quizStartTimeRef.current\n      );\n      cognitiveLoadRef.current = currentLoad;\n\n      const adjustedSequence = adjustDifficultyByCognitiveLoad(optimizedSequence, currentLoad);\n\n      // \n      const wordToPriority = new Map(adjustedSequence.map((p) => [p.word, p]));\n      filteredQuestions = filteredQuestions\n        .filter((q) => wordToPriority.has(q.word))\n        .sort((a, b) => {\n          const priorityA = wordToPriority.get(a.word)!.priority;\n          const priorityB = wordToPriority.get(b.word)!.priority;\n          return priorityB - priorityA;\n        });\n\n      logger.log(' AI: ');\n      logger.log(\n        '  :',\n        adjustedSequence\n          .slice(0, 5)\n          .map((p) => `${p.word}(${p.strategy}, ${p.estimatedSuccessRate.toFixed(0)}%)`)\n          .join(', ')\n      );\n\n      // \n      if (currentLoad.fatigueLevel > 40) {\n        const message = generateFatigueMessage(currentLoad);\n        logger.log(` : ${currentLoad.fatigueLevel.toFixed(0)}% - ${message}`);\n      }\n\n      // AI: \n      const contextualSeq = generateContextualSequence(\n        filteredQuestions,\n        progress.wordProgress,\n        recentlyStudiedWordsRef.current\n      );\n\n      // \n      const contextualOrder = new Map<string, number>();\n      contextualSeq.sequence.forEach((word, index) => {\n        contextualOrder.set(word, index);\n      });\n\n      filteredQuestions = filteredQuestions.sort((a, b) => {\n        const orderA = contextualOrder.get(a.word) ?? 999;\n        const orderB = contextualOrder.get(b.word) ?? 999;\n        return orderA - orderB;\n      });\n\n      logger.log(' AI: ');\n      logger.log(`  : ${contextualSeq.clusters.length}`);\n      if (contextualSeq.transitions.length > 0) {\n        const sample = contextualSeq.transitions[0];\n        logger.log(`  : ${sample.from}  ${sample.to} (${sample.reason})`);\n      }\n    }\n    // NOTE: AI+AIif\n    // (selectAdaptiveQuestions)\n\n    if (reviewFocusMode) {\n      logger.log(` : ${filteredQuestions.length}`);\n    } else {\n      logger.log(` : ${filteredQuestions.length}`);\n    }\n\n    setQuizState({\n      questions: filteredQuestions,\n      currentIndex: 0,\n      score: 0,\n      totalAnswered: 0,\n      answered: false,\n      selectedAnswer: null,\n    });\n\n    // \n    setSessionStats({\n      correct: 0,\n      incorrect: 0,\n      review: 0,\n      mastered: 0,\n      newQuestions: 0,\n      reviewQuestions: 0,\n      consecutiveNew: 0,\n      consecutiveReview: 0,\n    });\n\n    // \n    quizStartTimeRef.current = Date.now();\n    questionStartTimeRef.current = Date.now();\n    incorrectWordsRef.current = [];\n\n    // AI\n    sessionResponsesRef.current = [];\n    cognitiveLoadRef.current = null;\n\n    // AI: \n    const progress = await loadProgress();\n    const errorAnalysis = analyzeErrorPatterns(progress.wordProgress, recentAnswersRef.current);\n    errorAnalysisRef.current = errorAnalysis;\n\n    // \n    const words = filteredQuestions.map((q) => q.word);\n    const currentFatigue =\n      (cognitiveLoadRef.current as CognitiveLoadMonitor | null)?.fatigueLevel ?? 0;\n    const predictions = batchPredictErrors(\n      words,\n      progress.wordProgress,\n      errorAnalysis,\n      currentFatigue,\n      0 // 0\n    );\n    errorPredictionsRef.current = predictions;\n\n    logger.log(' AI: ');\n    const highRisk = Array.from(predictions.values())\n      .filter((p) => p.warningLevel === 'high' || p.warningLevel === 'critical')\n      .sort((a, b) => b.errorRisk - a.errorRisk);\n    if (highRisk.length > 0) {\n      logger.log(`  : ${highRisk.length}`);\n      logger.log(\n        `  : ${highRisk[0].word} (${highRisk[0].errorRisk.toFixed(0)}% - ${highRisk[0].primaryPattern})`\n      );\n    }\n  };\n\n  // \n  const handleReviewFocus = () => {\n    if (reviewFocusMode) {\n      // \n      setReviewFocusMode(false);\n      setReviewQuestionPool([]);\n      setReviewCorrectStreak(new Map());\n    } else {\n      // \n      setReviewFocusMode(true);\n      setReviewCorrectStreak(new Map()); // \n    }\n    handleStartQuiz();\n  };\n\n  // \n  const handleSpellingReviewFocus = () => {\n    if (reviewFocusMode) {\n      // \n      setReviewFocusMode(false);\n      setReviewQuestionPool([]);\n      setReviewCorrectStreak(new Map());\n    } else {\n      // \n      setReviewFocusMode(true);\n      setReviewCorrectStreak(new Map()); // \n    }\n    handleStartQuiz();\n  };\n\n  // \n  const handleCategoryChange = (category: string) => {\n    setSelectedCategory(category);\n    // \n    setReviewFocusMode(false);\n    setReviewQuestionPool([]);\n    // \n    if (quizState.questions.length > 0) {\n      handleStartQuiz();\n    }\n  };\n\n  // \n  const handleDifficultyChange = (level: DifficultyLevel) => {\n    setSelectedDifficulty(level);\n    // \n    setReviewFocusMode(false);\n    setReviewQuestionPool([]);\n    // \n    if (quizState.questions.length > 0) {\n      handleStartQuiz();\n    }\n  };\n\n  const handleAnswer = async (\n    answer: string,\n    correct: string,\n    selectedQuestion?: Question | null\n  ) => {\n    if (quizState.answered) return;\n\n    // \n    const isDontKnow = answer === '';\n\n    // trim()\n    const normalizedAnswer = answer.trim();\n    const normalizedCorrect = correct.trim();\n    const isCorrect = !isDontKnow && normalizedAnswer === normalizedCorrect;\n    const currentQuestion = quizState.questions[quizState.currentIndex];\n\n    // \n    if (!isCorrect && selectedQuestion && selectedQuestion.word) {\n      await recordConfusion(selectedQuestion.word, currentQuestion.word);\n      logger.log(` : ${selectedQuestion.word}  ${currentQuestion.word}`);\n    }\n\n    // \n    const responseTime = Date.now() - questionStartTimeRef.current;\n\n    // AI: \n    if (currentQuestion) {\n      const progress = await loadProgress();\n      const wordProgress = progress.wordProgress?.[currentQuestion.word];\n\n      // \n      const successRate = wordProgress\n        ? wordProgress.correctCount / (wordProgress.correctCount + wordProgress.incorrectCount)\n        : 0.5;\n      const difficulty = 1 - successRate;\n\n      sessionResponsesRef.current.push({\n        timestamp: Date.now(),\n        wasCorrect: isCorrect,\n        responseTime,\n        questionDifficulty: difficulty,\n      });\n\n      // \n      const currentLoad = calculateCognitiveLoad(\n        sessionResponsesRef.current,\n        quizStartTimeRef.current\n      );\n      cognitiveLoadRef.current = currentLoad;\n\n      // \n      if (currentLoad.breakRecommendation?.shouldBreak) {\n        logger.log(` : ${currentLoad.breakRecommendation.reason}`);\n      }\n\n      // AI: \n      recentAnswersRef.current.push({\n        word: currentQuestion.word,\n        wasCorrect: isCorrect,\n        userAnswer: normalizedAnswer,\n      });\n      // 50\n      if (recentAnswersRef.current.length > 50) {\n        recentAnswersRef.current = recentAnswersRef.current.slice(-50);\n      }\n    }\n\n    // \n    if (currentQuestion) {\n      await updateWordProgress(\n        currentQuestion.word,\n        isCorrect,\n        responseTime,\n        undefined,\n        'translation'\n      );\n\n      // \n      const progress = await loadProgress();\n      const wordProgress = progress.wordProgress?.[currentQuestion.word];\n      let status: 'correct' | 'incorrect' | 'review' | 'mastered' = isCorrect\n        ? 'correct'\n        : 'incorrect';\n\n      // \n      if (wordProgress && wordProgress.masteryLevel === 'mastered') {\n        status = 'mastered';\n      } else if (!isCorrect && wordProgress && wordProgress.incorrectCount >= 2) {\n        // 2\n        status = 'review';\n      }\n\n      // \n      setSessionStats((prev) => ({\n        ...prev,\n        correct: prev.correct + (status === 'correct' ? 1 : 0),\n        incorrect: prev.incorrect + (status === 'incorrect' ? 1 : 0),\n        review: prev.review + (status === 'review' ? 1 : 0),\n        mastered: prev.mastered + (status === 'mastered' ? 1 : 0),\n      }));\n\n      addSessionHistory(\n        {\n          status,\n          word: currentQuestion.word,\n          timestamp: Date.now(),\n        },\n        'translation'\n      );\n\n      // AI: \n      recentlyStudiedWordsRef.current.push(currentQuestion.word);\n      // 10\n      if (recentlyStudiedWordsRef.current.length > 10) {\n        recentlyStudiedWordsRef.current = recentlyStudiedWordsRef.current.slice(-10);\n      }\n\n      //  AI: progressStorage\n      sessionQuestionIndexRef.current++;\n\n      // AI: \n      const currentProgress = await loadProgress();\n      const skipWordProgress = currentProgress.wordProgress?.[currentQuestion.word];\n\n      if (skipWordProgress && skipWordProgress.skippedCount && skipWordProgress.skippedCount > 0) {\n        // \n        if (isCorrect) {\n          handleSkippedWordCorrect(currentQuestion.word);\n        } else {\n          handleSkippedWordIncorrect(currentQuestion.word);\n          logger.log(\n            ' AI: '\n          );\n        }\n      }\n\n      // QuizResult\n      addQuizResult({\n        id: generateId(),\n        questionSetId: 'main-set-single',\n        questionSetName: '',\n        score: isCorrect ? 1 : 0,\n        total: 1,\n        percentage: isCorrect ? 100 : 0,\n        date: Date.now(),\n        timeSpent: Math.floor(responseTime / 1000),\n        incorrectWords: isCorrect ? [] : [currentQuestion.word],\n        mode: 'translation',\n        category: selectedCategory !== 'all' ? selectedCategory : undefined,\n        difficulty: selectedDifficulty !== 'all' ? selectedDifficulty : undefined,\n      });\n\n      // \n      if (!isCorrect) {\n        incorrectWordsRef.current.push(currentQuestion.word);\n      }\n\n      // : \n      if (reviewFocusMode) {\n        const newStreak = new Map(reviewCorrectStreak);\n        if (isCorrect) {\n          const currentStreak = newStreak.get(currentQuestion.word) || 0;\n          newStreak.set(currentQuestion.word, currentStreak + 1);\n\n          // 2\n          if (currentStreak + 1 >= 2) {\n            const newPool = reviewQuestionPool.filter((q) => q.word !== currentQuestion.word);\n            setReviewQuestionPool(newPool);\n            logger.log(` ${currentQuestion.word}  (2)`);\n\n            // \n            if (newPool.length === 0) {\n              alert(' ');\n              setReviewFocusMode(false);\n              setReviewCorrectStreak(new Map());\n            }\n          }\n        } else {\n          // \n          newStreak.set(currentQuestion.word, 0);\n        }\n        setReviewCorrectStreak(newStreak);\n      }\n    }\n\n    // \n    if (!isCorrect && !reviewFocusMode) {\n      setQuizState((prev) => {\n        const shouldResortImmediately = true; // \n        const shouldResortPeriodically = prev.totalAnswered % 3 === 0;\n\n        if (shouldResortImmediately || shouldResortPeriodically) {\n          const remainingQuestions = prev.questions.slice(prev.currentIndex + 1);\n\n          if (remainingQuestions.length > 1) {\n            // \n            const savedLearningLimit = localStorage.getItem('learning-limit-translation');\n            const savedReviewLimit = localStorage.getItem('review-limit-translation');\n            const learningLimit = savedLearningLimit ? parseInt(savedLearningLimit) : null;\n            const reviewLimit = savedReviewLimit ? parseInt(savedReviewLimit) : null;\n\n            // \n            const resorted = sortQuestionsByPriority(remainingQuestions, {\n              isReviewFocusMode: false,\n              learningLimit,\n              reviewLimit,\n              mode: 'translation',\n            });\n\n            return {\n              ...prev,\n              questions: [...prev.questions.slice(0, prev.currentIndex + 1), ...resorted],\n            };\n          }\n        }\n\n        return prev;\n      });\n    }\n\n    // 3-5\n    if (!isCorrect && !reviewFocusMode && currentQuestion) {\n      setQuizState((prev) => ({\n        ...prev,\n        questions: reAddQuestion(currentQuestion, prev.questions, prev.currentIndex),\n      }));\n    }\n\n    // /\n    if (currentQuestion) {\n      const qid = String((currentQuestion as any).word);\n      sessionKpi.onShown(qid);\n      sessionKpi.onAnswer(qid, isCorrect);\n      updateRequeueStats(currentQuestion, sessionStats, setSessionStats);\n    }\n\n    setQuizState((prev) => {\n      const newState = {\n        ...prev,\n        answered: true,\n        selectedAnswer: answer,\n        score: isCorrect ? prev.score + 1 : prev.score,\n        totalAnswered: prev.totalAnswered + 1,\n      };\n\n      // \n      // autoAdvance\n\n      return newState;\n    });\n  };\n\n  const handleNext = () => {\n    setQuizState((prev) => {\n      // \n      const currentQuestions = reviewFocusMode ? reviewQuestionPool : prev.questions;\n      const nextIndex = prev.currentIndex + 1;\n\n      // 5\n      if (!reviewFocusMode && nextIndex < currentQuestions.length) {\n        const cleanedQuestions = clearExpiredFlags(currentQuestions, nextIndex - 1);\n        if (cleanedQuestions !== currentQuestions) {\n          return {\n            ...prev,\n            questions: cleanedQuestions,\n            currentIndex: nextIndex,\n            answered: false,\n            selectedAnswer: null,\n          };\n        }\n      }\n\n      // \n      if (!reviewFocusMode && nextIndex >= currentQuestions.length) {\n        // AI: \n        const sessionEndTime = Date.now();\n        const totalResponseTime = sessionResponsesRef.current.reduce(\n          (sum, r) => sum + r.responseTime,\n          0\n        );\n        const avgResponseTime =\n          sessionResponsesRef.current.length > 0\n            ? totalResponseTime / sessionResponsesRef.current.length\n            : 0;\n\n        const currentFatigue =\n          (cognitiveLoadRef.current as CognitiveLoadMonitor | null)?.fatigueLevel ?? 0;\n\n        const newSessionStats = recordSessionStats(\n          quizStartTimeRef.current,\n          sessionEndTime,\n          prev.totalAnswered,\n          prev.score,\n          avgResponseTime,\n          currentFatigue,\n          sessionStats.correct + sessionStats.mastered,\n          sessionStats.review\n        );\n\n        saveSessionToHistory(newSessionStats);\n\n        // \n        const history = loadSessionHistory();\n        if (history.length >= 3) {\n          const profile = generateLearningStyleProfile('user', history);\n          const currentTime = getTimeOfDayStyle();\n          const message = generateRecommendationMessage(profile, currentTime);\n          logger.log(' AI:', message);\n        }\n\n        // AI: \n        const sessionDurationMinutes = (sessionEndTime - quizStartTimeRef.current) / (1000 * 60);\n        const gamificationResult = processSessionEnd(\n          prev.score,\n          prev.totalAnswered,\n          avgResponseTime,\n          sessionDurationMinutes,\n          sessionStats.correct + sessionStats.mastered,\n          currentFatigue\n        );\n\n        // \n        logger.log(' :');\n        logger.log(`  XP: ${gamificationResult.xpGained}`);\n        if (gamificationResult.leveledUp) {\n          logger.log(`   ! Lv.${gamificationResult.newLevel}`);\n        }\n        gamificationResult.feedback.forEach((fb) => {\n          logger.log(`  ${fb.icon} ${fb.message}`);\n        });\n      }\n\n      // \n      if (reviewFocusMode && nextIndex >= currentQuestions.length) {\n        logger.log(' : ');\n        return {\n          ...prev,\n          questions: currentQuestions,\n          currentIndex: 0,\n          answered: false,\n          selectedAnswer: null,\n        };\n      }\n\n      return {\n        ...prev,\n        questions: currentQuestions,\n        currentIndex: nextIndex % currentQuestions.length,\n        answered: false,\n        selectedAnswer: null,\n      };\n    });\n\n    // \n    questionStartTimeRef.current = Date.now();\n  };\n\n  const handlePrevious = () => {\n    setQuizState((prev) => ({\n      ...prev,\n      currentIndex: prev.currentIndex > 0 ? prev.currentIndex - 1 : 0,\n      answered: false,\n      selectedAnswer: null,\n    }));\n  };\n\n  // ()\n  const handleSkip = async () => {\n    const currentQuestion = quizState.questions[quizState.currentIndex];\n    if (currentQuestion) {\n      // \n      const responseTime = Date.now() - questionStartTimeRef.current;\n\n      // (30AI)\n      await recordWordSkip(currentQuestion.word, 30);\n\n      // AI: \n      addToSkipGroup(currentQuestion.word);\n\n      // \n      // updateWordProgressprogress.resultsaddQuizResult\n      await updateWordProgress(currentQuestion.word, true, responseTime, undefined, 'translation');\n\n      // QuizViewhandleSkipWrapper\n      // \n      // \n\n      // ()\n      setQuizState((prev) => ({\n        ...prev,\n        score: prev.score + 1,\n        totalAnswered: prev.totalAnswered + 1,\n        currentIndex: (prev.currentIndex + 1) % prev.questions.length,\n        answered: false,\n        selectedAnswer: null,\n      }));\n\n      // \n      setSessionStats((prev) => ({\n        ...prev,\n        correct: prev.correct + 1,\n        mastered: prev.mastered + 1, // \n      }));\n\n      // \n      addSessionHistory(\n        {\n          status: 'correct',\n          word: currentQuestion.word,\n          timestamp: Date.now(),\n        },\n        'translation'\n      );\n    } else {\n      // \n      setQuizState((prev) => ({\n        ...prev,\n        currentIndex: (prev.currentIndex + 1) % prev.questions.length,\n        answered: false,\n        selectedAnswer: null,\n      }));\n    }\n\n    // \n    questionStartTimeRef.current = Date.now();\n  };\n\n  // \n  const handleDifficultyRate = (rating: number) => {\n    const currentQuestion = quizState.questions[quizState.currentIndex];\n    if (currentQuestion) {\n      // \n      const responseTime = Date.now() - questionStartTimeRef.current;\n      updateWordProgress(\n        currentQuestion.word,\n        quizState.selectedAnswer === currentQuestion.meaning,\n        responseTime,\n        rating,\n        'translation'\n      );\n    }\n  };\n\n  return (\n    <div className=\"min-h-screen bg-gray-50\">\n      {/*  */}\n      <LoadingIndicator isVisible={isLoadingTab} message=\"...\" />\n\n      {/*  -  */}\n      <div className=\"flex gap-0 bg-gray-100 shadow-md py-1 sm:py-2\">\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'memorization'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('memorization')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'translation'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('translation')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'spelling'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('spelling')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'grammar'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => {\n            setActiveTab('grammar');\n            // \n            setIsLoadingTab(true);\n            // 1.5UI\n            setTimeout(() => setIsLoadingTab(false), 1500);\n            // \n            _preloadHeavyComponents();\n          }}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'reading'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => {\n            setActiveTab('reading');\n            // \n            setIsLoadingTab(true);\n            // 1.5UI\n            setTimeout(() => setIsLoadingTab(false), 1500);\n            // \n            _preloadHeavyComponents();\n          }}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'grammar-guide'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('grammar-guide')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'dictionary'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('dictionary')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'stats'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('stats')}\n        >\n           \n        </button>\n        <button\n          className={`flex-1 py-3 sm:py-4 px-2 sm:px-3 text-sm sm:text-base font-semibold transition-all duration-200 border-b-4 ${\n            activeTab === 'settings'\n              ? 'bg-white text-blue-600 border-blue-600'\n              : 'bg-blue-50 text-gray-700 border-transparent hover:bg-blue-100:bg-gray-800'\n          }`}\n          onClick={() => setActiveTab('settings')}\n        >\n           \n        </button>\n      </div>\n\n      {/*  */}\n      <FloatingPanel\n        isOpen={isFloatingPanelOpen}\n        onClose={() => setIsFloatingPanelOpen(false)}\n        sets={customQuestionState.sets}\n        onCreateSet={handleCreateCustomSet}\n        onDeleteSet={handleDeleteCustomSet}\n        onEditSet={handleEditCustomSet}\n        onRemoveWord={handleRemoveWordFromCustomSet}\n      />\n\n      {/*  */}\n      <div className=\"p-2 md:p-6 bg-gray-50\">\n        <div className=\"max-w-app mx-auto\">\n          {activeTab === 'memorization' ? (\n            <MemorizationView\n              allQuestions={allQuestions}\n              questionSets={questionSets}\n              customQuestionSets={customQuestionState.sets}\n              onAddWordToCustomSet={handleAddWordToCustomSet}\n              onRemoveWordFromCustomSet={handleRemoveWordFromCustomSet}\n              onOpenCustomSetManagement={() => setIsFloatingPanelOpen(true)}\n            />\n          ) : activeTab === 'translation' ? (\n            <QuizView\n              quizState={quizState}\n              _categoryList={categoryList}\n              selectedCategory={selectedCategory}\n              onCategoryChange={handleCategoryChange}\n              selectedDifficulty={selectedDifficulty}\n              onDifficultyChange={handleDifficultyChange}\n              selectedWordPhraseFilter={selectedWordPhraseFilter}\n              onWordPhraseFilterChange={setSelectedWordPhraseFilter}\n              selectedPhraseTypeFilter={selectedPhraseTypeFilter}\n              onPhraseTypeFilterChange={setSelectedPhraseTypeFilter}\n              selectedDataSource={selectedDataSource}\n              onDataSourceChange={setSelectedDataSource}\n              questionSets={questionSets}\n              onStartQuiz={handleStartQuiz}\n              onAnswer={handleAnswer}\n              onNext={handleNext}\n              onPrevious={handlePrevious}\n              onSkip={handleSkip}\n              onDifficultyRate={handleDifficultyRate}\n              onReviewFocus={handleReviewFocus}\n              sessionStats={sessionStats}\n              isReviewFocusMode={reviewFocusMode}\n              errorPrediction={\n                quizState.questions.length > 0 &&\n                quizState.currentIndex < quizState.questions.length\n                  ? errorPredictionsRef.current.get(\n                      quizState.questions[quizState.currentIndex].word\n                    )\n                  : undefined\n              }\n              customQuestionSets={customQuestionState.sets}\n              onAddWordToCustomSet={handleAddWordToCustomSet}\n              onRemoveWordFromCustomSet={handleRemoveWordFromCustomSet}\n              onOpenCustomSetManagement={() => setIsFloatingPanelOpen(true)}\n            />\n          ) : activeTab === 'spelling' ? (\n            <SpellingView\n              questions={quizState.questions}\n              _categoryList={categoryList}\n              selectedCategory={selectedCategory}\n              onCategoryChange={handleCategoryChange}\n              selectedDifficulty={selectedDifficulty}\n              onDifficultyChange={handleDifficultyChange}\n              selectedWordPhraseFilter={selectedWordPhraseFilter}\n              onWordPhraseFilterChange={setSelectedWordPhraseFilter}\n              selectedPhraseTypeFilter={selectedPhraseTypeFilter}\n              onPhraseTypeFilterChange={setSelectedPhraseTypeFilter}\n              selectedDataSource={selectedDataSource}\n              onDataSourceChange={setSelectedDataSource}\n              onStartQuiz={handleStartQuiz}\n              onReviewFocus={handleSpellingReviewFocus}\n              isReviewFocusMode={reviewFocusMode}\n              customQuestionSets={customQuestionState.sets}\n              onAddWordToCustomSet={handleAddWordToCustomSet}\n              onRemoveWordFromCustomSet={handleRemoveWordFromCustomSet}\n              onOpenCustomSetManagement={() => setIsFloatingPanelOpen(true)}\n            />\n          ) : activeTab === 'reading' ? (\n            <ComprehensiveReadingView\n              customQuestionSets={customQuestionState.sets}\n              onAddWordToCustomSet={handleAddWordToCustomSet}\n              onRemoveWordFromCustomSet={handleRemoveWordFromCustomSet}\n              onOpenCustomSetManagement={() => setIsFloatingPanelOpen(true)}\n              onSaveUnknownWords={async (words) => {\n                // \n                if (words.length === 0) return;\n\n                const now = new Date();\n                const dateStr = `${now.getMonth() + 1}/${now.getDate()}`;\n                const defaultName = ` (${dateStr})`;\n\n                const setName = prompt(\n                  `${words.length}\\n:`,\n                  defaultName\n                );\n                if (!setName) return;\n\n                const newSet: QuestionSet = {\n                  id: generateId(),\n                  name: setName,\n                  questions: words.map((w) => ({\n                    word: w.word,\n                    reading: w.reading || '',\n                    meaning: w.meaning,\n                    etymology: w.etymology || '',\n                    relatedWords: w.relatedWords || '',\n                    relatedFields: w.relatedFields || '',\n                    difficulty: w.difficulty || 'intermediate',\n                  })),\n                  createdAt: Date.now(),\n                  isBuiltIn: false,\n                  source: '',\n                };\n                const updatedSets = [...questionSets, newSet];\n                setQuestionSets(updatedSets);\n                saveQuestionSets(updatedSets);\n\n                alert(` ${setName}${words.length}`);\n              }}\n            />\n          ) : activeTab === 'grammar' ? (\n            <GrammarQuizView />\n          ) : activeTab === 'grammar-guide' ? (\n            <GrammarGuideView />\n          ) : activeTab === 'dictionary' ? (\n            <DictionaryView />\n          ) : activeTab === 'stats' ? (\n            <StatsView\n              questionSets={questionSets}\n              allQuestions={allQuestions}\n              categoryList={categoryList}\n              onResetComplete={() => setActiveTab('stats')}\n              onQuestionSetsUpdated={reloadQuestionSets}\n            />\n          ) : (\n            <SettingsView\n              allQuestions={allQuestions}\n              _selectedDataSource={selectedDataSource}\n              _onDataSourceChange={setSelectedDataSource}\n              customQuestionSets={customQuestionState.sets}\n              onOpenCustomSetManagement={() => setIsFloatingPanelOpen(true)}\n              onStartSession={(_mode, questions) => {\n                // \n                setQuizState({\n                  questions,\n                  currentIndex: 0,\n                  score: 0,\n                  totalAnswered: 0,\n                  answered: false,\n                  selectedAnswer: null,\n                });\n                quizStartTimeRef.current = Date.now();\n                questionStartTimeRef.current = Date.now();\n                incorrectWordsRef.current = [];\n                setActiveTab('translation');\n              }}\n            />\n          )}\n        </div>\n      </div>\n    </div>\n  );\n}\n\nexport default App;\n","import React from 'react';\nimport ReactDOM from 'react-dom/client';\nimport App from './App.tsx';\nimport './index-tailwind.css';\nimport * as Sentry from '@sentry/react';\n\n// \nconst initializeDarkMode = () => {\n  const saved = localStorage.getItem('darkMode');\n  let mode: 'light' | 'dark' | 'system' = 'system';\n\n  if (saved === 'system' || saved === 'light' || saved === 'dark') {\n    mode = saved;\n  } else if (saved === 'true') {\n    // boolean\n    mode = 'dark';\n    localStorage.setItem('darkMode', 'dark');\n  } else if (saved === 'false') {\n    mode = 'light';\n    localStorage.setItem('darkMode', 'light');\n  }\n\n  // Tailwinddark\n  let isDark = false;\n  if (mode === 'system') {\n    isDark = window.matchMedia('(prefers-color-scheme: dark)').matches;\n  } else {\n    isDark = mode === 'dark';\n  }\n\n  // Tailwinddark\n  document.documentElement.classList.toggle('dark', isDark);\n};\n\n// FLASH\ninitializeDarkMode();\n\n// Sentry\n// DSN\nconst sentryDsn = import.meta.env.VITE_SENTRY_DSN || '';\nif (import.meta.env.PROD && sentryDsn && sentryDsn !== 'your-sentry-dsn-here') {\n  Sentry.init({\n    dsn: sentryDsn,\n    environment: import.meta.env.MODE,\n\n    // 10%\n    tracesSampleRate: 0.1,\n\n    // \n    replaysSessionSampleRate: 0,\n    replaysOnErrorSampleRate: 1.0,\n\n    integrations: [Sentry.browserTracingIntegration(), Sentry.replayIntegration()],\n\n    // \n    beforeSend(event, _hint) {\n      // Sentry\n      const msg = event.message || event.exception?.values?.[0]?.value || '';\n      if (\n        msg.includes('Sentry') ||\n        msg.includes('Sentry') ||\n        msg.includes(' Sentry')\n      ) {\n        return null;\n      }\n      // UIErrorLogPanel/ErrorBadge\n      const frames = event.exception?.values?.[0]?.stacktrace?.frames || [];\n      if (Array.isArray(frames)) {\n        const uiError = frames.some((f: any) => {\n          const fn = `${f.function || ''}`;\n          const file = `${f.filename || ''}`;\n          return (\n            fn.includes('ErrorLogPanel') ||\n            fn.includes('ErrorBadge') ||\n            file.includes('ErrorLogPanel') ||\n            file.includes('ErrorBadge')\n          );\n        });\n        if (uiError) return null;\n      }\n      // LocalStorage\n      if (event.exception?.values?.[0]?.value?.includes('localStorage')) {\n        return null;\n      }\n\n      // ResizeObserver\n      if (event.message?.includes('ResizeObserver')) {\n        return null;\n      }\n\n      // Service Worker\n      const errorMsg = event.exception?.values?.[0]?.value || '';\n      if (\n        errorMsg.includes('newestWorker') ||\n        errorMsg.includes('serviceWorker') ||\n        errorMsg.includes('InvalidStateError')\n      ) {\n        return null;\n      }\n\n      return event;\n    },\n  });\n}\n\nReactDOM.createRoot(document.getElementById('root')!).render(\n  <React.StrictMode>\n    <App />\n  </React.StrictMode>\n);\n"],"file":"assets/index-C4XTM80x.js"}