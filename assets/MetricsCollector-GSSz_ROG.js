var b=Object.defineProperty;var w=(u,t,e)=>t in u?b(u,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):u[t]=e;var _=(u,t,e)=>w(u,typeof t!="symbol"?t+"":t,e);class O{constructor(t){_(this,"storage");this.storage=t}logLearningOutcome(t,e,a){this.storage.logEvent({type:"learning_outcome",testId:t,variantId:e,timestamp:new Date,data:a})}logEngagement(t,e,a){this.storage.logEvent({type:"engagement",testId:t,variantId:e,timestamp:new Date,data:a})}logTrustRating(t,e,a){this.storage.logEvent({type:"trust_rating",testId:t,variantId:e,timestamp:new Date,data:a})}logFeatureInteraction(t,e,a){this.storage.logEvent({type:"feature_interaction",testId:t,variantId:e,timestamp:new Date,data:a})}summarize(t,e,a){const r=this.storage.getEvents(t,void 0,e,a);if(r.length===0)return{testId:t,byVariant:{},period:{start:e||new Date,end:a||new Date},totalEvents:0};const c=new Map;for(const i of r)c.has(i.variantId)||c.set(i.variantId,[]),c.get(i.variantId).push(i);const s={};for(const[i,o]of c)s[i]=this.calculateVariantMetrics(i,o);return{testId:t,byVariant:s,period:{start:e||r[0].timestamp,end:a||r[r.length-1].timestamp},totalEvents:r.length}}calculateVariantMetrics(t,e){const a=e.filter(n=>n.type==="learning_outcome"),r=e.filter(n=>n.type==="engagement"),c=e.filter(n=>n.type==="trust_rating"),s=e.filter(n=>n.type==="feature_interaction"),i=a.filter(n=>n.data.isCorrect).length,o=a.length,l=o>0?i/o:0,g=a.map(n=>n.data.retentionRate).filter(n=>typeof n=="number"),m=g.length>0?g.reduce((n,v)=>n+v,0)/g.length:0,f=new Set(r.map(n=>n.data.sessionId).filter(Boolean)).size||1,p=r.filter(n=>n.data.action==="question_answered").map(n=>n.data.duration).filter(n=>typeof n=="number"),y=p.length>0?p.reduce((n,v)=>n+v,0)/p.length/1e3:0,E=r.length/f,h=c.map(n=>n.data.rating),S=h.length>0?h.reduce((n,v)=>n+v,0)/h.length:0;return{variantId:t,sampleSize:f,learningOutcome:{correctRate:l,avgRetentionRate:m,totalQuestions:o},engagement:{avgSessionDuration:y,actionsPerSession:E,featureInteractions:s.length},trust:{avgRating:S,ratingCount:h.length}}}compareVariants(t,e,a,r){const c=this.summarize(t),s=c.byVariant[e],i=c.byVariant[a];if(!s||!i)throw new Error("Variant not found");let o,l,g,m;switch(r){case"correctRate":o=s.learningOutcome.correctRate,l=i.learningOutcome.correctRate,g=s.learningOutcome.totalQuestions,m=i.learningOutcome.totalQuestions;break;case"avgRetentionRate":o=s.learningOutcome.avgRetentionRate,l=i.learningOutcome.avgRetentionRate,g=s.learningOutcome.totalQuestions,m=i.learningOutcome.totalQuestions;break;case"avgRating":o=s.trust.avgRating,l=i.trust.avgRating,g=s.trust.ratingCount,m=i.trust.ratingCount;break}const d=o-l,f=l!==0?d/l*100:0,p=Math.min(g,m),y=p>=30&&Math.abs(f)>5;return{variant1:{id:e,value:o,sampleSize:g},variant2:{id:a,value:l,sampleSize:m},difference:d,relativeDifference:f,isSignificant:y,confidence:this.calculateConfidence(p,Math.abs(f))}}calculateConfidence(t,e){return t<30?0:t>=100&&e>=10?.95:t>=50&&e>=5?.9:t>=30&&e>=5?.8:.5}}let R=null;function C(){if(!R){const u={logEvent(t){const e=`ab_test_metrics_${t.testId}`,a=localStorage.getItem(e),r=a?JSON.parse(a):[];r.push({...t,timestamp:t.timestamp.toISOString()}),r.length>1e4&&r.splice(0,r.length-1e4),localStorage.setItem(e,JSON.stringify(r))},getEvents(t,e,a,r){const c=`ab_test_metrics_${t}`,s=localStorage.getItem(c);return s?JSON.parse(s).map(o=>({...o,timestamp:new Date(o.timestamp)})).filter(o=>!(e&&o.variantId!==e||a&&o.timestamp<a||r&&o.timestamp>r)):[]},getEventsByType(t,e){const a=`ab_test_metrics_${t}`,r=localStorage.getItem(a);return r?JSON.parse(r).map(s=>({...s,timestamp:new Date(s.timestamp)})).filter(s=>s.type===e):[]},clearEvents(t){const e=`ab_test_metrics_${t}`;localStorage.removeItem(e)}};R=new O(u)}return R}export{O as MetricsCollector,C as getMetricsCollector};
//# sourceMappingURL=MetricsCollector-GSSz_ROG.js.map
