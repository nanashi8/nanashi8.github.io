name: Swift Code Quality Check

on:
  push:
    branches: [ main, develop ]
  pull_request:
    branches: [ main, develop ]

jobs:
  swiftlint:
    name: SwiftLint Check
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Install SwiftLint
      run: brew install swiftlint
    
    - name: Run SwiftLint
      run: swiftlint lint --reporter github-actions-logging
    
  deprecated-patterns:
    name: Check for Deprecated Patterns
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Check for deprecated onChange syntax
      run: |
        echo "üîç Checking for deprecated onChange syntax..."
        if grep -r "\.onChange(of:.*) { _ in" SimpleWord/; then
          echo "‚ùå ERROR: Found deprecated onChange syntax with underscore parameter"
          exit 1
        else
          echo "‚úÖ No deprecated onChange syntax found"
        fi
    
    - name: Check for NavigationView usage
      run: |
        echo "üîç Checking for NavigationView usage..."
        if grep -r "NavigationView" SimpleWord/; then
          echo "‚ö†Ô∏è  WARNING: NavigationView is deprecated in iOS 16+"
          echo "Consider migrating to NavigationStack when iOS 15 support is dropped"
        else
          echo "‚úÖ No NavigationView usage found"
        fi
  
  build:
    name: Build Project
    runs-on: macos-latest
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v3
    
    - name: Select Xcode version
      run: sudo xcode-select -s /Applications/Xcode.app
    
    - name: Build project
      run: |
        xcodebuild clean build \
          -project SimpleWord.xcodeproj \
          -scheme SimpleWord \
          -destination 'platform=iOS Simulator,name=iPhone 15' \
          | tee build.log
    
    - name: Check for deprecation warnings
      run: |
        echo "üîç Checking for deprecation warnings in build log..."
        if grep -i "deprecated" build.log; then
          echo "‚ö†Ô∏è  WARNING: Found deprecation warnings in build"
          grep -i "deprecated" build.log
          exit 1
        else
          echo "‚úÖ No deprecation warnings found"
        fi
