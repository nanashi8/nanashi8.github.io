# yaml-language-server: $schema=https://json.schemastore.org/github-workflow.json

name: Quality Check Strategy (Reusable)

on:
  workflow_call:
    inputs:
      strategy:
        required: true
        type: string
        description: 'ãƒã‚§ãƒƒã‚¯æˆ¦ç•¥: lint | test | build | security | css'
      node-version:
        required: false
        type: string
        default: '20'
        description: 'Node.jsãƒãƒ¼ã‚¸ãƒ§ãƒ³'
    outputs:
      result:
        description: 'ãƒã‚§ãƒƒã‚¯çµæœ (success/failure)'
        value: ${{ jobs.check.outputs.result }}

jobs:
  check:
    name: ${{ inputs.strategy }} ãƒã‚§ãƒƒã‚¯
    runs-on: ubuntu-latest
    outputs:
      result: ${{ steps.execute.outputs.result }}

    steps:
      - name: ãƒã‚§ãƒƒã‚¯ã‚¢ã‚¦ãƒˆ
        uses: actions/checkout@v4

      - name: Workspace Setup
        uses: ./.github/actions/setup-workspace
        with:
          node-version: ${{ inputs.node-version }}

      - name: Execute Strategy
        id: execute
        run: |
          echo "ğŸ” å®Ÿè¡Œæˆ¦ç•¥: ${{ inputs.strategy }}"

          case "${{ inputs.strategy }}" in
            "lint")
              echo "ğŸ“ ESLintå®Ÿè¡Œä¸­..."
              npm run lint
              ;;
            "css")
              echo "ğŸ¨ Stylelintå®Ÿè¡Œä¸­..."
              npm run lint:css
              ;;
            "test")
              echo "ğŸ§ª ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆå®Ÿè¡Œä¸­..."
              npm run test:unit
              ;;
            "build")
              echo "ğŸ”¨ TypeScriptå‹ãƒã‚§ãƒƒã‚¯ & ãƒ“ãƒ«ãƒ‰å®Ÿè¡Œä¸­..."
              npm run typecheck
              npm run build
              ;;
            "security")
              echo "ğŸ”’ ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£ç›£æŸ»å®Ÿè¡Œä¸­..."
              npm audit --audit-level=high || echo "::warning::ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£è„†å¼±æ€§ãŒæ¤œå‡ºã•ã‚Œã¾ã—ãŸ"
              ;;
            *)
              echo "::error::Unknown strategy: ${{ inputs.strategy }}"
              exit 1
              ;;
          esac

          echo "result=success" >> $GITHUB_OUTPUT
          echo "âœ… ${{ inputs.strategy }} ãƒã‚§ãƒƒã‚¯æˆåŠŸ"
