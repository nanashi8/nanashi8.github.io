# リファクタリングプロンプト

**対象**: 既存コードの構造改善や最適化

---

## リファクタリングの原則

### 1. 既存の設計パターンを維持
- Feature-First / Vertical Slice Architectureを維持
- 既存の命名規則や構造を尊重
- アーキテクチャの一貫性を保つ

### 2. 単一の実装・単一路線・単一管理点
- 複数の実装がある場合は一つに統合
- 重複コードを排除
- 共通部分は適切に抽出

### 3. シンプルさの維持
- 過度な抽象化は避ける
- 読みやすさを優先
- オーバーエンジニアリングを避ける

---

## リファクタリング指針

### ファイル分割
**分割すべきタイミング**:
- View ファイル: 200〜300行を超える
- ViewModel ファイル: 300〜400行を超える
- 複数の独立した機能が混在している
- テストが書きにくい構造になっている

**分割パターン**:
```
Features/〇〇/
├── 〇〇View.swift (メイン画面、100〜200行)
├── 〇〇ViewModel.swift (メインロジック、150〜300行)
├── Components/ (UI部品)
│   ├── 〇〇HeaderView.swift
│   └── 〇〇ContentView.swift
├── Services/ (ビジネスロジック)
│   └── 〇〇DataLoader.swift
└── Models/ (データ構造)
    └── 〇〇Model.swift
```

### 責務の整理
- **View**: UI表示のみ、ロジックを含まない
- **ViewModel**: プレゼンテーションロジック、状態管理
- **Model**: データ構造とバリデーション
- **Service**: ビジネスロジック、外部依存

### テストコードの保護
- テストコードがある場合は破壊しない
- リファクタリング後もテストが通ることを確認
- 必要に応じてテストを追加・更新

---

## リファクタリング手順

1. **現状把握**
   - リファクタリング対象の範囲を明確化
   - 依存関係を確認
   - テストの有無を確認

2. **計画策定**
   - 分割・統合の方針を決定
   - 影響範囲を特定
   - 段階的な実施計画を立てる

3. **実施**
   - 小さな単位で段階的に実施
   - 各ステップで動作確認
   - コミットを細かく分ける

4. **検証**
   - 既存機能が動作することを確認
   - テストが通ることを確認
   - コードレビューを実施

---

## 注意事項

### 避けるべきこと
- 過度な分割（10行程度のファイルを大量に作る）
- 不必要な抽象化レイヤーの追加
- 既存の動作を変更する
- テストコードの削除

### 推奨すること
- 密接に関連する処理は同じファイルに置く
- ファイル名で役割が明確に分かるようにする
- 日本語コメントで意図を説明
- 既存の仕組みを最大限活用

---

## チェックリスト

- [ ] 既存の設計パターンを維持した
- [ ] 単一の実装・単一路線に集約した
- [ ] 過度な抽象化を避けた
- [ ] テストコードを破壊していない
- [ ] 小さな単位で段階的に実施した
- [ ] 既存機能が正常に動作することを確認した
- [ ] 日本語コメントで意図を説明した
- [ ] ファイル名で役割が明確に分かる
