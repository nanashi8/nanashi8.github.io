# 01. 開発履歴

**作成日**: 2025年11月5日  
**最終更新**: 2025年11月5日

---

## 📋 概要

SimpleWordアプリの開発における主要なマイルストーンと改善の履歴を時系列で記録します。

---

## 🗓️ 2025年10月

### 10月23日: 初期リファクタリングと機能復元

#### リファクタリング実施
- QuizViewの大規模なコードベースを分割
- コンポーネント指向の設計に移行
- 各機能を独立したコンポーネントに分離

#### 機能復元完了（8項目）

**1. タイマー機能**
- 問題ごとの制限時間設定
- 残り時間のカウントダウン表示（残り10秒以下で赤色警告）
- 時間切れ時の自動処理

**2. 音声読み上げ機能**
- AVFoundationを使用した日本語音声読み上げ
- 語句と読みを自動で読み上げ
- 設定でON/OFF可能

**3. 補修モード**
- 低正答率単語が50%以上の場合に自動発動
- 苦手な単語を集中的に出題
- 繰り返し回数を4倍に増加

**4. バッチ評価機能**
- バッチ終了時に成功率を判定
- 成功時はバッチサイズを増加
- 不合格時は最大3回まで再試行
- クイズ結果を自動保存

**5. ローテーション機能**
- 習熟した単語を低出題回数単語と入れ替え
- 学習の均等化を実現

**6. 個別繰り返し回数計算**
- 単語ごとに最適な繰り返し回数を動的計算
- 正答率に応じて1〜12回まで調整

**7. 学習モード表示**
- 設定画面で選択したモードを正確に表示
- 通常/復習/補習の3モードに対応

**8. 応答時間計測**
- 実際の応答時間を正確に計測
- AdaptiveSchedulerに記録して学習分析に活用

#### エラー解決体制の確立

**背景**:
- ContentViewからQuizViewへの画面遷移が動作せず、10回以上の修正試行でも解決できなかった
- 環境オブジェクトの注入漏れ、`.onReceive`による無限ループなどが発生

**改善策**:
- `ERROR_RESOLUTION_PROTOCOL.md`の作成
- エラー解決の4フェーズ標準手順を確立
- SwiftUI頻出エラーパターン集の整備
- ビルド成功 ≠ 正常動作の原則を明文化

---

### 10月24日: ファイル混入問題の解決とポリシー確立

#### ファイル混入問題の発生と解決

**発生した問題**:
- QuizView.swiftにREADME.mdの内容が混入（2回）
- README.mdにPythonスクリプトが混入

**対応**:
- 混入内容を適切な場所に保存
  - Pythonスクリプト → `Tools/translate_relatedfields_categories.py`
  - 正しいREADME → `README_RECOVERED.md`
- gitコマンドを使わず仕様書とコンポーネントから完全再構築

#### QuizView完全復元
- 約600行のコードを仕様書ベースで再構築
- すべての機能を正常に復元
- エラー・警告: 0件

#### シミュレーションポリシーの導入

**作成したドキュメント**:
- `SIMULATION_POLICY.md`: AIのビルド/シミュレーター実行に関する事前確認モード
- `AI_WORK_TEMPLATE.md`: ポリシーを適用した作業テンプレート

**確立したルール**:
- 実装 → 説明 → **事前確認** → 実行 → 報告のフロー
- 実行レベル一覧（L0〜L4）の定義
- 自動実行可能な項目と確認必須項目の明確化

---

### 10月25日: Copilot Prompt Files診断と最適化

#### Prompt Files構造の診断

**発見した問題**:
1. `.github/copilot-instructions.md`が空
2. `.github/prompts/PromptFiles.prompt.md`に複数の`applyTo`が混在
3. ファイル名の誤字（Custum → Custom）

**実施した修正**:
- Swift専用プロンプト: `.github/prompts/swift.prompt.md` ✓
- CSV専用プロンプト: `.github/prompts/csv.prompt.md` ✓
- グローバル設定の分離と最適化

---

### 10月27日: CSVヘッダ駆動型パーサの実装

#### ヘッダ駆動型アーキテクチャへの移行

**背景**:
- 固定列インデックス（0, 1, 2, ...）に依存した実装
- CSV種類ごとに異なる列構成への対応が困難

**実装内容**:
1. **HeaderLabels構造体**の導入
   - CSVヘッダを解析して各列の役割を識別
   - `term`, `reading`, `meaning`などのキーに自動マッピング

2. **QuestionItem構造体**の拡張
   - 7つの標準フィールド + ヘッダラベル情報を保持
   - CSV種類を問わず統一的にデータアクセス

3. **CSVParser**の改良
   - ヘッダ行からHeaderLabelsを生成
   - 各データ行をHeaderLabelsに基づいて解析

**メリット**:
- CSV種類（中学歴史、古典単語、英単語など）への柔軟な対応
- 新しいCSV形式の追加が容易
- コードの可読性と保守性の向上

---

### 10月28日: CSV種類別表示順序の最適化

#### 選択肢カード詳細表示の改善

**実装内容**:

**1. CSV種類の自動判定**
```swift
enum CSVType {
    case history    // 中学歴史
    case classical  // 中学古典単語
    case english    // 中学英単語・英熟語・英会話・xcode
}
```

**2. 各CSV種類別の最適な表示順序**

**中学歴史**:
- 年号 → 史実名 → 解説 → 登場人物 → 関連史実 → 関連分野 & 難易度
- 時系列がわかる「年号」を最初に表示

**中学古典単語**:
- 語句 → 発音 → 意味 → 用法 → 関連語 → 関連分野 & 難易度
- 「語句」と「読み」を並べて表示（古典単語の学習に重要）

**中学英単語・英熟語・英会話**:
- 語句(発音) → 和訳 → 語源等解説 → 関連語と意味 → 関連分野 & 難易度
- 発音を語句の直後に括弧付きで表示（英語学習に重要）

**3. 共通仕様**
- メインテキストとの重複回避（meaning は詳細で非表示）
- 関連分野と難易度の1行表示
- 動的なラベル表示（CSVヘッダの実際の列名を優先）

---

### 10月下旬: CSV固定列選択肢生成の確立

#### 選択肢生成ロジックの最適化

**重要な決定**:
- 選択肢は**CSV固定列3（`rawColumns[2]`：意味/和訳/史実名）**から生成
- ヘッダ駆動型パーサの影響を受けない正確な選択肢表示
- すべてのCSV種類で一貫した動作を保証

**実装ファイル**:
- `SimpleWord/QuizComponents/ChoiceCardView.swift`
- `SimpleWord/QuizComponents/QuizChoicesView.swift`

---

### 11月初旬: コード整理と簡素化

#### 重複コードの削除

**実施内容**:
- 未使用の古いビュー・モデル・ストアの削除
- 参考資料の整理とアーカイブ
- プロジェクト構造の最適化

#### ドキュメント体系の確立

**新しい構造**:
```
docs/
├── 01_仕様書/
├── 02_実装ガイド/
├── 03_開発ガイド/
├── 04_レポート/
└── 99_アーカイブ/
```

---

## 🎯 主要な成果

### アーキテクチャ
✅ ヘッダ駆動型CSVパーサの確立  
✅ コンポーネント指向の設計への移行  
✅ 環境オブジェクトの適切な管理  
✅ 単一の実装・単一路線・単一管理点の原則

### 機能
✅ 適応型学習アルゴリズム  
✅ CSV種類別の最適な表示順序  
✅ バッチ学習と補修モード  
✅ タイマー・音声読み上げ機能

### 開発プロセス
✅ エラー解決プロトコルの確立  
✅ シミュレーションポリシーの導入  
✅ AI支援開発のベストプラクティス  
✅ 体系的なドキュメント管理

### コード品質
✅ エラー・警告: 0件  
✅ テスタビリティの向上  
✅ 可読性・保守性・拡張性の確保  
✅ オーバーエンジニアリングの回避

---

## 📚 関連ドキュメント

- **仕様書**: `docs/01_仕様書/`
- **実装ガイド**: `docs/02_実装ガイド/`
- **開発ガイド**: `docs/03_開発ガイド/`
- **アーキテクチャ**: `docs/01_仕様書/02_アーキテクチャ仕様書.md`

---

**以上、SimpleWordアプリの開発履歴をまとめました。** 📝
