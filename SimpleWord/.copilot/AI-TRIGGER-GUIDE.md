# AI自動実行トリガーガイド

このガイドは、AI（GitHub Copilot）が特定のフレーズで**自動的に作業を実行**するための仕組みです。

---

## 🤖 自動バージョン管理

### トリガーフレーズ

以下のフレーズのいずれかを言うと、AIが**完全自動で**バージョン管理を実行します：

```
✅ "バージョン管理してください"
✅ "バージョン管理して"
✅ "バージョニングしてください"
✅ "新しいバージョンを作成"
✅ "リリース準備"
✅ "ブランチを切って"
```

### 自動実行される内容

1. **現在の状態を分析**
   - ブランチ名の確認
   - 変更行数の計算
   - 変更タイプの判定

2. **バージョン番号を自動決定**
   - 1000行以上 → メジャーアップデート (v1.0.0)
   - 100-999行 → マイナーアップデート (v0.6.0)
   - 100行未満 → パッチアップデート (v0.5.1)

3. **新しいブランチを作成**
   - 命名規則: `v{version}_{type}/{description}`
   - 例: `v1.2.0_feature/quizview-complete`

4. **コミットとタグを作成**
   - 意味のあるコミットメッセージを自動生成
   - バージョンタグを付与

5. **ドキュメントを自動生成**
   - `.copilot/versions/v{version}-{description}.md`
   - `.copilot/changelog.md` を更新
   - `.copilot/structure-map.md` を更新

6. **ビルドテストを実行**
   - Xcodeビルドを自動実行
   - 結果を記録

7. **完了レポートを表示**
   - 何が実行されたかをレポート
   - 次のステップを提案

---

## 📋 使用例

### シナリオ1: QuizView実装完了後

**ユーザー**: 「バージョン管理してください」

**AI自動実行**:
```bash
# 1. 分析
現在のブランチ: v0.5.0
変更行数: 264行
判定: メジャーアップデート

# 2. バージョン決定
新しいバージョン: v1.2.0

# 3. ブランチ作成
git checkout -b v1.2.0_feature/quizview-complete

# 4. コミットとタグ
git commit -m "feat: QuizView v1.2.0 完全実装"
git tag -a v1.2.0

# 5. ドキュメント生成
作成: .copilot/versions/v1.2.0-complete.md
更新: .copilot/changelog.md

# 6. ビルドテスト
✅ BUILD SUCCEEDED

# 7. レポート表示
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
  バージョン管理完了レポート
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
✅ ブランチ作成: v1.2.0_feature/quizview-complete
✅ コミット作成: c7ad702
✅ タグ作成: v1.2.0
✅ ドキュメント生成: 完了
✅ ビルドテスト: ✅ BUILD SUCCEEDED
━━━━━━━━━━━━━━━━━━━━━━━━━━━━━
```

**ユーザーは何もする必要がありません！**

---

### シナリオ2: バグ修正後

**ユーザー**: 「バージョン管理して」

**AI自動実行**:
```bash
# 分析
現在のブランチ: v1.2.0_feature/quizview-complete
変更行数: 15行
判定: パッチアップデート

# バージョン決定
新しいバージョン: v1.2.1

# ブランチ作成
git checkout -b v1.2.1_bugfix/fix-timer-issue

# [以下同様に自動実行]
```

---

## 🛠️ 手動実行（オプション）

AIが自動実行できない場合や、細かい制御が必要な場合：

```bash
# スクリプトを直接実行
.copilot/scripts/auto-version.sh "説明文"

# 例:
.copilot/scripts/auto-version.sh "quizview-complete"
```

---

## 📊 バージョン判定ルール

| 変更行数 | バージョンタイプ | 例 | 説明 |
|---------|----------------|-----|------|
| 1000行以上 | メジャー | v0.5.0 → v1.0.0 | 大規模な機能追加・変更 |
| 100-999行 | マイナー | v1.0.0 → v1.1.0 | 中規模の機能追加 |
| 1-99行 | パッチ | v1.1.0 → v1.1.1 | バグ修正・小規模変更 |

---

## 🌿 ブランチ命名規則

```
v{バージョン}_{タイプ}/{説明}

例:
v1.2.0_feature/quizview-complete
v1.2.1_bugfix/fix-crash
v1.3.0_refactor/improve-performance
```

**タイプ**:
- `feature`: 新機能
- `bugfix`: バグ修正
- `refactor`: リファクタリング
- `docs`: ドキュメント更新
- `test`: テスト追加

---

## 📁 生成されるファイル

### 1. バージョンドキュメント
`.copilot/versions/v{version}-{description}.md`

内容:
- 変更内容のサマリー
- 統計情報
- 変更ファイルリスト
- コミット情報
- 次のステップ

### 2. Changelog更新
`.copilot/changelog.md`

追加内容:
- 日付とバージョン
- 変更内容
- 影響範囲

### 3. Structure Map更新
`.copilot/structure-map.md`

追加内容:
- 新しいバージョンのアーキテクチャ
- 変更箇所のハイライト

---

## ⚙️ カスタマイズ

### 設定ファイル
`.copilot/auto-version-config.json`

```json
{
  "version_thresholds": {
    "major": 1000,  // メジャーアップデートの行数閾値
    "minor": 100,   // マイナーアップデートの行数閾値
    "patch": 1      // パッチアップデートの行数閾値
  },
  "auto_build_test": true,  // ビルドテストを自動実行
  "auto_generate_docs": true  // ドキュメントを自動生成
}
```

---

## ✅ チェックリスト

AIが自動で実行する項目：

- [x] 現在のブランチを確認
- [x] 変更内容を分析
- [x] 適切なバージョン番号を決定
- [x] ブランチ命名規則に従う
- [x] 新しいブランチを作成
- [x] コミットとタグを作成
- [x] バージョンドキュメントを生成
- [x] Changelogを更新
- [x] Structure Mapを更新
- [x] ビルドテストを実行
- [x] 完了レポートを表示
- [x] 次のステップを提案

---

## 🚀 まとめ

### ユーザーがすること
```
「バージョン管理してください」と言うだけ
```

### AIがすること
```
✅ ブランチ作成
✅ コミット
✅ タグ付け
✅ ドキュメント生成
✅ Changelog更新
✅ Structure Map更新
✅ ビルドテスト
✅ レポート作成
✅ 次のステップ提案
```

**完全自動化！ユーザーは何もする必要がありません！** 🎉

---

## 📞 トラブルシューティング

### ビルドエラーが出た場合

**AI**: 
```
❌ ビルドエラーが検出されました

エラー: [エラーメッセージ]

推奨アクション:
1. エラーを修正
2. もう一度「バージョン管理してください」と言う
```

### コンフリクトが発生した場合

**AI**:
```
⚠️ マージコンフリクトが検出されました

対象ファイル: [ファイルリスト]

推奨アクション:
1. コンフリクトを手動で解決
2. git add [ファイル]
3. 「バージョン管理を続けて」と言う
```

---

## 🎯 今後の拡張

- [ ] 自動テスト実行
- [ ] 自動デプロイ
- [ ] Pull Request自動作成
- [ ] Slackへの通知
- [ ] メール通知

---

**このシステムにより、バージョン管理が完全に自動化されました！** 🚀
