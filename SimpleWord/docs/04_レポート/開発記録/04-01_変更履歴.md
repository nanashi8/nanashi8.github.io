# 04-01 変更履歴（CHANGELOG）

**文書番号**: 04-01  
**最終更新**: 2025-11-04  
**バージョン**: 2.0  
**ステータス**: 最新

---

## 📋 概要

このドキュメントは、SimpleWordプロジェクトの主要な変更を時系列で記録します。

**記録対象**:
- 機能追加・変更
- バグ修正
- アーキテクチャ変更
- パフォーマンス改善
- ドキュメント更新

---

## [2025-11-04] ドキュメント体系の整理

### 変更内容

プロジェクト全体のドキュメントを体系的に整理し、ナンバリングシステムを導入しました。

### 新規作成されたドキュメント

**00_INDEX.md**: 全体インデックス

**01_仕様書/**:
- `01-01_プロジェクト概要.md`
- `01-02_アーキテクチャ仕様.md`
- `01-04_CSV仕様.md`

**02_実装ガイド/**:
- `02-02_コーディング規約.md`

**03_開発ガイド/**:
- `03-04_AI活用ガイド.md`

**04_レポート/**:
- `04-01_変更履歴.md`（本ファイル）

### アーカイブされたドキュメント

以下のドキュメントを`99_アーカイブ/`に移動：
- 日付付きレポート（`*_20251023.md`など）
- 旧バージョンの仕様書
- 開発途中のドラフト

### メリット

- ✅ ドキュメントが体系的に整理された
- ✅ 目的別に素早くアクセスできる
- ✅ 新規参加者がプロジェクトを理解しやすくなった
- ✅ ドキュメントのメンテナンスが容易になった

---

## [2025-10-28] CSV種類別表示順序の実装

### 実装内容

回答後の選択肢カードの詳細表示を、CSV種類（中学歴史、中学古典単語、中学英単語・英会話など）に応じて最適な順序で表示するように実装しました。

### CSV種類の定義

```swift
private enum CSVType {
    case history    // 中学歴史
    case classical  // 中学古典単語
    case english    // 中学英単語・英熟語・英会話・xcode
}
```

### 判定方法

CSVヘッダラベルの内容から自動判定：
- **中学歴史**: `term`に「年号」、`reading`に「登場人物」、`meaning`に「史実」が含まれる
- **中学古典単語**: `reading`に「ひらがな」が含まれる
- **中学英単語・英会話**: `reading`に「カタカナ」または「発音」が含まれる

### 各CSV種類別の表示順序

#### 中学歴史
**表示順序**: 年号 → 史実名（表示済み） → 解説 → 登場人物 → 関連史実 → 関連分野 & 難易度

#### 中学古典単語
**表示順序**: 語句 → 発音 → 意味（表示済み） → 用法 → 関連語 → 関連分野 & 難易度

#### 中学英単語・英会話・xcode
**表示順序**: 語句(発音) → 和訳（表示済み） → 語源等解説 → 関連語と意味 → 関連分野 & 難易度

### 更新ファイル

- `SimpleWord/QuizComponents/ChoiceCardView.swift` - CSV種類別表示ロジックを実装

### 関連レポート

- `CSV_TYPE_SPECIFIC_DISPLAY_REPORT.md`

---

## [2025-10-27] CSVヘッダ更新対応

### 変更内容

CSVファイルのヘッダを手動修正したことに伴い、関連するコードとドキュメントを更新しました。

### 修正されたCSVヘッダ

#### 中学英会話.csv
```
語句,発音（カタカナ）,和訳,語源等解説（日本語）,関連語（英語）と意味（日本語）,関連分野（日本語）,難易度
```

#### 中学古典単語.csv
```
語句,読み（ひらがな）,意味,語源等解説（日本語）,関連語と意味,関連分野,難易度
```

### 更新ファイル

- `Common/Data/Schema/QuestionItemCSVSchema.swift` - ヘッダ候補に新しい列名を追加
- `Common/Data/DataSource/CSVDataSource.swift` - ヘッダ検出トークンを更新
- `SimpleWord/Utils/CSVLoader.swift` - ヘッダ検出トークンを更新
- `SimpleWord/Features/Quiz/Views/QuizView.swift` - ヘッダマッピングロジックを更新
- `SimpleWord/QuizComponents/ChoiceCardView.swift` - 発音表示機能を追加

### 新機能

**回答後の選択肢カードで発音表示**:
- CSVの2列目が「発音（カタカナ）」の場合、語句の後ろに発音を表示
- 表示例: `Hello! (ハロー)`
- 「読み（ひらがな）」などの場合は、従来通り独立した行として表示

### 関連レポート

- `CSV_HEADER_UPDATE_REPORT_20251027_v2.md`
- `CSV_HEADER_DRIVEN_IMPLEMENTATION_REPORT.md`

---

## [2025-10-27] CSV固定列選択肢生成の実装

### 問題

選択肢生成がヘッダ駆動型パーサの影響を受け、CSV種類によって意図しない選択肢が表示される問題がありました。

### 解決策

選択肢を**CSV固定列3（`rawColumns[2]`：意味/和訳/史実名）**から生成するように変更しました。

### 実装内容

```swift
// 正解の選択肢をrawColumns[2]から取得
let correctAnswer = correctItem.rawColumns.count > 2 
    ? correctItem.rawColumns[2] 
    : correctItem.meaning

// 不正解の選択肢もrawColumns[2]から取得
let wrongChoices = otherItems
    .map { $0.rawColumns.count > 2 ? $0.rawColumns[2] : $0.meaning }
```

### メリット

- ✅ CSV種類に関わらず正確な選択肢が表示される
- ✅ ヘッダ駆動型パーサの影響を受けない
- ✅ 一貫した動作が保証される

### 更新ファイル

- `SimpleWord/Features/Quiz/Views/QuizView.swift` - 選択肢生成ロジックを修正

### 関連レポート

- `CSV_FIXED_COLUMN_CHOICE_GENERATION_REPORT.md`
- `CSV_FIXED_COLUMN_CHOICE_GENERATION_SUMMARY.md`

---

## [2025-10-27] QuizView出題不具合修正

### 問題

- QuizViewでCSVを読み込んでも問題が出題されない不具合

### 原因

1. `CSVLoader.load(from:)` がURL引数を無視し、常にBundleから読み込んでいた
2. セッション復元時に `batchSize` が0の場合、バッチ準備が空になり即終了
3. `repeatCount` が0の場合、出題プールが空になり即完了

### 修正内容

- `CSVLoader.swift` - URL指定時に実ファイルを直接読み込むように修正
- `QuizSessionStore.swift` - `batchSize` を最小1にクランプ
- `QuizView.swift` - `repeatCount` を最小1にクランプ（既存実装）
- `LegacyCSVLoaderAdapter.swift` - エラー型の互換性修正

### 仕様

- 列数は7列固定を維持
- 先頭行のヘッダはスキップ（ラベル表示用に別途読み込み）
- Documents配下のCSVも正しく読み込まれるように改善

### 更新ファイル

- `SimpleWord/Utils/CSVLoader.swift`
- `SimpleWord/Stores/QuizSessionStore.swift`
- `SimpleWord/Features/Quiz/Views/QuizView.swift`
- `SimpleWord/Utils/LegacyCSVLoaderAdapter.swift`

### 関連レポート

- `CHANGELOG.md` - 詳細な変更記録

---

## [2025-10-25] 適応型学習システム導入

### 追加機能

- 6段階の記憶定着度管理（未学習→習熟済み）
- SM-2アルゴリズムベースの出題間隔調整
- 学習モード（通常/復習/補習）の導入
- 記憶定着度の可視化

### 新規ファイル

- `Features/Study/Domain/MemoryStage.swift` - 記憶段階モデル
- `Features/Study/Domain/StudyRecord.swift` - 学習履歴モデル
- `Features/Study/Logic/AdaptiveScheduler.swift` - 適応型スケジューラ
- `Features/Study/Logic/MemoryConsolidationTracker.swift` - 記憶定着追跡

### 更新ファイル

- `QuizView.swift` - 適応型学習システムの統合
- `QuizSettings.swift` - 学習モードの追加

### 関連ドキュメント

- `ADAPTIVE_LEARNING_GUIDE.md` - 学習アルゴリズムの詳細

---

## [2025-10-23] Feature-First Architecture への移行

### アーキテクチャ変更

従来のレイヤー分離型から Feature-First / Vertical Slice Architecture へ移行しました。

### 主な変更

- `Features/` ディレクトリの新設
- 機能ごとのディレクトリ構成（Quiz, Study, etc.）
- 各機能内で Views, Logic, Domain を垂直統合

### メリット

- 機能追加・修正時の影響範囲が明確化
- コードの可読性と保守性の向上
- チーム開発時の並行作業が容易

### 移行されたコンポーネント

- クイズ機能 → `Features/Quiz/`
- 学習管理 → `Features/Study/`
- CSV管理 → `Features/CSV/`
- 成績管理 → `Features/Statistics/`

### 関連ドキュメント

- `01-02_アーキテクチャ仕様.md`
- `FOLDER_REORGANIZATION_FINAL_REPORT.md`

---

## [2025-10-22] リファクタリングとコード整理

### 実施内容

- 非推奨構文の削除
- コードの重複を削除
- 命名規則の統一
- コメントの日本語化

### 更新ファイル

複数のファイルにわたる広範囲なリファクタリング。

### 関連ドキュメント

- `SIMPLIFICATION_COMPLETION_REPORT.md`
- `DEPRECATION_GUIDE.md`

---

## [2025-10-20] プロジェクト開始

### 初期実装

- 基本的なクイズ機能
- CSVファイル読み込み
- 成績管理の基礎

---

## 📚 関連ドキュメント

- **詳細レポート**: `04_レポート/` 内の各レポート
- **アーキテクチャ**: `01-02_アーキテクチャ仕様.md`
- **CSV仕様**: `01-04_CSV仕様.md`

---

## 📝 変更記録のガイドライン

### 記録すべき変更

- ✅ 新機能の追加
- ✅ 既存機能の変更
- ✅ バグ修正
- ✅ パフォーマンス改善
- ✅ アーキテクチャ変更
- ✅ ドキュメント更新（重要なもの）

### 記録しなくてよい変更

- ❌ タイポ修正
- ❌ コメントの微修正
- ❌ 内部的なリファクタリング（動作に影響なし）

### 記録フォーマット

```markdown
## [YYYY-MM-DD] 変更タイトル

### 変更内容
[変更の概要]

### 更新ファイル
- ファイルパス1
- ファイルパス2

### メリット
- ✅ メリット1
- ✅ メリット2

### 関連ドキュメント
- ドキュメント名
```

---

**文書履歴**:
- 2025-11-04: 初版作成、既存のCHANGELOG.mdを統合

**管理者**: SimpleWord開発チーム
