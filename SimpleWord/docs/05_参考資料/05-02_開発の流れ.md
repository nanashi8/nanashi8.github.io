# 05-02 開発の流れ（ワークフロー）

**対象**: プログラミング初心者・学生向け  
**目的**: 実際の開発作業の手順を理解する

---

## 📚 目次

1. [全体の流れ（大まかな地図）](#全体の流れ大まかな地図)
2. [詳しいステップ解説](#詳しいステップ解説)
3. [Pull Request（PR）って何？](#pull-requestprって何)
4. [レビューとマージ](#レビューとマージ)
5. [実際の作業例](#実際の作業例)

---

## 全体の流れ（大まかな地図）

### 🗺️ 開発の流れ（全体像）

```
開始
 │
 ├─ ① 最新版を取得（git pull）
 │     「最新の地図をダウンロード」
 │
 ├─ ② ブランチを作成（git switch -c）
 │     「自分の作業場所を作る」
 │
 ├─ ③ コードを編集
 │     「プログラムを書く・修正する」
 │
 ├─ ④ 動作確認・テスト
 │     「ちゃんと動くか確認」
 │
 ├─ ⑤ コミット（git commit）
 │     「セーブする」
 │
 ├─ ⑥ プッシュ（git push）
 │     「GitHub にアップロード」
 │
 ├─ ⑦ Pull Request 作成
 │     「レビューしてください！」と依頼
 │
 ├─ ⑧ レビュー・修正
 │     「指摘を受けて直す」
 │
 ├─ ⑨ CI チェック
 │     「自動テストが走る」
 │
 └─ ⑩ マージ
       「本番（main）に反映」
       
完了！ 🎉
```

---

## 詳しいステップ解説

### ステップ① 最新版を取得

**目的**: 他の人の変更を取り込んで、最新の状態にする

```bash
# main ブランチに移動
git switch main

# 最新版をダウンロード
git pull origin main
```

**なぜ必要？**
- 他の人が変更している可能性がある
- 古い状態で作業すると、後で衝突（コンフリクト）が起きる

**イメージ**:
```
あなた    A ─────────────── ?（古い）
他の人    A ──B──C──D──E   （最新）
         ↑
       共通の出発点

pull すると...
あなた    A ──B──C──D──E   （最新！）
```

---

### ステップ② ブランチを作成

**目的**: 作業用の「枝」を作る（main を汚さない）

```bash
# 新しいブランチを作成して移動
git switch -c feature/add-new-button

# 確認
git branch
```

**ブランチ名の付け方**:
```
feature/〇〇   → 新機能追加
fix/〇〇      → バグ修正
refactor/〇〇 → コード整理
docs/〇〇     → ドキュメント更新
```

**例**:
- `feature/add-timer` - タイマー機能を追加
- `fix/crash-on-start` - 起動時のクラッシュを修正
- `refactor/simplify-code` - コードをシンプルにする

---

### ステップ③ コードを編集

**目的**: 実際にプログラムを書く・修正する

**作業の流れ**:
1. VS Code やエディタでファイルを開く
2. コードを書く・修正する
3. こまめに保存（⌘+S / Ctrl+S）

**ポイント**:
- 小さな単位で作業する（1つの機能ずつ）
- コメントを書く（後で自分が読んでもわかるように）
- 日本語コメントOK（このプロジェクトでは推奨）

---

### ステップ④ 動作確認・テスト

**目的**: 作った機能がちゃんと動くか確認

```bash
# Xcode でビルド
⌘+B

# 実行してテスト
⌘+R

# シミュレータで動作確認
```

**確認すること**:
- [ ] エラーが出ないか
- [ ] 想定通りに動くか
- [ ] 他の機能を壊していないか
- [ ] アプリが落ちないか

---

### ステップ⑤ コミット（セーブ）

**目的**: 変更を記録する

```bash
# 変更したファイルを確認
git status

# 全ての変更をステージに追加
git add .

# コミット（メッセージを付けてセーブ）
git commit -m "Add timer button to quiz screen"
```

**良いコミットメッセージの例**:
```
✅ 良い例
- Add timer button to quiz screen
- Fix crash when loading empty CSV
- Update quiz settings layout

❌ 悪い例
- test
- 修正
- aaa
```

**コミットメッセージのルール**:
- 英語で書く（50文字以内）
- 何をしたか明確に書く
- 過去形ではなく現在形（Add / Fix / Update）

---

### ステップ⑥ プッシュ（アップロード）

**目的**: ローカルの変更を GitHub に送る

```bash
# リモートにプッシュ
git push origin feature/add-new-button
```

**初回プッシュの場合**:
```bash
# ブランチを作成してプッシュ
git push -u origin feature/add-new-button
# -u オプション: 次回から git push だけでOKになる
```

**イメージ**:
```
ローカル（あなたのPC）     GitHub（クラウド）
  📁                   →     ☁️
  feature/add-button        feature/add-button
```

---

### ステップ⑦ Pull Request（PR）作成

**目的**: 「レビューしてください！」と依頼する

**GitHub の画面で操作**:
1. GitHub のリポジトリページを開く
2. 「Compare & pull request」ボタンをクリック
3. 情報を入力:
   - タイトル: わかりやすい名前
   - 説明: 何を変更したか詳しく書く
4. 「Create pull request」をクリック

**または、コマンドで作成（GitHub CLI がある場合）**:
```bash
gh pr create --base main --head feature/add-new-button \
  --title "Add timer button to quiz screen" \
  --body "タイマーボタンを追加しました。右上に表示されます。"
```

**PR の説明に書くこと**:
```markdown
## 変更内容
- クイズ画面にタイマーボタンを追加
- 右上に配置
- タップすると時間が表示される

## 動作確認
- [x] iPhone 15 シミュレータで動作確認
- [x] ビルドエラーなし
- [x] 他の画面に影響なし

## スクリーンショット
（画像を貼り付け）
```

---

### ステップ⑧ レビュー・修正

**目的**: 指摘を受けて改善する

**レビューで指摘されたら**:
1. 指摘内容を確認
2. コードを修正
3. コミット→プッシュ
4. PR が自動的に更新される

```bash
# 修正したファイルをコミット
git add .
git commit -m "Fix button alignment as requested"
git push
```

**レビューでよく指摘されること**:
- コードが複雑すぎる → シンプルに書き直す
- コメントが不足 → 日本語コメントを追加
- 命名が不適切 → わかりやすい名前に変更
- テストが不足 → 動作確認を追加

---

### ステップ⑨ CI チェック

**目的**: 自動テストで問題がないか確認

**CI（Continuous Integration）** = 自動テスト

PR を作ると自動的に実行される:
- ✅ SwiftLint チェック（コードスタイル）
- ✅ ビルドチェック（コンパイルできるか）
- ✅ アーキテクチャチェック（構造が正しいか）
- ✅ 非推奨パターンチェック

**CI が失敗したら**:
1. エラーメッセージを読む
2. 問題を修正
3. コミット→プッシュ
4. CI が再実行される

---

### ステップ⑩ マージ

**目的**: 本番（main）に反映する

**マージの条件**:
- [ ] レビューで承認された
- [ ] CI が全て通った
- [ ] コンフリクトがない

**マージの方法（GitHub 上）**:
1. 「Merge pull request」ボタンをクリック
2. マージ方法を選択:
   - **Squash and merge**: コミットを1つにまとめる（推奨）
   - **Rebase and merge**: コミット履歴をきれいに保つ
   - **Create a merge commit**: 全てのコミットを残す

**マージ後の後片付け**:
```bash
# main ブランチに戻る
git switch main

# 最新版を取得
git pull origin main

# 作業ブランチを削除（もう不要）
git branch -d feature/add-new-button
```

---

## Pull Request（PR）って何？

### 🎁 PR = 「プレゼントを贈る」

**イメージ**:
```
あなた: 「このコード、良かったら使ってください！」
      ↓（Pull Request）
レビュアー: 「見てみるね」
      ↓（レビュー）
レビュアー: 「いいね！採用します」
      ↓（マージ）
main: 「あなたのコードが本番に入りました」
```

### PR の役割

1. **レビュー依頼**
   - 「このコード、見てください」
   - バグや改善点を指摘してもらう

2. **議論の場**
   - 「この実装で良いですか？」
   - 他の方法を提案してもらう

3. **CI チェック**
   - 自動テストが走る
   - 問題があればマージ前に発見

4. **履歴として残る**
   - なぜこの変更をしたか記録される
   - 後で振り返れる

---

## レビューとマージ

### 👀 レビューの流れ

```
PR 作成
  ↓
レビュアーが確認
  ├─ 承認（Approve）→ マージへ
  ├─ 変更依頼（Request changes）→ 修正が必要
  └─ コメント（Comment）→ 質問や提案
```

### レビューでチェックされること

| 項目 | 内容 |
|------|------|
| **動作** | ちゃんと動くか |
| **コード品質** | 読みやすいか、複雑すぎないか |
| **アーキテクチャ** | 設計方針に沿っているか |
| **テスト** | 動作確認が十分か |
| **ドキュメント** | コメントや説明が適切か |

### マージの種類

#### 1. Squash and merge（おすすめ）
```
変更前: A ── B ── C ── D ── E  （5つのコミット）
変更後: A ──────────────── F  （1つにまとめる）
```
- **メリット**: 履歴がすっきり
- **デメリット**: 途中のコミット履歴が消える
- **使い時**: 通常の開発（ほとんどの場合これ）

#### 2. Rebase and merge
```
main      A ── B ── C
                    ↓
feature        D ── E
                    ↓
結果      A ── B ── C ── D ── E  （きれいな一直線）
```
- **メリット**: 履歴が一直線できれい
- **デメリット**: コミットIDが変わる
- **使い時**: 履歴をきれいに保ちたい時

#### 3. Create a merge commit
```
main      A ── B ── C ─────── M  （マージコミット）
               ↖          ↗
feature         D ── E ──┘
```
- **メリット**: 全ての履歴が残る
- **デメリット**: 履歴が複雑になる
- **使い時**: 重要な変更で履歴を残したい時

---

## 実際の作業例

### 例1: 新機能を追加する（完全版）

```bash
# ===== ステップ1: 準備 =====
# main ブランチに移動して最新版を取得
git switch main
git pull origin main

# ===== ステップ2: ブランチ作成 =====
# 新しいブランチを作成
git switch -c feature/add-quiz-timer

# 確認
git branch
# * feature/add-quiz-timer  ← 今ここ
#   main

# ===== ステップ3: コードを編集 =====
# VS Code でファイルを編集
# - QuizView.swift を開く
# - タイマー機能を追加
# - 保存（⌘+S）

# ===== ステップ4: 動作確認 =====
# Xcode でビルド＆実行（⌘+R）
# シミュレータで動作をチェック

# ===== ステップ5: コミット =====
# 変更を確認
git status
# 変更されたファイル:
#   modified: SimpleWord/Features/Quiz/Views/QuizView.swift

# ステージに追加
git add .

# コミット
git commit -m "Add timer display to quiz screen"

# ===== ステップ6: プッシュ =====
# GitHub にアップロード
git push -u origin feature/add-quiz-timer

# ===== ステップ7: PR 作成 =====
# ブラウザで GitHub を開く
# または
gh pr create --base main --head feature/add-quiz-timer \
  --title "Add timer display to quiz screen" \
  --body "クイズ画面に経過時間を表示する機能を追加しました。"

# ===== ステップ8: レビュー待ち =====
# GitHub で通知が来るまで待つ

# ===== ステップ9: 修正が必要な場合 =====
# 指摘箇所を修正
git add .
git commit -m "Fix timer alignment"
git push
# PR が自動更新される

# ===== ステップ10: マージ後の片付け =====
# GitHub で「Squash and merge」をクリック
# ブランチを削除

# ローカルも片付け
git switch main
git pull origin main
git branch -d feature/add-quiz-timer
```

---

### 例2: バグを修正する（緊急対応）

```bash
# 1. 最新版を取得
git switch main
git pull origin main

# 2. 修正用ブランチを作成
git switch -c fix/crash-on-empty-csv

# 3. バグを修正
# CSVLoader.swift を編集

# 4. 動作確認
# - 空のCSVファイルを読み込む
# - クラッシュしないことを確認

# 5. コミット
git add .
git commit -m "Fix crash when loading empty CSV file"

# 6. プッシュ
git push -u origin fix/crash-on-empty-csv

# 7. PR 作成（緊急の旨を書く）
gh pr create --base main --head fix/crash-on-empty-csv \
  --title "🚨 Fix crash when loading empty CSV file" \
  --body "空のCSVファイルを読み込むとクラッシュする不具合を修正しました。

## 原因
- 配列が空の時にインデックスアクセスしていた

## 修正内容
- 配列の長さをチェック
- エラーハンドリングを追加

## 動作確認
- [x] 空のCSVでクラッシュしない
- [x] 正常なCSVも読み込める"

# 8. レビュー・マージ
# 緊急なので優先的にレビューしてもらう

# 9. マージ後
git switch main
git pull origin main
git branch -d fix/crash-on-empty-csv
```

---

## 🎯 よくある作業パターン

### パターンA: 小さな修正（1時間以内）

```
main から分岐
  ↓
修正（1〜2ファイル）
  ↓
コミット（1つ）
  ↓
プッシュ → PR
  ↓
レビュー → マージ
```

### パターンB: 新機能追加（数日）

```
main から分岐
  ↓
実装（複数ファイル）
  ├─ コミット1: データモデル追加
  ├─ コミット2: ViewModel 実装
  ├─ コミット3: View 作成
  └─ コミット4: テスト追加
  ↓
プッシュ → PR
  ↓
レビュー → 修正 → 再レビュー
  ↓
マージ
```

### パターンC: リファクタリング（数週間）

```
main から分岐
  ↓
段階的に改善
  ├─ 週1: ファイル分割
  ├─ 週2: 命名整理
  ├─ 週3: コメント追加
  └─ 週4: テスト追加
  ↓
各週でコミット → プッシュ
  ↓
完了したら PR
  ↓
レビュー → マージ
```

---

## 📖 次のステップ

- [05-03 よくある質問・トラブル解決](./05-03_よくある質問とトラブル解決.md) - 困った時の対処法

---

## 💡 役立つヒント

### 作業を始める前のチェックリスト

- [ ] main ブランチを最新にした？（`git pull`）
- [ ] 適切な名前のブランチを作った？
- [ ] 何を作るか明確？（ゴールを決める）

### コミットする前のチェックリスト

- [ ] 動作確認した？（ビルド・実行）
- [ ] 不要なファイルを含めていない？（`git status` で確認）
- [ ] コミットメッセージは明確？

### PR を作る前のチェックリスト

- [ ] 自分でコードをもう一度見直した？
- [ ] コメントは十分？
- [ ] CI が通る？（ビルドエラーなし）
- [ ] PR の説明を書いた？

---

**戻る**: [← Git・GitHub の基礎](./05-01_Git・GitHubの基礎.md)  
**次へ**: [よくある質問とトラブル解決 →](./05-03_よくある質問とトラブル解決.md)
