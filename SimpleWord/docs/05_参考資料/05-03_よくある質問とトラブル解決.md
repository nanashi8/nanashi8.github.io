# 05-03 よくある質問とトラブル解決

**対象**: プログラミング初心者・学生向け  
**目的**: 困った時にすぐ解決できるようにする

---

## 📚 目次

1. [困った時の基本手順](#困った時の基本手順)
2. [よくあるエラーと解決法](#よくあるエラーと解決法)
3. [コンフリクト（衝突）の解決](#コンフリクト衝突の解決)
4. [状況別トラブルシューティング](#状況別トラブルシューティング)
5. [取り消し・やり直し方法](#取り消しやり直し方法)

---

## 困った時の基本手順

### 🆘 まず最初にやること

```bash
# 1. 現在の状態を確認
git status

# 2. どのブランチにいるか確認
git branch

# 3. 最近のコミット履歴を見る
git log --oneline -5
```

### 📋 状況を整理する質問

1. **今どこにいる？** → `git branch` で確認
2. **何をしようとしていた？** → 作業内容を思い出す
3. **何が起きた？** → エラーメッセージを読む
4. **どうなってほしい？** → 目標を明確にする

---

## よくあるエラーと解決法

### エラー1: 「Changes not staged for commit」

**状況**: ファイルを変更したけど、コミットできない

```
Changes not staged for commit:
  modified: QuizView.swift
```

**原因**: `git add` を忘れている

**解決法**:
```bash
# ファイルをステージに追加
git add QuizView.swift

# または全部追加
git add .

# コミット
git commit -m "Update quiz view"
```

---

### エラー2: 「fatal: not a git repository」

**状況**: Git コマンドが動かない

```
fatal: not a git repository (or any of the parent directories): .git
```

**原因**: Git リポジトリではないフォルダにいる

**解決法**:
```bash
# 正しいフォルダに移動
cd /Users/yuichinakamura/quiz_app/quiz-app

# 確認
git status
```

---

### エラー3: 「Your branch is behind 'origin/main'」

**状況**: リモートより古い状態

```
Your branch is behind 'origin/main' by 3 commits, and can be fast-forwarded.
```

**原因**: 他の人が main を更新した

**解決法**:
```bash
# 最新版を取得
git pull origin main
```

---

### エラー4: 「Permission denied (publickey)」

**状況**: GitHub に接続できない

```
Permission denied (publickey).
fatal: Could not read from remote repository.
```

**原因**: SSH 鍵が設定されていない

**解決法**:
```bash
# SSH 鍵を生成
ssh-keygen -t ed25519 -C "your_email@example.com"

# 公開鍵をコピー
cat ~/.ssh/id_ed25519.pub

# GitHub の Settings → SSH and GPG keys → New SSH key
# コピーした内容を貼り付ける
```

---

### エラー5: 「Please commit your changes or stash them」

**状況**: ブランチを切り替えようとしたら怒られた

```
error: Your local changes to the following files would be overwritten by checkout:
  QuizView.swift
Please commit your changes or stash them before you switch branches.
```

**原因**: 未コミットの変更がある

**解決法（パターン1: コミットする）**:
```bash
# 変更をコミット
git add .
git commit -m "WIP: working on quiz view"
git switch main
```

**解決法（パターン2: 一時保存）**:
```bash
# 変更を一時保存
git stash

# ブランチを切り替え
git switch main

# 後で変更を戻す
git switch feature/my-work
git stash pop
```

---

### エラー6: 「rejected - non-fast-forward」

**状況**: プッシュが拒否された

```
! [rejected]        main -> main (non-fast-forward)
error: failed to push some refs to 'origin'
```

**原因**: リモートに新しいコミットがある

**解決法**:
```bash
# リモートの変更を取り込む
git pull origin main

# 再度プッシュ
git push origin main
```

---

## コンフリクト（衝突）の解決

### 🔥 コンフリクトって何？

**コンフリクト** = 同じ場所を別々に編集した時に起きる衝突

**イメージ**:
```
あなた:   行10を「Hello」に変更
他の人:   行10を「Goodbye」に変更
         ↓
Git:     「どっちを採用する？」← コンフリクト発生
```

---

### コンフリクトの解決手順

#### ステップ1: コンフリクトが起きた

```bash
git pull origin main

# エラーが出る
Auto-merging QuizView.swift
CONFLICT (content): Merge conflict in QuizView.swift
Automatic merge failed; fix conflicts and then commit the result.
```

#### ステップ2: どのファイルか確認

```bash
git status

# 結果
Unmerged paths:
  both modified: QuizView.swift
```

#### ステップ3: ファイルを開く

VS Code でファイルを開くと、こんな表示が出る:

```swift
<<<<<<< HEAD (Current Change)
let message = "Hello"
=======
let message = "Goodbye"
>>>>>>> origin/main (Incoming Change)
```

**意味**:
- `<<<<<<< HEAD`: あなたの変更
- `=======`: 区切り線
- `>>>>>>> origin/main`: 相手の変更

#### ステップ4: どちらか選ぶ

**VS Code の場合**:
- 「Accept Current Change」: 自分のを採用
- 「Accept Incoming Change」: 相手のを採用
- 「Accept Both Changes」: 両方採用
- 「Compare Changes」: 比較して手動で編集

**手動で編集する場合**:
```swift
// マーカーを削除して、正しいコードを残す
let message = "Hello World"  // 両方を合体した新しいコード
```

#### ステップ5: 解決をコミット

```bash
# 変更を確認
git status

# ステージに追加
git add QuizView.swift

# コンフリクト解決をコミット
git commit -m "Resolve merge conflict in QuizView"

# プッシュ
git push
```

---

### コンフリクトを避けるコツ

1. **こまめに pull する**
   ```bash
   # 作業前に必ず
   git pull origin main
   ```

2. **小さな単位でコミット**
   - 大きな変更は衝突しやすい
   - 1つの機能ずつコミット

3. **同じファイルを複数人で触らない**
   - 作業前にチームで相談
   - 担当を明確にする

---

## 状況別トラブルシューティング

### 状況1: 間違ったブランチで作業してしまった

**問題**: main ブランチで直接コードを書いてしまった

**解決法**:
```bash
# 1. 新しいブランチを作成（コミット前）
git switch -c feature/my-work

# 2. コミット
git add .
git commit -m "Add new feature"

# 3. プッシュ
git push origin feature/my-work
```

---

### 状況2: コミットメッセージを間違えた

**問題**: 「test」とだけ書いてコミットしてしまった

**解決法（まだプッシュしていない場合）**:
```bash
# 直前のコミットメッセージを修正
git commit --amend -m "Add quiz timer feature"
```

**解決法（既にプッシュした場合）**:
```bash
# メッセージを修正
git commit --amend -m "Add quiz timer feature"

# 強制プッシュ（注意！）
git push --force-with-lease
```

⚠️ **注意**: 他の人と共有しているブランチでは `--force` を使わない！

---

### 状況3: ファイルを間違って追加した

**問題**: 不要なファイルをコミットしてしまった

**解決法（まだコミットしていない場合）**:
```bash
# ステージから外す
git reset HEAD 不要なファイル.txt
```

**解決法（コミット済みの場合）**:
```bash
# ファイルを削除してコミット
git rm 不要なファイル.txt
git commit -m "Remove unnecessary file"
git push
```

---

### 状況4: 古いコミットに戻りたい

**問題**: 2つ前のコミットの状態に戻したい

**解決法（確認だけしたい）**:
```bash
# コミット履歴を見る
git log --oneline

# 特定のコミットを見る
git checkout abc1234
# abc1234 = コミットID

# 元に戻る
git switch main
```

**解決法（本当に戻す）**:
```bash
# 直前のコミットを取り消す（変更は残る）
git reset --soft HEAD~1

# 直前のコミットを完全に取り消す（変更も消える）
git reset --hard HEAD~1

# ⚠️ 注意: --hard は取り消せない！
```

---

### 状況5: ブランチを削除したい

**問題**: 不要なブランチがたくさんある

**解決法**:
```bash
# ローカルブランチを削除
git branch -d feature/old-work

# 強制削除（マージしていない場合）
git branch -D feature/old-work

# リモートブランチを削除
git push origin --delete feature/old-work
```

---

### 状況6: 作業を一時的に保存したい

**問題**: 今の作業を保存して、別の作業をしたい

**解決法（stash を使う）**:
```bash
# 現在の変更を一時保存
git stash

# 別の作業をする
git switch main
git switch -c fix/urgent-bug
# バグ修正...

# 元のブランチに戻る
git switch feature/my-work

# 保存した変更を戻す
git stash pop

# stash の一覧を見る
git stash list
```

---

## 取り消し・やり直し方法

### パターン1: ファイルの変更を取り消す（コミット前）

```bash
# 特定のファイルを元に戻す
git restore QuizView.swift

# 全部元に戻す
git restore .
```

⚠️ **注意**: 変更が消えます！

---

### パターン2: add を取り消す

```bash
# 特定のファイルをステージから外す
git restore --staged QuizView.swift

# 全部外す
git restore --staged .
```

---

### パターン3: コミットを取り消す

```bash
# 直前のコミットを取り消す（変更は残る）
git reset --soft HEAD~1

# 直前のコミットを取り消す（変更も消える）
git reset --hard HEAD~1

# 2つ前のコミットを取り消す
git reset --soft HEAD~2
```

---

### パターン4: プッシュを取り消す

```bash
# ローカルで取り消し
git reset --hard HEAD~1

# 強制プッシュ（注意！）
git push --force-with-lease
```

⚠️ **警告**: 他の人と共有しているブランチでは絶対にやらない！

---

### パターン5: 間違ったマージを取り消す

```bash
# マージを取り消す
git reset --hard ORIG_HEAD

# または
git reset --hard HEAD~1
```

---

## 🆘 それでも解決できない時

### 方法1: 助けを求める

1. **エラーメッセージをコピー**
   - 全文をコピーしてチームに共有

2. **何をしたか説明**
   - 「〇〇をしようとした」
   - 「〇〇のエラーが出た」
   - 「〇〇の状態になっている」

3. **スクリーンショットを撮る**
   - 画面を見せるとわかりやすい

---

### 方法2: やり直す（最終手段）

**⚠️ 注意**: これは本当に最後の手段！

```bash
# 1. 変更をバックアップ
cp -r /path/to/project /path/to/backup

# 2. リポジトリを削除
cd ..
rm -rf quiz-app

# 3. 再度クローン
git clone https://github.com/nanashi8/quiz-app.git
cd quiz-app

# 4. バックアップから必要なファイルをコピー
```

---

## 📋 よくある質問（FAQ）

### Q1: コミットはいつすればいい？

**A**: 小さな単位で頻繁に！

- ✅ 1つの機能が完成したら
- ✅ バグを1つ修正したら
- ✅ 一区切りついたら
- ❌ 1日の終わりにまとめて（これは避ける）

**理由**: 小さくコミットすると、問題が起きた時に戻しやすい

---

### Q2: プッシュはいつすればいい？

**A**: 1日の終わりか、区切りがついた時

- ✅ 作業が完成したら
- ✅ 1日の終わりに
- ✅ 相談したい時
- ❌ コンパイルエラーがある状態（これは避ける）

**理由**: バックアップになる。他の人が見れるようになる

---

### Q3: いつブランチを作ればいい？

**A**: 新しい作業を始める時

- ✅ 新機能を追加する時
- ✅ バグを修正する時
- ✅ コードを整理する時
- ❌ main で直接作業（これは絶対NG）

---

### Q4: main で作業してもいい？

**A**: ❌ ダメ！絶対にダメ！

**理由**:
- main は「正式版」。壊してはいけない
- 必ずブランチを作って作業する
- レビューを通してから main にマージ

---

### Q5: コミットメッセージは日本語でもいい？

**A**: このプロジェクトでは英語推奨（50文字以内）

**理由**:
- 国際的な標準
- ツールが英語を前提としている
- CI のログが英語

**コメントは日本語OK**: コード内のコメントは日本語で書いてOK

---

### Q6: リベースとマージ、どっちを使う？

**A**: 迷ったらマージ（merge）を使う

**理由**:
- マージの方が安全
- リベースは履歴を書き換えるので危険
- このプロジェクトでは Squash and merge 推奨

---

### Q7: フォースプッシュしてもいい？

**A**: ❌ 基本的にダメ！

**使っていい場合**:
- 自分だけのブランチ
- まだ誰もプルしていない
- どうしても必要な時のみ

**使ってはいけない場合**:
- main ブランチ
- 他の人と共有しているブランチ
- PR を作った後

---

### Q8: エラーが出たら英語で検索すべき？

**A**: はい、英語で検索すると情報が多い

**検索のコツ**:
```
git + エラーメッセージの一部

例:
"git Permission denied publickey"
"git conflict resolution"
```

**参考サイト**:
- Stack Overflow
- GitHub Docs
- Git 公式ドキュメント

---

## 🎓 まとめ：困らないための習慣

### 毎日の習慣

```bash
# 朝：作業を始める前
git pull origin main

# 夜：作業が終わったら
git add .
git commit -m "..."
git push
```

### トラブルを防ぐチェックリスト

- [ ] 作業前に `git pull` した？
- [ ] 正しいブランチにいる？（`git branch` で確認）
- [ ] コミットメッセージは明確？
- [ ] ビルドエラーがない？
- [ ] 不要なファイルを含めていない？

### 困った時の行動

1. **慌てない** - 落ち着いて状況を確認
2. **状態を確認** - `git status` を見る
3. **検索する** - エラーメッセージで検索
4. **助けを求める** - わからなければチームに相談
5. **記録する** - 解決法をメモしておく

---

## 📖 関連ドキュメント

- [05-01 Git・GitHub の基礎](./05-01_Git・GitHubの基礎.md) - 用語や基本概念
- [05-02 開発の流れ](./05-02_開発の流れ.md) - ワークフローの詳細

---

## 🔗 参考リンク

### 公式ドキュメント
- [Git 公式ドキュメント（日本語）](https://git-scm.com/book/ja/v2)
- [GitHub Docs（日本語）](https://docs.github.com/ja)

### 学習サイト
- [Learn Git Branching](https://learngitbranching.js.org/?locale=ja) - ゲーム感覚で学べる
- [サル先生の Git 入門](https://backlog.com/ja/git-tutorial/) - 日本語でわかりやすい

### チートシート
- [Git Cheat Sheet（日本語）](https://training.github.com/downloads/ja/github-git-cheat-sheet/)

---

**困ったことがあれば、このドキュメントを見返してください！**
