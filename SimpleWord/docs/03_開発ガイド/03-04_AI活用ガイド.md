# 03-04 AI活用ガイド

**文書番号**: 03-04  
**最終更新**: 2025-11-04  
**バージョン**: 2.0  
**ステータス**: 最新

---

## 📋 目次

1. [GitHub Copilot活用の基本](#github-copilot活用の基本)
2. [効果的なプロンプトの書き方](#効果的なプロンプトの書き方)
3. [コンテキスト提供の技術](#コンテキスト提供の技術)
4. [ワークフロー](#ワークフロー)
5. [ベストプラクティス](#ベストプラクティス)
6. [よくある失敗と対策](#よくある失敗と対策)

---

## 🤖 GitHub Copilot活用の基本

### Copilotの役割

GitHub Copilotは以下の作業を支援します：

- **コード生成**: 仕様から実装コードを生成
- **リファクタリング**: 既存コードの改善提案
- **バグ修正**: エラーの原因分析と修正案
- **ドキュメント作成**: コメントやドキュメントの生成
- **テスト作成**: ユニットテストの実装

### Copilotが得意なこと

✅ **明確な指示があるタスク**
- 「この関数をSwift 5.9の最新構文で書き直して」
- 「CSVパーサーを実装して」

✅ **パターンが明確なタスク**
- SwiftUIのView作成
- データモデルの定義
- ユニットテストの生成

✅ **既存コードの改善**
- リファクタリング
- パフォーマンス最適化
- コードの整理

### Copilotが苦手なこと

❌ **曖昧な指示**
- 「良い感じに修正して」
- 「バグを直して」（原因不明確）

❌ **大規模な設計判断**
- アーキテクチャ全体の設計
- 複数ファイルにまたがる大規模リファクタリング

❌ **プロジェクト固有の文脈理解**
- 暗黙的なルールや慣習
- 過去の議論や意思決定の背景

---

## ✍️ 効果的なプロンプトの書き方

### プロンプトの基本構造

```
[作業タイプ] + [対象] + [要件] + [制約条件]
```

### 良いプロンプトの例

#### 1. 具体的で明確

```
❌ 悪い例:
「QuizViewを修正して」

✅ 良い例:
「QuizViewの submitAnswer() メソッドを修正して、
回答後に StudyRecord を更新し、次の問題に自動的に
移動するようにしてください。
ただし、最後の問題の場合は結果画面に遷移します。」
```

#### 2. 制約条件を明示

```
❌ 悪い例:
「CSVローダーを作って」

✅ 良い例:
「CSVローダーを実装してください。
制約条件:
- Swift 5.9の async/await を使用
- エンコーディングはUTF-8固定
- ヘッダ行は必須（1行目）
- 列数は7列固定
- エラーハンドリングを含める」
```

#### 3. 期待する出力形式を指定

```
❌ 悪い例:
「統計データを表示して」

✅ 良い例:
「StatisticsViewを実装してください。
表示形式:
- 円グラフで正答率を表示
- リストで単語別の詳細を表示
- ソート機能（正答率、出題回数）を実装
SwiftUIのChartフレームワークを使用してください。」
```

### プロンプトテンプレート

#### 新規機能実装

```
【機能名】
[機能の名前]

【目的】
[何を実現したいか]

【要件】
- [要件1]
- [要件2]
- [要件3]

【制約条件】
- [制約1]
- [制約2]

【関連ファイル】
- [ファイルパス1]
- [ファイルパス2]

【実装方針】
[どのように実装するか]
```

#### バグ修正

```
【バグの症状】
[何が起きているか]

【再現手順】
1. [手順1]
2. [手順2]
3. [結果]

【期待される動作】
[本来どうあるべきか]

【関連ファイル】
- [ファイルパス]

【調査結果】
[わかっている範囲の原因]
```

#### リファクタリング

```
【対象コード】
[ファイル名と行数]

【現在の問題】
- [問題点1]
- [問題点2]

【改善目標】
- [目標1]
- [目標2]

【制約条件】
- 既存の機能を維持
- テストを追加
- [その他の制約]
```

---

## 🎯 コンテキスト提供の技術

### 1. ファイルを開いておく

Copilotは開いているファイルをコンテキストとして使用します。

**作業前に開くべきファイル**:
- 編集対象のファイル
- 関連する仕様書
- 参考にすべき実装例
- データモデル定義

### 2. コメントでコンテキストを提供

```swift
// このファイルについて:
// - QuizView: クイズ画面のメイン実装
// - 4択形式で問題を出題
// - 適応型学習システムと連携
// - CSV種類に応じて表示を最適化

struct QuizView: View {
    // Copilotがコンテキストを理解した状態で生成
}
```

### 3. 既存のパターンを示す

```swift
// 既存の実装パターンに従って、新しい機能を追加してください
// 参考: displayHistoryDetails() の実装パターン

@ViewBuilder
private func displayNewTypeDetails(_ item: QuestionItem, _ color: Color) -> some View {
    // Copilotが既存パターンを参考に生成
}
```

### 4. 型情報を明示

```swift
// ✅ 良い例：型が明確
let items: [QuestionItem] = []
let scheduler: AdaptiveScheduler

// ❌ 悪い例：型が不明確
let items = []  // Copilotが型を推測しにくい
```

---

## 🔄 ワークフロー

### 標準的な開発フロー

#### 1. 計画フェーズ

```
1. 仕様書を確認
2. 関連ドキュメントを読む
3. 既存実装を調査
4. 実装方針を決定
```

#### 2. コンテキスト準備フェーズ

```
1. 関連ファイルを開く
2. 仕様書をCopilotに提供
3. プロンプトを準備
```

#### 3. 実装フェーズ

```
1. プロンプトをCopilotに送信
2. 生成されたコードをレビュー
3. 必要に応じて修正を指示
4. テストを追加
```

#### 4. 検証フェーズ

```
1. ビルドして構文エラーを確認
2. テストを実行
3. 動作確認
4. ドキュメントを更新
```

### 反復的な改善フロー

```
初回プロンプト
    ↓
コード生成
    ↓
レビュー
    ↓
問題があれば修正プロンプト ──┐
    ↓                        │
再生成 ←─────────────────────┘
    ↓
完成
```

---

## 💡 ベストプラクティス

### 1. 一度に一つのタスク

```
❌ 悪い例:
「QuizViewを修正して、CSVローダーも改善して、
統計機能も追加して」

✅ 良い例:
「まず、QuizViewの submitAnswer() を修正してください。」
→ 完了後
「次に、CSVローダーのエラーハンドリングを改善してください。」
```

### 2. 段階的に複雑化

```
ステップ1: 基本機能の実装
「シンプルなCSVローダーを実装してください」

ステップ2: エラーハンドリング追加
「エラーハンドリングを追加してください」

ステップ3: 最適化
「パフォーマンスを最適化してください」
```

### 3. フィードバックループ

```swift
// プロンプト: 「この関数をリファクタリングしてください」
// ↓ 生成されたコード
func refactoredFunction() { }

// フィードバック: 「良いですが、エラーハンドリングが不足しています」
// ↓ 改善されたコード
func refactoredFunction() throws { }
```

### 4. コード生成後の確認

生成されたコードは必ず確認：

- [ ] 構文エラーがないか
- [ ] 命名規則に従っているか
- [ ] コメントが日本語か
- [ ] テストが必要か
- [ ] ドキュメント更新が必要か

### 5. 既存パターンの活用

```
「ChoiceCardViewの displayHistoryDetails() と
同じパターンで、displayScienceDetails() を実装してください」
```

---

## ⚠️ よくある失敗と対策

### 失敗1: コンテキスト不足

**症状**: 生成されたコードが期待と異なる

**原因**: Copilotに十分なコンテキストが提供されていない

**対策**:
```
1. 関連ファイルを開く
2. 仕様書を提示
3. 既存の実装パターンを示す
```

### 失敗2: 曖昧な指示

**症状**: 何度も修正が必要になる

**原因**: プロンプトが曖昧

**対策**:
```
具体的な要件と制約条件を明示
期待する出力形式を指定
```

### 失敗3: 一度に複雑すぎる変更

**症状**: 生成されたコードが動かない

**原因**: 変更範囲が大きすぎる

**対策**:
```
小さな単位に分割
段階的に実装
各ステップで検証
```

### 失敗4: 既存コードとの不整合

**症状**: 生成されたコードが他の部分と合わない

**原因**: プロジェクトの規約や慣習を理解していない

**対策**:
```
コーディング規約を明示
既存パターンを参考にさせる
レビューで整合性を確認
```

### 失敗5: 非推奨構文の使用

**症状**: ビルド時に警告が出る

**原因**: Copilotが古いパターンを使用

**対策**:
```
「iOS 17の最新構文を使用してください」と明示
DEPRECATION_GUIDEを参照させる
```

---

## 📋 チェックリスト

### プロンプト送信前

- [ ] 作業内容が明確か？
- [ ] 制約条件を記載したか？
- [ ] 関連ファイルを開いたか？
- [ ] 仕様書を確認したか？

### コード生成後

- [ ] 構文エラーはないか？
- [ ] 命名規則に従っているか？
- [ ] コメントは日本語か？
- [ ] 非推奨構文を使用していないか？
- [ ] テストを追加したか？
- [ ] ドキュメントを更新したか？

---

## 📚 関連ドキュメント

- **プロンプトテンプレート**: `03-06_プロンプトテンプレート.md`
- **コーディング規約**: `02-02_コーディング規約.md`
- **エラー対応**: `03-05_エラー対応プロトコル.md`
- **GitHub設定**: `.github/copilot-instructions.md`

---

## 🎓 学習リソース

### 推奨記事

- [GitHub Copilot公式ドキュメント](https://docs.github.com/copilot)
- [Effective Prompting Guide](https://github.blog/2023-06-20-how-to-write-better-prompts-for-github-copilot/)

### 実践例

プロジェクト内の成功事例：
- `CSV_HEADER_DRIVEN_IMPLEMENTATION_REPORT.md`
- `CSV_FIXED_COLUMN_CHOICE_GENERATION_REPORT.md`
- `CSV_TYPE_SPECIFIC_DISPLAY_REPORT.md`

---

**文書履歴**:
- 2025-11-04: 初版作成、AI活用のベストプラクティスを統合

**管理者**: SimpleWord開発チーム
