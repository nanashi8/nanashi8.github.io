# 編集ガイド（プロジェクト全体）

**最終更新: 2025-10-19**

## 目的
この文書は、SimpleWord プロジェクトを編集する開発者が、効率的かつ安全にコードを変更できるようにするためのガイドラインです。

## 前提環境
- macOS（最新の安定版を推奨）
- Xcode 15 以降
- Git（バージョン管理）
- Apple Developer アカウントは不要（シミュレータ実行のみの想定）

## プロジェクト構造

### ディレクトリ構成
```
SimpleWord/
├── .copilot/                        # AI作業効率化ファイル群（隠しフォルダ）
│   ├── README.md                    # AI作業ガイド
│   ├── structure-map.md             # アーキテクチャマップ
│   ├── quick-ref.md                 # 実装パターン集
│   ├── changelog.md                 # 変更履歴
│   ├── components/                  # コンポーネント仕様
│   └── prompts/                     # プロンプトテンプレート
├── .github/instructions/            # GitHub Copilot 指示
├── SimpleWord.xcodeproj/            # Xcodeプロジェクト
├── SimpleWord/                      # アプリ本体
│   ├── Views/                       # 画面（SwiftUI）
│   ├── Stores/                      # 状態管理・永続化
│   ├── Models/                      # データモデル
│   ├── Utils/                       # ユーティリティ
│   ├── Features/                    # 機能別ロジック
│   └── docs/仕様書/                 # 本ドキュメント一式
├── Resources/                       # リポジトリ同梱CSV
└── SimpleWordTests/                 # テストコード
```

### 重要な隠しフォルダ `.copilot/`
- **表示方法**: Finder で `⌘ + Shift + .` を押す
- **用途**: AI（GitHub Copilot）との作業効率化のためのドキュメント
- **詳細**: `.copilot/README.md` を参照

## 編集を始める前に

### 1. 現状確認（5分）
```bash
# プロジェクトルートに移動
cd /path/to/SimpleWord

# 最新のコードを取得
git pull

# Xcodeでビルド確認
open SimpleWord.xcodeproj
# ▶ボタンでビルド・実行して動作確認
```

### 2. 影響範囲の確認
編集前に以下を確認してください：
- `.copilot/structure-map.md` - アーキテクチャ全体像
- `.copilot/quick-ref.md` - 既存の実装パターン
- `.copilot/changelog.md` - 最近の変更履歴

### 3. ブランチ作成（推奨）
```bash
# 機能追加の場合
git checkout -b feature/your-feature-name

# バグ修正の場合
git checkout -b fix/bug-description
```

## 編集の基本フロー

### 小規模変更（単一ファイル、100行以内）
1. `.copilot/quick-ref.md` で実装パターンを確認
2. 該当ファイルを編集
3. ビルド・動作確認
4. `.copilot/changelog.md` に変更を記録
5. コミット・プッシュ

### 中規模変更（複数ファイル、新機能追加）
1. `.copilot/structure-map.md` で影響範囲を確認
2. `.copilot/prompts/add-feature.md` のテンプレートに従う
3. 段階的に実装・テスト
4. `.copilot/changelog.md` に記録
5. コミット・プッシュ

### 大規模リファクタリング
1. `.copilot/prompts/refactor-component.md` のテンプレートに従う
2. 作業を複数フェーズに分割
3. 各フェーズごとにコミット
4. `.copilot/structure-map.md` を更新
5. `.copilot/changelog.md` に詳細記録

## 主要コンポーネントの編集ガイド

### QuizView（クイズ画面）の編集
- **ファイル**: `SimpleWord/QuizView.swift`
- **現在の行数**: 約1100行
- **注意点**: 
  - 大規模ファイルのため、コンパイル時間が長い
  - 分割を推奨（`.copilot/structure-map.md` 参照）
  - 状態管理が複雑なため、既存パターンを踏襲すること

**編集時のチェックポイント**:
- [ ] @State/@Published の更新がUI反映されるか
- [ ] アニメーション効果が正常に動作するか
- [ ] 既存の正答率計算に影響がないか

### 設定画面（QuizSettingsView）の編集
- **ファイル**: `SimpleWord/Views/QuizSettingsView.swift`
- **依存**: `QuizSettings`, `CurrentCSV`, `AppearanceManager`
- **注意点**: 設定変更が即座に保存されること

### CSV読み込み（CSVLoader）の編集
- **ファイル**: `SimpleWord/Utils/CSVLoader.swift`
- **注意点**: 
  - ヘッダーの正規化ロジックが複雑
  - 既存CSVとの互換性を保つこと

## テストとデバッグ

### ビルド前の確認
```bash
# エラーチェック（Xcode内で）
⌘ + B

# 警告の確認
Build Settings → Other Warning Flags
```

### 実行時のデバッグ
- ブレークポイントの活用
- `print("🔍 変数名: \(変数)")` でログ出力
- Preview機能で素早く確認

### テスト観点
- [ ] 空データでクラッシュしない
- [ ] 大量データでパフォーマンス劣化しない
- [ ] エッジケース（0、負の数、nil）の処理
- [ ] ダークモード／ライトモード対応

## コミットとプッシュ

### コミットメッセージの書き方
```bash
# 機能追加
git commit -m "Add: 合格数と総出題数の光るエフェクト機能"

# バグ修正
git commit -m "Fix: アニメーションが動作しない問題を修正"

# リファクタリング
git commit -m "Refactor: QuizViewを複数コンポーネントに分割"

# ドキュメント更新
git commit -m "Docs: 編集ガイドを最新の実装に合わせて更新"
```

### 変更履歴の記録
`.copilot/changelog.md` に以下を追記：
```markdown
## 2025-10-19: [変更タイトル]
- ファイル: [ファイル名]
- 変更内容: [簡潔な説明]
- 影響範囲: [影響を受ける機能]
- 理由: [なぜこの変更が必要だったか]
```

## よくあるつまずきと対処

### ビルドエラー
- **エラー**: "Cannot find type in scope"
  - **対処**: import文を確認
  
- **エラー**: "@EnvironmentObject が見つからない"
  - **対処**: `SimpleWordApp.swift` で `.environmentObject()` を確認

### 動作不良
- **問題**: アニメーションが動作しない
  - **対処**: `.copilot/prompts/fix-bug.md` のアニメーション実例を参照
  
- **問題**: データが保存されない
  - **対処**: `save()` メソッドの呼び出しタイミングを確認

### Git関連
- **問題**: コンフリクトが発生
  - **対処**: `git status` で確認し、手動でマージ

## 編集完了チェックリスト

- [ ] ビルドエラーがない
- [ ] 警告を可能な限り解消した
- [ ] 既存機能に影響がない（回帰テスト）
- [ ] 新機能が期待通りに動作する
- [ ] コードが既存のスタイルに従っている
- [ ] `.copilot/changelog.md` に記録した
- [ ] コミットメッセージが明確
- [ ] 必要に応じて仕様書を更新した

## 次のステップ

- 機能別の詳細は `01_〜09_` の各仕様書を参照
- AI作業効率化の詳細は `.copilot/README.md` を参照
- 主要ファイルの一覧は `99_ファイル索引.md` を参照
