# 01-06 ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ãƒ»çŠ¶æ…‹ç®¡ç†ä»•æ§˜

**æ–‡æ›¸ç•ªå·**: 01-06  
**æœ€çµ‚æ›´æ–°**: 2025-11-05  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 1.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ€æ–°

---

## ğŸ“‹ ç›®æ¬¡

1. [æ¦‚è¦](#æ¦‚è¦)
2. [ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ](#ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ)
3. [ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼](#ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼)
4. [çŠ¶æ…‹ç®¡ç†](#çŠ¶æ…‹ç®¡ç†)
5. [æ°¸ç¶šåŒ–](#æ°¸ç¶šåŒ–)
6. [å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³](#å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³)
7. [ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°](#ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°)

---

## ğŸ¯ æ¦‚è¦

### è¨­è¨ˆåŸå‰‡

SimpleWordã®ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼ã¨çŠ¶æ…‹ç®¡ç†ã¯ã€ä»¥ä¸‹ã®åŸå‰‡ã«åŸºã¥ã„ã¦ã„ã¾ã™ï¼š

1. **å˜ä¸€ã®ã‚½ãƒ¼ã‚¹ã‚ªãƒ–ãƒˆã‚¥ãƒ«ãƒ¼ã‚¹**
   - ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã§çŠ¶æ…‹ã‚’ä¸€å…ƒç®¡ç†
   - SimpleWordApp.swiftã§åˆæœŸåŒ–ãƒ»æ³¨å…¥

2. **ãƒ‡ãƒ¼ã‚¿ã®æµã‚Œã®æ˜ç¢ºåŒ–**
   - ãƒˆãƒƒãƒ—ãƒ€ã‚¦ãƒ³ã§ãƒ‡ãƒ¼ã‚¿ã‚’ä¼æ’­
   - ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯ã§ä¸Šä½å±¤ã«é€šçŸ¥

3. **ç–çµåˆ**
   - ãƒ—ãƒ­ãƒˆã‚³ãƒ«ã§æŠ½è±¡åŒ–
   - ä¾å­˜æ€§æ³¨å…¥ã‚’æ´»ç”¨

### ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£

```
SimpleWordApp.swift
    â†“ ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ³¨å…¥
ContentView
    â†“
å„Feature
    â†“
ViewModels
    â†“
Services/Stores
```

---

## ğŸŒ ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ

### 1. QuizSettings

**è²¬å‹™**: ã‚¯ã‚¤ã‚ºã®è¨­å®šã‚’ç®¡ç†

**å®Ÿè£…å ´æ‰€**: `SimpleWord/Stores/QuizSettings.swift`

```swift
@MainActor
class QuizSettings: ObservableObject {
    @Published var model: QuizSettingsModel
    
    // ä¸»è¦ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    var isRandomOrder: Bool { model.isRandomOrder }
    var isSpeechEnabled: Bool { model.isSpeechEnabled }
    var isTimerEnabled: Bool { model.isTimerEnabled }
    var timeLimit: TimeInterval { model.timeLimit }
    var learningMode: LearningMode { model.learningMode }
    var autoAdvance: Bool { model.autoAdvance }
    
    // åˆæœŸåŒ–
    init() {
        self.model = QuizSettingsModel.load()
    }
    
    // ä¿å­˜
    func save() {
        model.save()
    }
}
```

**QuizSettingsModel**:
```swift
struct QuizSettingsModel: Codable {
    var isRandomOrder: Bool = false
    var isSpeechEnabled: Bool = false
    var isTimerEnabled: Bool = false
    var timeLimit: TimeInterval = 30.0
    var learningMode: LearningMode = .normal
    var autoAdvance: Bool = false
    var selectedFilters: [String] = []
    
    // UserDefaultsã‹ã‚‰èª­ã¿è¾¼ã¿
    static func load() -> QuizSettingsModel {
        guard let data = UserDefaults.standard.data(forKey: "QuizSettings"),
              let model = try? JSONDecoder().decode(QuizSettingsModel.self, from: data) else {
            return QuizSettingsModel()
        }
        return model
    }
    
    // UserDefaultsã¸ä¿å­˜
    func save() {
        if let data = try? JSONEncoder().encode(self) {
            UserDefaults.standard.set(data, forKey: "QuizSettings")
        }
    }
}
```

### 2. WordScoreStore

**è²¬å‹™**: å˜èªã”ã¨ã®æˆç¸¾ã‚’ç®¡ç†

**å®Ÿè£…å ´æ‰€**: `SimpleWord/Stores/WordScoreStore.swift`

```swift
@MainActor
class WordScoreStore: ObservableObject {
    @Published var scores: [UUID: WordScore] = [:]
    private var currentCSVName: String = ""
    
    // å›ç­”è¨˜éŒ²
    func recordAnswer(for item: QuestionItem, isCorrect: Bool, csvName: String) {
        var score = scores[item.id] ?? WordScore(itemID: item.id)
        
        score.totalAttempts += 1
        if isCorrect {
            score.correctCount += 1
            score.correctStreak += 1
            score.wrongStreak = 0
        } else {
            score.wrongCount += 1
            score.wrongStreak += 1
            score.correctStreak = 0
        }
        
        score.lastAttemptDate = Date()
        scores[item.id] = score
        
        save(for: csvName)
    }
    
    // CSVåˆ‡ã‚Šæ›¿ãˆ
    func switchToCSV(_ csvName: String) {
        currentCSVName = csvName
        load(for: csvName)
    }
    
    // æ°¸ç¶šåŒ–
    private func save(for csvName: String) {
        let filename = "word_scores_\(csvName).json"
        // JSONãƒ•ã‚¡ã‚¤ãƒ«ã¨ã—ã¦ä¿å­˜
    }
    
    private func load(for csvName: String) {
        let filename = "word_scores_\(csvName).json"
        // JSONãƒ•ã‚¡ã‚¤ãƒ«ã‹ã‚‰èª­ã¿è¾¼ã¿
    }
}
```

**WordScoreæ§‹é€ **:
```swift
struct WordScore: Codable {
    let itemID: UUID
    var totalAttempts: Int = 0
    var correctCount: Int = 0
    var wrongCount: Int = 0
    var correctStreak: Int = 0
    var wrongStreak: Int = 0
    var lastAttemptDate: Date?
    
    var accuracy: Double {
        guard totalAttempts > 0 else { return 0.0 }
        return Double(correctCount) / Double(totalAttempts)
    }
}
```

### 3. CurrentCSV

**è²¬å‹™**: ç¾åœ¨é¸æŠä¸­ã®CSVãƒ•ã‚¡ã‚¤ãƒ«ã‚’ç®¡ç†

**å®Ÿè£…å ´æ‰€**: `SimpleWord/Stores/CurrentCSV.swift`

```swift
@MainActor
class CurrentCSV: ObservableObject {
    @Published var name: String {
        didSet {
            UserDefaults.standard.set(name, forKey: "CurrentCSVName")
        }
    }
    
    init() {
        self.name = UserDefaults.standard.string(forKey: "CurrentCSVName") 
                    ?? "ä¸­å­¦è‹±å˜èª"
    }
}
```

### 4. AppearanceManager

**è²¬å‹™**: ã‚¢ãƒ—ãƒªã®ãƒ†ãƒ¼ãƒï¼ˆãƒ©ã‚¤ãƒˆ/ãƒ€ãƒ¼ã‚¯ï¼‰ã‚’ç®¡ç†

**å®Ÿè£…å ´æ‰€**: `Appearance/Appearance.swift`

```swift
@MainActor
class AppearanceManager: ObservableObject {
    @Published var appearance: Appearance {
        didSet {
            UserDefaults.standard.set(appearance.rawValue, forKey: "Appearance")
            applyAppearance()
        }
    }
    
    init() {
        let stored = UserDefaults.standard.string(forKey: "Appearance")
        self.appearance = Appearance(rawValue: stored ?? "system") ?? .system
        applyAppearance()
    }
    
    private func applyAppearance() {
        guard let windowScene = UIApplication.shared.connectedScenes.first as? UIWindowScene,
              let window = windowScene.windows.first else { return }
        
        switch appearance {
        case .system:
            window.overrideUserInterfaceStyle = .unspecified
        case .light:
            window.overrideUserInterfaceStyle = .light
        case .dark:
            window.overrideUserInterfaceStyle = .dark
        }
    }
}
```

---

## ğŸ”„ ãƒ‡ãƒ¼ã‚¿ãƒ•ãƒ­ãƒ¼

### ã‚¢ãƒ—ãƒªèµ·å‹•æ™‚

```
1. SimpleWordApp.swiftèµ·å‹•
   â†“
2. ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã‚’åˆæœŸåŒ–
   â”œâ”€ QuizSettings.init()
   â”œâ”€ WordScoreStore.init()
   â”œâ”€ CurrentCSV.init()
   â””â”€ AppearanceManager.init()
   â†“
3. ContentViewã«æ³¨å…¥
   â†“
4. å„Featureã§åˆ©ç”¨å¯èƒ½ã«
```

**å®Ÿè£…**:
```swift
@main
struct SimpleWordApp: App {
    @StateObject private var quizSettings = QuizSettings()
    @StateObject private var wordScoreStore = WordScoreStore()
    @StateObject private var currentCSV = CurrentCSV()
    @StateObject private var appearanceManager = AppearanceManager()
    
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(quizSettings)
                .environmentObject(wordScoreStore)
                .environmentObject(currentCSV)
                .environmentObject(appearanceManager)
        }
    }
}
```

### ã‚¯ã‚¤ã‚ºã‚»ãƒƒã‚·ãƒ§ãƒ³

```
1. QuizViewèµ·å‹•
   â†“
2. CSVãƒ­ãƒ¼ãƒ‰
   â”œâ”€ CSVLoader.load()
   â””â”€ QuestionItemé…åˆ—ã‚’å–å¾—
   â†“
3. ãƒ•ã‚£ãƒ«ã‚¿ãƒªãƒ³ã‚°
   â”œâ”€ QuizSettings.selectedFiltersã‚’é©ç”¨
   â””â”€ filteredItemsã‚’ç”Ÿæˆ
   â†“
4. ãƒãƒƒãƒæº–å‚™
   â”œâ”€ AdaptiveScheduler.scheduleNextBatch()
   â””â”€ currentBatchã‚’ç”Ÿæˆ
   â†“
5. å•é¡Œè¡¨ç¤º
   â”œâ”€ QuestionCardView
   â””â”€ ChoiceCardView
   â†“
6. å›ç­”å‡¦ç†
   â”œâ”€ WordScoreStore.recordAnswer()
   â”œâ”€ AdaptiveScheduler.record()
   â””â”€ æ¬¡ã®å•é¡Œã¸
```

### ãƒ‡ãƒ¼ã‚¿ä¿å­˜

```
1. ãƒ¦ãƒ¼ã‚¶ãƒ¼æ“ä½œ
   â”œâ”€ å›ç­”
   â”œâ”€ è¨­å®šå¤‰æ›´
   â””â”€ CSVåˆ‡ã‚Šæ›¿ãˆ
   â†“
2. ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆæ›´æ–°
   â”œâ”€ @Publishedå¤‰æ•°ã®å¤‰æ›´
   â””â”€ ObservableObjecté€šçŸ¥
   â†“
3. æ°¸ç¶šåŒ–
   â”œâ”€ UserDefaultsï¼ˆè¨­å®šï¼‰
   â”œâ”€ JSONãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆã‚¹ã‚³ã‚¢ï¼‰
   â””â”€ JSONãƒ•ã‚¡ã‚¤ãƒ«ï¼ˆå­¦ç¿’å±¥æ­´ï¼‰
   â†“
4. UIè‡ªå‹•æ›´æ–°
   â””â”€ SwiftUIã®è‡ªå‹•å†æç”»
```

---

## ğŸ—„ï¸ çŠ¶æ…‹ç®¡ç†

### çŠ¶æ…‹ã®ç¨®é¡

| ç¨®é¡ | ä¿å­˜å ´æ‰€ | ç”¨é€” | æ°¸ç¶šåŒ– |
|-----|---------|------|-------|
| **ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹** | ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆ | ã‚¢ãƒ—ãƒªå…¨ä½“ã§å…±æœ‰ | ã‚ã‚Š |
| **ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹** | `@State` | ç”»é¢å†…ã®ã¿ | ãªã— |
| **ä¸€æ™‚çŠ¶æ…‹** | ãƒ­ãƒ¼ã‚«ãƒ«å¤‰æ•° | é–¢æ•°å†…ã®ã¿ | ãªã— |

### çŠ¶æ…‹ç®¡ç†ã®ãƒ™ã‚¹ãƒˆãƒ—ãƒ©ã‚¯ãƒ†ã‚£ã‚¹

#### 1. ã‚°ãƒ­ãƒ¼ãƒãƒ«çŠ¶æ…‹ï¼ˆç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆï¼‰

**ä½¿ç”¨å ´é¢**:
- è¤‡æ•°ã®ç”»é¢ã§å…±æœ‰ã™ã‚‹å¿…è¦ãŒã‚ã‚‹
- ã‚¢ãƒ—ãƒªçµ‚äº†å¾Œã‚‚ä¿æŒã™ã‚‹å¿…è¦ãŒã‚ã‚‹

**ä¾‹**:
```swift
// QuizSettings: è¤‡æ•°ã®ç”»é¢ã§å‚ç…§
@EnvironmentObject var quizSettings: QuizSettings

// WordScoreStore: ã‚¯ã‚¤ã‚ºç”»é¢ã¨æˆç¸¾ç”»é¢ã§å…±æœ‰
@EnvironmentObject var wordScoreStore: WordScoreStore
```

#### 2. ãƒ­ãƒ¼ã‚«ãƒ«çŠ¶æ…‹ï¼ˆ@Stateï¼‰

**ä½¿ç”¨å ´é¢**:
- ç”»é¢å†…ã§ã®ã¿ä½¿ç”¨
- ä¸€æ™‚çš„ãªè¡¨ç¤ºçŠ¶æ…‹

**ä¾‹**:
```swift
// é¸æŠä¸­ã®é¸æŠè‚¢IDï¼ˆQuizViewå†…ã®ã¿ï¼‰
@State private var selectedChoiceID: UUID?

// ãƒ¢ãƒ¼ãƒ€ãƒ«è¡¨ç¤ºãƒ•ãƒ©ã‚°
@State private var showingSettings = false
```

#### 3. è¨ˆç®—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£

**ä½¿ç”¨å ´é¢**:
- ä»–ã®çŠ¶æ…‹ã‹ã‚‰å°å‡ºã§ãã‚‹å€¤
- ã‚­ãƒ£ãƒƒã‚·ãƒ¥ä¸è¦

**ä¾‹**:
```swift
var currentItem: QuestionItem? {
    guard currentBatchIndex < currentBatch.count else { return nil }
    return currentBatch[currentBatchIndex]
}

var canGoNext: Bool {
    selectedChoiceID != nil
}
```

### çŠ¶æ…‹æ›´æ–°ã®ãƒ‘ã‚¿ãƒ¼ãƒ³

#### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ç›´æ¥æ›´æ–°

```swift
@State private var count = 0

Button("å¢—ã‚„ã™") {
    count += 1  // SwiftUIãŒè‡ªå‹•ã§å†æç”»
}
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³2: ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆçµŒç”±

```swift
@EnvironmentObject var quizSettings: QuizSettings

Toggle("éŸ³å£°", isOn: Binding(
    get: { quizSettings.isSpeechEnabled },
    set: { quizSettings.model.isSpeechEnabled = $0 }
))
```

#### ãƒ‘ã‚¿ãƒ¼ãƒ³3: ã‚³ãƒ¼ãƒ«ãƒãƒƒã‚¯çµŒç”±

```swift
ChoiceCardView(
    id: choice.id,
    onSelect: { id in
        handleChoiceSelection(id)  // è¦ªã®ãƒ¡ã‚½ãƒƒãƒ‰ã‚’å‘¼ã³å‡ºã—
    }
)
```

---

## ğŸ’¾ æ°¸ç¶šåŒ–

### ä¿å­˜æ–¹æ³•ã®é¸æŠ

| ãƒ‡ãƒ¼ã‚¿ç¨®é¡ | ä¿å­˜æ–¹æ³• | ç†ç”± |
|-----------|---------|------|
| **è¨­å®š** | UserDefaults | å°ã•ã„ãƒ‡ãƒ¼ã‚¿ã€ã‚·ãƒ³ãƒ—ãƒ« |
| **ã‚¹ã‚³ã‚¢** | JSON | æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€CSVåˆ¥ç®¡ç† |
| **å­¦ç¿’å±¥æ­´** | JSON | æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿ã€CSVåˆ¥ç®¡ç† |
| **CSVãƒ•ã‚¡ã‚¤ãƒ«** | Documents | ãƒ¦ãƒ¼ã‚¶ãƒ¼ãŒã‚¤ãƒ³ãƒãƒ¼ãƒˆ/ã‚¨ã‚¯ã‚¹ãƒãƒ¼ãƒˆ |

### UserDefaultsã®ä½¿ç”¨

**é©åˆ‡ãªç”¨é€”**:
- è¨­å®šå€¤ï¼ˆBoolã€Stringã€Intï¼‰
- å°ã•ã„ãƒ‡ãƒ¼ã‚¿ï¼ˆ< 1KBï¼‰

**å®Ÿè£…**:
```swift
// ä¿å­˜
UserDefaults.standard.set(value, forKey: "Key")

// èª­ã¿è¾¼ã¿
let value = UserDefaults.standard.string(forKey: "Key")
```

### JSONãƒ•ã‚¡ã‚¤ãƒ«ã®ä½¿ç”¨

**é©åˆ‡ãªç”¨é€”**:
- æ§‹é€ åŒ–ãƒ‡ãƒ¼ã‚¿
- å¤§ãã„ãƒ‡ãƒ¼ã‚¿ï¼ˆ> 1KBï¼‰
- CSVåˆ¥ã®ç®¡ç†ãŒå¿…è¦

**å®Ÿè£…**:
```swift
// ä¿å­˜
func saveToJSON<T: Encodable>(_ data: T, filename: String) throws {
    let documentsDir = FileManager.default.urls(
        for: .documentDirectory,
        in: .userDomainMask
    )[0]
    let fileURL = documentsDir.appendingPathComponent(filename)
    
    let encoded = try JSONEncoder().encode(data)
    try encoded.write(to: fileURL)
}

// èª­ã¿è¾¼ã¿
func loadFromJSON<T: Decodable>(_ type: T.Type, filename: String) throws -> T {
    let documentsDir = FileManager.default.urls(
        for: .documentDirectory,
        in: .userDomainMask
    )[0]
    let fileURL = documentsDir.appendingPathComponent(filename)
    
    let data = try Data(contentsOf: fileURL)
    return try JSONDecoder().decode(T.self, from: data)
}
```

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹æˆ

```
Documents/
â”œâ”€â”€ word_scores_ä¸­å­¦è‹±å˜èª.json
â”œâ”€â”€ word_scores_ä¸­å­¦å¤å…¸å˜èª.json
â”œâ”€â”€ study_records_ä¸­å­¦è‹±å˜èª.json
â”œâ”€â”€ study_records_ä¸­å­¦å¤å…¸å˜èª.json
â””â”€â”€ CSVs/
    â”œâ”€â”€ ä¸­å­¦è‹±å˜èª.csv
    â”œâ”€â”€ ä¸­å­¦å¤å…¸å˜èª.csv
    â””â”€â”€ ã‚«ã‚¹ã‚¿ãƒ å˜èª.csv
```

---

## ğŸ› ï¸ å®Ÿè£…ãƒ‘ã‚¿ãƒ¼ãƒ³

### ãƒ‘ã‚¿ãƒ¼ãƒ³1: ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã®æ³¨å…¥

**SimpleWordApp.swift**:
```swift
@main
struct SimpleWordApp: App {
    @StateObject private var quizSettings = QuizSettings()
    @StateObject private var wordScoreStore = WordScoreStore()
    @StateObject private var currentCSV = CurrentCSV()
    
    var body: some Scene {
        WindowGroup {
            ContentView()
                .environmentObject(quizSettings)
                .environmentObject(wordScoreStore)
                .environmentObject(currentCSV)
        }
    }
}
```

**ContentView.swift**:
```swift
struct ContentView: View {
    @EnvironmentObject var quizSettings: QuizSettings
    
    var body: some View {
        NavigationView {
            // ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆã¯è‡ªå‹•ã§å­ãƒ“ãƒ¥ãƒ¼ã«ä¼æ’­
            QuizView()
        }
    }
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³2: CSVåˆ¥ãƒ‡ãƒ¼ã‚¿ç®¡ç†

```swift
@MainActor
class WordScoreStore: ObservableObject {
    @Published var scores: [UUID: WordScore] = [:]
    private var currentCSVName: String = ""
    
    func switchToCSV(_ csvName: String) {
        // 1. ç¾åœ¨ã®ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
        if !currentCSVName.isEmpty {
            save(for: currentCSVName)
        }
        
        // 2. æ–°ã—ã„CSVã®ãƒ‡ãƒ¼ã‚¿ã‚’èª­ã¿è¾¼ã¿
        currentCSVName = csvName
        load(for: csvName)
    }
    
    private func save(for csvName: String) {
        let filename = "word_scores_\(csvName).json"
        try? saveToJSON(scores, filename: filename)
    }
    
    private func load(for csvName: String) {
        let filename = "word_scores_\(csvName).json"
        scores = (try? loadFromJSON([UUID: WordScore].self, filename: filename)) ?? [:]
    }
}
```

### ãƒ‘ã‚¿ãƒ¼ãƒ³3: éåŒæœŸãƒ‡ãƒ¼ã‚¿ãƒ­ãƒ¼ãƒ‰

```swift
struct QuizView: View {
    @State private var items: [QuestionItem] = []
    @State private var isLoading = true
    
    var body: some View {
        Group {
            if isLoading {
                ProgressView("èª­ã¿è¾¼ã¿ä¸­...")
            } else {
                QuizContentView(items: items)
            }
        }
        .task {
            await loadCSV()
        }
    }
    
    private func loadCSV() async {
        do {
            items = try await CSVLoader().load(named: currentCSV.name)
            isLoading = false
        } catch {
            print("Error: \(error)")
        }
    }
}
```

---

## ğŸ› ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°

### å•é¡Œ1: ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒè¦‹ã¤ã‹ã‚‰ãªã„

**ç—‡çŠ¶**:
```
Fatal error: No ObservableObject of type QuizSettings found.
```

**åŸå› **:
- ç’°å¢ƒã‚ªãƒ–ã‚¸ã‚§ã‚¯ãƒˆãŒæ³¨å…¥ã•ã‚Œã¦ã„ãªã„
- ãƒŠãƒ“ã‚²ãƒ¼ã‚·ãƒ§ãƒ³éšå±¤ã§ä¼æ’­ã•ã‚Œã¦ã„ãªã„

**è§£æ±ºç­–**:
```swift
// SimpleWordApp.swiftã§æ³¨å…¥ã‚’ç¢ºèª
ContentView()
    .environmentObject(quizSettings)  // â† ã“ã‚ŒãŒå¿…è¦

// ã¾ãŸã¯ã€å€‹åˆ¥ã®ãƒ“ãƒ¥ãƒ¼ã§æ˜ç¤ºçš„ã«æ¸¡ã™
NavigationLink(destination: QuizView()
    .environmentObject(quizSettings)
)
```

### å•é¡Œ2: ç„¡é™ãƒ«ãƒ¼ãƒ—

**ç—‡çŠ¶**:
- CPUä½¿ç”¨ç‡100%
- ã‚¢ãƒ—ãƒªãŒãƒ•ãƒªãƒ¼ã‚º

**åŸå› **:
- `@Published`å¤‰æ•°ã®å¾ªç’°å‚ç…§
- `.onReceive`ã§ã®ç„¡é™æ›´æ–°

**è§£æ±ºç­–**:
```swift
// âŒ æ‚ªã„ä¾‹
.onReceive(quizSettings.$model) { _ in
    quizSettings.model = newModel  // ç„¡é™ãƒ«ãƒ¼ãƒ—
}

// âœ… è‰¯ã„ä¾‹
.onChange(of: quizSettings.model.learningMode) { newMode in
    updateForMode(newMode)
}
```

### å•é¡Œ3: ãƒ‡ãƒ¼ã‚¿ãŒä¿å­˜ã•ã‚Œãªã„

**ç—‡çŠ¶**:
- ã‚¢ãƒ—ãƒªå†èµ·å‹•å¾Œã«ãƒ‡ãƒ¼ã‚¿ãŒæ¶ˆãˆã‚‹

**åŸå› **:
- ä¿å­˜ãƒ¡ã‚½ãƒƒãƒ‰ãŒå‘¼ã°ã‚Œã¦ã„ãªã„
- ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ãŒé–“é•ã£ã¦ã„ã‚‹

**è§£æ±ºç­–**:
```swift
// ä¿å­˜ã®ã‚¿ã‚¤ãƒŸãƒ³ã‚°ã‚’ç¢ºèª
func recordAnswer(...) {
    // ãƒ‡ãƒ¼ã‚¿æ›´æ–°
    scores[item.id] = score
    
    // å³åº§ã«ä¿å­˜
    save(for: csvName)  // â† ã“ã‚ŒãŒå¿…è¦
}

// ãƒ•ã‚¡ã‚¤ãƒ«ãƒ‘ã‚¹ã®ç¢ºèª
let documentsDir = FileManager.default.urls(
    for: .documentDirectory,
    in: .userDomainMask
)[0]
print("Documents: \(documentsDir)")
```

### å•é¡Œ4: @PublishedãŒæ©Ÿèƒ½ã—ãªã„

**ç—‡çŠ¶**:
- å€¤ãŒå¤‰æ›´ã•ã‚Œã¦ã‚‚UIãŒæ›´æ–°ã•ã‚Œãªã„

**åŸå› **:
- `@Published`ãŒã¤ã„ã¦ã„ãªã„
- `ObservableObject`ã‚’ç¶™æ‰¿ã—ã¦ã„ãªã„
- `@MainActor`ãŒã¤ã„ã¦ã„ãªã„

**è§£æ±ºç­–**:
```swift
@MainActor  // â† å¿…é ˆ
class QuizSettings: ObservableObject {  // â† å¿…é ˆ
    @Published var model: QuizSettingsModel  // â† å¿…é ˆ
}
```

---

## ğŸ“Š ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–

### 1. ä¸è¦ãªå†æç”»ã®å›é¿

```swift
// âŒ æ‚ªã„ä¾‹: å…¨ä½“ãŒå†æç”»ã•ã‚Œã‚‹
@EnvironmentObject var quizSettings: QuizSettings

var body: some View {
    Text("Mode: \(quizSettings.model.learningMode.rawValue)")
}

// âœ… è‰¯ã„ä¾‹: å¿…è¦ãªéƒ¨åˆ†ã®ã¿ç›£è¦–
@EnvironmentObject var quizSettings: QuizSettings

var body: some View {
    Text("Mode: \(mode)")
}

private var mode: String {
    quizSettings.model.learningMode.rawValue
}
```

### 2. é…å»¶èª­ã¿è¾¼ã¿

```swift
// å¤§é‡ã®ãƒ‡ãƒ¼ã‚¿ã¯å¿…è¦ã«ãªã‚‹ã¾ã§èª­ã¿è¾¼ã¾ãªã„
struct QuizView: View {
    @State private var currentBatch: [QuestionItem] = []
    private var allItems: [QuestionItem] = []  // ãƒ¡ãƒ¢ãƒªã«å…¨ãƒ‡ãƒ¼ã‚¿ã‚’ä¿æŒã—ãªã„
    
    func prepareNextBatch() {
        // ãƒãƒƒãƒã‚µã‚¤ã‚ºåˆ†ã ã‘ãƒ­ãƒ¼ãƒ‰
        currentBatch = allItems.prefix(10).shuffled()
    }
}
```

### 3. ã‚­ãƒ£ãƒƒã‚·ãƒ¥ã®æ´»ç”¨

```swift
class CSVCache {
    private static var cache: [String: [QuestionItem]] = [:]
    
    static func load(csvName: String) async throws -> [QuestionItem] {
        if let cached = cache[csvName] {
            return cached
        }
        
        let items = try await CSVLoader().load(named: csvName)
        cache[csvName] = items
        return items
    }
}
```

---

## ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **å‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `01-05_ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ä»•æ§˜.md`
- **ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£**: `01-02_ã‚¢ãƒ¼ã‚­ãƒ†ã‚¯ãƒãƒ£ä»•æ§˜.md`
- **é©å¿œå‹å­¦ç¿’**: `01-03_é©å¿œå‹å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜.md`
- **ãƒˆãƒ©ãƒ–ãƒ«ã‚·ãƒ¥ãƒ¼ãƒ†ã‚£ãƒ³ã‚°**: `docs/04_ãƒ¬ãƒãƒ¼ãƒˆ/02_æŠ€è¡“çš„èª²é¡Œã¨è§£æ±ºç­–.md`

---

**æœ¬ä»•æ§˜æ›¸ã¯ã€å®Ÿè£…ãŒæå¤±ã—ãŸéš›ã«å®Œå…¨å¾©å…ƒã§ãã‚‹ã‚ˆã†ã«è¨˜è¿°ã•ã‚Œã¦ã„ã¾ã™ã€‚**
