# 01-04 CSVä»•æ§˜

**æ–‡æ›¸ç•ªå·**: 01-04  
**æœ€çµ‚æ›´æ–°**: 2025-11-04  
**ãƒãƒ¼ã‚¸ãƒ§ãƒ³**: 2.0  
**ã‚¹ãƒ†ãƒ¼ã‚¿ã‚¹**: æœ€æ–°

---

## ğŸ“‹ ç›®æ¬¡

1. [CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¦‚è¦](#csvãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¦‚è¦)
2. [ãƒ˜ãƒƒãƒ€ä»•æ§˜](#ãƒ˜ãƒƒãƒ€ä»•æ§˜)
3. [CSVç¨®é¡åˆ¥ä»•æ§˜](#csvç¨®é¡åˆ¥ä»•æ§˜)
4. [ãƒ‘ãƒ¼ã‚¹å‡¦ç†](#ãƒ‘ãƒ¼ã‚¹å‡¦ç†)
5. [é¸æŠè‚¢ç”Ÿæˆ](#é¸æŠè‚¢ç”Ÿæˆ)
6. [è¡¨ç¤ºé †åº](#è¡¨ç¤ºé †åº)

---

## ğŸ“„ CSVãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆæ¦‚è¦

### åŸºæœ¬ä»•æ§˜

| é …ç›® | ä»•æ§˜ |
|-----|------|
| **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°** | UTF-8 |
| **åˆ—æ•°** | 7åˆ—å›ºå®š |
| **ãƒ˜ãƒƒãƒ€è¡Œ** | å¿…é ˆï¼ˆ1è¡Œç›®ï¼‰ |
| **ãƒ‡ãƒ¼ã‚¿è¡Œ** | 2è¡Œç›®ä»¥é™ |
| **åŒºåˆ‡ã‚Šæ–‡å­—** | ã‚«ãƒ³ãƒ (`,`) |
| **è¤‡æ•°å€¤ã®åŒºåˆ‡ã‚Š** | ã‚»ãƒŸã‚³ãƒ­ãƒ³ (`;`) |

### ãƒ•ã‚¡ã‚¤ãƒ«æ§‹é€ 

```
ãƒ˜ãƒƒãƒ€è¡Œï¼ˆ1è¡Œç›®ï¼‰
ãƒ‡ãƒ¼ã‚¿è¡Œï¼ˆ2è¡Œç›®ä»¥é™ï¼‰
```

**ä¾‹**:
```csv
èªå¥,èª­ã¿ï¼ˆã²ã‚‰ãŒãªï¼‰,æ„å‘³,èªæºç­‰è§£èª¬,é–¢é€£èªã¨æ„å‘³,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
ã‚ã¯ã‚Œ,ã‚ã¯ã‚Œ,ã—ã¿ã˜ã¿ã¨ã—ãŸæƒ…è¶£,æ„Ÿå‹•è©ã‹ã‚‰,ã‚‚ã®ã®ã‚ã¯ã‚Œ,æ–‡å­¦,2
```

---

## ğŸ“‘ ãƒ˜ãƒƒãƒ€ä»•æ§˜

### ãƒ˜ãƒƒãƒ€é§†å‹•å‹ãƒ‘ãƒ¼ã‚¹

SimpleWordã¯**ãƒ˜ãƒƒãƒ€é§†å‹•å‹ãƒ‘ãƒ¼ã‚¹**ã‚’æ¡ç”¨ã—ã¦ã„ã¾ã™ã€‚ã“ã‚Œã«ã‚ˆã‚Šã€CSVã®ãƒ˜ãƒƒãƒ€ã‚’èª­ã¿å–ã£ã¦å‹•çš„ã«ãƒ©ãƒ™ãƒ«ã‚’æ±ºå®šã—ã¾ã™ã€‚

### åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°

å„åˆ—ã¯ä»¥ä¸‹ã®**ã‚­ãƒ¼**ã«ãƒãƒƒãƒ”ãƒ³ã‚°ã•ã‚Œã¾ã™ï¼š

| åˆ—ä½ç½® | ã‚­ãƒ¼ | ç”¨é€” |
|-------|------|------|
| 1åˆ—ç›® | `term` | èªå¥ãƒ»å¹´å· |
| 2åˆ—ç›® | `reading` | èª­ã¿ãƒ»ç™ºéŸ³ãƒ»ç™»å ´äººç‰© |
| 3åˆ—ç›® | `meaning` | æ„å‘³ãƒ»å’Œè¨³ãƒ»å²å®Ÿå |
| 4åˆ—ç›® | `etymology` | èªæºç­‰è§£èª¬ãƒ»è§£èª¬ |
| 5åˆ—ç›® | `relatedWords` | é–¢é€£èªãƒ»é–¢é€£å²å®Ÿ |
| 6åˆ—ç›® | `relatedFields` | é–¢é€£åˆ†é‡ |
| 7åˆ—ç›® | `difficulty` | é›£æ˜“åº¦ |

### ãƒ˜ãƒƒãƒ€æ¤œå‡ºãƒ­ã‚¸ãƒƒã‚¯

**å®Ÿè£…å ´æ‰€**: `Common/Data/DataSource/CSVDataSource.swift`

```swift
private func detectHeaders(in csvContent: String) -> [String: String] {
    // 1è¡Œç›®ã‚’ãƒ˜ãƒƒãƒ€ã¨ã—ã¦èª­ã¿å–ã‚Š
    // å„åˆ—ã‚’å¯¾å¿œã™ã‚‹ã‚­ãƒ¼ã«ãƒãƒƒãƒ”ãƒ³ã‚°
}
```

**ãƒãƒƒãƒ”ãƒ³ã‚°ä¾‹**:
- ã€Œèªå¥ã€â†’ `term`
- ã€Œèª­ã¿ï¼ˆã²ã‚‰ãŒãªï¼‰ã€â†’ `reading`
- ã€Œæ„å‘³ã€â†’ `meaning`

---

## ğŸ“š CSVç¨®é¡åˆ¥ä»•æ§˜

### 1. ä¸­å­¦æ­´å²

**ãƒ˜ãƒƒãƒ€**:
```csv
å¹´å·,ç™»å ´äººç‰©,å²å®Ÿå,è§£èª¬,é–¢é€£å²å®Ÿ,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
```

**åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°**:
- `term`: å¹´å·ï¼ˆä¾‹: ã€Œ4ä¸–ç´€é ƒã€ï¼‰
- `reading`: ç™»å ´äººç‰©ï¼ˆä¾‹: ã€Œå¤§å’Œæœå»·ã®è±ªæ—ãŸã¡ã€ï¼‰
- `meaning`: å²å®Ÿåï¼ˆä¾‹: ã€Œå¤§å’Œæ”¿æ¨©ã®æˆç«‹ã€ï¼‰
- `etymology`: è§£èª¬ï¼ˆä¾‹: ã€Œå¼¥ç”Ÿæ™‚ä»£å¾ŒæœŸã«...ã€ï¼‰
- `relatedWords`: é–¢é€£å²å®Ÿï¼ˆä¾‹: ã€Œå¤å¢³æ–‡åŒ–ã€ï¼‰
- `relatedFields`: é–¢é€£åˆ†é‡ï¼ˆä¾‹: ã€Œæ”¿æ²»ã€ï¼‰
- `difficulty`: é›£æ˜“åº¦ï¼ˆä¾‹: ã€Œ2ã€ï¼‰

**ãƒ‡ãƒ¼ã‚¿ä¾‹**:
```csv
å¹´å·,ç™»å ´äººç‰©,å²å®Ÿå,è§£èª¬,é–¢é€£å²å®Ÿ,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
4ä¸–ç´€é ƒ,å¤§å’Œæœå»·ã®è±ªæ—ãŸã¡,å¤§å’Œæ”¿æ¨©ã®æˆç«‹,å¼¥ç”Ÿæ™‚ä»£å¾ŒæœŸã«å„åœ°ã®è±ªæ—ãŒåŠ›ã‚’æŒã¤ã‚ˆã†ã«ãªã‚‹,å¤å¢³æ–‡åŒ–;å¾‹ä»¤ä»¥å‰ã®çµ±åˆéç¨‹,ãã®ä»–,2
```

### 2. ä¸­å­¦å¤å…¸å˜èª

**ãƒ˜ãƒƒãƒ€**:
```csv
èªå¥,èª­ã¿ï¼ˆã²ã‚‰ãŒãªï¼‰,æ„å‘³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªã¨æ„å‘³,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
```

**åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°**:
- `term`: èªå¥ï¼ˆä¾‹: ã€Œã‚ã¯ã‚Œã€ï¼‰
- `reading`: èª­ã¿ï¼ˆä¾‹: ã€Œã‚ã¯ã‚Œã€ï¼‰
- `meaning`: æ„å‘³ï¼ˆä¾‹: ã€Œã—ã¿ã˜ã¿ã¨ã—ãŸæƒ…è¶£ã€ï¼‰
- `etymology`: èªæºç­‰è§£èª¬ï¼ˆä¾‹: ã€Œæ„Ÿå‹•è©ã€Œã‚ã¯ã‚Œã€ã‹ã‚‰ã€ï¼‰
- `relatedWords`: é–¢é€£èªã¨æ„å‘³ï¼ˆä¾‹: ã€Œã‚‚ã®ã®ã‚ã¯ã‚Œã€ï¼‰
- `relatedFields`: é–¢é€£åˆ†é‡ï¼ˆä¾‹: ã€Œæ–‡å­¦ãƒ»ç¾å­¦ã€ï¼‰
- `difficulty`: é›£æ˜“åº¦ï¼ˆä¾‹: ã€Œ2ã€ï¼‰

**ãƒ‡ãƒ¼ã‚¿ä¾‹**:
```csv
èªå¥,èª­ã¿ï¼ˆã²ã‚‰ãŒãªï¼‰,æ„å‘³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªã¨æ„å‘³,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
ã‚ã¯ã‚Œ,ã‚ã¯ã‚Œ,ã—ã¿ã˜ã¿ã¨ã—ãŸæƒ…è¶£,æ„Ÿå‹•è©ã€Œã‚ã¯ã‚Œã€ã‹ã‚‰,ã€Œã‚‚ã®ã®ã‚ã¯ã‚Œã€,æ–‡å­¦ãƒ»ç¾å­¦,2
```

### 3. ä¸­å­¦è‹±å˜èªãƒ»è‹±ç†Ÿèª

**ãƒ˜ãƒƒãƒ€**:
```csv
èªå¥,ç™ºéŸ³ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰,å’Œè¨³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªï¼ˆè‹±èªï¼‰ã¨æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£åˆ†é‡ï¼ˆæ—¥æœ¬èªï¼‰,é›£æ˜“åº¦
```

**åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°**:
- `term`: èªå¥ï¼ˆä¾‹: ã€Œappleã€ï¼‰
- `reading`: ç™ºéŸ³ï¼ˆä¾‹: ã€Œã‚¢ãƒƒãƒ—ãƒ«ã€ï¼‰
- `meaning`: å’Œè¨³ï¼ˆä¾‹: ã€Œã‚Šã‚“ã”ã€ï¼‰
- `etymology`: èªæºç­‰è§£èª¬ï¼ˆä¾‹: ã€Œå¤è‹±èªÃ¦ppelã‹ã‚‰ã€ï¼‰
- `relatedWords`: é–¢é€£èªã¨æ„å‘³ï¼ˆä¾‹: ã€Œfruit / æœç‰©ã€ï¼‰
- `relatedFields`: é–¢é€£åˆ†é‡ï¼ˆä¾‹: ã€Œé£Ÿã¹ç‰©ã€ï¼‰
- `difficulty`: é›£æ˜“åº¦ï¼ˆä¾‹: ã€Œ1ã€ï¼‰

**ãƒ‡ãƒ¼ã‚¿ä¾‹**:
```csv
èªå¥,ç™ºéŸ³ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰,å’Œè¨³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªï¼ˆè‹±èªï¼‰ã¨æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£åˆ†é‡ï¼ˆæ—¥æœ¬èªï¼‰,é›£æ˜“åº¦
apple,ã‚¢ãƒƒãƒ—ãƒ«,ã‚Šã‚“ã”,å¤è‹±èªÃ¦ppelã‹ã‚‰,fruit / æœç‰©,é£Ÿã¹ç‰©,1
```

### 4. ä¸­å­¦è‹±ä¼šè©±

**ãƒ˜ãƒƒãƒ€**:
```csv
èªå¥,ç™ºéŸ³ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰,å’Œè¨³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªï¼ˆè‹±èªï¼‰ã¨æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£åˆ†é‡ï¼ˆæ—¥æœ¬èªï¼‰,é›£æ˜“åº¦
```

**åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°**: è‹±å˜èªã¨åŒã˜

**ãƒ‡ãƒ¼ã‚¿ä¾‹**:
```csv
èªå¥,ç™ºéŸ³ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰,å’Œè¨³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªï¼ˆè‹±èªï¼‰ã¨æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£åˆ†é‡ï¼ˆæ—¥æœ¬èªï¼‰,é›£æ˜“åº¦
Hello!,ãƒãƒ­ãƒ¼,ã“ã‚“ã«ã¡ã¯ï¼,å¤è‹±èªã®æŒ¨æ‹¶èª,Hi / ã‚„ã‚,æŒ¨æ‹¶,1
```

### 5. Xcodeï¼ˆãƒ—ãƒ­ã‚°ãƒ©ãƒŸãƒ³ã‚°ç”¨èªï¼‰

**ãƒ˜ãƒƒãƒ€**:
```csv
èªå¥,ç™ºéŸ³ï¼ˆã‚«ã‚¿ã‚«ãƒŠï¼‰,å’Œè¨³,èªæºç­‰è§£èª¬ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£èªï¼ˆè‹±èªï¼‰ã¨æ„å‘³ï¼ˆæ—¥æœ¬èªï¼‰,é–¢é€£åˆ†é‡ï¼ˆæ—¥æœ¬èªï¼‰,é›£æ˜“åº¦
```

**åˆ—ãƒãƒƒãƒ”ãƒ³ã‚°**: è‹±å˜èªã¨åŒã˜

---

## ğŸ” ãƒ‘ãƒ¼ã‚¹å‡¦ç†

### ãƒ‘ãƒ¼ã‚¹å‡¦ç†ã®æµã‚Œ

```
1. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
   â†“
2. ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ¤œè¨¼ï¼ˆUTF-8ï¼‰
   â†“
3. ãƒ˜ãƒƒãƒ€è¡Œã®è§£æ
   â†“
4. ãƒ˜ãƒƒãƒ€ãƒãƒƒãƒ”ãƒ³ã‚°ã®ä½œæˆ
   â†“
5. ãƒ‡ãƒ¼ã‚¿è¡Œã®ãƒ‘ãƒ¼ã‚¹
   â†“
6. QuestionItemãƒ¢ãƒ‡ãƒ«ã®ç”Ÿæˆ
```

### å®Ÿè£…å ´æ‰€

- **CSVDataSource**: `Common/Data/DataSource/CSVDataSource.swift`
- **QuestionItemCSVSchema**: `Common/Data/Schema/QuestionItemCSVSchema.swift`
- **CSVLoader**: `SimpleWord/Utils/CSVLoader.swift`

### ãƒ‘ãƒ¼ã‚¹é–¢æ•°

```swift
func load(from url: URL) async throws -> [QuestionItem] {
    // 1. ãƒ•ã‚¡ã‚¤ãƒ«èª­ã¿è¾¼ã¿
    let csvContent = try String(contentsOf: url, encoding: .utf8)
    
    // 2. ãƒ˜ãƒƒãƒ€æ¤œå‡º
    let headerLabels = detectHeaders(in: csvContent)
    
    // 3. ãƒ‡ãƒ¼ã‚¿è¡Œã®ãƒ‘ãƒ¼ã‚¹
    let rows = parseCSV(csvContent)
    
    // 4. QuestionItemã®ç”Ÿæˆ
    return rows.compactMap { row in
        parseRow(row, headers: headerLabels)
    }
}
```

---

## ğŸ¯ é¸æŠè‚¢ç”Ÿæˆ

### é¸æŠè‚¢ã®ç”Ÿæˆå…ƒ

**é‡è¦**: é¸æŠè‚¢ã¯**CSVå›ºå®šåˆ—3ï¼ˆ`rawColumns[2]`ï¼šæ„å‘³/å’Œè¨³/å²å®Ÿåï¼‰**ã‹ã‚‰ç”Ÿæˆã•ã‚Œã¾ã™ã€‚

**ç†ç”±**:
- ãƒ˜ãƒƒãƒ€é§†å‹•å‹ãƒ‘ãƒ¼ã‚µã®å½±éŸ¿ã‚’å—ã‘ãªã„
- å¸¸ã«æ­£ç¢ºãªé¸æŠè‚¢ãŒè¡¨ç¤ºã•ã‚Œã‚‹
- CSVç¨®é¡ã«é–¢ã‚ã‚‰ãšä¸€è²«ã—ãŸå‹•ä½œ

### å®Ÿè£…å ´æ‰€

`SimpleWord/Features/Quiz/Views/QuizView.swift`

```swift
private func generateChoices(
    for correctItem: QuestionItem,
    from allItems: [QuestionItem]
) -> [String] {
    // CSVå›ºå®šåˆ—3ã‹ã‚‰é¸æŠè‚¢ã‚’ç”Ÿæˆ
    let correctAnswer = correctItem.rawColumns.count > 2 
        ? correctItem.rawColumns[2] 
        : correctItem.meaning
    
    // ä»–ã®3ã¤ã®é¸æŠè‚¢ã‚‚å›ºå®šåˆ—3ã‹ã‚‰å–å¾—
    let wrongChoices = allItems
        .filter { $0.id != correctItem.id }
        .prefix(3)
        .map { $0.rawColumns.count > 2 ? $0.rawColumns[2] : $0.meaning }
    
    return ([correctAnswer] + wrongChoices).shuffled()
}
```

---

## ğŸ“Š è¡¨ç¤ºé †åº

### CSVç¨®é¡ã®è‡ªå‹•åˆ¤å®š

**å®Ÿè£…å ´æ‰€**: `SimpleWord/QuizComponents/ChoiceCardView.swift`

```swift
private enum CSVType {
    case history    // ä¸­å­¦æ­´å²
    case classical  // ä¸­å­¦å¤å…¸å˜èª
    case english    // ä¸­å­¦è‹±å˜èªãƒ»è‹±ä¼šè©±ãƒ»xcode
}

private func detectCSVType(from headerLabels: [String: String]) -> CSVType {
    let term = headerLabels["term"] ?? ""
    let reading = headerLabels["reading"] ?? ""
    let meaning = headerLabels["meaning"] ?? ""
    
    // ä¸­å­¦æ­´å²ã®åˆ¤å®š
    if term.contains("å¹´å·") && reading.contains("ç™»å ´äººç‰©") && meaning.contains("å²å®Ÿ") {
        return .history
    }
    
    // ä¸­å­¦å¤å…¸å˜èªã®åˆ¤å®š
    if reading.contains("ã²ã‚‰ãŒãª") {
        return .classical
    }
    
    // ä¸­å­¦è‹±å˜èªãƒ»è‹±ä¼šè©±ãƒ»xcodeã®åˆ¤å®š
    if reading.contains("ã‚«ã‚¿ã‚«ãƒŠ") || reading.contains("ç™ºéŸ³") || meaning.contains("å’Œè¨³") {
        return .english
    }
    
    return .english // ãƒ‡ãƒ•ã‚©ãƒ«ãƒˆ
}
```

### CSVç¨®é¡åˆ¥ã®è¡¨ç¤ºé †åº

#### ä¸­å­¦æ­´å²

**è¡¨ç¤ºé †åº**: å¹´å· â†’ å²å®Ÿåï¼ˆè¡¨ç¤ºæ¸ˆã¿ï¼‰ â†’ è§£èª¬ â†’ ç™»å ´äººç‰© â†’ é–¢é€£å²å®Ÿ â†’ é–¢é€£åˆ†é‡ & é›£æ˜“åº¦

#### ä¸­å­¦å¤å…¸å˜èª

**è¡¨ç¤ºé †åº**: èªå¥ â†’ ç™ºéŸ³ â†’ æ„å‘³ï¼ˆè¡¨ç¤ºæ¸ˆã¿ï¼‰ â†’ ç”¨æ³• â†’ é–¢é€£èª â†’ é–¢é€£åˆ†é‡ & é›£æ˜“åº¦

#### ä¸­å­¦è‹±å˜èªãƒ»è‹±ä¼šè©±ãƒ»xcode

**è¡¨ç¤ºé †åº**: èªå¥(ç™ºéŸ³) â†’ å’Œè¨³ï¼ˆè¡¨ç¤ºæ¸ˆã¿ï¼‰ â†’ èªæºç­‰è§£èª¬ â†’ é–¢é€£èªã¨æ„å‘³ â†’ é–¢é€£åˆ†é‡ & é›£æ˜“åº¦

**ç‰¹å¾´**: ç™ºéŸ³ã‚’èªå¥ã®ç›´å¾Œã«æ‹¬å¼§ä»˜ãã§è¡¨ç¤ºï¼ˆä¾‹: `Hello! (ãƒãƒ­ãƒ¼)`ï¼‰

---

## ğŸ”§ CSVä½œæˆã‚¬ã‚¤ãƒ‰ãƒ©ã‚¤ãƒ³

### å¿…é ˆè¦ä»¶

1. **ã‚¨ãƒ³ã‚³ãƒ¼ãƒ‡ã‚£ãƒ³ã‚°**: UTF-8ã§ä¿å­˜
2. **ãƒ˜ãƒƒãƒ€è¡Œ**: å¿…ãš1è¡Œç›®ã«é…ç½®
3. **åˆ—æ•°**: 7åˆ—å›ºå®š
4. **ãƒ‡ãƒ¼ã‚¿ã®æ•´åˆæ€§**: ã™ã¹ã¦ã®è¡ŒãŒ7åˆ—ã‚’æŒã¤

### æ¨å¥¨äº‹é …

1. **ã‚»ãƒŸã‚³ãƒ­ãƒ³åŒºåˆ‡ã‚Š**: é–¢é€£èªã€é–¢é€£åˆ†é‡ã¯`;`ã§åŒºåˆ‡ã‚‹
2. **ç©ºæ¬„ã®æ‰±ã„**: ãƒ‡ãƒ¼ã‚¿ãŒãªã„å ´åˆã¯ç©ºæ¬„ã®ã¾ã¾ï¼ˆå‰Šé™¤ã—ãªã„ï¼‰
3. **é›£æ˜“åº¦**: 1-5ã®æ•´æ•°å€¤ã‚’ä½¿ç”¨
4. **ä¸€è²«æ€§**: åŒã˜CSVå†…ã§ã¯åŒã˜ãƒ•ã‚©ãƒ¼ãƒãƒƒãƒˆã‚’ç¶­æŒ

### ä¾‹

**è‰¯ã„ä¾‹**:
```csv
èªå¥,èª­ã¿ï¼ˆã²ã‚‰ãŒãªï¼‰,æ„å‘³,èªæºç­‰è§£èª¬,é–¢é€£èªã¨æ„å‘³,é–¢é€£åˆ†é‡,é›£æ˜“åº¦
ã‚ã¯ã‚Œ,ã‚ã¯ã‚Œ,ã—ã¿ã˜ã¿ã¨ã—ãŸæƒ…è¶£,æ„Ÿå‹•è©ã‹ã‚‰,ã‚‚ã®ã®ã‚ã¯ã‚Œ,æ–‡å­¦,2
```

**æ‚ªã„ä¾‹**ï¼ˆåˆ—æ•°ãŒä¸è¶³ï¼‰:
```csv
èªå¥,èª­ã¿,æ„å‘³
ã‚ã¯ã‚Œ,ã‚ã¯ã‚Œ,ã—ã¿ã˜ã¿ã¨ã—ãŸæƒ…è¶£
```

---

## ï¿½ï¸ å®Ÿè£…è©³ç´°

### QuestionItemæ§‹é€ 

**å®Ÿè£…å ´æ‰€**: `Common/Models/QuestionItem.swift`

```swift
struct QuestionItem: Identifiable, Codable {
    let id: UUID
    let term: String              // èªå¥ãƒ»å¹´å·
    let reading: String           // èª­ã¿ãƒ»ç™ºéŸ³ãƒ»ç™»å ´äººç‰©
    let meaning: String           // æ„å‘³ãƒ»å’Œè¨³ãƒ»å²å®Ÿå
    let etymology: String         // èªæºç­‰è§£èª¬ãƒ»è§£èª¬
    let relatedWordsCSV: String   // é–¢é€£èªï¼ˆã‚»ãƒŸã‚³ãƒ­ãƒ³åŒºåˆ‡ã‚Šï¼‰
    let relatedFieldsCSV: String  // é–¢é€£åˆ†é‡ï¼ˆã‚»ãƒŸã‚³ãƒ­ãƒ³åŒºåˆ‡ã‚Šï¼‰
    let difficulty: String        // é›£æ˜“åº¦
    let rawColumns: [String]      // ç”Ÿã®CSVåˆ—ãƒ‡ãƒ¼ã‚¿ï¼ˆå›ºå®šåˆ—é †ï¼‰
    
    // è¨ˆç®—ãƒ—ãƒ­ãƒ‘ãƒ†ã‚£
    var relatedWords: [String] {
        relatedWordsCSV.split(separator: ";").map(String.init)
    }
    
    var relatedFields: [String] {
        relatedFieldsCSV.split(separator: ";").map(String.init)
    }
}
```

### CSVDataSourceå®Ÿè£…

**å®Ÿè£…å ´æ‰€**: `Common/Data/DataSource/CSVDataSource.swift`

#### 1. ãƒ˜ãƒƒãƒ€é§†å‹•å‹ãƒ¢ãƒ¼ãƒ‰

```swift
/// ãƒ˜ãƒƒãƒ€é§†å‹•å‹ã‚¤ãƒ‹ã‚·ãƒ£ãƒ©ã‚¤ã‚¶
public init(
    fileName: String,
    headerDrivenParser: @escaping (Int, [String], [String: Int]) throws -> T?
) {
    self.fileName = fileName
    self.columnCount = nil  // ãƒ˜ãƒƒãƒ€é§†å‹•å‹ã§ã¯åˆ—æ•°ãƒã‚§ãƒƒã‚¯ãªã—
    self.headerDrivenParser = headerDrivenParser
}
```

#### 2. ãƒ˜ãƒƒãƒ€ãƒãƒƒãƒ”ãƒ³ã‚°æ§‹ç¯‰

```swift
private func buildColumnMapping(_ headers: [String]) -> [String: Int] {
    var mapping: [String: Int] = [:]
    
    for (index, header) in headers.enumerated() {
        let normalized = header.lowercased()
            .replacingOccurrences(of: " ", with: "")
            .replacingOccurrences(of: "ï¼ˆ", with: "")
            .replacingOccurrences(of: "ï¼‰", with: "")
        
        // ã‚ˆã‚Šå…·ä½“çš„ãªãƒ˜ãƒƒãƒ€ã‚’å„ªå…ˆçš„ã«è©•ä¾¡
        if normalized.contains("å²å®Ÿå") { mapping["meaning"] = index }
        else if normalized.contains("å’Œè¨³") { mapping["meaning"] = index }
        else if normalized.contains("æ„å‘³") { mapping["meaning"] = index }
        else if normalized.contains("å²å®Ÿ") { mapping["meaning"] = index }
        
        if normalized.contains("å¹´å·") { mapping["term"] = index }
        else if normalized.contains("èªå¥") { mapping["term"] = index }
        
        if normalized.contains("ç™»å ´äººç‰©") { mapping["reading"] = index }
        else if normalized.contains("ç™ºéŸ³") { mapping["reading"] = index }
        else if normalized.contains("èª­ã¿") { mapping["reading"] = index }
        
        if normalized.contains("è§£èª¬") { mapping["etymology"] = index }
        else if normalized.contains("èªæº") { mapping["etymology"] = index }
        
        if normalized.contains("é–¢é€£å²å®Ÿ") { mapping["relatedWords"] = index }
        else if normalized.contains("é–¢é€£èª") { mapping["relatedWords"] = index }
        
        if normalized.contains("é–¢é€£åˆ†é‡") { mapping["relatedFields"] = index }
        if normalized.contains("é›£æ˜“åº¦") { mapping["difficulty"] = index }
    }
    
    return mapping
}
```

### QuestionItemParserå®Ÿè£…

**å®Ÿè£…å ´æ‰€**: `Common/Data/Parcer/QuestionItemParser.swift`

#### å›ºå®šåˆ—é †ãƒ‘ãƒ¼ã‚µ

```swift
public static func makeParser() -> CSVLineParser<QuestionItem> {
    CSVLineParser { lineNumber, columns in
        guard columns.count == 7 else {
            throw DataSourceError.invalidData(
                "è¡Œ\(lineNumber): åˆ—æ•°ä¸æ­£ï¼ˆæœŸå¾…: 7, å®Ÿéš›: \(columns.count)ï¼‰"
            )
        }
        
        return QuestionItem(
            term: columns[0],
            reading: columns[1],
            meaning: columns[2],
            etymology: columns[3],
            relatedWordsCSV: columns[4],
            relatedFieldsCSV: columns[5],
            difficulty: columns[6],
            rawColumns: columns,  // ç”Ÿã®CSVåˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            id: UUID()
        )
    }
}
```

#### ãƒ˜ãƒƒãƒ€é§†å‹•å‹ãƒ‘ãƒ¼ã‚µ

```swift
public static func makeHeaderDrivenParser() -> (Int, [String], [String: Int]) throws -> QuestionItem {
    return { lineNumber, columns, mapping in
        // å„ãƒ•ã‚£ãƒ¼ãƒ«ãƒ‰ã‚’å–å¾—ï¼ˆå­˜åœ¨ã—ãªã„å ´åˆã¯ç©ºæ–‡å­—åˆ—ï¼‰
        let term = mapping["term"].flatMap { columns[safe: $0] } ?? ""
        let reading = mapping["reading"].flatMap { columns[safe: $0] } ?? ""
        let meaning = mapping["meaning"].flatMap { columns[safe: $0] } ?? ""
        let etymology = mapping["etymology"].flatMap { columns[safe: $0] } ?? ""
        let relatedWordsCSV = mapping["relatedWords"].flatMap { columns[safe: $0] } ?? ""
        let relatedFieldsCSV = mapping["relatedFields"].flatMap { columns[safe: $0] } ?? ""
        let difficulty = mapping["difficulty"].flatMap { columns[safe: $0] } ?? ""
        
        return QuestionItem(
            term: term,
            reading: reading,
            meaning: meaning,
            etymology: etymology,
            relatedWordsCSV: relatedWordsCSV,
            relatedFieldsCSV: relatedFieldsCSV,
            difficulty: difficulty,
            rawColumns: columns,  // ç”Ÿã®CSVåˆ—ãƒ‡ãƒ¼ã‚¿ã‚’ä¿å­˜
            id: UUID()
        )
    }
}
```

---

## ğŸ§ª ãƒ†ã‚¹ãƒˆæˆ¦ç•¥

### ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ

**å®Ÿè£…å ´æ‰€**: `SimpleWordTests/CSVFixedColumnChoiceGenerationTests.swift`

```swift
class CSVFixedColumnChoiceGenerationTests: XCTestCase {
    func testGenerateChoicesFromEnglishConversationCSV() throws {
        // Given: ä¸­å­¦è‹±ä¼šè©±CSVã‚’èª­ã¿è¾¼ã‚€
        let items = try loader.loadFromBundle(named: "ä¸­å­¦è‹±ä¼šè©±")
        
        // When: æœ€åˆã®ã‚¢ã‚¤ãƒ†ãƒ ã§é¸æŠè‚¢ã‚’ç”Ÿæˆ
        let correctItem = items[0]
        let choices = generator.generateChoices(
            for: correctItem,
            from: items,
            count: 4
        )
        
        // Then: å›ºå®šåˆ—3ã‹ã‚‰é¸æŠè‚¢ãŒç”Ÿæˆã•ã‚Œã¦ã„ã‚‹
        XCTAssertEqual(choices.count, 4)
        XCTAssertTrue(choices.contains(correctItem.rawColumns[2]))
    }
}
```

### çµ±åˆãƒ†ã‚¹ãƒˆ

```swift
func testCSVLoadingAndChoiceGeneration() throws {
    // 1. CSVãƒ­ãƒ¼ãƒ‰
    let items = try CSVLoader().loadFromBundle(named: "ä¸­å­¦è‹±ä¼šè©±")
    XCTAssertFalse(items.isEmpty)
    
    // 2. rawColumnsãŒä¿å­˜ã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    XCTAssertEqual(items[0].rawColumns.count, 7)
    
    // 3. é¸æŠè‚¢ç”Ÿæˆ
    let generator = QuizQuestionGenerator()
    let choices = generator.generateChoices(for: items[0], from: items, count: 4)
    
    // 4. é¸æŠè‚¢ãŒå›ºå®šåˆ—3ã‹ã‚‰ç”Ÿæˆã•ã‚Œã¦ã„ã‚‹ã‹ç¢ºèª
    XCTAssertTrue(choices.contains(items[0].rawColumns[2]))
}
```

---

## ï¿½ğŸ“š é–¢é€£ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ

- **å‰ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `01-03_é©å¿œå‹å­¦ç¿’ã‚·ã‚¹ãƒ†ãƒ ä»•æ§˜.md`
- **æ¬¡ã®ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ**: `01-05_ã‚¯ã‚¤ã‚ºæ©Ÿèƒ½ä»•æ§˜.md`ï¼ˆä½œæˆäºˆå®šï¼‰
- **å®Ÿè£…è©³ç´°**: `docs/99_ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–/CSV_HEADER_DRIVEN_IMPLEMENTATION_REPORT.md`
- **é¸æŠè‚¢ç”Ÿæˆ**: `docs/99_ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–/CSV_FIXED_COLUMN_CHOICE_GENERATION_REPORT.md`
- **è¡¨ç¤ºé †åº**: `docs/99_ã‚¢ãƒ¼ã‚«ã‚¤ãƒ–/CHOICE_CARD_DISPLAY_ORDER_FIX_REPORT.md`

---

**æ–‡æ›¸å±¥æ­´**:
- 2025-11-05: å®Ÿè£…è©³ç´°ã¨ãƒ†ã‚¹ãƒˆæˆ¦ç•¥ã‚’è¿½åŠ 
- 2025-11-04: åˆç‰ˆä½œæˆã€CSVä»•æ§˜ã‚’çµ±åˆ
- 2025-10-27: CSVãƒ˜ãƒƒãƒ€æ›´æ–°å¯¾å¿œ

**ç®¡ç†è€…**: SimpleWordé–‹ç™ºãƒãƒ¼ãƒ 
