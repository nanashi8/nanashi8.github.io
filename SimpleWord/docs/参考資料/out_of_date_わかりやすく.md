# プッシュが「out of date」と言われたとき（小中学生にもわかる説明）

この文書は、Gitで「push（プッシュ）したら "out of date" と言われて拒否された」理由を、やさしく説明します。

- 対象: Xcodeやターミナルで開発している人
- 目的: なぜプッシュが拒否されるのかを理解して、安全に直せるようになること

---

## 1) まず、ちょっとした例え話

あなたと友だちが同じノート（これを「リポジトリ」と呼びます）に絵を描いているとします。あなたが机で新しい絵（変更）を描いて、友だちに見せたいので渡そうとしたら、友だちのノートにあなたが見ていない新しい絵がすでに貼られていた、という状態です。

- あなたのページ: 1ページ目に絵Aを書いた
- 友だちのページ（リモート）: 1ページ目に絵Bを書いて、先に貼った

あなたが自分の絵Aを貼ろうとすると、"あれ？こっち（リモート）には別の絵Bがあるよ" とGitが言います。これが「out of date（古くなっている）」の意味です。

---

## 2) 技術的に何が起きているの？（かんたんに）

- Gitでは「コミット」という単位で変更を保存します（ノートに貼った1枚がコミット）。
- あなたが `git push` をすると、ローカル（あなたのPC）の最新コミットをリモート（GitHubなど）に送ります。
- でも、リモートにあなたより新しいコミットがあったら、Gitは「そのまま上書きしたら困るかもしれないから拒否するよ」と言って、push を止めます。これが「out of date」や "failed to push" の正体です。

理由の具体例:
- 別の人がリモートに新しい変更をプッシュした
- あなたが別のマシンで作業していてそこからプッシュされた
- CI（自動ツール）が自動でコミット/更新した
- あなたが以前にコミットを直して（ amend や rebase などで）コミットIDが変わり、リモートの履歴と差ができた

---

## 3) 図で見ると（とても簡単）

- リモート: A --- B  （最新は B）
- あなた:    A --- C  （ローカルの最新は C）

このとき `git push` をすると、リモートには B の先に C をつなげるか、あるいはどちらを優先するかの判断が必要になります。だからそのままは送れません。

---

## 4) どう直せばいいの？（安全でよく使う方法）

ここでは「自分のローカルの変更を残したままリモートの最新を取り込んでからプッシュする」手順を説明します。ターミナルでのコマンド例を示します。

1) リモートの最新を取得する（fetch）

```bash
git fetch origin
```

2) 自分のブランチ（たとえば `main`）に持ってくる

安全な方法A（推奨: 履歴をきれいに保つ）―― rebase を使う:

```bash
# 自分の作業ブランチにいることを確認
git checkout main

# リモートの main を基準に、自分のコミットをその先に付け替える
git rebase origin/main
```

もしコンフリクト（衝突）が出たら：
- 変更されたファイルをエディタで開き、どちらを残すか手で直す
- 直したら `git add <ファイル>` を実行
- その後、`git rebase --continue` を実行
- やめたいときは `git rebase --abort` で元に戻せます

安全な方法B（簡単）―― merge を使う（マージコミットが残る）:

```bash
git checkout main
git merge origin/main
```

3) 再度 push する

```bash
git push origin main
```

これでリモートにあなたの変更が反映されるはずです。

---

## 5) `git pull --rebase` と `git pull` の違い（とても簡単）

- `git pull` は `fetch` の後に自動で `merge` します（マージの履歴が残る）
- `git pull --rebase` は `fetch` の後に `rebase` します（履歴を直線にしてきれいに保つ）

チームで「履歴はきれいに保とう」という話があるなら `--rebase` を使うことが多いです。

---

## 6) 注意点（大事）

- rebase は「履歴を書き換える」操作です。もしそのコミットをすでに他の人と共有（push）している場合、rebase すると相手が困ることがあります。だから「公開済みのブランチ（main など）」で勝手に rebase しないこと。
- どうしても履歴を書き換える必要があるときは、`git push --force-with-lease` を使います。これはちょっと安全な強制上書きですが、念のためチームに伝えてから実行しましょう。

```bash
# 安全な強制プッシュ
git push --force-with-lease origin main
```

- もし操作が不安なら、まずは `git fetch` と `git status` を実行して、何が起きているか確認しましょう。

---

## 7) よくある「自分はXcodeでしか作業していないのに…」というケースの説明

- 可能性1: 別の誰か（チームメンバー）がその間にプッシュした
- 可能性2: ほかのPCやCIがリポジトリを更新した
- 可能性3: あなたが以前に `git commit --amend` や `git rebase` をしてコミットIDが変わった（XcodeのGUIでやっていることが裏でこれに当たることもあります）

どの場合でも、リモートとローカルの履歴が一致していないと push は拒否されます。

---

## 8) まとめ（小学生向け超短縮版）

1. 「out of date」はリモートにあなたが持っていない新しい変更がある合図
2. 直し方は「リモートの最新を取り込んで、自分の変更とまとめる」こと
3. 安全には `git fetch` → `git rebase origin/ブランチ` → `git push` を使う（チームルールに合わせる）

---

## 9) 参考コマンド一覧（よく使うもの）

```bash
# リモートの最新を取得
git fetch origin

# リベースで取り込む（推奨）
git checkout main
git rebase origin/main

# 解決後に続ける
git add <file>
git rebase --continue

# やめたいとき
git rebase --abort

# マージで取り込む（マージコミットが作られる）
git checkout main
git merge origin/main

# 通常のプッシュ
git push origin main

# 履歴を書き換えた後にどうしても上書きしたいとき（要注意）
git push --force-with-lease origin main
```

---

このドキュメントは `SimpleWord/docs/参考資料/` に保存されています。操作に不安があれば、ここに書いてある手順を試す前にチームに確認してください。

作業でわからないことがあれば、どのコマンドを実行したか教えてください。状況に合わせて次の安全なコマンドを一緒に作ります。