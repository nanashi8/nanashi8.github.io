# GitHub Copilot 動作の仕組み - 学習ガイド

**最終更新**: 2025年10月30日  
**対象読者**: AI 開発アシスタントの仕組みを理解したい開発者  
**学習時間**: 20分

---

## 📋 このガイドについて

GitHub Copilot（や類似のAI開発アシスタント）がどのように動作し、どのようにコードを生成するのかを、分かりやすく解説します。

**このガイドで学べること**:
- Copilot がコードを生成する仕組み
- 効果的なプロンプトの書き方
- コンテキスト管理のベストプラクティス
- SimpleWord プロジェクトでの実践例

---

## 🎯 学習目標

1. ✅ Copilot の基本的な動作原理を理解する
2. ✅ コンテキストウィンドウの概念を理解する
3. ✅ 効果的なプロンプトを書けるようになる
4. ✅ プロジェクト固有の指示を設定できるようになる

---

## 📖 第1章: Copilot の基本動作

### 1.1 Copilot とは

**GitHub Copilot** は、OpenAI の大規模言語モデル (LLM) を使用した AI プログラミングアシスタントです。

**主な機能**:
- コードの自動補完
- コメントからのコード生成
- コードの説明・ドキュメント生成
- バグ修正の提案
- リファクタリングの支援

### 1.2 動作の流れ

```
┌─────────────────────────────────────────┐
│ 1. 入力: あなたがコードやコメントを書く  │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│ 2. コンテキスト収集:                     │
│    - 現在のファイル                      │
│    - 開いている他のファイル              │
│    - プロジェクト設定                    │
│    - Copilot Instructions                │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│ 3. AI モデルに送信:                      │
│    - コンテキストと入力を組み合わせる    │
│    - OpenAI API に送信                   │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│ 4. 生成: AI がコードを生成               │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│ 5. 提案: エディタに提案を表示            │
└─────────────────────────────────────────┘
                  ↓
┌─────────────────────────────────────────┐
│ 6. 選択: あなたが提案を受け入れるか決定  │
└─────────────────────────────────────────┘
```

---

## 📖 第2章: コンテキストウィンドウ

### 2.1 コンテキストとは

**コンテキスト** = AI がコードを生成するために参照する情報

Copilot は以下の情報を自動的に収集します：

1. **現在のファイル**
   - カーソル位置の前後のコード
   - ファイル全体の構造

2. **開いている他のファイル**
   - 最近編集したファイル
   - 関連性の高いファイル

3. **プロジェクト設定**
   - `.github/copilot-instructions.md`
   - Workspace settings

4. **言語・フレームワーク情報**
   - ファイル拡張子から推測
   - import/include 文から推測

### 2.2 コンテキストウィンドウのサイズ

**制限**: 約8,000〜32,000トークン（モデルによる）
- 1トークン ≈ 4文字（英語の場合）
- 実質的には数千行程度のコード

**重要**: すべてのファイルを読むわけではない
→ 効果的にコンテキストを提供することが重要

### 2.3 コンテキストの優先順位

Copilot は以下の優先順位でコンテキストを収集します：

1. **カーソル位置周辺**（最高優先度）
2. **同じファイル内**
3. **最近開いたファイル**
4. **関連性の高いファイル**（import先など）
5. **プロジェクト設定ファイル**

---

## 📖 第3章: 効果的なプロンプトの書き方

### 3.1 基本原則

**明確さ > 簡潔さ**

❌ **悪い例**:
```swift
// 処理を追加
```

✅ **良い例**:
```swift
// CSVファイルから単語データを読み込み、
// フィルタリングして、ランダムにシャッフルする処理を追加
```

### 3.2 具体的なプロンプトのテンプレート

#### パターン1: 新規関数の作成

```swift
/// ユーザーの正答率を計算する
/// - Parameters:
///   - correctCount: 正解数
///   - totalCount: 総問題数
/// - Returns: 正答率（0.0〜1.0）
/// - Note: 総問題数が0の場合は0.0を返す
func calculateAccuracy(correctCount: Int, totalCount: Int) -> Double {
    // Copilot がここで実装を提案
}
```

#### パターン2: クラスの作成

```swift
/// クイズのバッチ学習を管理するサービス
/// 
/// 責務:
/// - 出題する問題のバッチを生成
/// - 繰り返し学習のための問題配置
/// - バッチサイズの管理
///
/// 使用例:
/// ```
/// let manager = QuizBatchManager()
/// let batch = manager.prepareBatch(from: items, batchSize: 10)
/// ```
struct QuizBatchManager {
    // Copilot がメソッドを提案
}
```

#### パターン3: 修正・リファクタリング

```swift
// TODO: この関数を以下の要件でリファクタリング
// - エラーハンドリングを追加（Result型を使用）
// - 非同期処理に対応（async/await）
// - ログ出力を追加
func loadData() {
    // 既存のコード
}
```

### 3.3 日本語 vs 英語

**結論**: どちらでもOK、プロジェクトに合わせる

SimpleWord プロジェクトでは**日本語コメント**を推奨：
- コードの意図が明確
- 日本人開発者の理解が容易
- Copilot は日本語も理解できる

```swift
// ✅ 推奨（SimpleWordプロジェクト）
// バッチサイズを超えないように問題を選択する

// ⚠️ 可（他のプロジェクト）
// Select questions without exceeding batch size
```

---

## 📖 第4章: プロジェクト固有の設定

### 4.1 Copilot Instructions

`.github/copilot-instructions.md` ファイルで、プロジェクト固有の指示を設定できます。

**SimpleWord の例**:

```markdown
# SimpleWord プロジェクト固有指示

## 技術スタック
- Swift 専用（Objective-C は使用しない)
- SwiftUI + Combine
- Xcode プロジェクト

## アーキテクチャ
- Feature-First / Vertical Slice Architecture を採用
- 各 Feature は `Features/` 配下に配置
- View と ViewModel は責務を分離し、別ファイルで管理

## 命名規則
- View: `〇〇View.swift`
- ViewModel: `〇〇ViewModel.swift`
- Model: `〇〇Model.swift`

## コーディング規約
- インデントはスペース4つ
- 日本語コメントで意図を補足
- 責務分離を徹底
```

### 4.2 Workspace Settings

`.vscode/settings.json` で、エディタレベルの設定も可能：

```json
{
  "github.copilot.enable": {
    "*": true,
    "markdown": true,
    "swift": true
  },
  "github.copilot.advanced": {
    "debug.overrideEngine": "gpt-4"
  }
}
```

---

## 📖 第5章: SimpleWord での実践例

### 5.1 実例1: サービスクラスの生成

**プロンプト**:
```swift
// Features/Quiz/Services/QuizDataLoader.swift

/// CSVファイルからクイズデータを読み込むサービス
/// 
/// 責務:
/// - ResourcesフォルダまたはドキュメントフォルダからCSVを読み込む
/// - ヘッダー行を解析してカラム情報を取得
/// - 分野・難易度でフィルタリング
/// - ランダムソートまたは順序維持
///
/// エラーハンドリング:
/// - ファイルが見つからない場合
/// - CSV形式が不正な場合
/// - 列数が一致しない場合
struct QuizDataLoader {
```

**結果**: Copilot が完全な実装を提案

### 5.2 実例2: 状態管理の実装

**プロンプト**:
```swift
/// クイズセッションの状態を管理するストア
/// 
/// 管理する状態:
/// - csvName: 現在の問題集名
/// - batchSize: バッチサイズ
/// - totalQuestions: 総問題数
/// - score: 累積正解数
/// - questionCount: 累積出題数
/// - batchCorrect: バッチ内正解数
///
/// 永続化:
/// - UserDefaultsに保存
/// - アプリ再起動時に復元可能
class QuizSessionStore: ObservableObject {
```

**結果**: 完全な Store 実装を提案

### 5.3 実例3: UI コンポーネント

**プロンプト**:
```swift
/// 正答率を表示するビュー
///
/// 表示内容:
/// - パーセンテージ（小数点1桁）
/// - プログレスバー
/// - 色: 80%以上は緑、50-80%は黄色、50%未満は赤
///
/// アニメーション:
/// - 値が変わる時にスムーズに遷移
struct AccuracyDisplayView: View {
    let accuracy: Double // 0.0 ~ 1.0
```

**結果**: SwiftUI ビューの実装を提案

---

## 📖 第6章: ベストプラクティス

### 6.1 コンテキストを整理する

**開きすぎない**:
- 関連するファイルだけを開く
- 不要なファイルは閉じる

**関連ファイルを開く**:
- モデル定義のファイル
- 依存するサービスのファイル

### 6.2 段階的に進める

**大きなタスクは分割**:

❌ **悪い例**:
```
// クイズ機能全体を実装してください
```

✅ **良い例**:
```
// Step 1: データロード部分を実装してください
// Step 2: バッチ管理を実装してください
// Step 3: 選択肢生成を実装してください
```

### 6.3 生成されたコードを必ず確認

**盲目的に受け入れない**:
- ロジックが正しいか確認
- エッジケースを考慮しているか確認
- パフォーマンスは問題ないか確認

---

## 📖 第7章: トラブルシューティング

### 7.1 提案が不適切

**原因**: コンテキスト不足

**解決策**:
1. より詳細なコメントを書く
2. 関連ファイルを開く
3. `.github/copilot-instructions.md` を充実させる

### 7.2 提案が出ない

**原因**: コンテキストが曖昧

**解決策**:
1. カーソル位置を確認
2. 具体的なコメントを追加
3. 既存のコードパターンを参考にする

### 7.3 生成されたコードが動かない

**原因**: AI の幻覚（存在しない API の使用など）

**解決策**:
1. エラーメッセージを確認
2. ドキュメントで API を確認
3. 修正を依頼

---

## 📚 まとめ

### 重要ポイント

1. ✅ Copilot はコンテキストベースでコードを生成
2. ✅ 明確で具体的なプロンプトが効果的
3. ✅ プロジェクト固有の設定で精度向上
4. ✅ 段階的に進めて確認を怠らない
5. ✅ 生成されたコードは必ずレビュー

### Copilot を最大限活用するために

1. **詳細なコメントを書く**
2. **プロジェクト設定を整備する**
3. **関連ファイルを開く**
4. **小さく始めて段階的に進める**
5. **常にコードをレビューする**

---

## 📖 参考資料

- **[GitHub Copilot Documentation](https://docs.github.com/copilot)** - 公式ドキュメント
- **[クイックスタートガイド](../クイックスタートガイド_新版.md)** - プロジェクトの基本
- **[AIとのやり取り_クイックリファレンス](../AIとのやり取り_クイックリファレンス.md)** - 実践的なプロンプト集

---

**これで Copilot の基本は完璧です！** 🎉  
実際に使いながら、自分なりの効果的な使い方を見つけていきましょう。
