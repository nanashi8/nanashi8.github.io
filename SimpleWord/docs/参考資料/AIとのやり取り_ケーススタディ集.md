# AI とのやり取り - ケーススタディ集

**実際の問題解決プロセスを学ぶ**

このドキュメントでは、実際のやり取りを「改善前」「改善後」で比較し、
効果的なコミュニケーション方法を学びます。

---

## ケース 1: UI 表示順序の不具合

### ❌ 改善前（時間: 15分）

**ユーザー**:
「登場人物が解説になってませんか？」

**AI の作業**:
1. CSV ファイルの構造確認 ✓
2. CSVDataSource のヘッダマッピング確認 ✓
3. QuestionItemParser のデータパース確認 ✓
4. QuizView のヘッダラベルマップ確認 ✓
5. ChoiceCardView の表示ロジック確認 ✓ ← ここに問題があった

**問題点**:
- データの流れを上流から下流まで全て確認
- 5つのファイルを順に調査
- 最後にやっと原因を特定

---

### ✅ 改善後（時間: 3分）

**ユーザー**:
「中学歴史で、回答後の選択肢カードの表示順序が CSV と違います。

**CSV の列順**:
```
年号,登場人物,史実名,解説,関連史実,関連分野,難易度
```

**UI の表示順**:
```
1. 年号
2. 史実名
3. 解説
4. 登場人物
```

2番目と3番目の位置が違います。
ChoiceCardView.swift の displayHistoryDetails() だと思います。」

**AI の作業**:
1. ChoiceCardView.swift の該当関数を確認 ✓
2. 表示順序を修正 ✓

**改善点**:
- **事実ベース**: 「CSV の列順」と「UI の表示順」を明記
- **差分明確**: 何が違うかを具体的に指摘
- **ファイル特定**: 該当ファイルを推測で提示
- **結果**: 調査時間を 80% 削減（15分 → 3分）

---

## ケース 2: パフォーマンス問題

### ❌ 改善前（時間: 20分）

**ユーザー**:
「CSV の読み込みが遅いです。」

**AI の反応**:
「どのCSVですか？どれくらい遅いですか？デバイスは何ですか？」

**ユーザー**:
「中学英単語です。結構遅いです。iPhone です。」

**AI の反応**:
「何秒くらいですか？他の CSV では？」

（質疑応答が続く...）

**問題点**:
- 情報が不足しているため、質問のキャッチボールが続く
- 具体的な数値がないため、最適化の目標が不明確
- 再現条件が曖昧

---

### ✅ 改善後（時間: 5分）

**ユーザー**:
「CSV 読み込みのパフォーマンス問題

**症状**: QuizView 表示時に CSV 読み込みで待たされる

**測定結果**:
- 中学英単語（2000行）: 約5秒
- 中学歴史（500行）: 約1秒
- サンプル単語（100行）: 瞬時

**環境**:
- デバイス: iPhone 12
- iOS: 17.0
- ビルド: Debug

**期待**: 2000行でも1秒以内で読み込み

**推測**: CSVDataSource.swift のパース処理が O(n²) になっている可能性」

**AI の作業**:
1. 測定データから O(n²) を確認
2. CSVDataSource.swift のボトルネック特定
3. 最適化案を提示
4. 実装

**改善点**:
- **定量データ**: 複数のCSVで測定した数値
- **環境情報**: デバイス、iOS バージョン
- **目標明確**: 「1秒以内」という具体的な目標
- **仮説提示**: 原因の推測
- **結果**: 即座に原因特定と修正が可能

---

## ケース 3: 新機能追加

### ❌ 改善前（時間: 30分 + 何度も修正）

**ユーザー**:
「エクスポート機能が欲しいです。」

**AI の反応**:
「何をエクスポートしますか？」

**ユーザー**:
「学習結果です。」

**AI の反応**:
「どのフォーマットですか？どこに出力しますか？」

（質疑応答が続く...）

**AI の実装**:
```swift
// 推測で実装したが...
func exportResults() {
    // JSON 形式で出力
    // ファイルに保存
}
```

**ユーザー**:
「CSV が良かったです。共有シートで送りたいです。」

**問題点**:
- 仕様が曖昧なため、推測で実装
- ユーザーの期待と異なる実装になり、修正が必要
- 合計時間が増加

---

### ✅ 改善後（時間: 10分、一発OK）

**ユーザー**:
「新機能: 学習履歴のエクスポート

**目的**:
- 学習記録をバックアップしたい
- Excel で分析したい

**詳細な仕様**:

**入力**:
- 「学習結果」画面に「エクスポート」ボタンを追加
- タップで共有シートを表示

**処理**:
- ScoreStore の全履歴を CSV 形式に変換
- フォーマット: `日時,CSV名,総問題数,正解数,正答率,学習モード`
- 文字コード: UTF-8

**出力**:
- ファイル名: `SimpleWord学習履歴_YYYYMMDD.csv`
- 共有シート経由で AirDrop、Files、メール等で送信可能

**参考**:
- FileUtils.swift に CSV 書き出しメソッドあり
- QuizResult 構造体が履歴データを保持

**優先度**: 中（あると便利）」

**AI の作業**:
1. 仕様通りに実装
2. ScoreStore に export メソッド追加
3. ScoreView にエクスポートボタン追加
4. 共有シート実装
5. テスト

**改善点**:
- **仕様詳細**: 入力→処理→出力の流れを明確化
- **フォーマット指定**: CSV の列構成を明記
- **参考情報**: 既存コードを提示
- **優先度**: 実装の緊急度を明示
- **結果**: 一度の実装で要件を満たし、修正不要

---

## ケース 4: 機能削除

### ❌ 改善前（時間: 10分 + 削除漏れ）

**ユーザー**:
「NavigatorView を削除してください。」

**AI の作業**:
1. NavigatorView.swift を削除
2. 完了報告

**後日...**

**ユーザー**:
「ビルドエラーが出ます。ContentView で NavigatorView が見つからないと...」

**問題点**:
- 依存関係の確認不足
- 削除漏れが発生
- 追加作業が必要

---

### ✅ 改善後（時間: 5分、完全削除）

**ユーザー**:
「機能削除: NavigatorView

**削除対象**:
- SimpleWord/Views/NavigatorView.swift
- 関連する import、@EnvironmentObject

**理由**:
- 現在使用されていない（QuizView から直接出題する方式に変更済み）
- コード保守コストの削減

**依存関係**:
- ContentView.swift のナビゲーションリンク（削除必要）
- CSVManagerView からの参照（あれば削除）

**代替機能**:
- 単語確認は「学習結果」画面から可能
- 直接編集は「問題集管理」から可能

**確認事項**:
- ビルドエラーがないことを確認
- 削除漏れファイルのリスト作成」

**AI の作業**:
1. NavigatorView.swift の使用箇所を検索
2. ContentView.swift から NavigationLink を削除
3. 関連 import を削除
4. ビルドエラーチェック
5. 削除ファイルリスト作成
6. 完全削除を確認

**改善点**:
- **依存関係明示**: 削除すべき関連コードを事前にリスト化
- **代替機能提示**: 削除後の代替手段を明確化
- **確認項目**: ビルドエラーチェックを依頼
- **結果**: 一度の作業で完全に削除、追加作業不要

---

## ケース 5: リファクタリング

### ❌ 改善前（時間: 1時間 + 手戻り）

**ユーザー**:
「QuizSettings を綺麗にしてください。」

**AI の実装**:
```swift
// 推測で実装
struct QuizSettings {
    var general: GeneralSettings
    var display: DisplaySettings
    // ...
}
```

**ユーザー**:
「UI設定、バッチ設定、フィルタ設定で分けたかったです。」

**問題点**:
- 「綺麗に」が曖昧
- 分割方針が共有されていない
- 手戻りが発生

---

### ✅ 改善後（時間: 30分、一発OK）

**ユーザー**:
「リファクタリング: QuizSettings の分割

**現在の問題**:
- プロパティが20個以上（多すぎる）
- UI設定、バッチ設定、フィルタ設定が混在
- 新規プロパティ追加時に全体への影響が大きい

**分割方針**:

```swift
// 1. UI設定
struct QuizUISettings: Codable {
    var numberOfChoices: Int
    var isTimerEnabled: Bool
    var timeLimit: Int
    var isRandomOrder: Bool
    var isSpeechEnabled: Bool
    var appearance: String
}

// 2. バッチ設定
struct QuizBatchSettings: Codable {
    var questionsPerBatch: Int
    var repeatCount: Int
    var successThreshold: Double
    var autoAdvance: Bool
}

// 3. フィルタ設定
struct QuizFilterSettings: Codable {
    var selectedCSV: String?
    var selectedFields: [String]
    var difficulties: [String]
    var learningMode: LearningMode
}

// 統合モデル
struct QuizSettingsModel: Codable {
    var ui: QuizUISettings
    var batch: QuizBatchSettings
    var filter: QuizFilterSettings
}
```

**移行方針**:
- UserDefaults の保存形式は維持（後方互換性）
- マイグレーション処理で古い形式を新形式に変換
- 既存の computed properties で互換性を保つ

**影響範囲**:
- QuizSettings.swift（構造変更）
- QuizSettingsView.swift（アクセス方法変更: `quizSettings.ui.numberOfChoices`）
- QuizView.swift（設定参照を変更）

**期待するメリット**:
- 責務が明確になる
- テストしやすくなる
- 変更の影響範囲が限定される」

**AI の作業**:
1. 提案通りに3つの構造体を作成
2. QuizSettingsModel に統合
3. マイグレーション処理を実装
4. 既存コードを段階的に移行
5. テスト実施

**改善点**:
- **具体的な構造**: コードで分割方針を明示
- **移行方針**: 後方互換性とマイグレーション
- **影響範囲**: 変更が必要なファイルをリスト化
- **メリット明示**: なぜリファクタリングするのか
- **結果**: 設計意図が共有され、一度の実装で完了

---

## 📊 効果の比較

| ケース | 改善前 | 改善後 | 削減率 |
|--------|--------|--------|--------|
| UI 表示順序 | 15分 | 3分 | 80% |
| パフォーマンス | 20分 | 5分 | 75% |
| 新機能追加 | 30分+ | 10分 | 67% |
| 機能削除 | 10分+ | 5分 | 50% |
| リファクタリング | 60分+ | 30分 | 50% |

**平均削減率**: 約 64%

---

## 💡 成功パターンの共通点

### 1. 事実ベース
- 推測や感覚ではなく、具体的な事実を記載
- 数値、コード、画面内容など

### 2. 期待と実際の対比
- 「こうあるべき」と「実際はこう」を並べる
- 差分が明確になる

### 3. コンテキスト提供
- 環境情報（デバイス、iOS バージョン）
- 該当ファイル（推測でも可）
- 関連する他の動作

### 4. 具体的な仕様
- 曖昧な表現を避ける
- 入力→処理→出力の流れで記載

### 5. 影響範囲の認識
- 依存関係を意識
- 変更が及ぶファイルをリスト化

---

## 🎯 次のステップ

1. このケーススタディを読む
2. 自分の問題を「改善後」の形式で書いてみる
3. AI に送信して結果を確認
4. 効果を実感する

---

## 🔗 関連ドキュメント

- `効率的なやり取りテンプレート集.md` - 詳細なテンプレート
- `AIとのやり取り_クイックリファレンス.md` - 簡易版

---

**作成日**: 2025年10月28日  
**最終更新**: 2025年10月28日
