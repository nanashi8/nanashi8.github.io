#!/bin/bash
# ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‘½åè¦å‰‡ãƒã‚§ãƒƒã‚¯
# å‚ç…§: docs/guidelines/DOCUMENT_NAMING_CONVENTION.md

RED='\033[0;31m'
YELLOW='\033[1;33m'
GREEN='\033[0;32m'
NC='\033[0m' # No Color

echo "ğŸ“ ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆå‘½åè¦å‰‡ãƒã‚§ãƒƒã‚¯ä¸­..."

errors=0
warnings=0

# æ–°è¦è¿½åŠ ãƒ»å¤‰æ›´ã•ã‚ŒãŸdocsé…ä¸‹ã®Markdownãƒ•ã‚¡ã‚¤ãƒ«ã‚’å–å¾—
changed_docs=$(git diff --cached --name-only --diff-filter=A | grep "^docs/.*\.md$" | grep -v "docs/archive")

if [ -z "$changed_docs" ]; then
  echo "âœ… ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆãƒ•ã‚¡ã‚¤ãƒ«ã®å¤‰æ›´ãªã—"
  exit 0
fi

for file in $changed_docs; do
  dir=$(dirname "$file")
  base=$(basename "$file")

  # README.mdã¨INDEX.mdã¯é™¤å¤–
  if [[ "$base" == "README.md" ]] || [[ "$base" == "INDEX.md" ]]; then
    continue
  fi

  # ãƒ‡ã‚£ãƒ¬ã‚¯ãƒˆãƒªåˆ¥ãƒã‚§ãƒƒã‚¯
  case "$dir" in
    docs/specifications)
      # ç•ªå·ä»˜ãkebab-case ã¾ãŸã¯ UPPER_SNAKE_CASEï¼ˆæ—§ä»•æ§˜æ›¸ï¼‰
      if ! [[ "$base" =~ ^[0-9]{2}-[a-z0-9-]+\.md$ ]] && ! [[ "$base" =~ ^[A-Z_]+\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   specifications/ ã¯ 'ç•ªå·-kebab-case.md' ã¾ãŸã¯ 'UPPER_SNAKE_CASE.md' ã«ã—ã¦ãã ã•ã„"
        echo "   ä¾‹: 01-project-overview.md ã¾ãŸã¯ ADAPTIVE_NETWORK_API_SPECIFICATION.md"
        errors=$((errors + 1))
      fi
      ;;

    docs/guidelines|docs/guidelines/*)
      # UPPER_SNAKE_CASE
      if ! [[ "$base" =~ ^[A-Z][A-Z0-9_]*\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   guidelines/ ã¯ 'UPPER_SNAKE_CASE.md' ã«ã—ã¦ãã ã•ã„"
        echo "   ä¾‹: META_AI_TROUBLESHOOTING.md"
        errors=$((errors + 1))
      fi
      ;;

    docs/references)
      # UPPER_SNAKE_CASE
      if ! [[ "$base" =~ ^[A-Z][A-Z0-9_]*\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   references/ ã¯ 'UPPER_SNAKE_CASE.md' ã«ã—ã¦ãã ã•ã„"
        echo "   ä¾‹: QUICK_REFERENCE.md"
        errors=$((errors + 1))
      fi
      ;;

    docs/development)
      # kebab-case ã¾ãŸã¯ UPPER_SNAKE_CASE
      if ! [[ "$base" =~ ^[a-z][a-z0-9-]*\.md$ ]] && ! [[ "$base" =~ ^[A-Z][A-Z0-9_]*\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   development/ ã¯ 'kebab-case.md' ã¾ãŸã¯ 'UPPER_SNAKE_CASE.md' ã«ã—ã¦ãã ã•ã„"
        echo "   ä¾‹: setup.md ã¾ãŸã¯ TYPESCRIPT_DEVELOPMENT_GUIDELINES.md"
        errors=$((errors + 1))
      fi
      ;;

    docs/plans|docs/reports|docs/quality|docs/how-to|docs/processes|docs/maintenance)
      # UPPER_SNAKE_CASE (ã‚ªãƒ—ã‚·ãƒ§ãƒŠãƒ«ãªæ—¥ä»˜ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹)
      if ! [[ "$base" =~ ^[A-Z][A-Z0-9_]*(_[0-9]{4}-[0-9]{2}-[0-9]{2})?\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   ${dir#docs/}/ ã¯ 'UPPER_SNAKE_CASE.md' ã«ã—ã¦ãã ã•ã„ï¼ˆæ—¥ä»˜ã‚µãƒ•ã‚£ãƒƒã‚¯ã‚¹å¯ï¼‰"
        echo "   ä¾‹: LINK_FIX_PLAN.md ã¾ãŸã¯ ADAPTIVE_AI_INTEGRATION_PLAN_2025-12-17.md"
        errors=$((errors + 1))
      fi
      ;;

    docs/features)
      # kebab-case
      if ! [[ "$base" =~ ^[a-z][a-z0-9-]*\.md$ ]]; then
        echo -e "${RED}âŒ $file${NC}"
        echo "   features/ ã¯ 'kebab-case.md' ã«ã—ã¦ãã ã•ã„"
        echo "   ä¾‹: random-skip-feature.md"
        errors=$((errors + 1))
      fi
      ;;

    docs)
      # docsç›´ä¸‹ã¯åŸºæœ¬çš„ã«UPPER_SNAKE_CASE
      if ! [[ "$base" =~ ^[A-Z][A-Z0-9_]*\.md$ ]]; then
        echo -e "${YELLOW}âš ï¸  $file${NC}"
        echo "   docsç›´ä¸‹ã¯é€šå¸¸ 'UPPER_SNAKE_CASE.md' ã‚’æ¨å¥¨"
        warnings=$((warnings + 1))
      fi
      ;;
  esac
done

echo ""
if [ $errors -gt 0 ]; then
  echo -e "${RED}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo -e "${RED}âŒ å‘½åè¦å‰‡é•å: ${errors}ä»¶${NC}"
  echo -e "${RED}â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”${NC}"
  echo ""
  echo "ğŸ“– å‘½åè¦å‰‡ã®è©³ç´°: docs/guidelines/DOCUMENT_NAMING_CONVENTION.md"
  echo ""
  exit 1
fi

if [ $warnings -gt 0 ]; then
  echo -e "${YELLOW}âš ï¸  è­¦å‘Š: ${warnings}ä»¶ï¼ˆã‚³ãƒŸãƒƒãƒˆã¯å¯èƒ½ï¼‰${NC}"
fi

echo -e "${GREEN}âœ… å‘½åè¦å‰‡ãƒã‚§ãƒƒã‚¯å®Œäº†${NC}"
exit 0
