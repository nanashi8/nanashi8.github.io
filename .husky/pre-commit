#!/bin/sh

echo "🔍 Pre-commit チェック開始..."

# 1. ステージされたファイルのみをチェック
echo "📝 変更ファイルを確認中..."

# 2. ESLintチェック（TypeScript/TSXファイルのみ）
if git diff --cached --name-only | grep -E '\.(tsx?|jsx?)$' > /dev/null; then
  echo "🔎 ESLintチェック実行中..."
  npm run lint || {
    echo "⚠️  ESLintエラーが検出されました"
    echo "💡 警告: ESLintエラーがありますが、コミットは継続されます"
    echo "💡 修正するには: npm run lint を実行してください"
    # ESLintエラーは警告のみ（exit しない）
  }
fi

# 3. TypeScript型チェック
echo "🔍 TypeScript型チェック実行中..."
npm run typecheck || {
  echo "⚠️  TypeScript型エラーが検出されました"
  echo "💡 警告: 型エラーがありますが、コミットは継続されます"
  # 型エラーは警告のみ（exit しない）
}

# 4. CSSチェック（CSSファイルが変更されている場合）
if git diff --cached --name-only | grep '\.css$' > /dev/null; then
  echo "🎨 CSSチェック実行中..."
  npm run lint:css || {
    echo "❌ CSSエラーが検出されました"
    echo "💡 npm run lint:css:fix で自動修正できます"
    exit 1
  }
fi

# 5. ビルドチェック（重要なファイルが変更されている場合）
if git diff --cached --name-only | grep -E '\.(tsx?|jsx?|css)$' > /dev/null; then
  echo "🏗️  ビルドチェック実行中..."
  npm run build > /dev/null 2>&1 || {
    echo "❌ ビルドに失敗しました"
    echo "💡 npm run build でエラー内容を確認してください"
    exit 1
  }
  echo "✅ ビルド成功"
fi

echo "✨ すべてのチェックが完了しました！"
